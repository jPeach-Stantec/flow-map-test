function sC(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var g4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $y(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oC={exports:{}},fn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ep=Symbol.for("react.element"),y4=Symbol.for("react.portal"),_4=Symbol.for("react.fragment"),v4=Symbol.for("react.strict_mode"),x4=Symbol.for("react.profiler"),b4=Symbol.for("react.provider"),w4=Symbol.for("react.context"),E4=Symbol.for("react.forward_ref"),T4=Symbol.for("react.suspense"),S4=Symbol.for("react.memo"),P4=Symbol.for("react.lazy"),SE=Symbol.iterator;function A4(t){return t===null||typeof t!="object"?null:(t=SE&&t[SE]||t["@@iterator"],typeof t=="function"?t:null)}var aC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lC=Object.assign,cC={};function Mh(t,e,n){this.props=t,this.context=e,this.refs=cC,this.updater=n||aC}Mh.prototype.isReactComponent={};Mh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Mh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function uC(){}uC.prototype=Mh.prototype;function J1(t,e,n){this.props=t,this.context=e,this.refs=cC,this.updater=n||aC}var Q1=J1.prototype=new uC;Q1.constructor=J1;lC(Q1,Mh.prototype);Q1.isPureReactComponent=!0;var PE=Array.isArray,hC=Object.prototype.hasOwnProperty,eb={current:null},dC={key:!0,ref:!0,__self:!0,__source:!0};function fC(t,e,n){var r,i={},a=null,h=null;if(e!=null)for(r in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(a=""+e.key),e)hC.call(e,r)&&!dC.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){for(var m=Array(l),v=0;v<l;v++)m[v]=arguments[v+2];i.children=m}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:ep,type:t,key:a,ref:h,props:i,_owner:eb.current}}function C4(t,e){return{$$typeof:ep,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function tb(t){return typeof t=="object"&&t!==null&&t.$$typeof===ep}function I4(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var AE=/\/+/g;function Y_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?I4(""+t.key):e.toString(36)}function pg(t,e,n,r,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var h=!1;if(t===null)h=!0;else switch(a){case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case ep:case y4:h=!0}}if(h)return h=t,i=i(h),t=r===""?"."+Y_(h,0):r,PE(i)?(n="",t!=null&&(n=t.replace(AE,"$&/")+"/"),pg(i,e,n,"",function(v){return v})):i!=null&&(tb(i)&&(i=C4(i,n+(!i.key||h&&h.key===i.key?"":(""+i.key).replace(AE,"$&/")+"/")+t)),e.push(i)),1;if(h=0,r=r===""?".":r+":",PE(t))for(var l=0;l<t.length;l++){a=t[l];var m=r+Y_(a,l);h+=pg(a,e,n,m,i)}else if(m=A4(t),typeof m=="function")for(t=m.call(t),l=0;!(a=t.next()).done;)a=a.value,m=r+Y_(a,l++),h+=pg(a,e,n,m,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function Sm(t,e,n){if(t==null)return t;var r=[],i=0;return pg(t,r,"","",function(a){return e.call(n,a,i++)}),r}function M4(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Xi={current:null},mg={transition:null},k4={ReactCurrentDispatcher:Xi,ReactCurrentBatchConfig:mg,ReactCurrentOwner:eb};fn.Children={map:Sm,forEach:function(t,e,n){Sm(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Sm(t,function(){e++}),e},toArray:function(t){return Sm(t,function(e){return e})||[]},only:function(t){if(!tb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};fn.Component=Mh;fn.Fragment=_4;fn.Profiler=x4;fn.PureComponent=J1;fn.StrictMode=v4;fn.Suspense=T4;fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k4;fn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=lC({},t.props),i=t.key,a=t.ref,h=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,h=eb.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(m in e)hC.call(e,m)&&!dC.hasOwnProperty(m)&&(r[m]=e[m]===void 0&&l!==void 0?l[m]:e[m])}var m=arguments.length-2;if(m===1)r.children=n;else if(1<m){l=Array(m);for(var v=0;v<m;v++)l[v]=arguments[v+2];r.children=l}return{$$typeof:ep,type:t.type,key:i,ref:a,props:r,_owner:h}};fn.createContext=function(t){return t={$$typeof:w4,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:b4,_context:t},t.Consumer=t};fn.createElement=fC;fn.createFactory=function(t){var e=fC.bind(null,t);return e.type=t,e};fn.createRef=function(){return{current:null}};fn.forwardRef=function(t){return{$$typeof:E4,render:t}};fn.isValidElement=tb;fn.lazy=function(t){return{$$typeof:P4,_payload:{_status:-1,_result:t},_init:M4}};fn.memo=function(t,e){return{$$typeof:S4,type:t,compare:e===void 0?null:e}};fn.startTransition=function(t){var e=mg.transition;mg.transition={};try{t()}finally{mg.transition=e}};fn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};fn.useCallback=function(t,e){return Xi.current.useCallback(t,e)};fn.useContext=function(t){return Xi.current.useContext(t)};fn.useDebugValue=function(){};fn.useDeferredValue=function(t){return Xi.current.useDeferredValue(t)};fn.useEffect=function(t,e){return Xi.current.useEffect(t,e)};fn.useId=function(){return Xi.current.useId()};fn.useImperativeHandle=function(t,e,n){return Xi.current.useImperativeHandle(t,e,n)};fn.useInsertionEffect=function(t,e){return Xi.current.useInsertionEffect(t,e)};fn.useLayoutEffect=function(t,e){return Xi.current.useLayoutEffect(t,e)};fn.useMemo=function(t,e){return Xi.current.useMemo(t,e)};fn.useReducer=function(t,e,n){return Xi.current.useReducer(t,e,n)};fn.useRef=function(t){return Xi.current.useRef(t)};fn.useState=function(t){return Xi.current.useState(t)};fn.useSyncExternalStore=function(t,e,n){return Xi.current.useSyncExternalStore(t,e,n)};fn.useTransition=function(){return Xi.current.useTransition()};fn.version="18.2.0";oC.exports=fn;var Pe=oC.exports;const Hi=$y(Pe),CE=sC({__proto__:null,default:Hi},[Pe]);var pC={exports:{}},Os={},mC={exports:{}},gC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(We,Qe){var Tt=We.length;We.push(Qe);e:for(;0<Tt;){var tn=Tt-1>>>1,Xt=We[tn];if(0<i(Xt,Qe))We[tn]=Qe,We[Tt]=Xt,Tt=tn;else break e}}function n(We){return We.length===0?null:We[0]}function r(We){if(We.length===0)return null;var Qe=We[0],Tt=We.pop();if(Tt!==Qe){We[0]=Tt;e:for(var tn=0,Xt=We.length,An=Xt>>>1;tn<An;){var xn=2*(tn+1)-1,zn=We[xn],Dn=xn+1,ln=We[Dn];if(0>i(zn,Tt))Dn<Xt&&0>i(ln,zn)?(We[tn]=ln,We[Dn]=Tt,tn=Dn):(We[tn]=zn,We[xn]=Tt,tn=xn);else if(Dn<Xt&&0>i(ln,Tt))We[tn]=ln,We[Dn]=Tt,tn=Dn;else break e}}return Qe}function i(We,Qe){var Tt=We.sortIndex-Qe.sortIndex;return Tt!==0?Tt:We.id-Qe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var h=Date,l=h.now();t.unstable_now=function(){return h.now()-l}}var m=[],v=[],E=1,T=null,S=3,z=!1,D=!1,F=!1,J=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(We){for(var Qe=n(v);Qe!==null;){if(Qe.callback===null)r(v);else if(Qe.startTime<=We)r(v),Qe.sortIndex=Qe.expirationTime,e(m,Qe);else break;Qe=n(v)}}function ee(We){if(F=!1,G(We),!D)if(n(m)!==null)D=!0,Je(se);else{var Qe=n(v);Qe!==null&&en(ee,Qe.startTime-We)}}function se(We,Qe){D=!1,F&&(F=!1,U(Me),Me=-1),z=!0;var Tt=S;try{for(G(Qe),T=n(m);T!==null&&(!(T.expirationTime>Qe)||We&&!Oe());){var tn=T.callback;if(typeof tn=="function"){T.callback=null,S=T.priorityLevel;var Xt=tn(T.expirationTime<=Qe);Qe=t.unstable_now(),typeof Xt=="function"?T.callback=Xt:T===n(m)&&r(m),G(Qe)}else r(m);T=n(m)}if(T!==null)var An=!0;else{var xn=n(v);xn!==null&&en(ee,xn.startTime-Qe),An=!1}return An}finally{T=null,S=Tt,z=!1}}var me=!1,ve=null,Me=-1,Be=5,ze=-1;function Oe(){return!(t.unstable_now()-ze<Be)}function tt(){if(ve!==null){var We=t.unstable_now();ze=We;var Qe=!0;try{Qe=ve(!0,We)}finally{Qe?et():(me=!1,ve=null)}}else me=!1}var et;if(typeof V=="function")et=function(){V(tt)};else if(typeof MessageChannel<"u"){var st=new MessageChannel,Bt=st.port2;st.port1.onmessage=tt,et=function(){Bt.postMessage(null)}}else et=function(){J(tt,0)};function Je(We){ve=We,me||(me=!0,et())}function en(We,Qe){Me=J(function(){We(t.unstable_now())},Qe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(We){We.callback=null},t.unstable_continueExecution=function(){D||z||(D=!0,Je(se))},t.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Be=0<We?Math.floor(1e3/We):5},t.unstable_getCurrentPriorityLevel=function(){return S},t.unstable_getFirstCallbackNode=function(){return n(m)},t.unstable_next=function(We){switch(S){case 1:case 2:case 3:var Qe=3;break;default:Qe=S}var Tt=S;S=Qe;try{return We()}finally{S=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(We,Qe){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var Tt=S;S=We;try{return Qe()}finally{S=Tt}},t.unstable_scheduleCallback=function(We,Qe,Tt){var tn=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?tn+Tt:tn):Tt=tn,We){case 1:var Xt=-1;break;case 2:Xt=250;break;case 5:Xt=1073741823;break;case 4:Xt=1e4;break;default:Xt=5e3}return Xt=Tt+Xt,We={id:E++,callback:Qe,priorityLevel:We,startTime:Tt,expirationTime:Xt,sortIndex:-1},Tt>tn?(We.sortIndex=Tt,e(v,We),n(m)===null&&We===n(v)&&(F?(U(Me),Me=-1):F=!0,en(ee,Tt-tn))):(We.sortIndex=Xt,e(m,We),D||z||(D=!0,Je(se))),We},t.unstable_shouldYield=Oe,t.unstable_wrapCallback=function(We){var Qe=S;return function(){var Tt=S;S=Qe;try{return We.apply(this,arguments)}finally{S=Tt}}}})(gC);mC.exports=gC;var L4=mC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yC=Pe,zs=L4;function Xe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _C=new Set,xf={};function Vc(t,e){lh(t,e),lh(t+"Capture",e)}function lh(t,e){for(xf[t]=e,t=0;t<e.length;t++)_C.add(e[t])}var Ta=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mx=Object.prototype.hasOwnProperty,R4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,IE={},ME={};function z4(t){return mx.call(ME,t)?!0:mx.call(IE,t)?!1:R4.test(t)?ME[t]=!0:(IE[t]=!0,!1)}function D4(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function O4(t,e,n,r){if(e===null||typeof e>"u"||D4(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Yi(t,e,n,r,i,a,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=h}var _i={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){_i[t]=new Yi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];_i[e]=new Yi(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){_i[t]=new Yi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){_i[t]=new Yi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){_i[t]=new Yi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){_i[t]=new Yi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){_i[t]=new Yi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){_i[t]=new Yi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){_i[t]=new Yi(t,5,!1,t.toLowerCase(),null,!1,!1)});var nb=/[\-:]([a-z])/g;function rb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(nb,rb);_i[e]=new Yi(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(nb,rb);_i[e]=new Yi(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(nb,rb);_i[e]=new Yi(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){_i[t]=new Yi(t,1,!1,t.toLowerCase(),null,!1,!1)});_i.xlinkHref=new Yi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){_i[t]=new Yi(t,1,!1,t.toLowerCase(),null,!0,!0)});function ib(t,e,n,r){var i=_i.hasOwnProperty(e)?_i[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(O4(e,n,i,r)&&(n=null),r||i===null?z4(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ka=yC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pm=Symbol.for("react.element"),Du=Symbol.for("react.portal"),Ou=Symbol.for("react.fragment"),sb=Symbol.for("react.strict_mode"),gx=Symbol.for("react.profiler"),vC=Symbol.for("react.provider"),xC=Symbol.for("react.context"),ob=Symbol.for("react.forward_ref"),yx=Symbol.for("react.suspense"),_x=Symbol.for("react.suspense_list"),ab=Symbol.for("react.memo"),ul=Symbol.for("react.lazy"),bC=Symbol.for("react.offscreen"),kE=Symbol.iterator;function Ad(t){return t===null||typeof t!="object"?null:(t=kE&&t[kE]||t["@@iterator"],typeof t=="function"?t:null)}var Er=Object.assign,K_;function Zd(t){if(K_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);K_=e&&e[1]||""}return`
`+K_+t}var J_=!1;function Q_(t,e){if(!t||J_)return"";J_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(v){var r=v}Reflect.construct(t,[],e)}else{try{e.call()}catch(v){r=v}t.call(e.prototype)}else{try{throw Error()}catch(v){r=v}t()}}catch(v){if(v&&r&&typeof v.stack=="string"){for(var i=v.stack.split(`
`),a=r.stack.split(`
`),h=i.length-1,l=a.length-1;1<=h&&0<=l&&i[h]!==a[l];)l--;for(;1<=h&&0<=l;h--,l--)if(i[h]!==a[l]){if(h!==1||l!==1)do if(h--,l--,0>l||i[h]!==a[l]){var m=`
`+i[h].replace(" at new "," at ");return t.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",t.displayName)),m}while(1<=h&&0<=l);break}}}finally{J_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Zd(t):""}function F4(t){switch(t.tag){case 5:return Zd(t.type);case 16:return Zd("Lazy");case 13:return Zd("Suspense");case 19:return Zd("SuspenseList");case 0:case 2:case 15:return t=Q_(t.type,!1),t;case 11:return t=Q_(t.type.render,!1),t;case 1:return t=Q_(t.type,!0),t;default:return""}}function vx(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ou:return"Fragment";case Du:return"Portal";case gx:return"Profiler";case sb:return"StrictMode";case yx:return"Suspense";case _x:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case xC:return(t.displayName||"Context")+".Consumer";case vC:return(t._context.displayName||"Context")+".Provider";case ob:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ab:return e=t.displayName||null,e!==null?e:vx(t.type)||"Memo";case ul:e=t._payload,t=t._init;try{return vx(t(e))}catch{}}return null}function B4(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vx(e);case 8:return e===sb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ml(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function wC(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function N4(t){var e=wC(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(h){r=""+h,a.call(this,h)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(h){r=""+h},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Am(t){t._valueTracker||(t._valueTracker=N4(t))}function EC(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=wC(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function jg(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function xx(t,e){var n=e.checked;return Er({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function LE(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ml(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function TC(t,e){e=e.checked,e!=null&&ib(t,"checked",e,!1)}function bx(t,e){TC(t,e);var n=Ml(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?wx(t,e.type,n):e.hasOwnProperty("defaultValue")&&wx(t,e.type,Ml(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function RE(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function wx(t,e,n){(e!=="number"||jg(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Xd=Array.isArray;function Yu(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ml(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Ex(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return Er({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function zE(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Xe(92));if(Xd(n)){if(1<n.length)throw Error(Xe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ml(n)}}function SC(t,e){var n=Ml(e.value),r=Ml(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function DE(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function PC(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Tx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?PC(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Cm,AC=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Cm=Cm||document.createElement("div"),Cm.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Cm.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function bf(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var rf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},U4=["Webkit","ms","Moz","O"];Object.keys(rf).forEach(function(t){U4.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),rf[e]=rf[t]})});function CC(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||rf.hasOwnProperty(t)&&rf[t]?(""+e).trim():e+"px"}function IC(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=CC(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var V4=Er({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sx(t,e){if(e){if(V4[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Xe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Xe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Xe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Xe(62))}}function Px(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ax=null;function lb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Cx=null,Ku=null,Ju=null;function OE(t){if(t=rp(t)){if(typeof Cx!="function")throw Error(Xe(280));var e=t.stateNode;e&&(e=Xy(e),Cx(t.stateNode,t.type,e))}}function MC(t){Ku?Ju?Ju.push(t):Ju=[t]:Ku=t}function kC(){if(Ku){var t=Ku,e=Ju;if(Ju=Ku=null,OE(t),e)for(t=0;t<e.length;t++)OE(e[t])}}function LC(t,e){return t(e)}function RC(){}var ev=!1;function zC(t,e,n){if(ev)return t(e,n);ev=!0;try{return LC(t,e,n)}finally{ev=!1,(Ku!==null||Ju!==null)&&(RC(),kC())}}function wf(t,e){var n=t.stateNode;if(n===null)return null;var r=Xy(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Xe(231,e,typeof n));return n}var Ix=!1;if(Ta)try{var Cd={};Object.defineProperty(Cd,"passive",{get:function(){Ix=!0}}),window.addEventListener("test",Cd,Cd),window.removeEventListener("test",Cd,Cd)}catch{Ix=!1}function j4(t,e,n,r,i,a,h,l,m){var v=Array.prototype.slice.call(arguments,3);try{e.apply(n,v)}catch(E){this.onError(E)}}var sf=!1,Gg=null,$g=!1,Mx=null,G4={onError:function(t){sf=!0,Gg=t}};function $4(t,e,n,r,i,a,h,l,m){sf=!1,Gg=null,j4.apply(G4,arguments)}function W4(t,e,n,r,i,a,h,l,m){if($4.apply(this,arguments),sf){if(sf){var v=Gg;sf=!1,Gg=null}else throw Error(Xe(198));$g||($g=!0,Mx=v)}}function jc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function DC(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function FE(t){if(jc(t)!==t)throw Error(Xe(188))}function H4(t){var e=t.alternate;if(!e){if(e=jc(t),e===null)throw Error(Xe(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return FE(i),t;if(a===r)return FE(i),e;a=a.sibling}throw Error(Xe(188))}if(n.return!==r.return)n=i,r=a;else{for(var h=!1,l=i.child;l;){if(l===n){h=!0,n=i,r=a;break}if(l===r){h=!0,r=i,n=a;break}l=l.sibling}if(!h){for(l=a.child;l;){if(l===n){h=!0,n=a,r=i;break}if(l===r){h=!0,r=a,n=i;break}l=l.sibling}if(!h)throw Error(Xe(189))}}if(n.alternate!==r)throw Error(Xe(190))}if(n.tag!==3)throw Error(Xe(188));return n.stateNode.current===n?t:e}function OC(t){return t=H4(t),t!==null?FC(t):null}function FC(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=FC(t);if(e!==null)return e;t=t.sibling}return null}var BC=zs.unstable_scheduleCallback,BE=zs.unstable_cancelCallback,q4=zs.unstable_shouldYield,Z4=zs.unstable_requestPaint,Br=zs.unstable_now,X4=zs.unstable_getCurrentPriorityLevel,cb=zs.unstable_ImmediatePriority,NC=zs.unstable_UserBlockingPriority,Wg=zs.unstable_NormalPriority,Y4=zs.unstable_LowPriority,UC=zs.unstable_IdlePriority,Wy=null,Zo=null;function K4(t){if(Zo&&typeof Zo.onCommitFiberRoot=="function")try{Zo.onCommitFiberRoot(Wy,t,void 0,(t.current.flags&128)===128)}catch{}}var xo=Math.clz32?Math.clz32:ez,J4=Math.log,Q4=Math.LN2;function ez(t){return t>>>=0,t===0?32:31-(J4(t)/Q4|0)|0}var Im=64,Mm=4194304;function Yd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Hg(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,a=t.pingedLanes,h=n&268435455;if(h!==0){var l=h&~i;l!==0?r=Yd(l):(a&=h,a!==0&&(r=Yd(a)))}else h=n&~i,h!==0?r=Yd(h):a!==0&&(r=Yd(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-xo(e),i=1<<n,r|=t[n],e&=~i;return r}function tz(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nz(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var h=31-xo(a),l=1<<h,m=i[h];m===-1?(!(l&n)||l&r)&&(i[h]=tz(l,e)):m<=e&&(t.expiredLanes|=l),a&=~l}}function kx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function VC(){var t=Im;return Im<<=1,!(Im&4194240)&&(Im=64),t}function tv(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function tp(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-xo(e),t[e]=n}function rz(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-xo(n),a=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~a}}function ub(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-xo(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Bn=0;function jC(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var GC,hb,$C,WC,HC,Lx=!1,km=[],xl=null,bl=null,wl=null,Ef=new Map,Tf=new Map,dl=[],iz="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function NE(t,e){switch(t){case"focusin":case"focusout":xl=null;break;case"dragenter":case"dragleave":bl=null;break;case"mouseover":case"mouseout":wl=null;break;case"pointerover":case"pointerout":Ef.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tf.delete(e.pointerId)}}function Id(t,e,n,r,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=rp(e),e!==null&&hb(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function sz(t,e,n,r,i){switch(e){case"focusin":return xl=Id(xl,t,e,n,r,i),!0;case"dragenter":return bl=Id(bl,t,e,n,r,i),!0;case"mouseover":return wl=Id(wl,t,e,n,r,i),!0;case"pointerover":var a=i.pointerId;return Ef.set(a,Id(Ef.get(a)||null,t,e,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Tf.set(a,Id(Tf.get(a)||null,t,e,n,r,i)),!0}return!1}function qC(t){var e=yc(t.target);if(e!==null){var n=jc(e);if(n!==null){if(e=n.tag,e===13){if(e=DC(n),e!==null){t.blockedOn=e,HC(t.priority,function(){$C(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function gg(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Rx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Ax=r,n.target.dispatchEvent(r),Ax=null}else return e=rp(n),e!==null&&hb(e),t.blockedOn=n,!1;e.shift()}return!0}function UE(t,e,n){gg(t)&&n.delete(e)}function oz(){Lx=!1,xl!==null&&gg(xl)&&(xl=null),bl!==null&&gg(bl)&&(bl=null),wl!==null&&gg(wl)&&(wl=null),Ef.forEach(UE),Tf.forEach(UE)}function Md(t,e){t.blockedOn===e&&(t.blockedOn=null,Lx||(Lx=!0,zs.unstable_scheduleCallback(zs.unstable_NormalPriority,oz)))}function Sf(t){function e(i){return Md(i,t)}if(0<km.length){Md(km[0],t);for(var n=1;n<km.length;n++){var r=km[n];r.blockedOn===t&&(r.blockedOn=null)}}for(xl!==null&&Md(xl,t),bl!==null&&Md(bl,t),wl!==null&&Md(wl,t),Ef.forEach(e),Tf.forEach(e),n=0;n<dl.length;n++)r=dl[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<dl.length&&(n=dl[0],n.blockedOn===null);)qC(n),n.blockedOn===null&&dl.shift()}var Qu=ka.ReactCurrentBatchConfig,qg=!0;function az(t,e,n,r){var i=Bn,a=Qu.transition;Qu.transition=null;try{Bn=1,db(t,e,n,r)}finally{Bn=i,Qu.transition=a}}function lz(t,e,n,r){var i=Bn,a=Qu.transition;Qu.transition=null;try{Bn=4,db(t,e,n,r)}finally{Bn=i,Qu.transition=a}}function db(t,e,n,r){if(qg){var i=Rx(t,e,n,r);if(i===null)hv(t,e,r,Zg,n),NE(t,r);else if(sz(i,t,e,n,r))r.stopPropagation();else if(NE(t,r),e&4&&-1<iz.indexOf(t)){for(;i!==null;){var a=rp(i);if(a!==null&&GC(a),a=Rx(t,e,n,r),a===null&&hv(t,e,r,Zg,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else hv(t,e,r,null,n)}}var Zg=null;function Rx(t,e,n,r){if(Zg=null,t=lb(r),t=yc(t),t!==null)if(e=jc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=DC(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Zg=t,null}function ZC(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(X4()){case cb:return 1;case NC:return 4;case Wg:case Y4:return 16;case UC:return 536870912;default:return 16}default:return 16}}var pl=null,fb=null,yg=null;function XC(){if(yg)return yg;var t,e=fb,n=e.length,r,i="value"in pl?pl.value:pl.textContent,a=i.length;for(t=0;t<n&&e[t]===i[t];t++);var h=n-t;for(r=1;r<=h&&e[n-r]===i[a-r];r++);return yg=i.slice(t,1<r?1-r:void 0)}function _g(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Lm(){return!0}function VE(){return!1}function Fs(t){function e(n,r,i,a,h){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=h,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Lm:VE,this.isPropagationStopped=VE,this}return Er(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Lm)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Lm)},persist:function(){},isPersistent:Lm}),e}var kh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pb=Fs(kh),np=Er({},kh,{view:0,detail:0}),cz=Fs(np),nv,rv,kd,Hy=Er({},np,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==kd&&(kd&&t.type==="mousemove"?(nv=t.screenX-kd.screenX,rv=t.screenY-kd.screenY):rv=nv=0,kd=t),nv)},movementY:function(t){return"movementY"in t?t.movementY:rv}}),jE=Fs(Hy),uz=Er({},Hy,{dataTransfer:0}),hz=Fs(uz),dz=Er({},np,{relatedTarget:0}),iv=Fs(dz),fz=Er({},kh,{animationName:0,elapsedTime:0,pseudoElement:0}),pz=Fs(fz),mz=Er({},kh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),gz=Fs(mz),yz=Er({},kh,{data:0}),GE=Fs(yz),_z={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bz(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=xz[t])?!!e[t]:!1}function mb(){return bz}var wz=Er({},np,{key:function(t){if(t.key){var e=_z[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_g(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?vz[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mb,charCode:function(t){return t.type==="keypress"?_g(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_g(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ez=Fs(wz),Tz=Er({},Hy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$E=Fs(Tz),Sz=Er({},np,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mb}),Pz=Fs(Sz),Az=Er({},kh,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cz=Fs(Az),Iz=Er({},Hy,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Mz=Fs(Iz),kz=[9,13,27,32],gb=Ta&&"CompositionEvent"in window,of=null;Ta&&"documentMode"in document&&(of=document.documentMode);var Lz=Ta&&"TextEvent"in window&&!of,YC=Ta&&(!gb||of&&8<of&&11>=of),WE=String.fromCharCode(32),HE=!1;function KC(t,e){switch(t){case"keyup":return kz.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JC(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Fu=!1;function Rz(t,e){switch(t){case"compositionend":return JC(e);case"keypress":return e.which!==32?null:(HE=!0,WE);case"textInput":return t=e.data,t===WE&&HE?null:t;default:return null}}function zz(t,e){if(Fu)return t==="compositionend"||!gb&&KC(t,e)?(t=XC(),yg=fb=pl=null,Fu=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return YC&&e.locale!=="ko"?null:e.data;default:return null}}var Dz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Dz[t.type]:e==="textarea"}function QC(t,e,n,r){MC(r),e=Xg(e,"onChange"),0<e.length&&(n=new pb("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var af=null,Pf=null;function Oz(t){uI(t,0)}function qy(t){var e=Uu(t);if(EC(e))return t}function Fz(t,e){if(t==="change")return e}var eI=!1;if(Ta){var sv;if(Ta){var ov="oninput"in document;if(!ov){var ZE=document.createElement("div");ZE.setAttribute("oninput","return;"),ov=typeof ZE.oninput=="function"}sv=ov}else sv=!1;eI=sv&&(!document.documentMode||9<document.documentMode)}function XE(){af&&(af.detachEvent("onpropertychange",tI),Pf=af=null)}function tI(t){if(t.propertyName==="value"&&qy(Pf)){var e=[];QC(e,Pf,t,lb(t)),zC(Oz,e)}}function Bz(t,e,n){t==="focusin"?(XE(),af=e,Pf=n,af.attachEvent("onpropertychange",tI)):t==="focusout"&&XE()}function Nz(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qy(Pf)}function Uz(t,e){if(t==="click")return qy(e)}function Vz(t,e){if(t==="input"||t==="change")return qy(e)}function jz(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var To=typeof Object.is=="function"?Object.is:jz;function Af(t,e){if(To(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!mx.call(e,i)||!To(t[i],e[i]))return!1}return!0}function YE(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function KE(t,e){var n=YE(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=YE(n)}}function nI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?nI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function rI(){for(var t=window,e=jg();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=jg(t.document)}return e}function yb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Gz(t){var e=rI(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&nI(n.ownerDocument.documentElement,n)){if(r!==null&&yb(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!t.extend&&a>r&&(i=r,r=a,a=i),i=KE(n,a);var h=KE(n,r);i&&h&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==h.node||t.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var $z=Ta&&"documentMode"in document&&11>=document.documentMode,Bu=null,zx=null,lf=null,Dx=!1;function JE(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Dx||Bu==null||Bu!==jg(r)||(r=Bu,"selectionStart"in r&&yb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),lf&&Af(lf,r)||(lf=r,r=Xg(zx,"onSelect"),0<r.length&&(e=new pb("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Bu)))}function Rm(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Nu={animationend:Rm("Animation","AnimationEnd"),animationiteration:Rm("Animation","AnimationIteration"),animationstart:Rm("Animation","AnimationStart"),transitionend:Rm("Transition","TransitionEnd")},av={},iI={};Ta&&(iI=document.createElement("div").style,"AnimationEvent"in window||(delete Nu.animationend.animation,delete Nu.animationiteration.animation,delete Nu.animationstart.animation),"TransitionEvent"in window||delete Nu.transitionend.transition);function Zy(t){if(av[t])return av[t];if(!Nu[t])return t;var e=Nu[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in iI)return av[t]=e[n];return t}var sI=Zy("animationend"),oI=Zy("animationiteration"),aI=Zy("animationstart"),lI=Zy("transitionend"),cI=new Map,QE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rl(t,e){cI.set(t,e),Vc(e,[t])}for(var lv=0;lv<QE.length;lv++){var cv=QE[lv],Wz=cv.toLowerCase(),Hz=cv[0].toUpperCase()+cv.slice(1);Rl(Wz,"on"+Hz)}Rl(sI,"onAnimationEnd");Rl(oI,"onAnimationIteration");Rl(aI,"onAnimationStart");Rl("dblclick","onDoubleClick");Rl("focusin","onFocus");Rl("focusout","onBlur");Rl(lI,"onTransitionEnd");lh("onMouseEnter",["mouseout","mouseover"]);lh("onMouseLeave",["mouseout","mouseover"]);lh("onPointerEnter",["pointerout","pointerover"]);lh("onPointerLeave",["pointerout","pointerover"]);Vc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qz=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kd));function eT(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,W4(r,e,void 0,t),t.currentTarget=null}function uI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var h=r.length-1;0<=h;h--){var l=r[h],m=l.instance,v=l.currentTarget;if(l=l.listener,m!==a&&i.isPropagationStopped())break e;eT(i,l,v),a=m}else for(h=0;h<r.length;h++){if(l=r[h],m=l.instance,v=l.currentTarget,l=l.listener,m!==a&&i.isPropagationStopped())break e;eT(i,l,v),a=m}}}if($g)throw t=Mx,$g=!1,Mx=null,t}function lr(t,e){var n=e[Ux];n===void 0&&(n=e[Ux]=new Set);var r=t+"__bubble";n.has(r)||(hI(e,t,2,!1),n.add(r))}function uv(t,e,n){var r=0;e&&(r|=4),hI(n,t,r,e)}var zm="_reactListening"+Math.random().toString(36).slice(2);function Cf(t){if(!t[zm]){t[zm]=!0,_C.forEach(function(n){n!=="selectionchange"&&(qz.has(n)||uv(n,!1,t),uv(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[zm]||(e[zm]=!0,uv("selectionchange",!1,e))}}function hI(t,e,n,r){switch(ZC(e)){case 1:var i=az;break;case 4:i=lz;break;default:i=db}n=i.bind(null,e,n,t),i=void 0,!Ix||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function hv(t,e,n,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var h=r.tag;if(h===3||h===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(h===4)for(h=r.return;h!==null;){var m=h.tag;if((m===3||m===4)&&(m=h.stateNode.containerInfo,m===i||m.nodeType===8&&m.parentNode===i))return;h=h.return}for(;l!==null;){if(h=yc(l),h===null)return;if(m=h.tag,m===5||m===6){r=a=h;continue e}l=l.parentNode}}r=r.return}zC(function(){var v=a,E=lb(n),T=[];e:{var S=cI.get(t);if(S!==void 0){var z=pb,D=t;switch(t){case"keypress":if(_g(n)===0)break e;case"keydown":case"keyup":z=Ez;break;case"focusin":D="focus",z=iv;break;case"focusout":D="blur",z=iv;break;case"beforeblur":case"afterblur":z=iv;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=jE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=hz;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=Pz;break;case sI:case oI:case aI:z=pz;break;case lI:z=Cz;break;case"scroll":z=cz;break;case"wheel":z=Mz;break;case"copy":case"cut":case"paste":z=gz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=$E}var F=(e&4)!==0,J=!F&&t==="scroll",U=F?S!==null?S+"Capture":null:S;F=[];for(var V=v,G;V!==null;){G=V;var ee=G.stateNode;if(G.tag===5&&ee!==null&&(G=ee,U!==null&&(ee=wf(V,U),ee!=null&&F.push(If(V,ee,G)))),J)break;V=V.return}0<F.length&&(S=new z(S,D,null,n,E),T.push({event:S,listeners:F}))}}if(!(e&7)){e:{if(S=t==="mouseover"||t==="pointerover",z=t==="mouseout"||t==="pointerout",S&&n!==Ax&&(D=n.relatedTarget||n.fromElement)&&(yc(D)||D[Sa]))break e;if((z||S)&&(S=E.window===E?E:(S=E.ownerDocument)?S.defaultView||S.parentWindow:window,z?(D=n.relatedTarget||n.toElement,z=v,D=D?yc(D):null,D!==null&&(J=jc(D),D!==J||D.tag!==5&&D.tag!==6)&&(D=null)):(z=null,D=v),z!==D)){if(F=jE,ee="onMouseLeave",U="onMouseEnter",V="mouse",(t==="pointerout"||t==="pointerover")&&(F=$E,ee="onPointerLeave",U="onPointerEnter",V="pointer"),J=z==null?S:Uu(z),G=D==null?S:Uu(D),S=new F(ee,V+"leave",z,n,E),S.target=J,S.relatedTarget=G,ee=null,yc(E)===v&&(F=new F(U,V+"enter",D,n,E),F.target=G,F.relatedTarget=J,ee=F),J=ee,z&&D)t:{for(F=z,U=D,V=0,G=F;G;G=xu(G))V++;for(G=0,ee=U;ee;ee=xu(ee))G++;for(;0<V-G;)F=xu(F),V--;for(;0<G-V;)U=xu(U),G--;for(;V--;){if(F===U||U!==null&&F===U.alternate)break t;F=xu(F),U=xu(U)}F=null}else F=null;z!==null&&tT(T,S,z,F,!1),D!==null&&J!==null&&tT(T,J,D,F,!0)}}e:{if(S=v?Uu(v):window,z=S.nodeName&&S.nodeName.toLowerCase(),z==="select"||z==="input"&&S.type==="file")var se=Fz;else if(qE(S))if(eI)se=Vz;else{se=Nz;var me=Bz}else(z=S.nodeName)&&z.toLowerCase()==="input"&&(S.type==="checkbox"||S.type==="radio")&&(se=Uz);if(se&&(se=se(t,v))){QC(T,se,n,E);break e}me&&me(t,S,v),t==="focusout"&&(me=S._wrapperState)&&me.controlled&&S.type==="number"&&wx(S,"number",S.value)}switch(me=v?Uu(v):window,t){case"focusin":(qE(me)||me.contentEditable==="true")&&(Bu=me,zx=v,lf=null);break;case"focusout":lf=zx=Bu=null;break;case"mousedown":Dx=!0;break;case"contextmenu":case"mouseup":case"dragend":Dx=!1,JE(T,n,E);break;case"selectionchange":if($z)break;case"keydown":case"keyup":JE(T,n,E)}var ve;if(gb)e:{switch(t){case"compositionstart":var Me="onCompositionStart";break e;case"compositionend":Me="onCompositionEnd";break e;case"compositionupdate":Me="onCompositionUpdate";break e}Me=void 0}else Fu?KC(t,n)&&(Me="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Me="onCompositionStart");Me&&(YC&&n.locale!=="ko"&&(Fu||Me!=="onCompositionStart"?Me==="onCompositionEnd"&&Fu&&(ve=XC()):(pl=E,fb="value"in pl?pl.value:pl.textContent,Fu=!0)),me=Xg(v,Me),0<me.length&&(Me=new GE(Me,t,null,n,E),T.push({event:Me,listeners:me}),ve?Me.data=ve:(ve=JC(n),ve!==null&&(Me.data=ve)))),(ve=Lz?Rz(t,n):zz(t,n))&&(v=Xg(v,"onBeforeInput"),0<v.length&&(E=new GE("onBeforeInput","beforeinput",null,n,E),T.push({event:E,listeners:v}),E.data=ve))}uI(T,e)})}function If(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Xg(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=wf(t,n),a!=null&&r.unshift(If(t,a,i)),a=wf(t,e),a!=null&&r.push(If(t,a,i))),t=t.return}return r}function xu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function tT(t,e,n,r,i){for(var a=e._reactName,h=[];n!==null&&n!==r;){var l=n,m=l.alternate,v=l.stateNode;if(m!==null&&m===r)break;l.tag===5&&v!==null&&(l=v,i?(m=wf(n,a),m!=null&&h.unshift(If(n,m,l))):i||(m=wf(n,a),m!=null&&h.push(If(n,m,l)))),n=n.return}h.length!==0&&t.push({event:e,listeners:h})}var Zz=/\r\n?/g,Xz=/\u0000|\uFFFD/g;function nT(t){return(typeof t=="string"?t:""+t).replace(Zz,`
`).replace(Xz,"")}function Dm(t,e,n){if(e=nT(e),nT(t)!==e&&n)throw Error(Xe(425))}function Yg(){}var Ox=null,Fx=null;function Bx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Nx=typeof setTimeout=="function"?setTimeout:void 0,Yz=typeof clearTimeout=="function"?clearTimeout:void 0,rT=typeof Promise=="function"?Promise:void 0,Kz=typeof queueMicrotask=="function"?queueMicrotask:typeof rT<"u"?function(t){return rT.resolve(null).then(t).catch(Jz)}:Nx;function Jz(t){setTimeout(function(){throw t})}function dv(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Sf(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Sf(e)}function El(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function iT(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Lh=Math.random().toString(36).slice(2),Go="__reactFiber$"+Lh,Mf="__reactProps$"+Lh,Sa="__reactContainer$"+Lh,Ux="__reactEvents$"+Lh,Qz="__reactListeners$"+Lh,e5="__reactHandles$"+Lh;function yc(t){var e=t[Go];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Sa]||n[Go]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=iT(t);t!==null;){if(n=t[Go])return n;t=iT(t)}return e}t=n,n=t.parentNode}return null}function rp(t){return t=t[Go]||t[Sa],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Uu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Xe(33))}function Xy(t){return t[Mf]||null}var Vx=[],Vu=-1;function zl(t){return{current:t}}function ur(t){0>Vu||(t.current=Vx[Vu],Vx[Vu]=null,Vu--)}function sr(t,e){Vu++,Vx[Vu]=t.current,t.current=e}var kl={},zi=zl(kl),cs=zl(!1),Cc=kl;function ch(t,e){var n=t.type.contextTypes;if(!n)return kl;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function us(t){return t=t.childContextTypes,t!=null}function Kg(){ur(cs),ur(zi)}function sT(t,e,n){if(zi.current!==kl)throw Error(Xe(168));sr(zi,e),sr(cs,n)}function dI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Xe(108,B4(t)||"Unknown",i));return Er({},n,r)}function Jg(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||kl,Cc=zi.current,sr(zi,t),sr(cs,cs.current),!0}function oT(t,e,n){var r=t.stateNode;if(!r)throw Error(Xe(169));n?(t=dI(t,e,Cc),r.__reactInternalMemoizedMergedChildContext=t,ur(cs),ur(zi),sr(zi,t)):ur(cs),sr(cs,n)}var _a=null,Yy=!1,fv=!1;function fI(t){_a===null?_a=[t]:_a.push(t)}function t5(t){Yy=!0,fI(t)}function Dl(){if(!fv&&_a!==null){fv=!0;var t=0,e=Bn;try{var n=_a;for(Bn=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}_a=null,Yy=!1}catch(i){throw _a!==null&&(_a=_a.slice(t+1)),BC(cb,Dl),i}finally{Bn=e,fv=!1}}return null}var ju=[],Gu=0,Qg=null,ey=0,Ys=[],Ks=0,Ic=null,ba=1,wa="";function fc(t,e){ju[Gu++]=ey,ju[Gu++]=Qg,Qg=t,ey=e}function pI(t,e,n){Ys[Ks++]=ba,Ys[Ks++]=wa,Ys[Ks++]=Ic,Ic=t;var r=ba;t=wa;var i=32-xo(r)-1;r&=~(1<<i),n+=1;var a=32-xo(e)+i;if(30<a){var h=i-i%5;a=(r&(1<<h)-1).toString(32),r>>=h,i-=h,ba=1<<32-xo(e)+i|n<<i|r,wa=a+t}else ba=1<<a|n<<i|r,wa=t}function _b(t){t.return!==null&&(fc(t,1),pI(t,1,0))}function vb(t){for(;t===Qg;)Qg=ju[--Gu],ju[Gu]=null,ey=ju[--Gu],ju[Gu]=null;for(;t===Ic;)Ic=Ys[--Ks],Ys[Ks]=null,wa=Ys[--Ks],Ys[Ks]=null,ba=Ys[--Ks],Ys[Ks]=null}var ks=null,Is=null,gr=!1,mo=null;function mI(t,e){var n=Js(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function aT(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ks=t,Is=El(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ks=t,Is=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ic!==null?{id:ba,overflow:wa}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Js(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ks=t,Is=null,!0):!1;default:return!1}}function jx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Gx(t){if(gr){var e=Is;if(e){var n=e;if(!aT(t,e)){if(jx(t))throw Error(Xe(418));e=El(n.nextSibling);var r=ks;e&&aT(t,e)?mI(r,n):(t.flags=t.flags&-4097|2,gr=!1,ks=t)}}else{if(jx(t))throw Error(Xe(418));t.flags=t.flags&-4097|2,gr=!1,ks=t}}}function lT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ks=t}function Om(t){if(t!==ks)return!1;if(!gr)return lT(t),gr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Bx(t.type,t.memoizedProps)),e&&(e=Is)){if(jx(t))throw gI(),Error(Xe(418));for(;e;)mI(t,e),e=El(e.nextSibling)}if(lT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Xe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Is=El(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Is=null}}else Is=ks?El(t.stateNode.nextSibling):null;return!0}function gI(){for(var t=Is;t;)t=El(t.nextSibling)}function uh(){Is=ks=null,gr=!1}function xb(t){mo===null?mo=[t]:mo.push(t)}var n5=ka.ReactCurrentBatchConfig;function fo(t,e){if(t&&t.defaultProps){e=Er({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var ty=zl(null),ny=null,$u=null,bb=null;function wb(){bb=$u=ny=null}function Eb(t){var e=ty.current;ur(ty),t._currentValue=e}function $x(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function eh(t,e){ny=t,bb=$u=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(as=!0),t.firstContext=null)}function to(t){var e=t._currentValue;if(bb!==t)if(t={context:t,memoizedValue:e,next:null},$u===null){if(ny===null)throw Error(Xe(308));$u=t,ny.dependencies={lanes:0,firstContext:t}}else $u=$u.next=t;return e}var _c=null;function Tb(t){_c===null?_c=[t]:_c.push(t)}function yI(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Tb(e)):(n.next=i.next,i.next=n),e.interleaved=n,Pa(t,r)}function Pa(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var hl=!1;function Sb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _I(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ea(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Tl(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,En&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Pa(t,n)}return i=r.interleaved,i===null?(e.next=e,Tb(r)):(e.next=i.next,i.next=e),r.interleaved=e,Pa(t,n)}function vg(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ub(t,n)}}function cT(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var h={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=h:a=a.next=h,n=n.next}while(n!==null);a===null?i=a=e:a=a.next=e}else i=a=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ry(t,e,n,r){var i=t.updateQueue;hl=!1;var a=i.firstBaseUpdate,h=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var m=l,v=m.next;m.next=null,h===null?a=v:h.next=v,h=m;var E=t.alternate;E!==null&&(E=E.updateQueue,l=E.lastBaseUpdate,l!==h&&(l===null?E.firstBaseUpdate=v:l.next=v,E.lastBaseUpdate=m))}if(a!==null){var T=i.baseState;h=0,E=v=m=null,l=a;do{var S=l.lane,z=l.eventTime;if((r&S)===S){E!==null&&(E=E.next={eventTime:z,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var D=t,F=l;switch(S=e,z=n,F.tag){case 1:if(D=F.payload,typeof D=="function"){T=D.call(z,T,S);break e}T=D;break e;case 3:D.flags=D.flags&-65537|128;case 0:if(D=F.payload,S=typeof D=="function"?D.call(z,T,S):D,S==null)break e;T=Er({},T,S);break e;case 2:hl=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,S=i.effects,S===null?i.effects=[l]:S.push(l))}else z={eventTime:z,lane:S,tag:l.tag,payload:l.payload,callback:l.callback,next:null},E===null?(v=E=z,m=T):E=E.next=z,h|=S;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;S=l,l=S.next,S.next=null,i.lastBaseUpdate=S,i.shared.pending=null}}while(1);if(E===null&&(m=T),i.baseState=m,i.firstBaseUpdate=v,i.lastBaseUpdate=E,e=i.shared.interleaved,e!==null){i=e;do h|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);kc|=h,t.lanes=h,t.memoizedState=T}}function uT(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Xe(191,i));i.call(r)}}}var vI=new yC.Component().refs;function Wx(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Er({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ky={isMounted:function(t){return(t=t._reactInternals)?jc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Zi(),i=Pl(t),a=Ea(r,i);a.payload=e,n!=null&&(a.callback=n),e=Tl(t,a,i),e!==null&&(bo(e,t,i,r),vg(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Zi(),i=Pl(t),a=Ea(r,i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=Tl(t,a,i),e!==null&&(bo(e,t,i,r),vg(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zi(),r=Pl(t),i=Ea(n,r);i.tag=2,e!=null&&(i.callback=e),e=Tl(t,i,r),e!==null&&(bo(e,t,r,n),vg(e,t,r))}};function hT(t,e,n,r,i,a,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,h):e.prototype&&e.prototype.isPureReactComponent?!Af(n,r)||!Af(i,a):!0}function xI(t,e,n){var r=!1,i=kl,a=e.contextType;return typeof a=="object"&&a!==null?a=to(a):(i=us(e)?Cc:zi.current,r=e.contextTypes,a=(r=r!=null)?ch(t,i):kl),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ky,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function dT(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Ky.enqueueReplaceState(e,e.state,null)}function Hx(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=vI,Sb(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=to(a):(a=us(e)?Cc:zi.current,i.context=ch(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Wx(t,e,a,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ky.enqueueReplaceState(i,i.state,null),ry(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ld(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Xe(309));var r=n.stateNode}if(!r)throw Error(Xe(147,t));var i=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(h){var l=i.refs;l===vI&&(l=i.refs={}),h===null?delete l[a]:l[a]=h},e._stringRef=a,e)}if(typeof t!="string")throw Error(Xe(284));if(!n._owner)throw Error(Xe(290,t))}return t}function Fm(t,e){throw t=Object.prototype.toString.call(e),Error(Xe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fT(t){var e=t._init;return e(t._payload)}function bI(t){function e(U,V){if(t){var G=U.deletions;G===null?(U.deletions=[V],U.flags|=16):G.push(V)}}function n(U,V){if(!t)return null;for(;V!==null;)e(U,V),V=V.sibling;return null}function r(U,V){for(U=new Map;V!==null;)V.key!==null?U.set(V.key,V):U.set(V.index,V),V=V.sibling;return U}function i(U,V){return U=Al(U,V),U.index=0,U.sibling=null,U}function a(U,V,G){return U.index=G,t?(G=U.alternate,G!==null?(G=G.index,G<V?(U.flags|=2,V):G):(U.flags|=2,V)):(U.flags|=1048576,V)}function h(U){return t&&U.alternate===null&&(U.flags|=2),U}function l(U,V,G,ee){return V===null||V.tag!==6?(V=xv(G,U.mode,ee),V.return=U,V):(V=i(V,G),V.return=U,V)}function m(U,V,G,ee){var se=G.type;return se===Ou?E(U,V,G.props.children,ee,G.key):V!==null&&(V.elementType===se||typeof se=="object"&&se!==null&&se.$$typeof===ul&&fT(se)===V.type)?(ee=i(V,G.props),ee.ref=Ld(U,V,G),ee.return=U,ee):(ee=Sg(G.type,G.key,G.props,null,U.mode,ee),ee.ref=Ld(U,V,G),ee.return=U,ee)}function v(U,V,G,ee){return V===null||V.tag!==4||V.stateNode.containerInfo!==G.containerInfo||V.stateNode.implementation!==G.implementation?(V=bv(G,U.mode,ee),V.return=U,V):(V=i(V,G.children||[]),V.return=U,V)}function E(U,V,G,ee,se){return V===null||V.tag!==7?(V=Sc(G,U.mode,ee,se),V.return=U,V):(V=i(V,G),V.return=U,V)}function T(U,V,G){if(typeof V=="string"&&V!==""||typeof V=="number")return V=xv(""+V,U.mode,G),V.return=U,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case Pm:return G=Sg(V.type,V.key,V.props,null,U.mode,G),G.ref=Ld(U,null,V),G.return=U,G;case Du:return V=bv(V,U.mode,G),V.return=U,V;case ul:var ee=V._init;return T(U,ee(V._payload),G)}if(Xd(V)||Ad(V))return V=Sc(V,U.mode,G,null),V.return=U,V;Fm(U,V)}return null}function S(U,V,G,ee){var se=V!==null?V.key:null;if(typeof G=="string"&&G!==""||typeof G=="number")return se!==null?null:l(U,V,""+G,ee);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case Pm:return G.key===se?m(U,V,G,ee):null;case Du:return G.key===se?v(U,V,G,ee):null;case ul:return se=G._init,S(U,V,se(G._payload),ee)}if(Xd(G)||Ad(G))return se!==null?null:E(U,V,G,ee,null);Fm(U,G)}return null}function z(U,V,G,ee,se){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return U=U.get(G)||null,l(V,U,""+ee,se);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case Pm:return U=U.get(ee.key===null?G:ee.key)||null,m(V,U,ee,se);case Du:return U=U.get(ee.key===null?G:ee.key)||null,v(V,U,ee,se);case ul:var me=ee._init;return z(U,V,G,me(ee._payload),se)}if(Xd(ee)||Ad(ee))return U=U.get(G)||null,E(V,U,ee,se,null);Fm(V,ee)}return null}function D(U,V,G,ee){for(var se=null,me=null,ve=V,Me=V=0,Be=null;ve!==null&&Me<G.length;Me++){ve.index>Me?(Be=ve,ve=null):Be=ve.sibling;var ze=S(U,ve,G[Me],ee);if(ze===null){ve===null&&(ve=Be);break}t&&ve&&ze.alternate===null&&e(U,ve),V=a(ze,V,Me),me===null?se=ze:me.sibling=ze,me=ze,ve=Be}if(Me===G.length)return n(U,ve),gr&&fc(U,Me),se;if(ve===null){for(;Me<G.length;Me++)ve=T(U,G[Me],ee),ve!==null&&(V=a(ve,V,Me),me===null?se=ve:me.sibling=ve,me=ve);return gr&&fc(U,Me),se}for(ve=r(U,ve);Me<G.length;Me++)Be=z(ve,U,Me,G[Me],ee),Be!==null&&(t&&Be.alternate!==null&&ve.delete(Be.key===null?Me:Be.key),V=a(Be,V,Me),me===null?se=Be:me.sibling=Be,me=Be);return t&&ve.forEach(function(Oe){return e(U,Oe)}),gr&&fc(U,Me),se}function F(U,V,G,ee){var se=Ad(G);if(typeof se!="function")throw Error(Xe(150));if(G=se.call(G),G==null)throw Error(Xe(151));for(var me=se=null,ve=V,Me=V=0,Be=null,ze=G.next();ve!==null&&!ze.done;Me++,ze=G.next()){ve.index>Me?(Be=ve,ve=null):Be=ve.sibling;var Oe=S(U,ve,ze.value,ee);if(Oe===null){ve===null&&(ve=Be);break}t&&ve&&Oe.alternate===null&&e(U,ve),V=a(Oe,V,Me),me===null?se=Oe:me.sibling=Oe,me=Oe,ve=Be}if(ze.done)return n(U,ve),gr&&fc(U,Me),se;if(ve===null){for(;!ze.done;Me++,ze=G.next())ze=T(U,ze.value,ee),ze!==null&&(V=a(ze,V,Me),me===null?se=ze:me.sibling=ze,me=ze);return gr&&fc(U,Me),se}for(ve=r(U,ve);!ze.done;Me++,ze=G.next())ze=z(ve,U,Me,ze.value,ee),ze!==null&&(t&&ze.alternate!==null&&ve.delete(ze.key===null?Me:ze.key),V=a(ze,V,Me),me===null?se=ze:me.sibling=ze,me=ze);return t&&ve.forEach(function(tt){return e(U,tt)}),gr&&fc(U,Me),se}function J(U,V,G,ee){if(typeof G=="object"&&G!==null&&G.type===Ou&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case Pm:e:{for(var se=G.key,me=V;me!==null;){if(me.key===se){if(se=G.type,se===Ou){if(me.tag===7){n(U,me.sibling),V=i(me,G.props.children),V.return=U,U=V;break e}}else if(me.elementType===se||typeof se=="object"&&se!==null&&se.$$typeof===ul&&fT(se)===me.type){n(U,me.sibling),V=i(me,G.props),V.ref=Ld(U,me,G),V.return=U,U=V;break e}n(U,me);break}else e(U,me);me=me.sibling}G.type===Ou?(V=Sc(G.props.children,U.mode,ee,G.key),V.return=U,U=V):(ee=Sg(G.type,G.key,G.props,null,U.mode,ee),ee.ref=Ld(U,V,G),ee.return=U,U=ee)}return h(U);case Du:e:{for(me=G.key;V!==null;){if(V.key===me)if(V.tag===4&&V.stateNode.containerInfo===G.containerInfo&&V.stateNode.implementation===G.implementation){n(U,V.sibling),V=i(V,G.children||[]),V.return=U,U=V;break e}else{n(U,V);break}else e(U,V);V=V.sibling}V=bv(G,U.mode,ee),V.return=U,U=V}return h(U);case ul:return me=G._init,J(U,V,me(G._payload),ee)}if(Xd(G))return D(U,V,G,ee);if(Ad(G))return F(U,V,G,ee);Fm(U,G)}return typeof G=="string"&&G!==""||typeof G=="number"?(G=""+G,V!==null&&V.tag===6?(n(U,V.sibling),V=i(V,G),V.return=U,U=V):(n(U,V),V=xv(G,U.mode,ee),V.return=U,U=V),h(U)):n(U,V)}return J}var hh=bI(!0),wI=bI(!1),ip={},Xo=zl(ip),kf=zl(ip),Lf=zl(ip);function vc(t){if(t===ip)throw Error(Xe(174));return t}function Pb(t,e){switch(sr(Lf,e),sr(kf,t),sr(Xo,ip),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Tx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Tx(e,t)}ur(Xo),sr(Xo,e)}function dh(){ur(Xo),ur(kf),ur(Lf)}function EI(t){vc(Lf.current);var e=vc(Xo.current),n=Tx(e,t.type);e!==n&&(sr(kf,t),sr(Xo,n))}function Ab(t){kf.current===t&&(ur(Xo),ur(kf))}var xr=zl(0);function iy(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var pv=[];function Cb(){for(var t=0;t<pv.length;t++)pv[t]._workInProgressVersionPrimary=null;pv.length=0}var xg=ka.ReactCurrentDispatcher,mv=ka.ReactCurrentBatchConfig,Mc=0,wr=null,Qr=null,oi=null,sy=!1,cf=!1,Rf=0,r5=0;function Ai(){throw Error(Xe(321))}function Ib(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!To(t[n],e[n]))return!1;return!0}function Mb(t,e,n,r,i,a){if(Mc=a,wr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xg.current=t===null||t.memoizedState===null?a5:l5,t=n(r,i),cf){a=0;do{if(cf=!1,Rf=0,25<=a)throw Error(Xe(301));a+=1,oi=Qr=null,e.updateQueue=null,xg.current=c5,t=n(r,i)}while(cf)}if(xg.current=oy,e=Qr!==null&&Qr.next!==null,Mc=0,oi=Qr=wr=null,sy=!1,e)throw Error(Xe(300));return t}function kb(){var t=Rf!==0;return Rf=0,t}function Uo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?wr.memoizedState=oi=t:oi=oi.next=t,oi}function no(){if(Qr===null){var t=wr.alternate;t=t!==null?t.memoizedState:null}else t=Qr.next;var e=oi===null?wr.memoizedState:oi.next;if(e!==null)oi=e,Qr=t;else{if(t===null)throw Error(Xe(310));Qr=t,t={memoizedState:Qr.memoizedState,baseState:Qr.baseState,baseQueue:Qr.baseQueue,queue:Qr.queue,next:null},oi===null?wr.memoizedState=oi=t:oi=oi.next=t}return oi}function zf(t,e){return typeof e=="function"?e(t):e}function gv(t){var e=no(),n=e.queue;if(n===null)throw Error(Xe(311));n.lastRenderedReducer=t;var r=Qr,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var h=i.next;i.next=a.next,a.next=h}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var l=h=null,m=null,v=a;do{var E=v.lane;if((Mc&E)===E)m!==null&&(m=m.next={lane:0,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),r=v.hasEagerState?v.eagerState:t(r,v.action);else{var T={lane:E,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null};m===null?(l=m=T,h=r):m=m.next=T,wr.lanes|=E,kc|=E}v=v.next}while(v!==null&&v!==a);m===null?h=r:m.next=l,To(r,e.memoizedState)||(as=!0),e.memoizedState=r,e.baseState=h,e.baseQueue=m,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do a=i.lane,wr.lanes|=a,kc|=a,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function yv(t){var e=no(),n=e.queue;if(n===null)throw Error(Xe(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,a=e.memoizedState;if(i!==null){n.pending=null;var h=i=i.next;do a=t(a,h.action),h=h.next;while(h!==i);To(a,e.memoizedState)||(as=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function TI(){}function SI(t,e){var n=wr,r=no(),i=e(),a=!To(r.memoizedState,i);if(a&&(r.memoizedState=i,as=!0),r=r.queue,Lb(CI.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||oi!==null&&oi.memoizedState.tag&1){if(n.flags|=2048,Df(9,AI.bind(null,n,r,i,e),void 0,null),li===null)throw Error(Xe(349));Mc&30||PI(n,e,i)}return i}function PI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=wr.updateQueue,e===null?(e={lastEffect:null,stores:null},wr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function AI(t,e,n,r){e.value=n,e.getSnapshot=r,II(e)&&MI(t)}function CI(t,e,n){return n(function(){II(e)&&MI(t)})}function II(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!To(t,n)}catch{return!0}}function MI(t){var e=Pa(t,1);e!==null&&bo(e,t,1,-1)}function pT(t){var e=Uo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zf,lastRenderedState:t},e.queue=t,t=t.dispatch=o5.bind(null,wr,t),[e.memoizedState,t]}function Df(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=wr.updateQueue,e===null?(e={lastEffect:null,stores:null},wr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function kI(){return no().memoizedState}function bg(t,e,n,r){var i=Uo();wr.flags|=t,i.memoizedState=Df(1|e,n,void 0,r===void 0?null:r)}function Jy(t,e,n,r){var i=no();r=r===void 0?null:r;var a=void 0;if(Qr!==null){var h=Qr.memoizedState;if(a=h.destroy,r!==null&&Ib(r,h.deps)){i.memoizedState=Df(e,n,a,r);return}}wr.flags|=t,i.memoizedState=Df(1|e,n,a,r)}function mT(t,e){return bg(8390656,8,t,e)}function Lb(t,e){return Jy(2048,8,t,e)}function LI(t,e){return Jy(4,2,t,e)}function RI(t,e){return Jy(4,4,t,e)}function zI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function DI(t,e,n){return n=n!=null?n.concat([t]):null,Jy(4,4,zI.bind(null,e,t),n)}function Rb(){}function OI(t,e){var n=no();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Ib(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function FI(t,e){var n=no();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Ib(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function BI(t,e,n){return Mc&21?(To(n,e)||(n=VC(),wr.lanes|=n,kc|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,as=!0),t.memoizedState=n)}function i5(t,e){var n=Bn;Bn=n!==0&&4>n?n:4,t(!0);var r=mv.transition;mv.transition={};try{t(!1),e()}finally{Bn=n,mv.transition=r}}function NI(){return no().memoizedState}function s5(t,e,n){var r=Pl(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},UI(t))VI(e,n);else if(n=yI(t,e,n,r),n!==null){var i=Zi();bo(n,t,r,i),jI(n,e,r)}}function o5(t,e,n){var r=Pl(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(UI(t))VI(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var h=e.lastRenderedState,l=a(h,n);if(i.hasEagerState=!0,i.eagerState=l,To(l,h)){var m=e.interleaved;m===null?(i.next=i,Tb(e)):(i.next=m.next,m.next=i),e.interleaved=i;return}}catch{}finally{}n=yI(t,e,i,r),n!==null&&(i=Zi(),bo(n,t,r,i),jI(n,e,r))}}function UI(t){var e=t.alternate;return t===wr||e!==null&&e===wr}function VI(t,e){cf=sy=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function jI(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ub(t,n)}}var oy={readContext:to,useCallback:Ai,useContext:Ai,useEffect:Ai,useImperativeHandle:Ai,useInsertionEffect:Ai,useLayoutEffect:Ai,useMemo:Ai,useReducer:Ai,useRef:Ai,useState:Ai,useDebugValue:Ai,useDeferredValue:Ai,useTransition:Ai,useMutableSource:Ai,useSyncExternalStore:Ai,useId:Ai,unstable_isNewReconciler:!1},a5={readContext:to,useCallback:function(t,e){return Uo().memoizedState=[t,e===void 0?null:e],t},useContext:to,useEffect:mT,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,bg(4194308,4,zI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return bg(4194308,4,t,e)},useInsertionEffect:function(t,e){return bg(4,2,t,e)},useMemo:function(t,e){var n=Uo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Uo();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=s5.bind(null,wr,t),[r.memoizedState,t]},useRef:function(t){var e=Uo();return t={current:t},e.memoizedState=t},useState:pT,useDebugValue:Rb,useDeferredValue:function(t){return Uo().memoizedState=t},useTransition:function(){var t=pT(!1),e=t[0];return t=i5.bind(null,t[1]),Uo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=wr,i=Uo();if(gr){if(n===void 0)throw Error(Xe(407));n=n()}else{if(n=e(),li===null)throw Error(Xe(349));Mc&30||PI(r,e,n)}i.memoizedState=n;var a={value:n,getSnapshot:e};return i.queue=a,mT(CI.bind(null,r,a,t),[t]),r.flags|=2048,Df(9,AI.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=Uo(),e=li.identifierPrefix;if(gr){var n=wa,r=ba;n=(r&~(1<<32-xo(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Rf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=r5++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},l5={readContext:to,useCallback:OI,useContext:to,useEffect:Lb,useImperativeHandle:DI,useInsertionEffect:LI,useLayoutEffect:RI,useMemo:FI,useReducer:gv,useRef:kI,useState:function(){return gv(zf)},useDebugValue:Rb,useDeferredValue:function(t){var e=no();return BI(e,Qr.memoizedState,t)},useTransition:function(){var t=gv(zf)[0],e=no().memoizedState;return[t,e]},useMutableSource:TI,useSyncExternalStore:SI,useId:NI,unstable_isNewReconciler:!1},c5={readContext:to,useCallback:OI,useContext:to,useEffect:Lb,useImperativeHandle:DI,useInsertionEffect:LI,useLayoutEffect:RI,useMemo:FI,useReducer:yv,useRef:kI,useState:function(){return yv(zf)},useDebugValue:Rb,useDeferredValue:function(t){var e=no();return Qr===null?e.memoizedState=t:BI(e,Qr.memoizedState,t)},useTransition:function(){var t=yv(zf)[0],e=no().memoizedState;return[t,e]},useMutableSource:TI,useSyncExternalStore:SI,useId:NI,unstable_isNewReconciler:!1};function fh(t,e){try{var n="",r=e;do n+=F4(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function _v(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function qx(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var u5=typeof WeakMap=="function"?WeakMap:Map;function GI(t,e,n){n=Ea(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){ly||(ly=!0,r1=r),qx(t,e)},n}function $I(t,e,n){n=Ea(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){qx(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){qx(t,e),typeof r!="function"&&(Sl===null?Sl=new Set([this]):Sl.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),n}function gT(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new u5;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=T5.bind(null,t,e,n),e.then(t,t))}function yT(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function _T(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ea(-1,1),e.tag=2,Tl(n,e,1))),n.lanes|=1),t)}var h5=ka.ReactCurrentOwner,as=!1;function Wi(t,e,n,r){e.child=t===null?wI(e,null,n,r):hh(e,t.child,n,r)}function vT(t,e,n,r,i){n=n.render;var a=e.ref;return eh(e,i),r=Mb(t,e,n,r,a,i),n=kb(),t!==null&&!as?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Aa(t,e,i)):(gr&&n&&_b(e),e.flags|=1,Wi(t,e,r,i),e.child)}function xT(t,e,n,r,i){if(t===null){var a=n.type;return typeof a=="function"&&!Vb(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,WI(t,e,a,r,i)):(t=Sg(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var h=a.memoizedProps;if(n=n.compare,n=n!==null?n:Af,n(h,r)&&t.ref===e.ref)return Aa(t,e,i)}return e.flags|=1,t=Al(a,r),t.ref=e.ref,t.return=e,e.child=t}function WI(t,e,n,r,i){if(t!==null){var a=t.memoizedProps;if(Af(a,r)&&t.ref===e.ref)if(as=!1,e.pendingProps=r=a,(t.lanes&i)!==0)t.flags&131072&&(as=!0);else return e.lanes=t.lanes,Aa(t,e,i)}return Zx(t,e,n,r,i)}function HI(t,e,n){var r=e.pendingProps,i=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},sr(Hu,Ss),Ss|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,sr(Hu,Ss),Ss|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,sr(Hu,Ss),Ss|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,sr(Hu,Ss),Ss|=r;return Wi(t,e,i,n),e.child}function qI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Zx(t,e,n,r,i){var a=us(n)?Cc:zi.current;return a=ch(e,a),eh(e,i),n=Mb(t,e,n,r,a,i),r=kb(),t!==null&&!as?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Aa(t,e,i)):(gr&&r&&_b(e),e.flags|=1,Wi(t,e,n,i),e.child)}function bT(t,e,n,r,i){if(us(n)){var a=!0;Jg(e)}else a=!1;if(eh(e,i),e.stateNode===null)wg(t,e),xI(e,n,r),Hx(e,n,r,i),r=!0;else if(t===null){var h=e.stateNode,l=e.memoizedProps;h.props=l;var m=h.context,v=n.contextType;typeof v=="object"&&v!==null?v=to(v):(v=us(n)?Cc:zi.current,v=ch(e,v));var E=n.getDerivedStateFromProps,T=typeof E=="function"||typeof h.getSnapshotBeforeUpdate=="function";T||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==r||m!==v)&&dT(e,h,r,v),hl=!1;var S=e.memoizedState;h.state=S,ry(e,r,h,i),m=e.memoizedState,l!==r||S!==m||cs.current||hl?(typeof E=="function"&&(Wx(e,n,E,r),m=e.memoizedState),(l=hl||hT(e,n,l,r,S,m,v))?(T||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=m),h.props=r,h.state=m,h.context=v,r=l):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{h=e.stateNode,_I(t,e),l=e.memoizedProps,v=e.type===e.elementType?l:fo(e.type,l),h.props=v,T=e.pendingProps,S=h.context,m=n.contextType,typeof m=="object"&&m!==null?m=to(m):(m=us(n)?Cc:zi.current,m=ch(e,m));var z=n.getDerivedStateFromProps;(E=typeof z=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==T||S!==m)&&dT(e,h,r,m),hl=!1,S=e.memoizedState,h.state=S,ry(e,r,h,i);var D=e.memoizedState;l!==T||S!==D||cs.current||hl?(typeof z=="function"&&(Wx(e,n,z,r),D=e.memoizedState),(v=hl||hT(e,n,v,r,S,D,m)||!1)?(E||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(r,D,m),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(r,D,m)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=D),h.props=r,h.state=D,h.context=m,r=v):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=1024),r=!1)}return Xx(t,e,n,r,a,i)}function Xx(t,e,n,r,i,a){qI(t,e);var h=(e.flags&128)!==0;if(!r&&!h)return i&&oT(e,n,!1),Aa(t,e,a);r=e.stateNode,h5.current=e;var l=h&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&h?(e.child=hh(e,t.child,null,a),e.child=hh(e,null,l,a)):Wi(t,e,l,a),e.memoizedState=r.state,i&&oT(e,n,!0),e.child}function ZI(t){var e=t.stateNode;e.pendingContext?sT(t,e.pendingContext,e.pendingContext!==e.context):e.context&&sT(t,e.context,!1),Pb(t,e.containerInfo)}function wT(t,e,n,r,i){return uh(),xb(i),e.flags|=256,Wi(t,e,n,r),e.child}var Yx={dehydrated:null,treeContext:null,retryLane:0};function Kx(t){return{baseLanes:t,cachePool:null,transitions:null}}function XI(t,e,n){var r=e.pendingProps,i=xr.current,a=!1,h=(e.flags&128)!==0,l;if((l=h)||(l=t!==null&&t.memoizedState===null?!1:(i&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),sr(xr,i&1),t===null)return Gx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=r.children,t=r.fallback,a?(r=e.mode,a=e.child,h={mode:"hidden",children:h},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=h):a=t0(h,r,0,null),t=Sc(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Kx(n),e.memoizedState=Yx,t):zb(e,h));if(i=t.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return d5(t,e,h,r,l,i,n);if(a){a=r.fallback,h=e.mode,i=t.child,l=i.sibling;var m={mode:"hidden",children:r.children};return!(h&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=m,e.deletions=null):(r=Al(i,m),r.subtreeFlags=i.subtreeFlags&14680064),l!==null?a=Al(l,a):(a=Sc(a,h,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,h=t.child.memoizedState,h=h===null?Kx(n):{baseLanes:h.baseLanes|n,cachePool:null,transitions:h.transitions},a.memoizedState=h,a.childLanes=t.childLanes&~n,e.memoizedState=Yx,r}return a=t.child,t=a.sibling,r=Al(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function zb(t,e){return e=t0({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Bm(t,e,n,r){return r!==null&&xb(r),hh(e,t.child,null,n),t=zb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function d5(t,e,n,r,i,a,h){if(n)return e.flags&256?(e.flags&=-257,r=_v(Error(Xe(422))),Bm(t,e,h,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=t0({mode:"visible",children:r.children},i,0,null),a=Sc(a,i,h,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&hh(e,t.child,null,h),e.child.memoizedState=Kx(h),e.memoizedState=Yx,a);if(!(e.mode&1))return Bm(t,e,h,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var l=r.dgst;return r=l,a=Error(Xe(419)),r=_v(a,r,void 0),Bm(t,e,h,r)}if(l=(h&t.childLanes)!==0,as||l){if(r=li,r!==null){switch(h&-h){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|h)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,Pa(t,i),bo(r,t,i,-1))}return Ub(),r=_v(Error(Xe(421))),Bm(t,e,h,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=S5.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,Is=El(i.nextSibling),ks=e,gr=!0,mo=null,t!==null&&(Ys[Ks++]=ba,Ys[Ks++]=wa,Ys[Ks++]=Ic,ba=t.id,wa=t.overflow,Ic=e),e=zb(e,r.children),e.flags|=4096,e)}function ET(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),$x(t.return,e,n)}function vv(t,e,n,r,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function YI(t,e,n){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(Wi(t,e,r.children,n),r=xr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ET(t,n,e);else if(t.tag===19)ET(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(sr(xr,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&iy(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),vv(e,!1,i,n,a);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&iy(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}vv(e,!0,n,null,a);break;case"together":vv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function wg(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Aa(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),kc|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Xe(153));if(e.child!==null){for(t=e.child,n=Al(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Al(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function f5(t,e,n){switch(e.tag){case 3:ZI(e),uh();break;case 5:EI(e);break;case 1:us(e.type)&&Jg(e);break;case 4:Pb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;sr(ty,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(sr(xr,xr.current&1),e.flags|=128,null):n&e.child.childLanes?XI(t,e,n):(sr(xr,xr.current&1),t=Aa(t,e,n),t!==null?t.sibling:null);sr(xr,xr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return YI(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),sr(xr,xr.current),r)break;return null;case 22:case 23:return e.lanes=0,HI(t,e,n)}return Aa(t,e,n)}var KI,Jx,JI,QI;KI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Jx=function(){};JI=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,vc(Xo.current);var a=null;switch(n){case"input":i=xx(t,i),r=xx(t,r),a=[];break;case"select":i=Er({},i,{value:void 0}),r=Er({},r,{value:void 0}),a=[];break;case"textarea":i=Ex(t,i),r=Ex(t,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Yg)}Sx(n,r);var h;n=null;for(v in i)if(!r.hasOwnProperty(v)&&i.hasOwnProperty(v)&&i[v]!=null)if(v==="style"){var l=i[v];for(h in l)l.hasOwnProperty(h)&&(n||(n={}),n[h]="")}else v!=="dangerouslySetInnerHTML"&&v!=="children"&&v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(xf.hasOwnProperty(v)?a||(a=[]):(a=a||[]).push(v,null));for(v in r){var m=r[v];if(l=i!=null?i[v]:void 0,r.hasOwnProperty(v)&&m!==l&&(m!=null||l!=null))if(v==="style")if(l){for(h in l)!l.hasOwnProperty(h)||m&&m.hasOwnProperty(h)||(n||(n={}),n[h]="");for(h in m)m.hasOwnProperty(h)&&l[h]!==m[h]&&(n||(n={}),n[h]=m[h])}else n||(a||(a=[]),a.push(v,n)),n=m;else v==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,l=l?l.__html:void 0,m!=null&&l!==m&&(a=a||[]).push(v,m)):v==="children"?typeof m!="string"&&typeof m!="number"||(a=a||[]).push(v,""+m):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&(xf.hasOwnProperty(v)?(m!=null&&v==="onScroll"&&lr("scroll",t),a||l===m||(a=[])):(a=a||[]).push(v,m))}n&&(a=a||[]).push("style",n);var v=a;(e.updateQueue=v)&&(e.flags|=4)}};QI=function(t,e,n,r){n!==r&&(e.flags|=4)};function Rd(t,e){if(!gr)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ci(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function p5(t,e,n){var r=e.pendingProps;switch(vb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ci(e),null;case 1:return us(e.type)&&Kg(),Ci(e),null;case 3:return r=e.stateNode,dh(),ur(cs),ur(zi),Cb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Om(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,mo!==null&&(o1(mo),mo=null))),Jx(t,e),Ci(e),null;case 5:Ab(e);var i=vc(Lf.current);if(n=e.type,t!==null&&e.stateNode!=null)JI(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Xe(166));return Ci(e),null}if(t=vc(Xo.current),Om(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[Go]=e,r[Mf]=a,t=(e.mode&1)!==0,n){case"dialog":lr("cancel",r),lr("close",r);break;case"iframe":case"object":case"embed":lr("load",r);break;case"video":case"audio":for(i=0;i<Kd.length;i++)lr(Kd[i],r);break;case"source":lr("error",r);break;case"img":case"image":case"link":lr("error",r),lr("load",r);break;case"details":lr("toggle",r);break;case"input":LE(r,a),lr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},lr("invalid",r);break;case"textarea":zE(r,a),lr("invalid",r)}Sx(n,a),i=null;for(var h in a)if(a.hasOwnProperty(h)){var l=a[h];h==="children"?typeof l=="string"?r.textContent!==l&&(a.suppressHydrationWarning!==!0&&Dm(r.textContent,l,t),i=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&Dm(r.textContent,l,t),i=["children",""+l]):xf.hasOwnProperty(h)&&l!=null&&h==="onScroll"&&lr("scroll",r)}switch(n){case"input":Am(r),RE(r,a,!0);break;case"textarea":Am(r),DE(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Yg)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{h=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=PC(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=h.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=h.createElement(n,{is:r.is}):(t=h.createElement(n),n==="select"&&(h=t,r.multiple?h.multiple=!0:r.size&&(h.size=r.size))):t=h.createElementNS(t,n),t[Go]=e,t[Mf]=r,KI(t,e,!1,!1),e.stateNode=t;e:{switch(h=Px(n,r),n){case"dialog":lr("cancel",t),lr("close",t),i=r;break;case"iframe":case"object":case"embed":lr("load",t),i=r;break;case"video":case"audio":for(i=0;i<Kd.length;i++)lr(Kd[i],t);i=r;break;case"source":lr("error",t),i=r;break;case"img":case"image":case"link":lr("error",t),lr("load",t),i=r;break;case"details":lr("toggle",t),i=r;break;case"input":LE(t,r),i=xx(t,r),lr("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Er({},r,{value:void 0}),lr("invalid",t);break;case"textarea":zE(t,r),i=Ex(t,r),lr("invalid",t);break;default:i=r}Sx(n,i),l=i;for(a in l)if(l.hasOwnProperty(a)){var m=l[a];a==="style"?IC(t,m):a==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,m!=null&&AC(t,m)):a==="children"?typeof m=="string"?(n!=="textarea"||m!=="")&&bf(t,m):typeof m=="number"&&bf(t,""+m):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(xf.hasOwnProperty(a)?m!=null&&a==="onScroll"&&lr("scroll",t):m!=null&&ib(t,a,m,h))}switch(n){case"input":Am(t),RE(t,r,!1);break;case"textarea":Am(t),DE(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ml(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?Yu(t,!!r.multiple,a,!1):r.defaultValue!=null&&Yu(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Yg)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ci(e),null;case 6:if(t&&e.stateNode!=null)QI(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Xe(166));if(n=vc(Lf.current),vc(Xo.current),Om(e)){if(r=e.stateNode,n=e.memoizedProps,r[Go]=e,(a=r.nodeValue!==n)&&(t=ks,t!==null))switch(t.tag){case 3:Dm(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Dm(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Go]=e,e.stateNode=r}return Ci(e),null;case 13:if(ur(xr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gr&&Is!==null&&e.mode&1&&!(e.flags&128))gI(),uh(),e.flags|=98560,a=!1;else if(a=Om(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(Xe(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Xe(317));a[Go]=e}else uh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ci(e),a=!1}else mo!==null&&(o1(mo),mo=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||xr.current&1?ei===0&&(ei=3):Ub())),e.updateQueue!==null&&(e.flags|=4),Ci(e),null);case 4:return dh(),Jx(t,e),t===null&&Cf(e.stateNode.containerInfo),Ci(e),null;case 10:return Eb(e.type._context),Ci(e),null;case 17:return us(e.type)&&Kg(),Ci(e),null;case 19:if(ur(xr),a=e.memoizedState,a===null)return Ci(e),null;if(r=(e.flags&128)!==0,h=a.rendering,h===null)if(r)Rd(a,!1);else{if(ei!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(h=iy(t),h!==null){for(e.flags|=128,Rd(a,!1),r=h.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,h=a.alternate,h===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,t=h.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return sr(xr,xr.current&1|2),e.child}t=t.sibling}a.tail!==null&&Br()>ph&&(e.flags|=128,r=!0,Rd(a,!1),e.lanes=4194304)}else{if(!r)if(t=iy(h),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Rd(a,!0),a.tail===null&&a.tailMode==="hidden"&&!h.alternate&&!gr)return Ci(e),null}else 2*Br()-a.renderingStartTime>ph&&n!==1073741824&&(e.flags|=128,r=!0,Rd(a,!1),e.lanes=4194304);a.isBackwards?(h.sibling=e.child,e.child=h):(n=a.last,n!==null?n.sibling=h:e.child=h,a.last=h)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Br(),e.sibling=null,n=xr.current,sr(xr,r?n&1|2:n&1),e):(Ci(e),null);case 22:case 23:return Nb(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ss&1073741824&&(Ci(e),e.subtreeFlags&6&&(e.flags|=8192)):Ci(e),null;case 24:return null;case 25:return null}throw Error(Xe(156,e.tag))}function m5(t,e){switch(vb(e),e.tag){case 1:return us(e.type)&&Kg(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return dh(),ur(cs),ur(zi),Cb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ab(e),null;case 13:if(ur(xr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Xe(340));uh()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ur(xr),null;case 4:return dh(),null;case 10:return Eb(e.type._context),null;case 22:case 23:return Nb(),null;case 24:return null;default:return null}}var Nm=!1,Li=!1,g5=typeof WeakSet=="function"?WeakSet:Set,Et=null;function Wu(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Mr(t,e,r)}else n.current=null}function Qx(t,e,n){try{n()}catch(r){Mr(t,e,r)}}var TT=!1;function y5(t,e){if(Ox=qg,t=rI(),yb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var h=0,l=-1,m=-1,v=0,E=0,T=t,S=null;t:for(;;){for(var z;T!==n||i!==0&&T.nodeType!==3||(l=h+i),T!==a||r!==0&&T.nodeType!==3||(m=h+r),T.nodeType===3&&(h+=T.nodeValue.length),(z=T.firstChild)!==null;)S=T,T=z;for(;;){if(T===t)break t;if(S===n&&++v===i&&(l=h),S===a&&++E===r&&(m=h),(z=T.nextSibling)!==null)break;T=S,S=T.parentNode}T=z}n=l===-1||m===-1?null:{start:l,end:m}}else n=null}n=n||{start:0,end:0}}else n=null;for(Fx={focusedElem:t,selectionRange:n},qg=!1,Et=e;Et!==null;)if(e=Et,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Et=t;else for(;Et!==null;){e=Et;try{var D=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(D!==null){var F=D.memoizedProps,J=D.memoizedState,U=e.stateNode,V=U.getSnapshotBeforeUpdate(e.elementType===e.type?F:fo(e.type,F),J);U.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var G=e.stateNode.containerInfo;G.nodeType===1?G.textContent="":G.nodeType===9&&G.documentElement&&G.removeChild(G.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(ee){Mr(e,e.return,ee)}if(t=e.sibling,t!==null){t.return=e.return,Et=t;break}Et=e.return}return D=TT,TT=!1,D}function uf(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&Qx(e,n,a)}i=i.next}while(i!==r)}}function Qy(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function e1(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function eM(t){var e=t.alternate;e!==null&&(t.alternate=null,eM(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Go],delete e[Mf],delete e[Ux],delete e[Qz],delete e[e5])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function tM(t){return t.tag===5||t.tag===3||t.tag===4}function ST(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||tM(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function t1(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Yg));else if(r!==4&&(t=t.child,t!==null))for(t1(t,e,n),t=t.sibling;t!==null;)t1(t,e,n),t=t.sibling}function n1(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(n1(t,e,n),t=t.sibling;t!==null;)n1(t,e,n),t=t.sibling}var mi=null,po=!1;function rl(t,e,n){for(n=n.child;n!==null;)nM(t,e,n),n=n.sibling}function nM(t,e,n){if(Zo&&typeof Zo.onCommitFiberUnmount=="function")try{Zo.onCommitFiberUnmount(Wy,n)}catch{}switch(n.tag){case 5:Li||Wu(n,e);case 6:var r=mi,i=po;mi=null,rl(t,e,n),mi=r,po=i,mi!==null&&(po?(t=mi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):mi.removeChild(n.stateNode));break;case 18:mi!==null&&(po?(t=mi,n=n.stateNode,t.nodeType===8?dv(t.parentNode,n):t.nodeType===1&&dv(t,n),Sf(t)):dv(mi,n.stateNode));break;case 4:r=mi,i=po,mi=n.stateNode.containerInfo,po=!0,rl(t,e,n),mi=r,po=i;break;case 0:case 11:case 14:case 15:if(!Li&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,h=a.destroy;a=a.tag,h!==void 0&&(a&2||a&4)&&Qx(n,e,h),i=i.next}while(i!==r)}rl(t,e,n);break;case 1:if(!Li&&(Wu(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Mr(n,e,l)}rl(t,e,n);break;case 21:rl(t,e,n);break;case 22:n.mode&1?(Li=(r=Li)||n.memoizedState!==null,rl(t,e,n),Li=r):rl(t,e,n);break;default:rl(t,e,n)}}function PT(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new g5),e.forEach(function(r){var i=P5.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function ho(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=t,h=e,l=h;e:for(;l!==null;){switch(l.tag){case 5:mi=l.stateNode,po=!1;break e;case 3:mi=l.stateNode.containerInfo,po=!0;break e;case 4:mi=l.stateNode.containerInfo,po=!0;break e}l=l.return}if(mi===null)throw Error(Xe(160));nM(a,h,i),mi=null,po=!1;var m=i.alternate;m!==null&&(m.return=null),i.return=null}catch(v){Mr(i,e,v)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)rM(e,t),e=e.sibling}function rM(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ho(e,t),Oo(t),r&4){try{uf(3,t,t.return),Qy(3,t)}catch(F){Mr(t,t.return,F)}try{uf(5,t,t.return)}catch(F){Mr(t,t.return,F)}}break;case 1:ho(e,t),Oo(t),r&512&&n!==null&&Wu(n,n.return);break;case 5:if(ho(e,t),Oo(t),r&512&&n!==null&&Wu(n,n.return),t.flags&32){var i=t.stateNode;try{bf(i,"")}catch(F){Mr(t,t.return,F)}}if(r&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,h=n!==null?n.memoizedProps:a,l=t.type,m=t.updateQueue;if(t.updateQueue=null,m!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&TC(i,a),Px(l,h);var v=Px(l,a);for(h=0;h<m.length;h+=2){var E=m[h],T=m[h+1];E==="style"?IC(i,T):E==="dangerouslySetInnerHTML"?AC(i,T):E==="children"?bf(i,T):ib(i,E,T,v)}switch(l){case"input":bx(i,a);break;case"textarea":SC(i,a);break;case"select":var S=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var z=a.value;z!=null?Yu(i,!!a.multiple,z,!1):S!==!!a.multiple&&(a.defaultValue!=null?Yu(i,!!a.multiple,a.defaultValue,!0):Yu(i,!!a.multiple,a.multiple?[]:"",!1))}i[Mf]=a}catch(F){Mr(t,t.return,F)}}break;case 6:if(ho(e,t),Oo(t),r&4){if(t.stateNode===null)throw Error(Xe(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(F){Mr(t,t.return,F)}}break;case 3:if(ho(e,t),Oo(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Sf(e.containerInfo)}catch(F){Mr(t,t.return,F)}break;case 4:ho(e,t),Oo(t);break;case 13:ho(e,t),Oo(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Fb=Br())),r&4&&PT(t);break;case 22:if(E=n!==null&&n.memoizedState!==null,t.mode&1?(Li=(v=Li)||E,ho(e,t),Li=v):ho(e,t),Oo(t),r&8192){if(v=t.memoizedState!==null,(t.stateNode.isHidden=v)&&!E&&t.mode&1)for(Et=t,E=t.child;E!==null;){for(T=Et=E;Et!==null;){switch(S=Et,z=S.child,S.tag){case 0:case 11:case 14:case 15:uf(4,S,S.return);break;case 1:Wu(S,S.return);var D=S.stateNode;if(typeof D.componentWillUnmount=="function"){r=S,n=S.return;try{e=r,D.props=e.memoizedProps,D.state=e.memoizedState,D.componentWillUnmount()}catch(F){Mr(r,n,F)}}break;case 5:Wu(S,S.return);break;case 22:if(S.memoizedState!==null){CT(T);continue}}z!==null?(z.return=S,Et=z):CT(T)}E=E.sibling}e:for(E=null,T=t;;){if(T.tag===5){if(E===null){E=T;try{i=T.stateNode,v?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=T.stateNode,m=T.memoizedProps.style,h=m!=null&&m.hasOwnProperty("display")?m.display:null,l.style.display=CC("display",h))}catch(F){Mr(t,t.return,F)}}}else if(T.tag===6){if(E===null)try{T.stateNode.nodeValue=v?"":T.memoizedProps}catch(F){Mr(t,t.return,F)}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===t)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===t)break e;for(;T.sibling===null;){if(T.return===null||T.return===t)break e;E===T&&(E=null),T=T.return}E===T&&(E=null),T.sibling.return=T.return,T=T.sibling}}break;case 19:ho(e,t),Oo(t),r&4&&PT(t);break;case 21:break;default:ho(e,t),Oo(t)}}function Oo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(tM(n)){var r=n;break e}n=n.return}throw Error(Xe(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(bf(i,""),r.flags&=-33);var a=ST(t);n1(t,a,i);break;case 3:case 4:var h=r.stateNode.containerInfo,l=ST(t);t1(t,l,h);break;default:throw Error(Xe(161))}}catch(m){Mr(t,t.return,m)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function _5(t,e,n){Et=t,iM(t)}function iM(t,e,n){for(var r=(t.mode&1)!==0;Et!==null;){var i=Et,a=i.child;if(i.tag===22&&r){var h=i.memoizedState!==null||Nm;if(!h){var l=i.alternate,m=l!==null&&l.memoizedState!==null||Li;l=Nm;var v=Li;if(Nm=h,(Li=m)&&!v)for(Et=i;Et!==null;)h=Et,m=h.child,h.tag===22&&h.memoizedState!==null?IT(i):m!==null?(m.return=h,Et=m):IT(i);for(;a!==null;)Et=a,iM(a),a=a.sibling;Et=i,Nm=l,Li=v}AT(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Et=a):AT(t)}}function AT(t){for(;Et!==null;){var e=Et;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Li||Qy(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Li)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:fo(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&uT(e,a,r);break;case 3:var h=e.updateQueue;if(h!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}uT(e,h,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var m=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":m.autoFocus&&n.focus();break;case"img":m.src&&(n.src=m.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var v=e.alternate;if(v!==null){var E=v.memoizedState;if(E!==null){var T=E.dehydrated;T!==null&&Sf(T)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}Li||e.flags&512&&e1(e)}catch(S){Mr(e,e.return,S)}}if(e===t){Et=null;break}if(n=e.sibling,n!==null){n.return=e.return,Et=n;break}Et=e.return}}function CT(t){for(;Et!==null;){var e=Et;if(e===t){Et=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Et=n;break}Et=e.return}}function IT(t){for(;Et!==null;){var e=Et;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Qy(4,e)}catch(m){Mr(e,n,m)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(m){Mr(e,i,m)}}var a=e.return;try{e1(e)}catch(m){Mr(e,a,m)}break;case 5:var h=e.return;try{e1(e)}catch(m){Mr(e,h,m)}}}catch(m){Mr(e,e.return,m)}if(e===t){Et=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Et=l;break}Et=e.return}}var v5=Math.ceil,ay=ka.ReactCurrentDispatcher,Db=ka.ReactCurrentOwner,Qs=ka.ReactCurrentBatchConfig,En=0,li=null,qr=null,yi=0,Ss=0,Hu=zl(0),ei=0,Of=null,kc=0,e0=0,Ob=0,hf=null,os=null,Fb=0,ph=1/0,ya=null,ly=!1,r1=null,Sl=null,Um=!1,ml=null,cy=0,df=0,i1=null,Eg=-1,Tg=0;function Zi(){return En&6?Br():Eg!==-1?Eg:Eg=Br()}function Pl(t){return t.mode&1?En&2&&yi!==0?yi&-yi:n5.transition!==null?(Tg===0&&(Tg=VC()),Tg):(t=Bn,t!==0||(t=window.event,t=t===void 0?16:ZC(t.type)),t):1}function bo(t,e,n,r){if(50<df)throw df=0,i1=null,Error(Xe(185));tp(t,n,r),(!(En&2)||t!==li)&&(t===li&&(!(En&2)&&(e0|=n),ei===4&&fl(t,yi)),hs(t,r),n===1&&En===0&&!(e.mode&1)&&(ph=Br()+500,Yy&&Dl()))}function hs(t,e){var n=t.callbackNode;nz(t,e);var r=Hg(t,t===li?yi:0);if(r===0)n!==null&&BE(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&BE(n),e===1)t.tag===0?t5(MT.bind(null,t)):fI(MT.bind(null,t)),Kz(function(){!(En&6)&&Dl()}),n=null;else{switch(jC(r)){case 1:n=cb;break;case 4:n=NC;break;case 16:n=Wg;break;case 536870912:n=UC;break;default:n=Wg}n=dM(n,sM.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function sM(t,e){if(Eg=-1,Tg=0,En&6)throw Error(Xe(327));var n=t.callbackNode;if(th()&&t.callbackNode!==n)return null;var r=Hg(t,t===li?yi:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=uy(t,r);else{e=r;var i=En;En|=2;var a=aM();(li!==t||yi!==e)&&(ya=null,ph=Br()+500,Tc(t,e));do try{w5();break}catch(l){oM(t,l)}while(1);wb(),ay.current=a,En=i,qr!==null?e=0:(li=null,yi=0,e=ei)}if(e!==0){if(e===2&&(i=kx(t),i!==0&&(r=i,e=s1(t,i))),e===1)throw n=Of,Tc(t,0),fl(t,r),hs(t,Br()),n;if(e===6)fl(t,r);else{if(i=t.current.alternate,!(r&30)&&!x5(i)&&(e=uy(t,r),e===2&&(a=kx(t),a!==0&&(r=a,e=s1(t,a))),e===1))throw n=Of,Tc(t,0),fl(t,r),hs(t,Br()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(Xe(345));case 2:pc(t,os,ya);break;case 3:if(fl(t,r),(r&130023424)===r&&(e=Fb+500-Br(),10<e)){if(Hg(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Zi(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Nx(pc.bind(null,t,os,ya),e);break}pc(t,os,ya);break;case 4:if(fl(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var h=31-xo(r);a=1<<h,h=e[h],h>i&&(i=h),r&=~a}if(r=i,r=Br()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*v5(r/1960))-r,10<r){t.timeoutHandle=Nx(pc.bind(null,t,os,ya),r);break}pc(t,os,ya);break;case 5:pc(t,os,ya);break;default:throw Error(Xe(329))}}}return hs(t,Br()),t.callbackNode===n?sM.bind(null,t):null}function s1(t,e){var n=hf;return t.current.memoizedState.isDehydrated&&(Tc(t,e).flags|=256),t=uy(t,e),t!==2&&(e=os,os=n,e!==null&&o1(e)),t}function o1(t){os===null?os=t:os.push.apply(os,t)}function x5(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!To(a(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function fl(t,e){for(e&=~Ob,e&=~e0,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-xo(e),r=1<<n;t[n]=-1,e&=~r}}function MT(t){if(En&6)throw Error(Xe(327));th();var e=Hg(t,0);if(!(e&1))return hs(t,Br()),null;var n=uy(t,e);if(t.tag!==0&&n===2){var r=kx(t);r!==0&&(e=r,n=s1(t,r))}if(n===1)throw n=Of,Tc(t,0),fl(t,e),hs(t,Br()),n;if(n===6)throw Error(Xe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,pc(t,os,ya),hs(t,Br()),null}function Bb(t,e){var n=En;En|=1;try{return t(e)}finally{En=n,En===0&&(ph=Br()+500,Yy&&Dl())}}function Lc(t){ml!==null&&ml.tag===0&&!(En&6)&&th();var e=En;En|=1;var n=Qs.transition,r=Bn;try{if(Qs.transition=null,Bn=1,t)return t()}finally{Bn=r,Qs.transition=n,En=e,!(En&6)&&Dl()}}function Nb(){Ss=Hu.current,ur(Hu)}function Tc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Yz(n)),qr!==null)for(n=qr.return;n!==null;){var r=n;switch(vb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Kg();break;case 3:dh(),ur(cs),ur(zi),Cb();break;case 5:Ab(r);break;case 4:dh();break;case 13:ur(xr);break;case 19:ur(xr);break;case 10:Eb(r.type._context);break;case 22:case 23:Nb()}n=n.return}if(li=t,qr=t=Al(t.current,null),yi=Ss=e,ei=0,Of=null,Ob=e0=kc=0,os=hf=null,_c!==null){for(e=0;e<_c.length;e++)if(n=_c[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var h=a.next;a.next=i,r.next=h}n.pending=r}_c=null}return t}function oM(t,e){do{var n=qr;try{if(wb(),xg.current=oy,sy){for(var r=wr.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}sy=!1}if(Mc=0,oi=Qr=wr=null,cf=!1,Rf=0,Db.current=null,n===null||n.return===null){ei=1,Of=e,qr=null;break}e:{var a=t,h=n.return,l=n,m=e;if(e=yi,l.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){var v=m,E=l,T=E.tag;if(!(E.mode&1)&&(T===0||T===11||T===15)){var S=E.alternate;S?(E.updateQueue=S.updateQueue,E.memoizedState=S.memoizedState,E.lanes=S.lanes):(E.updateQueue=null,E.memoizedState=null)}var z=yT(h);if(z!==null){z.flags&=-257,_T(z,h,l,a,e),z.mode&1&&gT(a,v,e),e=z,m=v;var D=e.updateQueue;if(D===null){var F=new Set;F.add(m),e.updateQueue=F}else D.add(m);break e}else{if(!(e&1)){gT(a,v,e),Ub();break e}m=Error(Xe(426))}}else if(gr&&l.mode&1){var J=yT(h);if(J!==null){!(J.flags&65536)&&(J.flags|=256),_T(J,h,l,a,e),xb(fh(m,l));break e}}a=m=fh(m,l),ei!==4&&(ei=2),hf===null?hf=[a]:hf.push(a),a=h;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var U=GI(a,m,e);cT(a,U);break e;case 1:l=m;var V=a.type,G=a.stateNode;if(!(a.flags&128)&&(typeof V.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(Sl===null||!Sl.has(G)))){a.flags|=65536,e&=-e,a.lanes|=e;var ee=$I(a,l,e);cT(a,ee);break e}}a=a.return}while(a!==null)}cM(n)}catch(se){e=se,qr===n&&n!==null&&(qr=n=n.return);continue}break}while(1)}function aM(){var t=ay.current;return ay.current=oy,t===null?oy:t}function Ub(){(ei===0||ei===3||ei===2)&&(ei=4),li===null||!(kc&268435455)&&!(e0&268435455)||fl(li,yi)}function uy(t,e){var n=En;En|=2;var r=aM();(li!==t||yi!==e)&&(ya=null,Tc(t,e));do try{b5();break}catch(i){oM(t,i)}while(1);if(wb(),En=n,ay.current=r,qr!==null)throw Error(Xe(261));return li=null,yi=0,ei}function b5(){for(;qr!==null;)lM(qr)}function w5(){for(;qr!==null&&!q4();)lM(qr)}function lM(t){var e=hM(t.alternate,t,Ss);t.memoizedProps=t.pendingProps,e===null?cM(t):qr=e,Db.current=null}function cM(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=m5(n,e),n!==null){n.flags&=32767,qr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ei=6,qr=null;return}}else if(n=p5(n,e,Ss),n!==null){qr=n;return}if(e=e.sibling,e!==null){qr=e;return}qr=e=t}while(e!==null);ei===0&&(ei=5)}function pc(t,e,n){var r=Bn,i=Qs.transition;try{Qs.transition=null,Bn=1,E5(t,e,n,r)}finally{Qs.transition=i,Bn=r}return null}function E5(t,e,n,r){do th();while(ml!==null);if(En&6)throw Error(Xe(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Xe(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(rz(t,a),t===li&&(qr=li=null,yi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Um||(Um=!0,dM(Wg,function(){return th(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Qs.transition,Qs.transition=null;var h=Bn;Bn=1;var l=En;En|=4,Db.current=null,y5(t,n),rM(n,t),Gz(Fx),qg=!!Ox,Fx=Ox=null,t.current=n,_5(n),Z4(),En=l,Bn=h,Qs.transition=a}else t.current=n;if(Um&&(Um=!1,ml=t,cy=i),a=t.pendingLanes,a===0&&(Sl=null),K4(n.stateNode),hs(t,Br()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ly)throw ly=!1,t=r1,r1=null,t;return cy&1&&t.tag!==0&&th(),a=t.pendingLanes,a&1?t===i1?df++:(df=0,i1=t):df=0,Dl(),null}function th(){if(ml!==null){var t=jC(cy),e=Qs.transition,n=Bn;try{if(Qs.transition=null,Bn=16>t?16:t,ml===null)var r=!1;else{if(t=ml,ml=null,cy=0,En&6)throw Error(Xe(331));var i=En;for(En|=4,Et=t.current;Et!==null;){var a=Et,h=a.child;if(Et.flags&16){var l=a.deletions;if(l!==null){for(var m=0;m<l.length;m++){var v=l[m];for(Et=v;Et!==null;){var E=Et;switch(E.tag){case 0:case 11:case 15:uf(8,E,a)}var T=E.child;if(T!==null)T.return=E,Et=T;else for(;Et!==null;){E=Et;var S=E.sibling,z=E.return;if(eM(E),E===v){Et=null;break}if(S!==null){S.return=z,Et=S;break}Et=z}}}var D=a.alternate;if(D!==null){var F=D.child;if(F!==null){D.child=null;do{var J=F.sibling;F.sibling=null,F=J}while(F!==null)}}Et=a}}if(a.subtreeFlags&2064&&h!==null)h.return=a,Et=h;else e:for(;Et!==null;){if(a=Et,a.flags&2048)switch(a.tag){case 0:case 11:case 15:uf(9,a,a.return)}var U=a.sibling;if(U!==null){U.return=a.return,Et=U;break e}Et=a.return}}var V=t.current;for(Et=V;Et!==null;){h=Et;var G=h.child;if(h.subtreeFlags&2064&&G!==null)G.return=h,Et=G;else e:for(h=V;Et!==null;){if(l=Et,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Qy(9,l)}}catch(se){Mr(l,l.return,se)}if(l===h){Et=null;break e}var ee=l.sibling;if(ee!==null){ee.return=l.return,Et=ee;break e}Et=l.return}}if(En=i,Dl(),Zo&&typeof Zo.onPostCommitFiberRoot=="function")try{Zo.onPostCommitFiberRoot(Wy,t)}catch{}r=!0}return r}finally{Bn=n,Qs.transition=e}}return!1}function kT(t,e,n){e=fh(n,e),e=GI(t,e,1),t=Tl(t,e,1),e=Zi(),t!==null&&(tp(t,1,e),hs(t,e))}function Mr(t,e,n){if(t.tag===3)kT(t,t,n);else for(;e!==null;){if(e.tag===3){kT(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Sl===null||!Sl.has(r))){t=fh(n,t),t=$I(e,t,1),e=Tl(e,t,1),t=Zi(),e!==null&&(tp(e,1,t),hs(e,t));break}}e=e.return}}function T5(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Zi(),t.pingedLanes|=t.suspendedLanes&n,li===t&&(yi&n)===n&&(ei===4||ei===3&&(yi&130023424)===yi&&500>Br()-Fb?Tc(t,0):Ob|=n),hs(t,e)}function uM(t,e){e===0&&(t.mode&1?(e=Mm,Mm<<=1,!(Mm&130023424)&&(Mm=4194304)):e=1);var n=Zi();t=Pa(t,e),t!==null&&(tp(t,e,n),hs(t,n))}function S5(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),uM(t,n)}function P5(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Xe(314))}r!==null&&r.delete(e),uM(t,n)}var hM;hM=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||cs.current)as=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return as=!1,f5(t,e,n);as=!!(t.flags&131072)}else as=!1,gr&&e.flags&1048576&&pI(e,ey,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;wg(t,e),t=e.pendingProps;var i=ch(e,zi.current);eh(e,n),i=Mb(null,e,r,t,i,n);var a=kb();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,us(r)?(a=!0,Jg(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Sb(e),i.updater=Ky,e.stateNode=i,i._reactInternals=e,Hx(e,r,t,n),e=Xx(null,e,r,!0,a,n)):(e.tag=0,gr&&a&&_b(e),Wi(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(wg(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=C5(r),t=fo(r,t),i){case 0:e=Zx(null,e,r,t,n);break e;case 1:e=bT(null,e,r,t,n);break e;case 11:e=vT(null,e,r,t,n);break e;case 14:e=xT(null,e,r,fo(r.type,t),n);break e}throw Error(Xe(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fo(r,i),Zx(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fo(r,i),bT(t,e,r,i,n);case 3:e:{if(ZI(e),t===null)throw Error(Xe(387));r=e.pendingProps,a=e.memoizedState,i=a.element,_I(t,e),ry(e,r,null,n);var h=e.memoizedState;if(r=h.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=fh(Error(Xe(423)),e),e=wT(t,e,r,n,i);break e}else if(r!==i){i=fh(Error(Xe(424)),e),e=wT(t,e,r,n,i);break e}else for(Is=El(e.stateNode.containerInfo.firstChild),ks=e,gr=!0,mo=null,n=wI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(uh(),r===i){e=Aa(t,e,n);break e}Wi(t,e,r,n)}e=e.child}return e;case 5:return EI(e),t===null&&Gx(e),r=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,h=i.children,Bx(r,i)?h=null:a!==null&&Bx(r,a)&&(e.flags|=32),qI(t,e),Wi(t,e,h,n),e.child;case 6:return t===null&&Gx(e),null;case 13:return XI(t,e,n);case 4:return Pb(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=hh(e,null,r,n):Wi(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fo(r,i),vT(t,e,r,i,n);case 7:return Wi(t,e,e.pendingProps,n),e.child;case 8:return Wi(t,e,e.pendingProps.children,n),e.child;case 12:return Wi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,h=i.value,sr(ty,r._currentValue),r._currentValue=h,a!==null)if(To(a.value,h)){if(a.children===i.children&&!cs.current){e=Aa(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){h=a.child;for(var m=l.firstContext;m!==null;){if(m.context===r){if(a.tag===1){m=Ea(-1,n&-n),m.tag=2;var v=a.updateQueue;if(v!==null){v=v.shared;var E=v.pending;E===null?m.next=m:(m.next=E.next,E.next=m),v.pending=m}}a.lanes|=n,m=a.alternate,m!==null&&(m.lanes|=n),$x(a.return,n,e),l.lanes|=n;break}m=m.next}}else if(a.tag===10)h=a.type===e.type?null:a.child;else if(a.tag===18){if(h=a.return,h===null)throw Error(Xe(341));h.lanes|=n,l=h.alternate,l!==null&&(l.lanes|=n),$x(h,n,e),h=a.sibling}else h=a.child;if(h!==null)h.return=a;else for(h=a;h!==null;){if(h===e){h=null;break}if(a=h.sibling,a!==null){a.return=h.return,h=a;break}h=h.return}a=h}Wi(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,eh(e,n),i=to(i),r=r(i),e.flags|=1,Wi(t,e,r,n),e.child;case 14:return r=e.type,i=fo(r,e.pendingProps),i=fo(r.type,i),xT(t,e,r,i,n);case 15:return WI(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fo(r,i),wg(t,e),e.tag=1,us(r)?(t=!0,Jg(e)):t=!1,eh(e,n),xI(e,r,i),Hx(e,r,i,n),Xx(null,e,r,!0,t,n);case 19:return YI(t,e,n);case 22:return HI(t,e,n)}throw Error(Xe(156,e.tag))};function dM(t,e){return BC(t,e)}function A5(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Js(t,e,n,r){return new A5(t,e,n,r)}function Vb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function C5(t){if(typeof t=="function")return Vb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ob)return 11;if(t===ab)return 14}return 2}function Al(t,e){var n=t.alternate;return n===null?(n=Js(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Sg(t,e,n,r,i,a){var h=2;if(r=t,typeof t=="function")Vb(t)&&(h=1);else if(typeof t=="string")h=5;else e:switch(t){case Ou:return Sc(n.children,i,a,e);case sb:h=8,i|=8;break;case gx:return t=Js(12,n,e,i|2),t.elementType=gx,t.lanes=a,t;case yx:return t=Js(13,n,e,i),t.elementType=yx,t.lanes=a,t;case _x:return t=Js(19,n,e,i),t.elementType=_x,t.lanes=a,t;case bC:return t0(n,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case vC:h=10;break e;case xC:h=9;break e;case ob:h=11;break e;case ab:h=14;break e;case ul:h=16,r=null;break e}throw Error(Xe(130,t==null?t:typeof t,""))}return e=Js(h,n,e,i),e.elementType=t,e.type=r,e.lanes=a,e}function Sc(t,e,n,r){return t=Js(7,t,r,e),t.lanes=n,t}function t0(t,e,n,r){return t=Js(22,t,r,e),t.elementType=bC,t.lanes=n,t.stateNode={isHidden:!1},t}function xv(t,e,n){return t=Js(6,t,null,e),t.lanes=n,t}function bv(t,e,n){return e=Js(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function I5(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tv(0),this.expirationTimes=tv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tv(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jb(t,e,n,r,i,a,h,l,m){return t=new I5(t,e,n,l,m),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Js(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sb(a),t}function M5(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Du,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function fM(t){if(!t)return kl;t=t._reactInternals;e:{if(jc(t)!==t||t.tag!==1)throw Error(Xe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(us(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Xe(171))}if(t.tag===1){var n=t.type;if(us(n))return dI(t,n,e)}return e}function pM(t,e,n,r,i,a,h,l,m){return t=jb(n,r,!0,t,i,a,h,l,m),t.context=fM(null),n=t.current,r=Zi(),i=Pl(n),a=Ea(r,i),a.callback=e??null,Tl(n,a,i),t.current.lanes=i,tp(t,i,r),hs(t,r),t}function n0(t,e,n,r){var i=e.current,a=Zi(),h=Pl(i);return n=fM(n),e.context===null?e.context=n:e.pendingContext=n,e=Ea(a,h),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Tl(i,e,h),t!==null&&(bo(t,i,h,a),vg(t,i,h)),h}function hy(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function LT(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Gb(t,e){LT(t,e),(t=t.alternate)&&LT(t,e)}function k5(){return null}var mM=typeof reportError=="function"?reportError:function(t){console.error(t)};function $b(t){this._internalRoot=t}r0.prototype.render=$b.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Xe(409));n0(t,e,null,null)};r0.prototype.unmount=$b.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Lc(function(){n0(null,t,null,null)}),e[Sa]=null}};function r0(t){this._internalRoot=t}r0.prototype.unstable_scheduleHydration=function(t){if(t){var e=WC();t={blockedOn:null,target:t,priority:e};for(var n=0;n<dl.length&&e!==0&&e<dl[n].priority;n++);dl.splice(n,0,t),n===0&&qC(t)}};function Wb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function i0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function RT(){}function L5(t,e,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var v=hy(h);a.call(v)}}var h=pM(e,r,t,0,null,!1,!1,"",RT);return t._reactRootContainer=h,t[Sa]=h.current,Cf(t.nodeType===8?t.parentNode:t),Lc(),h}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var l=r;r=function(){var v=hy(m);l.call(v)}}var m=jb(t,0,!1,null,null,!1,!1,"",RT);return t._reactRootContainer=m,t[Sa]=m.current,Cf(t.nodeType===8?t.parentNode:t),Lc(function(){n0(e,m,n,r)}),m}function s0(t,e,n,r,i){var a=n._reactRootContainer;if(a){var h=a;if(typeof i=="function"){var l=i;i=function(){var m=hy(h);l.call(m)}}n0(e,h,t,i)}else h=L5(n,e,t,i,r);return hy(h)}GC=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Yd(e.pendingLanes);n!==0&&(ub(e,n|1),hs(e,Br()),!(En&6)&&(ph=Br()+500,Dl()))}break;case 13:Lc(function(){var r=Pa(t,1);if(r!==null){var i=Zi();bo(r,t,1,i)}}),Gb(t,1)}};hb=function(t){if(t.tag===13){var e=Pa(t,134217728);if(e!==null){var n=Zi();bo(e,t,134217728,n)}Gb(t,134217728)}};$C=function(t){if(t.tag===13){var e=Pl(t),n=Pa(t,e);if(n!==null){var r=Zi();bo(n,t,e,r)}Gb(t,e)}};WC=function(){return Bn};HC=function(t,e){var n=Bn;try{return Bn=t,e()}finally{Bn=n}};Cx=function(t,e,n){switch(e){case"input":if(bx(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Xy(r);if(!i)throw Error(Xe(90));EC(r),bx(r,i)}}}break;case"textarea":SC(t,n);break;case"select":e=n.value,e!=null&&Yu(t,!!n.multiple,e,!1)}};LC=Bb;RC=Lc;var R5={usingClientEntryPoint:!1,Events:[rp,Uu,Xy,MC,kC,Bb]},zd={findFiberByHostInstance:yc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},z5={bundleType:zd.bundleType,version:zd.version,rendererPackageName:zd.rendererPackageName,rendererConfig:zd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ka.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=OC(t),t===null?null:t.stateNode},findFiberByHostInstance:zd.findFiberByHostInstance||k5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vm.isDisabled&&Vm.supportsFiber)try{Wy=Vm.inject(z5),Zo=Vm}catch{}}Os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R5;Os.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wb(e))throw Error(Xe(200));return M5(t,e,null,n)};Os.createRoot=function(t,e){if(!Wb(t))throw Error(Xe(299));var n=!1,r="",i=mM;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=jb(t,1,!1,null,null,n,!1,r,i),t[Sa]=e.current,Cf(t.nodeType===8?t.parentNode:t),new $b(e)};Os.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Xe(188)):(t=Object.keys(t).join(","),Error(Xe(268,t)));return t=OC(e),t=t===null?null:t.stateNode,t};Os.flushSync=function(t){return Lc(t)};Os.hydrate=function(t,e,n){if(!i0(e))throw Error(Xe(200));return s0(null,t,e,!0,n)};Os.hydrateRoot=function(t,e,n){if(!Wb(t))throw Error(Xe(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",h=mM;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(h=n.onRecoverableError)),e=pM(e,null,t,1,n??null,i,!1,a,h),t[Sa]=e.current,Cf(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new r0(e)};Os.render=function(t,e,n){if(!i0(e))throw Error(Xe(200));return s0(null,t,e,!1,n)};Os.unmountComponentAtNode=function(t){if(!i0(t))throw Error(Xe(40));return t._reactRootContainer?(Lc(function(){s0(null,null,t,!1,function(){t._reactRootContainer=null,t[Sa]=null})}),!0):!1};Os.unstable_batchedUpdates=Bb;Os.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!i0(n))throw Error(Xe(200));if(t==null||t._reactInternals===void 0)throw Error(Xe(38));return s0(t,e,n,!1,r)};Os.version="18.2.0-next-9e3b772b8-20220608";function gM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gM)}catch(t){console.error(t)}}gM(),pC.exports=Os;var Hb=pC.exports,yM,zT=Hb;yM=zT.createRoot,zT.hydrateRoot;const D5="modulepreload",O5=function(t){return"/"+t},DT={},F5=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(a=>{if(a=O5(a),a in DT)return;DT[a]=!0;const h=a.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(!!r)for(let E=i.length-1;E>=0;E--){const T=i[E];if(T.href===a&&(!h||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":D5,h||(v.as="script",v.crossOrigin=""),v.href=a,document.head.appendChild(v),h)return new Promise((E,T)=>{v.addEventListener("load",E),v.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=a,window.dispatchEvent(h),!h.defaultPrevented)throw a})},B5=Pe.createContext(null);function N5(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===a}function va(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!va(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!va(t[i],e[i]))return!1;return!0}return!1}function U5(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function OT(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();va(n,r)||e.setProjection(n)}function FT(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function BT(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const V5=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function NT(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const a=e[r.ref];if(a){i=i||Object.assign({},r),delete i.ref;for(const h of V5)h in a&&(i[h]=a[h])}return i||r});return{...t,layers:n}}const UT={version:8,sources:{},layers:[]},VT={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},wv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},jT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},j5=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],G5=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class mh{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const a=this.props[jT[i.type]];a?a(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const a=this.props[VT[i.type]];a&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),a(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const a=this.props[wv[i.type]];a&&a(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),a=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=mh.savedMaps.pop();if(!r)return null;const i=r.map,a=i.getContainer();for(n.className=a.className;a.childNodes.length>0;)n.appendChild(a.childNodes[0]);i._container=n;const h=i._resizeObserver;h&&(h.disconnect(),h.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:l}=e;return l&&(l.bounds?i.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):r._updateViewState(l,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=UT}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||$5()||null,container:e,style:NT(r)},a=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),n.gl){const E=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=E,n.gl)}const h=new this._MapClass(i);a.padding&&h.setPadding(a.padding),n.cursor&&(h.getCanvas().style.cursor=n.cursor),this._createShadowTransform(h);const l=h._render;h._render=E=>{this._inRender=!0,l.call(h,E),this._inRender=!1};const m=h._renderTaskQueue.run;h._renderTaskQueue.run=E=>{m.call(h._renderTaskQueue,E),this._onBeforeRepaint()},h.on("render",()=>this._onAfterRepaint());const v=h.fire;h.fire=this._fireEvent.bind(this,v),h.on("resize",()=>{this._renderTransform.resize(h.transform.width,h.transform.height)}),h.on("styledata",()=>{this._updateStyleComponents(this.props,{}),OT(h.transform,this._renderTransform)}),h.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const E in VT)h.on(E,this._onPointerEvent);for(const E in wv)h.on(E,this._onCameraEvent);for(const E in jT)h.on(E,this._onEvent);this._map=h}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),mh.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=U5(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:a,pitch:h,bearing:l}=i,m=r.isMoving();m&&(i.cameraElevationReference="sea");const v=BT(i,{...FT(r.transform),...e});if(m&&(i.cameraElevationReference="ground"),v&&n){const E=this._deferredEvents;E.move=!0,E.zoom||(E.zoom=a!==i.zoom),E.rotate||(E.rotate=l!==i.bearing),E.pitch||(E.pitch=h!==i.pitch)}return m||BT(r.transform,e),v}_updateSettings(e,n){const r=this._map;let i=!1;for(const a of j5)if(a in e&&!va(e[a],n[a])){i=!0;const h=r[`set${a[0].toUpperCase()}${a.slice(1)}`];h==null||h.call(r,e[a])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const{mapStyle:r=UT,styleDiffing:i=!0}=e,a={diff:i};return"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(NT(r),a),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!va(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!va(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!va(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const a=this._map;let h=!1;for(const l of G5){const m=(r=e[l])!==null&&r!==void 0?r:!0,v=(i=n[l])!==null&&i!==void 0?i:!0;va(m,v)||(h=!0,m?a[l].enable(m):a[l].disable())}return h}_queryRenderedFeatures(e){const n=this._map,{interactiveLayerIds:r=[]}=this.props;try{return n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const a=e.type,h=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),m=l.length>0;!m&&h&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,m&&!h&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=a}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,a=i.transform,h=typeof n=="string"?n:n.type;return h==="move"&&this._updateViewState(this.props,!1),h in wv&&(typeof n=="object"&&(n.viewState=FT(a)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=a,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{OT(this._renderTransform,n),e.transform=n}}}mh.savedMaps=[];function $5(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const W5=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function H5(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const a=e.project(r);return e.transform=i,a},unproject:r=>{const i=e.transform;e.transform=t.transform;const a=e.unproject(r);return e.transform=i,a},queryTerrainElevation:(r,i)=>{const a=e.transform;e.transform=t.transform;const h=e.queryTerrainElevation(r,i);return e.transform=a,h}};for(const r of q5(e))!(r in n)&&!W5.includes(r)&&(n[r]=e[r].bind(e));return n}function q5(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const Z5=typeof document<"u"?Pe.useLayoutEffect:Pe.useEffect,X5=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Y5(t,e){for(const r of X5)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!1)}const o0=Pe.createContext(null);function K5(t,e,n){const r=Pe.useContext(B5),[i,a]=Pe.useState(null),h=Pe.useRef(),{current:l}=Pe.useRef({mapLib:null,map:null});Pe.useEffect(()=>{const E=t.mapLib;let T=!0,S;return Promise.resolve(E||n).then(z=>{if(!T)return;if(!z)throw new Error("Invalid mapLib");const D="Map"in z?z:z.default;if(!D.Map)throw new Error("Invalid mapLib");if(Y5(D,t),!D.supported||D.supported(t))t.reuseMaps&&(S=mh.reuse(t,h.current)),S||(S=new mh(D.Map,t,h.current)),l.map=H5(S),l.mapLib=D,a(S),r==null||r.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(z=>{const{onError:D}=t;D?D({type:"error",target:null,originalEvent:null,error:z}):console.error(z)}),()=>{T=!1,S&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?S.recycle():S.destroy())}},[]),Z5(()=>{i&&i.setProps(t)}),Pe.useImperativeHandle(e,()=>l.map,[i]);const m=Pe.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),v={height:"100%"};return Pe.createElement("div",{id:t.id,ref:h,style:m},i&&Pe.createElement(o0.Provider,{value:l},Pe.createElement("div",{"mapboxgl-children":"",style:v},t.children)))}const J5=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Gc(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!J5.test(r)?n[r]=`${i}px`:n[r]=i}}function Q5(t,e){const{map:n,mapLib:r}=Pe.useContext(o0),i=Pe.useRef({props:t});i.current.props=t;const a=Pe.useMemo(()=>{let F=!1;Pe.Children.forEach(t.children,V=>{V&&(F=!0)});const J={...t,element:F?document.createElement("div"):null},U=new r.Marker(J);return U.setLngLat([t.longitude,t.latitude]),U.getElement().addEventListener("click",V=>{var G,ee;(ee=(G=i.current.props).onClick)===null||ee===void 0||ee.call(G,{type:"click",target:U,originalEvent:V})}),U.on("dragstart",V=>{var G,ee;const se=V;se.lngLat=a.getLngLat(),(ee=(G=i.current.props).onDragStart)===null||ee===void 0||ee.call(G,se)}),U.on("drag",V=>{var G,ee;const se=V;se.lngLat=a.getLngLat(),(ee=(G=i.current.props).onDrag)===null||ee===void 0||ee.call(G,se)}),U.on("dragend",V=>{var G,ee;const se=V;se.lngLat=a.getLngLat(),(ee=(G=i.current.props).onDragEnd)===null||ee===void 0||ee.call(G,se)}),U},[]);Pe.useEffect(()=>(a.addTo(n.getMap()),()=>{a.remove()}),[]);const{longitude:h,latitude:l,offset:m,style:v,draggable:E=!1,popup:T=null,rotation:S=0,rotationAlignment:z="auto",pitchAlignment:D="auto"}=t;return Pe.useEffect(()=>{Gc(a.getElement(),v)},[v]),Pe.useImperativeHandle(e,()=>a,[]),(a.getLngLat().lng!==h||a.getLngLat().lat!==l)&&a.setLngLat([h,l]),m&&!N5(a.getOffset(),m)&&a.setOffset(m),a.isDraggable()!==E&&a.setDraggable(E),a.getRotation()!==S&&a.setRotation(S),a.getRotationAlignment()!==z&&a.setRotationAlignment(z),a.getPitchAlignment()!==D&&a.setPitchAlignment(D),a.getPopup()!==T&&a.setPopup(T),Hb.createPortal(t.children,a.getElement())}Pe.memo(Pe.forwardRef(Q5));function GT(t){return new Set(t?t.trim().split(/\s+/):[])}function eD(t,e){const{map:n,mapLib:r}=Pe.useContext(o0),i=Pe.useMemo(()=>document.createElement("div"),[]),a=Pe.useRef({props:t});a.current.props=t;const h=Pe.useMemo(()=>{const l={...t},m=new r.Popup(l);return m.setLngLat([t.longitude,t.latitude]),m.once("open",v=>{var E,T;(T=(E=a.current.props).onOpen)===null||T===void 0||T.call(E,v)}),m},[]);if(Pe.useEffect(()=>{const l=m=>{var v,E;(E=(v=a.current.props).onClose)===null||E===void 0||E.call(v,m)};return h.on("close",l),h.setDOMContent(i).addTo(n.getMap()),()=>{h.off("close",l),h.isOpen()&&h.remove()}},[]),Pe.useEffect(()=>{Gc(h.getElement(),t.style)},[t.style]),Pe.useImperativeHandle(e,()=>h,[]),h.isOpen()&&((h.getLngLat().lng!==t.longitude||h.getLngLat().lat!==t.latitude)&&h.setLngLat([t.longitude,t.latitude]),t.offset&&!va(h.options.offset,t.offset)&&h.setOffset(t.offset),(h.options.anchor!==t.anchor||h.options.maxWidth!==t.maxWidth)&&(h.options.anchor=t.anchor,h.setMaxWidth(t.maxWidth)),h.options.className!==t.className)){const l=GT(h.options.className),m=GT(t.className);for(const v of l)m.has(v)||h.removeClassName(v);for(const v of m)l.has(v)||h.addClassName(v);h.options.className=t.className}return Hb.createPortal(t.children,i)}Pe.memo(Pe.forwardRef(eD));function sp(t,e,n,r){const i=Pe.useContext(o0),a=Pe.useMemo(()=>t(i),[]);return Pe.useEffect(()=>{const h=r||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,m=typeof n=="function"?n:typeof e=="function"?e:null,{map:v}=i;return v.hasControl(a)||(v.addControl(a,h==null?void 0:h.position),l&&l(i)),()=>{m&&m(i),v.hasControl(a)&&v.removeControl(a)}},[]),a}function tD(t){const e=sp(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Pe.useEffect(()=>{Gc(e._container,t.style)},[t.style]),null}Pe.memo(tD);function nD(t){const e=sp(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Pe.useEffect(()=>{Gc(e._controlContainer,t.style)},[t.style]),null}Pe.memo(nD);function rD(t,e){const n=Pe.useRef({props:t}),r=sp(({mapLib:i})=>{const a=new i.GeolocateControl(t),h=a._setupUI;return a._setupUI=l=>{a._container.hasChildNodes()||h(l)},a.on("geolocate",l=>{var m,v;(v=(m=n.current.props).onGeolocate)===null||v===void 0||v.call(m,l)}),a.on("error",l=>{var m,v;(v=(m=n.current.props).onError)===null||v===void 0||v.call(m,l)}),a.on("outofmaxbounds",l=>{var m,v;(v=(m=n.current.props).onOutOfMaxBounds)===null||v===void 0||v.call(m,l)}),a.on("trackuserlocationstart",l=>{var m,v;(v=(m=n.current.props).onTrackUserLocationStart)===null||v===void 0||v.call(m,l)}),a.on("trackuserlocationend",l=>{var m,v;(v=(m=n.current.props).onTrackUserLocationEnd)===null||v===void 0||v.call(m,l)}),a},{position:t.position});return n.current.props=t,Pe.useImperativeHandle(e,()=>r,[]),Pe.useEffect(()=>{Gc(r._container,t.style)},[t.style]),null}Pe.memo(Pe.forwardRef(rD));function iD(t){const e=sp(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Pe.useEffect(()=>{Gc(e._container,t.style)},[t.style]),null}Pe.memo(iD);function sD(t){const e=sp(({mapLib:a})=>new a.ScaleControl(t),{position:t.position}),n=Pe.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),Pe.useEffect(()=>{Gc(e._container,i)},[i]),null}Pe.memo(sD);const oD=F5(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl-b25bb000.js"),[]),aD=(()=>Pe.forwardRef(function(e,n){return K5(e,n,oD)}))();var _M={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(g4,function(){var n,r,i;function a(l,m){if(!n)n=m;else if(!r)r=m;else{var v="var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk);",E={};n(E),i=m(E),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}a(["exports"],function(l){var m=v;function v(c,s,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=u,this.p2y=f}function E(c,s,u,f){const y=new m(c,s,u,f);return function(x){return y.solve(x)}}v.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var y=this.sampleCurveX(u)-c;if(Math.abs(y)<s)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=y/x}var w=0,A=1;for(u=c,f=0;f<20&&(y=this.sampleCurveX(u),!(Math.abs(y-c)<s));f++)c>y?w=u:A=u,u=.5*(A-w)+w;return u},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};const T=E(.25,.1,.25,1);function S(c,s,u){return Math.min(u,Math.max(s,c))}function z(c,s,u){const f=u-s,y=((c-s)%f+f)%f+s;return y===s?u:y}function D(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}let F=1;function J(c,s){c.forEach(u=>{s[u]&&(s[u]=s[u].bind(s))})}function U(c,s,u){const f={};for(const y in c)f[y]=s.call(u||this,c[y],y,c);return f}function V(c,s,u){const f={};for(const y in c)s.call(u||this,c[y],y,c)&&(f[y]=c[y]);return f}function G(c){return Array.isArray(c)?c.map(G):typeof c=="object"&&c?U(c,G):c}const ee={};function se(c){ee[c]||(typeof console<"u"&&console.warn(c),ee[c]=!0)}function me(c,s,u){return(u.y-c.y)*(s.x-c.x)>(s.y-c.y)*(u.x-c.x)}function ve(c){let s=0;for(let u,f,y=0,x=c.length,w=x-1;y<x;w=y++)u=c[y],f=c[w],s+=(f.x-u.x)*(u.y+f.y);return s}function Me(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Be(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,y,x)=>{const w=y||x;return s[f]=!w||w.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s}let ze,Oe,tt=null;function et(c){if(tt==null){const s=c.navigator?c.navigator.userAgent:null;tt=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return tt}function st(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Bt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){const u=window.document.createElement("canvas"),f=u.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return u.width=c.width,u.height=c.height,f.drawImage(c,0,0,c.width,c.height),f.getImageData(-s,-s,c.width+2*s,c.height+2*s)},resolveURL:c=>(ze||(ze=document.createElement("a")),ze.href=c,ze.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Oe==null&&(Oe=matchMedia("(prefers-reduced-motion: reduce)")),Oe.matches)}};var Je=en;function en(c,s){this.x=c,this.y=s}en.prototype={clone:function(){return new en(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,u=c.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),u=Math.sin(c),f=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=f,this},_rotateAround:function(c,s){var u=Math.cos(c),f=Math.sin(c),y=s.y+f*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-f*(this.y-s.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},en.convert=function(c){return c instanceof en?c:Array.isArray(c)?new en(c[0],c[1]):c};const We={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Qe="mapbox-tiles";let Tt,tn,Xt=500,An=50;function xn(){typeof caches>"u"||Tt||(Tt=caches.open(Qe))}let zn=1/0;const Dn={supported:!1,testSupport:function(c){!zt&&Wn&&(Tn?Lr(c):ln=c)}};let ln,Wn,zt=!1,Tn=!1;function Lr(c){const s=c.createTexture();c.bindTexture(c.TEXTURE_2D,s);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Wn),c.isContextLost())return;Dn.supported=!0}catch{}c.deleteTexture(s),zt=!0}typeof document<"u"&&(Wn=document.createElement("img"),Wn.onload=function(){ln&&Lr(ln),ln=null,Tn=!0},Wn.onerror=function(){zt=!0,ln=null},Wn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Hn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Hn);class pn extends Error{constructor(s,u,f,y){super(`AJAXError: ${u} (${s}): ${f}`),this.status=s,this.statusText=u,this.url=f,this.body=y}}const un=Me()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Jt(c,s){const u=new AbortController,f=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:un(),signal:u.signal});let y=!1,x=!1;return c.type==="json"&&f.headers.set("Accept","application/json"),((w,A,C)=>{if(x)return;const k=Date.now();fetch(f).then(O=>O.ok?((N,H,X)=>{(c.type==="arrayBuffer"?N.arrayBuffer():c.type==="json"?N.json():N.text()).then(Y=>{x||(H&&X&&function(de,le,be){if(xn(),!Tt)return;const Ie={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Se,Ve)=>Ie.headers.set(Ve,Se));const xe=Be(le.headers.get("Cache-Control")||"");xe["no-store"]||(xe["max-age"]&&Ie.headers.set("Expires",new Date(be+1e3*xe["max-age"]).toUTCString()),new Date(Ie.headers.get("Expires")).getTime()-be<42e4||function(Se,Ve){if(tn===void 0)try{new Response(new ReadableStream),tn=!0}catch{tn=!1}tn?Ve(Se.body):Se.blob().then(Ve)}(le,Se=>{const Ve=new Response(Se,Ie);xn(),Tt&&Tt.then(Ue=>Ue.put(function(dt){const yt=dt.indexOf("?");return yt<0?dt:dt.slice(0,yt)}(de.url),Ve)).catch(Ue=>se(Ue.message))}))}(f,H,X),y=!0,s(null,Y,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(Y=>{x||s(new Error(Y.message))})})(O,null,k):O.blob().then(N=>s(new pn(O.status,O.statusText,c.url,N)))).catch(O=>{O.code!==20&&s(new Error(O.message))})})(),{cancel:()=>{x=!0,y||u.abort()}}}const Un=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(Me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s);if(!Me()){const f=c.url.substring(0,c.url.indexOf("://"));return(We.REGISTERED_PROTOCOLS[f]||Jt)(c,s)}}if(!(/^file:/.test(u=c.url)||/^file:/.test(un())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Jt(c,s);if(Me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var u;return function(f,y){const x=new XMLHttpRequest;x.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const w in f.headers)x.setRequestHeader(w,f.headers[w]);return f.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=f.credentials==="include",x.onerror=()=>{y(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let w=x.response;if(f.type==="json")try{w=JSON.parse(x.response)}catch(A){return y(A)}y(null,w,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else{const w=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});y(new pn(x.status,x.statusText,f.url,w))}},x.send(f.body),{cancel:()=>x.abort()}}(c,s)},Jn=function(c,s){return Un(D(c,{type:"arrayBuffer"}),s)};function Ur(c){const s=window.document.createElement("a");return s.href=c,s.protocol===window.document.location.protocol&&s.host===window.document.location.host}const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cn,yn;cn=[],yn=0;const ui=function(c,s){if(Dn.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),yn>=We.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:c,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return cn.push(x),x}yn++;let u=!1;const f=()=>{if(!u)for(u=!0,yn--;cn.length&&yn<We.MAX_PARALLEL_IMAGE_REQUESTS;){const x=cn.shift(),{requestParameters:w,callback:A,cancelled:C}=x;C||(x.cancel=ui(w,A).cancel)}},y=Jn(c,(x,w,A,C)=>{f(),x?s(x):w&&function(k,O){typeof createImageBitmap=="function"?function(N,H){const X=new Blob([new Uint8Array(N)],{type:"image/png"});createImageBitmap(X).then(Y=>{H(null,Y)}).catch(Y=>{H(new Error(`Could not load image because of ${Y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(k,O):function(N,H){const X=new Image;X.onload=()=>{H(null,X),URL.revokeObjectURL(X.src),X.onload=null,window.requestAnimationFrame(()=>{X.src=Vt})},X.onerror=()=>H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new Blob([new Uint8Array(N)],{type:"image/png"});X.src=N.byteLength?URL.createObjectURL(Y):Vt}(k,O)}(w,(k,O)=>{k!=null?s(k):O!=null&&s(null,O,{cacheControl:A,expires:C})})});return{cancel:()=>{y.cancel(),f()}}};function Ki(c,s,u){u[c]&&u[c].indexOf(s)!==-1||(u[c]=u[c]||[],u[c].push(s))}function Rr(c,s,u){if(u&&u[c]){const f=u[c].indexOf(s);f!==-1&&u[c].splice(f,1)}}class Ye{constructor(s,u={}){D(this,u),this.type=s}}class St extends Ye{constructor(s,u={}){super("error",D({error:s},u))}}class Rt{on(s,u){return this._listeners=this._listeners||{},Ki(s,u,this._listeners),this}off(s,u){return Rr(s,u,this._listeners),Rr(s,u,this._oneTimeListeners),this}once(s,u){return this._oneTimeListeners=this._oneTimeListeners||{},Ki(s,u,this._oneTimeListeners),this}fire(s,u){typeof s=="string"&&(s=new Ye(s,u||{}));const f=s.type;if(this.listens(f)){s.target=this;const y=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of y)A.call(this,s);const x=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of x)Rr(f,A,this._oneTimeListeners),A.call(this,s);const w=this._eventedParent;w&&(D(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(s))}else s instanceof St&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}var Ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Re{constructor(s,u,f,y){this.message=(s?`${s}: `:"")+f,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function On(c){const s=c.value;return s?[new Re(c.key,s,"constants have been deprecated as of v8")]:[]}function Ut(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}function xt(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function rn(c){if(Array.isArray(c))return c.map(rn);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const u in c)s[u]=rn(c[u]);return s}return xt(c)}class Vn extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class yr{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[f,y]of u)this.bindings[f]=y}concat(s){return new yr(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Qn={kind:"null"},Ze={kind:"number"},Ft={kind:"string"},Ot={kind:"boolean"},hr={kind:"color"},vi={kind:"object"},kt={kind:"value"},Zr={kind:"collator"},or={kind:"formatted"},Ji={kind:"padding"},er={kind:"resolvedImage"};function dr(c,s){return{kind:"array",itemType:c,N:s}}function sn(c){if(c.kind==="array"){const s=sn(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const Qi=[Qn,Ze,Ft,Ot,hr,or,vi,dr(kt),Ji,er];function xi(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!xi(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const u of Qi)if(!xi(u,s))return null}}return`Expected ${sn(c)} but found ${sn(s)} instead.`}function bi(c,s){return s.some(u=>u.kind===c.kind)}function fs(c,s){return s.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}var Ns,es={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function te(c){return(c=Math.round(c))<0?0:c>255?255:c}function R(c){return te(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function j(c){return(s=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:s>1?1:s;var s}function K(c,s,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?c+(s-c)*u*6:2*u<1?s:3*u<2?c+(s-c)*(2/3-u)*6:c}try{Ns={}.parseCSSColor=function(c){var s,u=c.replace(/ /g,"").toLowerCase();if(u in es)return es[u].slice();if(u[0]==="#")return u.length===4?(s=parseInt(u.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:u.length===7&&(s=parseInt(u.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var f=u.indexOf("("),y=u.indexOf(")");if(f!==-1&&y+1===u.length){var x=u.substr(0,f),w=u.substr(f+1,y-(f+1)).split(","),A=1;switch(x){case"rgba":if(w.length!==4)return null;A=j(w.pop());case"rgb":return w.length!==3?null:[R(w[0]),R(w[1]),R(w[2]),A];case"hsla":if(w.length!==4)return null;A=j(w.pop());case"hsl":if(w.length!==3)return null;var C=(parseFloat(w[0])%360+360)%360/360,k=j(w[1]),O=j(w[2]),N=O<=.5?O*(k+1):O+k-O*k,H=2*O-N;return[te(255*K(H,N,C+1/3)),te(255*K(H,N,C)),te(255*K(H,N,C-1/3)),A];default:return null}}return null}}catch{}class Q{constructor(s,u,f,y=1){this.r=s,this.g=u,this.b=f,this.a=y}static parse(s){if(!s)return;if(s instanceof Q)return s;if(typeof s!="string")return;const u=Ns(s);return u?new Q(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[s,u,f,y]=this.toArray();return`rgba(${Math.round(s)},${Math.round(u)},${Math.round(f)},${y})`}toArray(){const{r:s,g:u,b:f,a:y}=this;return y===0?[0,0,0,0]:[255*s/y,255*u/y,255*f/y,y]}}Q.black=new Q(0,0,0,1),Q.white=new Q(1,1,1,1),Q.transparent=new Q(0,0,0,0),Q.red=new Q(1,0,0,1);class he{constructor(s,u,f){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fe{constructor(s,u,f,y,x){this.text=s,this.image=u,this.scale=f,this.fontStack=y,this.textColor=x}}class ue{constructor(s){this.sections=s}static fromString(s){return new ue([new fe(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof ue?s:ue.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class ce{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ce)return s;if(typeof s=="number")return new ce([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const u of s)if(typeof u!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new ce(s)}}toString(){return JSON.stringify(this.values)}}class ye{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new ye({name:s,available:!1}):null}}function Ae(c,s,u,f){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,s,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,s,u,f]:[c,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function je(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Q||c instanceof he||c instanceof ue||c instanceof ce||c instanceof ye)return!0;if(Array.isArray(c)){for(const s of c)if(!je(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!je(c[s]))return!1;return!0}return!1}function Le(c){if(c===null)return Qn;if(typeof c=="string")return Ft;if(typeof c=="boolean")return Ot;if(typeof c=="number")return Ze;if(c instanceof Q)return hr;if(c instanceof he)return Zr;if(c instanceof ue)return or;if(c instanceof ce)return Ji;if(c instanceof ye)return er;if(Array.isArray(c)){const s=c.length;let u;for(const f of c){const y=Le(f);if(u){if(u===y)continue;u=kt;break}u=y}return dr(u||kt,s)}return vi}function ft(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof Q||c instanceof ue||c instanceof ce||c instanceof ye?c.toString():JSON.stringify(c)}class gt{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!je(s[1]))return u.error("invalid value");const f=s[1];let y=Le(f);const x=u.expectedType;return y.kind!=="array"||y.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(y=x),new gt(y,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ot{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Pt={string:Ft,number:Ze,boolean:Ot,object:vi};class bt{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let f,y=1;const x=s[0];if(x==="array"){let A,C;if(s.length>2){const k=s[1];if(typeof k!="string"||!(k in Pt)||k==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=Pt[k],y++}else A=kt;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);C=s[2],y++}f=dr(A,C)}else{if(!Pt[x])throw new Error(`Types doesn't contain name = ${x}`);f=Pt[x]}const w=[];for(;y<s.length;y++){const A=u.parse(s[y],y,kt);if(!A)return null;w.push(A)}return new bt(f,w)}evaluate(s){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(s);if(!xi(this.type,Le(f)))return f;if(u===this.args.length-1)throw new ot(`Expected value to be of type ${sn(this.type)}, but found ${sn(Le(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const jt={"to-boolean":Ot,"to-color":hr,"to-number":Ze,"to-string":Ft};class It{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[0];if(!jt[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&s.length!==2)return u.error("Expected one argument.");const y=jt[f],x=[];for(let w=1;w<s.length;w++){const A=u.parse(s[w],w,kt);if(!A)return null;x.push(A)}return new It(y,x)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let u,f;for(const y of this.args){if(u=y.evaluate(s),f=null,u instanceof Q)return u;if(typeof u=="string"){const x=s.parseColor(u);if(x)return x}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ae(u[0],u[1],u[2],u[3]),!f))return new Q(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ot(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="padding"){let u;for(const f of this.args){u=f.evaluate(s);const y=ce.parse(u);if(y)return y}throw new ot(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(s),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new ot(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?ue.fromString(ft(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?ye.fromString(ft(this.args[0].evaluate(s))):ft(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Dt=["Unknown","Point","LineString","Polygon"];class Ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=Q.parse(s)),u}}class Yt{constructor(s,u,f,y){this.name=s,this.type=u,this._evaluate=f,this.args=y}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,u){const f=s[0],y=Yt.definitions[f];if(!y)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(y)?y[0]:y.type,w=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,A=w.filter(([k])=>!Array.isArray(k)||k.length===s.length-1);let C=null;for(const[k,O]of A){C=new He(u.registry,u.path,null,u.scope);const N=[];let H=!1;for(let X=1;X<s.length;X++){const Y=s[X],de=Array.isArray(k)?k[X-1]:k.type,le=C.parse(Y,1+N.length,de);if(!le){H=!0;break}N.push(le)}if(!H)if(Array.isArray(k)&&k.length!==N.length)C.error(`Expected ${k.length} arguments, but found ${N.length} instead.`);else{for(let X=0;X<N.length;X++){const Y=Array.isArray(k)?k[X]:k.type,de=N[X];C.concat(X+1).checkSubtype(Y,de.type)}if(C.errors.length===0)return new Yt(f,x,O,N)}}if(A.length===1)u.errors.push(...C.errors);else{const k=(A.length?A:w).map(([N])=>{return H=N,Array.isArray(H)?`(${H.map(sn).join(", ")})`:`(${sn(H.type)}...)`;var H}).join(" | "),O=[];for(let N=1;N<s.length;N++){const H=u.parse(s[N],1+O.length);if(!H)return null;O.push(sn(H.type))}u.error(`Expected arguments of type ${k}, but found (${O.join(", ")}) instead.`)}return null}static register(s,u){Yt.definitions=u;for(const f in u)s[f]=Yt}}class kn{constructor(s,u,f){this.type=Zr,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const y=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ot);if(!y)return null;const x=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ot);if(!x)return null;let w=null;return f.locale&&(w=u.parse(f.locale,1,Ft),!w)?null:new kn(y,x,w)}evaluate(s){return new he(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const Ln=8192;function zr(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function ps(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function Xr(c,s){const u=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,y=Math.pow(2,s.z);return[Math.round(u*y*Ln),Math.round(f*y*Ln)]}function hn(c,s,u){const f=c[0]-s[0],y=c[1]-s[1],x=c[0]-u[0],w=c[1]-u[1];return f*w-x*y==0&&f*x<=0&&y*w<=0}function ta(c,s){let u=!1;for(let w=0,A=s.length;w<A;w++){const C=s[w];for(let k=0,O=C.length;k<O-1;k++){if(hn(c,C[k],C[k+1]))return!1;(y=C[k])[1]>(f=c)[1]!=(x=C[k+1])[1]>f[1]&&f[0]<(x[0]-y[0])*(f[1]-y[1])/(x[1]-y[1])+y[0]&&(u=!u)}}var f,y,x;return u}function na(c,s){for(let u=0;u<s.length;u++)if(ta(c,s[u]))return!0;return!1}function Fa(c,s,u,f){const y=f[0]-u[0],x=f[1]-u[1],w=(c[0]-u[0])*x-y*(c[1]-u[1]),A=(s[0]-u[0])*x-y*(s[1]-u[1]);return w>0&&A<0||w<0&&A>0}function Ba(c,s,u){for(const k of u)for(let O=0;O<k.length-1;++O)if((A=[(w=k[O+1])[0]-(x=k[O])[0],w[1]-x[1]])[0]*(C=[(y=s)[0]-(f=c)[0],y[1]-f[1]])[1]-A[1]*C[0]!=0&&Fa(f,y,x,w)&&Fa(x,w,f,y))return!0;var f,y,x,w,A,C;return!1}function Po(c,s){for(let u=0;u<c.length;++u)if(!ta(c[u],s))return!1;for(let u=0;u<c.length-1;++u)if(Ba(c[u],c[u+1],s))return!1;return!0}function ms(c,s){for(let u=0;u<s.length;u++)if(Po(c,s[u]))return!0;return!1}function Na(c,s,u){const f=[];for(let y=0;y<c.length;y++){const x=[];for(let w=0;w<c[y].length;w++){const A=Xr(c[y][w],u);zr(s,A),x.push(A)}f.push(x)}return f}function Ua(c,s,u){const f=[];for(let y=0;y<c.length;y++){const x=Na(c[y],s,u);f.push(x)}return f}function Va(c,s,u,f){if(c[0]<u[0]||c[0]>u[2]){const y=.5*f;let x=c[0]-u[0]>y?-f:u[0]-c[0]>y?f:0;x===0&&(x=c[0]-u[2]>y?-f:u[2]-c[0]>y?f:0),c[0]+=x}zr(s,c)}function Fl(c,s,u,f){const y=Math.pow(2,f.z)*Ln,x=[f.x*Ln,f.y*Ln],w=[];for(const A of c)for(const C of A){const k=[C.x+x[0],C.y+x[1]];Va(k,s,u,y),w.push(k)}return w}function qc(c,s,u,f){const y=Math.pow(2,f.z)*Ln,x=[f.x*Ln,f.y*Ln],w=[];for(const C of c){const k=[];for(const O of C){const N=[O.x+x[0],O.y+x[1]];zr(s,N),k.push(N)}w.push(k)}if(s[2]-s[0]<=y/2){(A=s)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const C of w)for(const k of C)Va(k,s,u,y)}var A;return w}class ro{constructor(s,u){this.type=Ot,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(je(s[1])){const f=s[1];if(f.type==="FeatureCollection")for(let y=0;y<f.features.length;++y){const x=f.features[y].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new ro(f,f.features[y].geometry)}else if(f.type==="Feature"){const y=f.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ro(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ro(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,f){const y=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const A=Na(f.coordinates,x,w),C=Fl(u.geometry(),y,x,w);if(!ps(y,x))return!1;for(const k of C)if(!ta(k,A))return!1}if(f.type==="MultiPolygon"){const A=Ua(f.coordinates,x,w),C=Fl(u.geometry(),y,x,w);if(!ps(y,x))return!1;for(const k of C)if(!na(k,A))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,f){const y=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const A=Na(f.coordinates,x,w),C=qc(u.geometry(),y,x,w);if(!ps(y,x))return!1;for(const k of C)if(!Po(k,A))return!1}if(f.type==="MultiPolygon"){const A=Ua(f.coordinates,x,w),C=qc(u.geometry(),y,x,w);if(!ps(y,x))return!1;for(const k of C)if(!ms(k,A))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Z(c){if(c instanceof Yt&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof ro)return!1;let s=!0;return c.eachChild(u=>{s&&!Z(u)&&(s=!1)}),s}function ne(c){if(c instanceof Yt&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(u=>{s&&!ne(u)&&(s=!1)}),s}function pe(c,s){if(c instanceof Yt&&s.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(f=>{u&&!pe(f,s)&&(u=!1)}),u}class ke{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=s[1];return u.scope.has(f)?new ke(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class He{constructor(s,u=[],f,y=new yr,x=[]){this.registry=s,this.path=u,this.key=u.map(w=>`[${w}]`).join(""),this.scope=y,this.errors=x,this.expectedType=f}parse(s,u,f,y,x={}){return u?this.concat(u,f,y)._parse(s,x):this._parse(s,x)}_parse(s,u){function f(y,x,w){return w==="assert"?new bt(x,[y]):w==="coerce"?new It(x,[y]):y}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=s[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[y];if(x){let w=x.parse(s,this);if(!w)return null;if(this.expectedType){const A=this.expectedType,C=w.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||C.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(A.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array"){if(this.checkSubtype(A,C))return null}else w=f(w,A,u.typeAnnotation||"coerce");else w=f(w,A,u.typeAnnotation||"coerce");else w=f(w,A,u.typeAnnotation||"assert")}if(!(w instanceof gt)&&w.type.kind!=="resolvedImage"&&mt(w)){const A=new Ht;try{w=new gt(w.type,w.evaluate(A))}catch(C){return this.error(C.message),null}}return w}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,f){const y=typeof s=="number"?this.path.concat(s):this.path,x=f?this.scope.concat(f):this.scope;return new He(this.registry,y,u||null,x,this.errors)}error(s,...u){const f=`${this.key}${u.map(y=>`[${y}]`).join("")}`;this.errors.push(new Vn(f,s))}checkSubtype(s,u){const f=xi(s,u);return f&&this.error(f),f}}function mt(c){if(c instanceof ke)return mt(c.boundExpression);if(c instanceof Yt&&c.name==="error"||c instanceof kn||c instanceof ro)return!1;const s=c instanceof It||c instanceof bt;let u=!0;return c.eachChild(f=>{u=s?u&&mt(f):u&&f instanceof gt}),!!u&&Z(c)&&pe(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function qt(c,s){const u=c.length-1;let f,y,x=0,w=u,A=0;for(;x<=w;)if(A=Math.floor((x+w)/2),f=c[A],y=c[A+1],f<=s){if(A===u||s<y)return A;x=A+1}else{if(!(f>s))throw new ot("Input is not a number.");w=A-1}return 0}class tr{constructor(s,u,f){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[y,x]of f)this.labels.push(y),this.outputs.push(x)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(s[1],1,Ze);if(!f)return null;const y=[];let x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(let w=1;w<s.length;w+=2){const A=w===1?-1/0:s[w],C=s[w+1],k=w,O=w+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const N=u.parse(C,O,x);if(!N)return null;x=x||N.type,y.push([A,N])}return new tr(x,f,y)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const y=this.input.evaluate(s);if(y<=u[0])return f[0].evaluate(s);const x=u.length;return y>=u[x-1]?f[x-1].evaluate(s):f[qt(u,y)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Gt(c,s,u){return c*(1-u)+s*u}var _r=Object.freeze({__proto__:null,number:Gt,color:function(c,s,u){return new Q(Gt(c.r,s.r,u),Gt(c.g,s.g,u),Gt(c.b,s.b,u),Gt(c.a,s.a,u))},array:function(c,s,u){return c.map((f,y)=>Gt(f,s[y],u))},padding:function(c,s,u){const f=c.values,y=s.values;return new ce([Gt(f[0],y[0],u),Gt(f[1],y[1],u),Gt(f[2],y[2],u),Gt(f[3],y[3],u)])}});const Di=.95047,Tp=1.08883,Dh=4/29,Zc=6/29,Sp=3*Zc*Zc,q0=Math.PI/180,Z0=180/Math.PI;function Oh(c){return c>.008856451679035631?Math.pow(c,1/3):c/Sp+Dh}function Fh(c){return c>Zc?c*c*c:Sp*(c-Dh)}function Bh(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Nh(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function mn(c){const s=Nh(c.r),u=Nh(c.g),f=Nh(c.b),y=Oh((.4124564*s+.3575761*u+.1804375*f)/Di),x=Oh((.2126729*s+.7151522*u+.072175*f)/1);return{l:116*x-16,a:500*(y-x),b:200*(x-Oh((.0193339*s+.119192*u+.9503041*f)/Tp)),alpha:c.a}}function Pp(c){let s=(c.l+16)/116,u=isNaN(c.a)?s:s+c.a/500,f=isNaN(c.b)?s:s-c.b/200;return s=1*Fh(s),u=Di*Fh(u),f=Tp*Fh(f),new Q(Bh(3.2404542*u-1.5371385*s-.4985314*f),Bh(-.969266*u+1.8760108*s+.041556*f),Bh(.0556434*u-.2040259*s+1.0572252*f),c.alpha)}function X0(c,s,u){const f=s-c;return c+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const Bl={forward:mn,reverse:Pp,interpolate:function(c,s,u){return{l:Gt(c.l,s.l,u),a:Gt(c.a,s.a,u),b:Gt(c.b,s.b,u),alpha:Gt(c.alpha,s.alpha,u)}}},Nl={forward:function(c){const{l:s,a:u,b:f}=mn(c),y=Math.atan2(f,u)*Z0;return{h:y<0?y+360:y,c:Math.sqrt(u*u+f*f),l:s,alpha:c.a}},reverse:function(c){const s=c.h*q0,u=c.c;return Pp({l:c.l,a:Math.cos(s)*u,b:Math.sin(s)*u,alpha:c.alpha})},interpolate:function(c,s,u){return{h:X0(c.h,s.h,u),c:Gt(c.c,s.c,u),l:Gt(c.l,s.l,u),alpha:Gt(c.alpha,s.alpha,u)}}};var Ap=Object.freeze({__proto__:null,lab:Bl,hcl:Nl});class Oi{constructor(s,u,f,y,x){this.type=s,this.operator=u,this.interpolation=f,this.input=y,this.labels=[],this.outputs=[];for(const[w,A]of x)this.labels.push(w),this.outputs.push(A)}static interpolationFactor(s,u,f,y){let x=0;if(s.name==="exponential")x=Uh(u,s.base,f,y);else if(s.name==="linear")x=Uh(u,1,f,y);else if(s.name==="cubic-bezier"){const w=s.controlPoints;x=new m(w[0],w[1],w[2],w[3]).solve(Uh(u,1,f,y))}return x}static parse(s,u){let[f,y,x,...w]=s;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const k=y[1];if(typeof k!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:k}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const k=y.slice(1);if(k.length!==4||k.some(O=>typeof O!="number"||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:k}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(x=u.parse(x,2,Ze),!x)return null;const A=[];let C=null;f==="interpolate-hcl"||f==="interpolate-lab"?C=hr:u.expectedType&&u.expectedType.kind!=="value"&&(C=u.expectedType);for(let k=0;k<w.length;k+=2){const O=w[k],N=w[k+1],H=k+3,X=k+4;if(typeof O!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(A.length&&A[A.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const Y=u.parse(N,X,C);if(!Y)return null;C=C||Y.type,A.push([O,Y])}return C.kind==="number"||C.kind==="color"||C.kind==="padding"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Oi(C,f,y,x,A):u.error(`Type ${sn(C)} is not interpolatable.`)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const y=this.input.evaluate(s);if(y<=u[0])return f[0].evaluate(s);const x=u.length;if(y>=u[x-1])return f[x-1].evaluate(s);const w=qt(u,y),A=Oi.interpolationFactor(this.interpolation,y,u[w],u[w+1]),C=f[w].evaluate(s),k=f[w+1].evaluate(s);return this.operator==="interpolate"?_r[this.type.kind.toLowerCase()](C,k,A):this.operator==="interpolate-hcl"?Nl.reverse(Nl.interpolate(Nl.forward(C),Nl.forward(k),A)):Bl.reverse(Bl.interpolate(Bl.forward(C),Bl.forward(k),A))}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Uh(c,s,u,f){const y=f-u,x=c-u;return y===0?0:s===1?x/y:(Math.pow(s,x)-1)/(Math.pow(s,y)-1)}class Xc{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expectected at least one argument.");let f=null;const y=u.expectedType;y&&y.kind!=="value"&&(f=y);const x=[];for(const A of s.slice(1)){const C=u.parse(A,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,x.push(C)}if(!f)throw new Error("No output type");const w=y&&x.some(A=>xi(y,A.type));return new Xc(w?kt:f,x)}evaluate(s){let u,f=null,y=0;for(const x of this.args)if(y++,f=x.evaluate(s),f&&f instanceof ye&&!f.available&&(u||(u=f.name),f=null,y===this.args.length&&(f=u)),f!==null)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Yc{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let x=1;x<s.length-1;x+=2){const w=s[x];if(typeof w!="string")return u.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=u.parse(s[x+1],x+1);if(!A)return null;f.push([w,A])}const y=u.parse(s[s.length-1],s.length-1,u.expectedType,f);return y?new Yc(f,y):null}outputDefined(){return this.result.outputDefined()}}class Vh{constructor(s,u,f){this.type=s,this.index=u,this.input=f}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Ze),y=u.parse(s[2],2,dr(u.expectedType||kt));return f&&y?new Vh(y.type.itemType,f,y):null}evaluate(s){const u=this.index.evaluate(s),f=this.input.evaluate(s);if(u<0)throw new ot(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new ot(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new ot(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class jh{constructor(s,u){this.type=Ot,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,kt),y=u.parse(s[2],2,kt);return f&&y?bi(f.type,[Ot,Ft,Ze,Qn,kt])?new jh(f,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(f.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!fs(u,["boolean","string","number","null"]))throw new ot(`Expected first argument to be of type boolean, string, number or null, but found ${sn(Le(u))} instead.`);if(!fs(f,["string","array"]))throw new ot(`Expected second argument to be of type array or string, but found ${sn(Le(f))} instead.`);return f.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Kc{constructor(s,u,f){this.type=Ze,this.needle=s,this.haystack=u,this.fromIndex=f}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,kt),y=u.parse(s[2],2,kt);if(!f||!y)return null;if(!bi(f.type,[Ot,Ft,Ze,Qn,kt]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(f.type)} instead`);if(s.length===4){const x=u.parse(s[3],3,Ze);return x?new Kc(f,y,x):null}return new Kc(f,y)}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!fs(u,["boolean","string","number","null"]))throw new ot(`Expected first argument to be of type boolean, string, number or null, but found ${sn(Le(u))} instead.`);if(!fs(f,["string","array"]))throw new ot(`Expected second argument to be of type array or string, but found ${sn(Le(f))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(s);return f.indexOf(u,y)}return f.indexOf(u)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Gh{constructor(s,u,f,y,x,w){this.inputType=s,this.type=u,this.input=f,this.cases=y,this.outputs=x,this.otherwise=w}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let f,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const x={},w=[];for(let k=2;k<s.length-1;k+=2){let O=s[k];const N=s[k+1];Array.isArray(O)||(O=[O]);const H=u.concat(k);if(O.length===0)return H.error("Expected at least one branch label.");for(const Y of O){if(typeof Y!="number"&&typeof Y!="string")return H.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return H.error("Numeric branch labels must be integer values.");if(f){if(H.checkSubtype(f,Le(Y)))return null}else f=Le(Y);if(x[String(Y)]!==void 0)return H.error("Branch labels must be unique.");x[String(Y)]=w.length}const X=u.parse(N,k,y);if(!X)return null;y=y||X.type,w.push(X)}const A=u.parse(s[1],1,kt);if(!A)return null;const C=u.parse(s[s.length-1],s.length-1,y);return C?A.type.kind!=="value"&&u.concat(1).checkSubtype(f,A.type)?null:new Gh(f,y,A,x,w,C):null}evaluate(s){const u=this.input.evaluate(s);return(Le(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class $h{constructor(s,u,f){this.type=s,this.branches=u,this.otherwise=f}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const y=[];for(let w=1;w<s.length-1;w+=2){const A=u.parse(s[w],w,Ot);if(!A)return null;const C=u.parse(s[w+1],w+1,f);if(!C)return null;y.push([A,C]),f=f||C.type}const x=u.parse(s[s.length-1],s.length-1,f);if(!x)return null;if(!f)throw new Error("Can't infer output type");return new $h(f,y,x)}evaluate(s){for(const[u,f]of this.branches)if(u.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,f]of this.branches)s(u),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class Jc{constructor(s,u,f,y){this.type=s,this.input=u,this.beginIndex=f,this.endIndex=y}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,kt),y=u.parse(s[2],2,Ze);if(!f||!y)return null;if(!bi(f.type,[dr(kt),Ft,kt]))return u.error(`Expected first argument to be of type array or string, but found ${sn(f.type)} instead`);if(s.length===4){const x=u.parse(s[3],3,Ze);return x?new Jc(f.type,f,y,x):null}return new Jc(f.type,f,y)}evaluate(s){const u=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!fs(u,["string","array"]))throw new ot(`Expected first argument to be of type array or string, but found ${sn(Le(u))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(s);return u.slice(f,y)}return u.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Cp(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Ip(c,s,u,f){return f.compare(s,u)===0}function ja(c,s,u){const f=c!=="=="&&c!=="!=";return class vM{constructor(x,w,A){this.type=Ot,this.lhs=x,this.rhs=w,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const A=x[0];let C=w.parse(x[1],1,kt);if(!C)return null;if(!Cp(A,C.type))return w.concat(1).error(`"${A}" comparisons are not supported for type '${sn(C.type)}'.`);let k=w.parse(x[2],2,kt);if(!k)return null;if(!Cp(A,k.type))return w.concat(2).error(`"${A}" comparisons are not supported for type '${sn(k.type)}'.`);if(C.type.kind!==k.type.kind&&C.type.kind!=="value"&&k.type.kind!=="value")return w.error(`Cannot compare types '${sn(C.type)}' and '${sn(k.type)}'.`);f&&(C.type.kind==="value"&&k.type.kind!=="value"?C=new bt(k.type,[C]):C.type.kind!=="value"&&k.type.kind==="value"&&(k=new bt(C.type,[k])));let O=null;if(x.length===4){if(C.type.kind!=="string"&&k.type.kind!=="string"&&C.type.kind!=="value"&&k.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(x[3],3,Zr),!O)return null}return new vM(C,k,O)}evaluate(x){const w=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const C=Le(w),k=Le(A);if(C.kind!==k.kind||C.kind!=="string"&&C.kind!=="number")throw new ot(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${C.kind}, ${k.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=Le(w),k=Le(A);if(C.kind!=="string"||k.kind!=="string")return s(x,w,A)}return this.collator?u(x,w,A,this.collator.evaluate(x)):s(x,w,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Y0=ja("==",function(c,s,u){return s===u},Ip),K0=ja("!=",function(c,s,u){return s!==u},function(c,s,u,f){return!Ip(0,s,u,f)}),J0=ja("<",function(c,s,u){return s<u},function(c,s,u,f){return f.compare(s,u)<0}),Q0=ja(">",function(c,s,u){return s>u},function(c,s,u,f){return f.compare(s,u)>0}),e_=ja("<=",function(c,s,u){return s<=u},function(c,s,u,f){return f.compare(s,u)<=0}),t_=ja(">=",function(c,s,u){return s>=u},function(c,s,u,f){return f.compare(s,u)>=0});class Wh{constructor(s,u,f,y,x){this.type=Ft,this.number=s,this.locale=u,this.currency=f,this.minFractionDigits=y,this.maxFractionDigits=x}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const f=u.parse(s[1],1,Ze);if(!f)return null;const y=s[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let x=null;if(y.locale&&(x=u.parse(y.locale,1,Ft),!x))return null;let w=null;if(y.currency&&(w=u.parse(y.currency,1,Ft),!w))return null;let A=null;if(y["min-fraction-digits"]&&(A=u.parse(y["min-fraction-digits"],1,Ze),!A))return null;let C=null;return y["max-fraction-digits"]&&(C=u.parse(y["max-fraction-digits"],1,Ze),!C)?null:new Wh(f,x,w,A,C)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Qc{constructor(s){this.type=or,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const y=[];let x=!1;for(let w=1;w<=s.length-1;++w){const A=s[w];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let C=null;if(A["font-scale"]&&(C=u.parse(A["font-scale"],1,Ze),!C))return null;let k=null;if(A["text-font"]&&(k=u.parse(A["text-font"],1,dr(Ft)),!k))return null;let O=null;if(A["text-color"]&&(O=u.parse(A["text-color"],1,hr),!O))return null;const N=y[y.length-1];N.scale=C,N.font=k,N.textColor=O}else{const C=u.parse(s[w],1,kt);if(!C)return null;const k=C.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,y.push({content:C,scale:null,font:null,textColor:null})}}return new Qc(y)}evaluate(s){return new ue(this.sections.map(u=>{const f=u.content.evaluate(s);return Le(f)===er?new fe("",f,null,null,null):new fe(ft(f),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor)}outputDefined(){return!1}}class Hh{constructor(s){this.type=er,this.input=s}static parse(s,u){if(s.length!==2)return u.error("Expected two arguments.");const f=u.parse(s[1],1,Ft);return f?new Hh(f):u.error("No image name provided.")}evaluate(s){const u=this.input.evaluate(s),f=ye.fromString(u);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(u)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class qh{constructor(s){this.type=Ze,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=u.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${sn(f.type)} instead.`):new qh(f):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ot(`Expected value to be of type string or array, but found ${sn(Le(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Ga={"==":Y0,"!=":K0,">":Q0,"<":J0,">=":t_,"<=":e_,array:bt,at:Vh,boolean:bt,case:$h,coalesce:Xc,collator:kn,format:Qc,image:Hh,in:jh,"index-of":Kc,interpolate:Oi,"interpolate-hcl":Oi,"interpolate-lab":Oi,length:qh,let:Yc,literal:gt,match:Gh,number:bt,"number-format":Wh,object:bt,slice:Jc,step:tr,string:bt,"to-boolean":It,"to-color":It,"to-number":It,"to-string":It,var:ke,within:ro};function Mp(c,[s,u,f,y]){s=s.evaluate(c),u=u.evaluate(c),f=f.evaluate(c);const x=y?y.evaluate(c):1,w=Ae(s,u,f,x);if(w)throw new ot(w);return new Q(s/255*x,u/255*x,f/255*x,x)}function kp(c,s){return c in s}function eu(c,s){const u=s[c];return u===void 0?null:u}function ra(c){return{type:c}}function Lp(c){return{result:"success",value:c}}function $a(c){return{result:"error",value:c}}function jn(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Rp(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Qt(c){return!!c.expression&&c.expression.interpolated}function gn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Fn(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function qn(c){return c}function Ul(c,s){const u=s.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",y=f||!(f||c.property!==void 0),x=c.type||(Qt(s)?"exponential":"interval");if(u||s.type==="padding"){const k=u?Q.parse:ce.parse;(c=Ut({},c)).stops&&(c.stops=c.stops.map(O=>[O[0],k(O[1])])),c.default=k(c.default?c.default:s.default)}if(c.colorSpace&&c.colorSpace!=="rgb"&&!Ap[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let w,A,C;if(x==="exponential")w=zp;else if(x==="interval")w=r_;else if(x==="categorical"){w=n_,A=Object.create(null);for(const k of c.stops)A[k[0]]=k[1];C=typeof c.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);w=i_}if(f){const k={},O=[];for(let X=0;X<c.stops.length;X++){const Y=c.stops[X],de=Y[0].zoom;k[de]===void 0&&(k[de]={zoom:de,type:c.type,property:c.property,default:c.default,stops:[]},O.push(de)),k[de].stops.push([Y[0].value,Y[1]])}const N=[];for(const X of O)N.push([k[X].zoom,Ul(k[X],s)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Oi.interpolationFactor.bind(void 0,H),zoomStops:N.map(X=>X[0]),evaluate:({zoom:X},Y)=>zp({stops:N,base:c.base},s,X).evaluate(X,Y)}}if(y){const k=x==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Oi.interpolationFactor.bind(void 0,k),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(c,s,O,A,C)}}return{kind:"source",evaluate(k,O){const N=O&&O.properties?O.properties[c.property]:void 0;return N===void 0?Wa(c.default,s.default):w(c,s,N,A,C)}}}function Wa(c,s,u){return c!==void 0?c:s!==void 0?s:u!==void 0?u:void 0}function n_(c,s,u,f,y){return Wa(typeof u===y?f[u]:void 0,c.default,s.default)}function r_(c,s,u){if(gn(u)!=="number")return Wa(c.default,s.default);const f=c.stops.length;if(f===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[f-1][0])return c.stops[f-1][1];const y=qt(c.stops.map(x=>x[0]),u);return c.stops[y][1]}function zp(c,s,u){const f=c.base!==void 0?c.base:1;if(gn(u)!=="number")return Wa(c.default,s.default);const y=c.stops.length;if(y===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[y-1][0])return c.stops[y-1][1];const x=qt(c.stops.map(O=>O[0]),u),w=function(O,N,H,X){const Y=X-H,de=O-H;return Y===0?0:N===1?de/Y:(Math.pow(N,de)-1)/(Math.pow(N,Y)-1)}(u,f,c.stops[x][0],c.stops[x+1][0]),A=c.stops[x][1],C=c.stops[x+1][1];let k=_r[s.type]||qn;if(c.colorSpace&&c.colorSpace!=="rgb"){const O=Ap[c.colorSpace];k=(N,H)=>O.reverse(O.interpolate(O.forward(N),O.forward(H),w))}return typeof A.evaluate=="function"?{evaluate(...O){const N=A.evaluate.apply(void 0,O),H=C.evaluate.apply(void 0,O);if(N!==void 0&&H!==void 0)return k(N,H,w)}}:k(A,C,w)}function i_(c,s,u){switch(s.type){case"color":u=Q.parse(u);break;case"formatted":u=ue.fromString(u.toString());break;case"resolvedImage":u=ye.fromString(u.toString());break;case"padding":u=ce.parse(u);break;default:gn(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0)}return Wa(u,c.default,s.default)}Yt.register(Ga,{error:[{kind:"error"},[Ft],(c,[s])=>{throw new ot(s.evaluate(c))}],typeof:[Ft,[kt],(c,[s])=>sn(Le(s.evaluate(c)))],"to-rgba":[dr(Ze,4),[hr],(c,[s])=>s.evaluate(c).toArray()],rgb:[hr,[Ze,Ze,Ze],Mp],rgba:[hr,[Ze,Ze,Ze,Ze],Mp],has:{type:Ot,overloads:[[[Ft],(c,[s])=>kp(s.evaluate(c),c.properties())],[[Ft,vi],(c,[s,u])=>kp(s.evaluate(c),u.evaluate(c))]]},get:{type:kt,overloads:[[[Ft],(c,[s])=>eu(s.evaluate(c),c.properties())],[[Ft,vi],(c,[s,u])=>eu(s.evaluate(c),u.evaluate(c))]]},"feature-state":[kt,[Ft],(c,[s])=>eu(s.evaluate(c),c.featureState||{})],properties:[vi,[],c=>c.properties()],"geometry-type":[Ft,[],c=>c.geometryType()],id:[kt,[],c=>c.id()],zoom:[Ze,[],c=>c.globals.zoom],"heatmap-density":[Ze,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ze,[],c=>c.globals.lineProgress||0],accumulated:[kt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ze,ra(Ze),(c,s)=>{let u=0;for(const f of s)u+=f.evaluate(c);return u}],"*":[Ze,ra(Ze),(c,s)=>{let u=1;for(const f of s)u*=f.evaluate(c);return u}],"-":{type:Ze,overloads:[[[Ze,Ze],(c,[s,u])=>s.evaluate(c)-u.evaluate(c)],[[Ze],(c,[s])=>-s.evaluate(c)]]},"/":[Ze,[Ze,Ze],(c,[s,u])=>s.evaluate(c)/u.evaluate(c)],"%":[Ze,[Ze,Ze],(c,[s,u])=>s.evaluate(c)%u.evaluate(c)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(c,[s,u])=>Math.pow(s.evaluate(c),u.evaluate(c))],sqrt:[Ze,[Ze],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[Ze,[Ze],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[Ze,[Ze],(c,[s])=>Math.log(s.evaluate(c))],log2:[Ze,[Ze],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[Ze,[Ze],(c,[s])=>Math.sin(s.evaluate(c))],cos:[Ze,[Ze],(c,[s])=>Math.cos(s.evaluate(c))],tan:[Ze,[Ze],(c,[s])=>Math.tan(s.evaluate(c))],asin:[Ze,[Ze],(c,[s])=>Math.asin(s.evaluate(c))],acos:[Ze,[Ze],(c,[s])=>Math.acos(s.evaluate(c))],atan:[Ze,[Ze],(c,[s])=>Math.atan(s.evaluate(c))],min:[Ze,ra(Ze),(c,s)=>Math.min(...s.map(u=>u.evaluate(c)))],max:[Ze,ra(Ze),(c,s)=>Math.max(...s.map(u=>u.evaluate(c)))],abs:[Ze,[Ze],(c,[s])=>Math.abs(s.evaluate(c))],round:[Ze,[Ze],(c,[s])=>{const u=s.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[Ze,[Ze],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[Ze,[Ze],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[Ot,[Ft,kt],(c,[s,u])=>c.properties()[s.value]===u.value],"filter-id-==":[Ot,[kt],(c,[s])=>c.id()===s.value],"filter-type-==":[Ot,[Ft],(c,[s])=>c.geometryType()===s.value],"filter-<":[Ot,[Ft,kt],(c,[s,u])=>{const f=c.properties()[s.value],y=u.value;return typeof f==typeof y&&f<y}],"filter-id-<":[Ot,[kt],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<f}],"filter->":[Ot,[Ft,kt],(c,[s,u])=>{const f=c.properties()[s.value],y=u.value;return typeof f==typeof y&&f>y}],"filter-id->":[Ot,[kt],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>f}],"filter-<=":[Ot,[Ft,kt],(c,[s,u])=>{const f=c.properties()[s.value],y=u.value;return typeof f==typeof y&&f<=y}],"filter-id-<=":[Ot,[kt],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<=f}],"filter->=":[Ot,[Ft,kt],(c,[s,u])=>{const f=c.properties()[s.value],y=u.value;return typeof f==typeof y&&f>=y}],"filter-id->=":[Ot,[kt],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>=f}],"filter-has":[Ot,[kt],(c,[s])=>s.value in c.properties()],"filter-has-id":[Ot,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Ot,[dr(Ft)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[Ot,[dr(kt)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[Ot,[Ft,dr(kt)],(c,[s,u])=>u.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[Ot,[Ft,dr(kt)],(c,[s,u])=>function(f,y,x,w){for(;x<=w;){const A=x+w>>1;if(y[A]===f)return!0;y[A]>f?w=A-1:x=A+1}return!1}(c.properties()[s.value],u.value,0,u.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(c,[s,u])=>s.evaluate(c)&&u.evaluate(c)],[ra(Ot),(c,s)=>{for(const u of s)if(!u.evaluate(c))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(c,[s,u])=>s.evaluate(c)||u.evaluate(c)],[ra(Ot),(c,s)=>{for(const u of s)if(u.evaluate(c))return!0;return!1}]]},"!":[Ot,[Ot],(c,[s])=>!s.evaluate(c)],"is-supported-script":[Ot,[Ft],(c,[s])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(s.evaluate(c))}],upcase:[Ft,[Ft],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Ft,[Ft],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Ft,ra(kt),(c,s)=>s.map(u=>ft(u.evaluate(c))).join("")],"resolved-locale":[Ft,[Zr],(c,[s])=>s.evaluate(c).resolvedLocale()]});class tu{constructor(s,u){this.expression=s,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=u?function(f){return f.type==="color"&&Fn(f.default)?new Q(0,0,0,0):f.type==="color"?Q.parse(f.default)||null:f.type==="padding"?ce.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(s,u,f,y,x,w){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=y,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(s,u,f,y,x,w){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=y,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new ot(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function Vl(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Ga}function jl(c,s){const u=new He(Ga,[],s?function(y){const x={color:hr,string:Ft,number:Ze,enum:Ft,boolean:Ot,formatted:or,padding:Ji,resolvedImage:er};return y.type==="array"?dr(x[y.value]||kt,y.length):x[y.type]}(s):void 0),f=u.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Lp(new tu(f,s)):$a(u.errors)}class Gl{constructor(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!ne(u.expression)}evaluateWithoutErrorHandling(s,u,f,y,x,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,y,x,w)}evaluate(s,u,f,y,x,w){return this._styleExpression.evaluate(s,u,f,y,x,w)}}class Zh{constructor(s,u,f,y){this.kind=s,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!ne(u.expression),this.interpolationType=y}evaluateWithoutErrorHandling(s,u,f,y,x,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,y,x,w)}evaluate(s,u,f,y,x,w){return this._styleExpression.evaluate(s,u,f,y,x,w)}interpolationFactor(s,u,f){return this.interpolationType?Oi.interpolationFactor(this.interpolationType,s,u,f):0}}function Dp(c,s){const u=jl(c,s);if(u.result==="error")return u;const f=u.value.expression,y=Z(f);if(!y&&!jn(s))return $a([new Vn("","data expressions not supported")]);const x=pe(f,["zoom"]);if(!x&&!Rp(s))return $a([new Vn("","zoom expressions not supported")]);const w=ru(f);return w||x?w instanceof Vn?$a([w]):w instanceof Oi&&!Qt(s)?$a([new Vn("",'"interpolate" expressions cannot be used with this property')]):Lp(w?new Zh(y?"camera":"composite",u.value,w.labels,w instanceof Oi?w.interpolation:void 0):new Gl(y?"constant":"source",u.value)):$a([new Vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nu{constructor(s,u){this._parameters=s,this._specification=u,Ut(this,Ul(this._parameters,this._specification))}static deserialize(s){return new nu(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function ru(c){let s=null;if(c instanceof Yc)s=ru(c.result);else if(c instanceof Xc){for(const u of c.args)if(s=ru(u),s)break}else(c instanceof tr||c instanceof Oi)&&c.input instanceof Yt&&c.input.name==="zoom"&&(s=c);return s instanceof Vn||c.eachChild(u=>{const f=ru(u);f instanceof Vn?s=f:!s&&f?s=new Vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new Vn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function gs(c){const s=c.key,u=c.value,f=c.valueSpec||{},y=c.objectElementValidators||{},x=c.style,w=c.styleSpec;let A=[];const C=gn(u);if(C!=="object")return[new Re(s,u,`object expected, ${C} found`)];for(const k in u){const O=k.split(".")[0],N=f[O]||f["*"];let H;if(y[O])H=y[O];else if(f[O])H=Bi;else if(y["*"])H=y["*"];else{if(!f["*"]){A.push(new Re(s,u[k],`unknown property "${k}"`));continue}H=Bi}A=A.concat(H({key:(s&&`${s}.`)+k,value:u[k],valueSpec:N,style:x,styleSpec:w,object:u,objectKey:k},u))}for(const k in f)y[k]||f[k].required&&f[k].default===void 0&&u[k]===void 0&&A.push(new Re(s,u,`missing required property "${k}"`));return A}function Op(c){const s=c.value,u=c.valueSpec,f=c.style,y=c.styleSpec,x=c.key,w=c.arrayElementValidator||Bi;if(gn(s)!=="array")return[new Re(x,s,`array expected, ${gn(s)} found`)];if(u.length&&s.length!==u.length)return[new Re(x,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new Re(x,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let A={type:u.value,values:u.values};y.$version<7&&(A.function=u.function),gn(u.value)==="object"&&(A=u.value);let C=[];for(let k=0;k<s.length;k++)C=C.concat(w({array:s,arrayIndex:k,value:s[k],valueSpec:A,style:f,styleSpec:y,key:`${x}[${k}]`}));return C}function Xh(c){const s=c.key,u=c.value,f=c.valueSpec;let y=gn(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Re(s,u,`number expected, ${y} found`)]:"minimum"in f&&u<f.minimum?[new Re(s,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new Re(s,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function Fp(c){const s=c.valueSpec,u=xt(c.value.type);let f,y,x,w={};const A=u!=="categorical"&&c.value.property===void 0,C=!A,k=gn(c.value.stops)==="array"&&gn(c.value.stops[0])==="array"&&gn(c.value.stops[0][0])==="object",O=gs({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new Re(X.key,X.value,'identity function may not have a "stops" property')];let Y=[];const de=X.value;return Y=Y.concat(Op({key:X.key,value:de,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:N})),gn(de)==="array"&&de.length===0&&Y.push(new Re(X.key,de,"array must have at least one stop")),Y},default:function(X){return Bi({key:X.key,value:X.value,valueSpec:s,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&A&&O.push(new Re(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||O.push(new Re(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!Qt(c.valueSpec)&&O.push(new Re(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!jn(c.valueSpec)?O.push(new Re(c.key,c.value,"property functions not supported")):A&&!Rp(c.valueSpec)&&O.push(new Re(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!k||c.value.property!==void 0||O.push(new Re(c.key,c.value,'"property" property is required')),O;function N(X){let Y=[];const de=X.value,le=X.key;if(gn(de)!=="array")return[new Re(le,de,`array expected, ${gn(de)} found`)];if(de.length!==2)return[new Re(le,de,`array length 2 expected, length ${de.length} found`)];if(k){if(gn(de[0])!=="object")return[new Re(le,de,`object expected, ${gn(de[0])} found`)];if(de[0].zoom===void 0)return[new Re(le,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new Re(le,de,"object stop key must have value")];if(x&&x>xt(de[0].zoom))return[new Re(le,de[0].zoom,"stop zoom values must appear in ascending order")];xt(de[0].zoom)!==x&&(x=xt(de[0].zoom),y=void 0,w={}),Y=Y.concat(gs({key:`${le}[0]`,value:de[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:Xh,value:H}}))}else Y=Y.concat(H({key:`${le}[0]`,value:de[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},de));return Vl(rn(de[1]))?Y.concat([new Re(`${le}[1]`,de[1],"expressions are not allowed in function stops.")]):Y.concat(Bi({key:`${le}[1]`,value:de[1],valueSpec:s,style:X.style,styleSpec:X.styleSpec}))}function H(X,Y){const de=gn(X.value),le=xt(X.value),be=X.value!==null?X.value:Y;if(f){if(de!==f)return[new Re(X.key,be,`${de} stop domain type must match previous stop domain type ${f}`)]}else f=de;if(de!=="number"&&de!=="string"&&de!=="boolean")return[new Re(X.key,be,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&u!=="categorical"){let Ie=`number expected, ${de} found`;return jn(s)&&u===void 0&&(Ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(X.key,be,Ie)]}return u!=="categorical"||de!=="number"||isFinite(le)&&Math.floor(le)===le?u!=="categorical"&&de==="number"&&y!==void 0&&le<y?[new Re(X.key,be,"stop domain values must appear in ascending order")]:(y=le,u==="categorical"&&le in w?[new Re(X.key,be,"stop domain values must be unique")]:(w[le]=!0,[])):[new Re(X.key,be,`integer expected, found ${le}`)]}}function ia(c){const s=(c.expressionContext==="property"?Dp:jl)(rn(c.value),c.valueSpec);if(s.result==="error")return s.value.map(f=>new Re(`${c.key}${f.key}`,c.value,f.message));const u=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new Re(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!ne(u))return[new Re(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!ne(u))return[new Re(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!pe(u,["zoom","feature-state"]))return[new Re(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Z(u))return[new Re(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $l(c){const s=c.key,u=c.value,f=c.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(xt(u))===-1&&y.push(new Re(s,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(xt(u))===-1&&y.push(new Re(s,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Ha(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!Ha(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const s_={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function iu(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Ha(c)||(c=Wl(c));const s=jl(c,s_);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,y)=>s.value.evaluate(u,f,{},y),needGeometry:Np(c)}}function Bp(c,s){return c<s?-1:c>s?1:0}function Np(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(Np(c[s]))return!0;return!1}function Wl(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?Yh(c[1],c[2],"=="):s==="!="?qa(Yh(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Yh(c[1],c[2],s):s==="any"?(u=c.slice(1),["any"].concat(u.map(Wl))):s==="all"?["all"].concat(c.slice(1).map(Wl)):s==="none"?["all"].concat(c.slice(1).map(Wl).map(qa)):s==="in"?su(c[1],c.slice(2)):s==="!in"?qa(su(c[1],c.slice(2))):s==="has"?Hl(c[1]):s==="!has"?qa(Hl(c[1])):s!=="within"||c;var u}function Yh(c,s,u){switch(c){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,c,s]}}function su(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",c,["literal",s.sort(Bp)]]:["filter-in-small",c,["literal",s]]}}function Hl(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function qa(c){return["!",c]}function ql(c){return Ha(rn(c.value))?ia(Ut({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Up(c)}function Up(c){const s=c.value,u=c.key;if(gn(s)!=="array")return[new Re(u,s,`array expected, ${gn(s)} found`)];const f=c.styleSpec;let y,x=[];if(s.length<1)return[new Re(u,s,"filter array must have at least 1 element")];switch(x=x.concat($l({key:`${u}[0]`,value:s[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),xt(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&xt(s[1])==="$type"&&x.push(new Re(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new Re(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(y=gn(s[1]),y!=="string"&&x.push(new Re(`${u}[1]`,s[1],`string expected, ${y} found`)));for(let w=2;w<s.length;w++)y=gn(s[w]),xt(s[1])==="$type"?x=x.concat($l({key:`${u}[${w}]`,value:s[w],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&x.push(new Re(`${u}[${w}]`,s[w],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)x=x.concat(Up({key:`${u}[${w}]`,value:s[w],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":y=gn(s[1]),s.length!==2?x.push(new Re(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):y!=="string"&&x.push(new Re(`${u}[1]`,s[1],`string expected, ${y} found`));break;case"within":y=gn(s[1]),s.length!==2?x.push(new Re(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):y!=="object"&&x.push(new Re(`${u}[1]`,s[1],`object expected, ${y} found`))}return x}function Zl(c,s){const u=c.key,f=c.style,y=c.styleSpec,x=c.value,w=c.objectKey,A=y[`${s}_${c.layerType}`];if(!A)return[];const C=w.match(/^(.*)-transition$/);if(s==="paint"&&C&&A[C[1]]&&A[C[1]].transition)return Bi({key:u,value:x,valueSpec:y.transition,style:f,styleSpec:y});const k=c.valueSpec||A[w];if(!k)return[new Re(u,x,`unknown property "${w}"`)];let O;if(gn(x)==="string"&&jn(k)&&!k.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new Re(u,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const N=[];return c.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&N.push(new Re(u,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Fn(rn(x))&&xt(x.type)==="identity"&&N.push(new Re(u,x,'"text-font" does not support identity functions'))),N.concat(Bi({key:c.key,value:x,valueSpec:k,style:f,styleSpec:y,expressionContext:"property",propertyType:s,propertyKey:w}))}function Vp(c){return Zl(c,"paint")}function jp(c){return Zl(c,"layout")}function Gp(c){let s=[];const u=c.value,f=c.key,y=c.style,x=c.styleSpec;u.type||u.ref||s.push(new Re(f,u,'either "type" or "ref" is required'));let w=xt(u.type);const A=xt(u.ref);if(u.id){const C=xt(u.id);for(let k=0;k<c.arrayIndex;k++){const O=y.layers[k];xt(O.id)===C&&s.push(new Re(f,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let C;["type","source","source-layer","filter","layout"].forEach(k=>{k in u&&s.push(new Re(f,u[k],`"${k}" is prohibited for ref layers`))}),y.layers.forEach(k=>{xt(k.id)===A&&(C=k)}),C?C.ref?s.push(new Re(f,u.ref,"ref cannot reference another ref layer")):w=xt(C.type):s.push(new Re(f,u.ref,`ref layer "${A}" not found`))}else if(w!=="background")if(u.source){const C=y.sources&&y.sources[u.source],k=C&&xt(C.type);C?k==="vector"&&w==="raster"?s.push(new Re(f,u.source,`layer "${u.id}" requires a raster source`)):k==="raster"&&w!=="raster"?s.push(new Re(f,u.source,`layer "${u.id}" requires a vector source`)):k!=="vector"||u["source-layer"]?k==="raster-dem"&&w!=="hillshade"?s.push(new Re(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!u.paint||!u.paint["line-gradient"]||k==="geojson"&&C.lineMetrics||s.push(new Re(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Re(f,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new Re(f,u.source,`source "${u.source}" not found`))}else s.push(new Re(f,u,'missing required property "source"'));return s=s.concat(gs({key:f,value:u,valueSpec:x.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bi({key:`${f}.type`,value:u.type,valueSpec:x.layer.type,style:c.style,styleSpec:c.styleSpec,object:u,objectKey:"type"}),filter:ql,layout:C=>gs({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>jp(Ut({layerType:w},k))}}),paint:C=>gs({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>Vp(Ut({layerType:w},k))}})}})),s}function Za(c){const s=c.value,u=c.key,f=gn(s);return f!=="string"?[new Re(u,s,`string expected, ${f} found`)]:[]}const $p={promoteId:function({key:c,value:s}){if(gn(s)==="string")return Za({key:c,value:s});{const u=[];for(const f in s)u.push(...Za({key:`${c}.${f}`,value:s[f]}));return u}}};function Xl(c){const s=c.value,u=c.key,f=c.styleSpec,y=c.style;if(!s.type)return[new Re(u,s,'"type" is required')];const x=xt(s.type);let w;switch(x){case"vector":case"raster":case"raster-dem":return w=gs({key:u,value:s,valueSpec:f[`source_${x.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:$p}),w;case"geojson":if(w=gs({key:u,value:s,valueSpec:f.source_geojson,style:y,styleSpec:f,objectElementValidators:$p}),s.cluster)for(const A in s.clusterProperties){const[C,k]=s.clusterProperties[A],O=typeof C=="string"?[C,["accumulated"],["get",A]]:C;w.push(...ia({key:`${u}.${A}.map`,value:k,expressionContext:"cluster-map"})),w.push(...ia({key:`${u}.${A}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return gs({key:u,value:s,valueSpec:f.source_video,style:y,styleSpec:f});case"image":return gs({key:u,value:s,valueSpec:f.source_image,style:y,styleSpec:f});case"canvas":return[new Re(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $l({key:`${u}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:f})}}function Yl(c){const s=c.value,u=c.styleSpec,f=u.light,y=c.style;let x=[];const w=gn(s);if(s===void 0)return x;if(w!=="object")return x=x.concat([new Re("light",s,`object expected, ${w} found`)]),x;for(const A in s){const C=A.match(/^(.*)-transition$/);x=x.concat(C&&f[C[1]]&&f[C[1]].transition?Bi({key:A,value:s[A],valueSpec:u.transition,style:y,styleSpec:u}):f[A]?Bi({key:A,value:s[A],valueSpec:f[A],style:y,styleSpec:u}):[new Re(A,s[A],`unknown property "${A}"`)])}return x}function Fi(c){const s=c.value,u=c.styleSpec,f=u.terrain,y=c.style;let x=[];const w=gn(s);if(s===void 0)return x;if(w!=="object")return x=x.concat([new Re("terrain",s,`object expected, ${w} found`)]),x;for(const A in s)x=x.concat(f[A]?Bi({key:A,value:s[A],valueSpec:f[A],style:y,styleSpec:u}):[new Re(A,s[A],`unknown property "${A}"`)]);return x}const Kl={"*":()=>[],array:Op,boolean:function(c){const s=c.value,u=c.key,f=gn(s);return f!=="boolean"?[new Re(u,s,`boolean expected, ${f} found`)]:[]},number:Xh,color:function(c){const s=c.key,u=c.value,f=gn(u);return f!=="string"?[new Re(s,u,`color expected, ${f} found`)]:Ns(u)===null?[new Re(s,u,`color expected, "${u}" found`)]:[]},constants:On,enum:$l,filter:ql,function:Fp,layer:Gp,object:gs,source:Xl,light:Yl,terrain:Fi,string:Za,formatted:function(c){return Za(c).length===0?[]:ia(c)},resolvedImage:function(c){return Za(c).length===0?[]:ia(c)},padding:function(c){const s=c.key,u=c.value;if(gn(u)==="array"){if(u.length<1||u.length>4)return[new Re(s,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let y=[];for(let x=0;x<u.length;x++)y=y.concat(Bi({key:`${s}[${x}]`,value:u[x],valueSpec:f}));return y}return Xh({key:s,value:u,valueSpec:{}})}};function Bi(c){const s=c.value,u=c.valueSpec,f=c.styleSpec;return u.expression&&Fn(xt(s))?Fp(c):u.expression&&Vl(rn(s))?ia(c):u.type&&Kl[u.type]?Kl[u.type](c):gs(Ut({},c,{valueSpec:u.type?f[u.type]:u}))}function o_(c){const s=c.value,u=c.key,f=Za(c);return f.length||(s.indexOf("{fontstack}")===-1&&f.push(new Re(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&f.push(new Re(u,s,'"glyphs" url must include a "{range}" token'))),f}function Ao(c,s=Ee){let u=[];return u=u.concat(Bi({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,objectElementValidators:{glyphs:o_,"*":()=>[]}})),c.constants&&(u=u.concat(On({key:"constants",value:c.constants,style:c,styleSpec:s}))),Wp(u)}function Wp(c){return[].concat(c).sort((s,u)=>s.line-u.line)}function io(c){return function(...s){return Wp(c.apply(this,s))}}Ao.source=io(Xl),Ao.light=io(Yl),Ao.terrain=io(Fi),Ao.layer=io(Gp),Ao.filter=io(ql),Ao.paintProperty=io(Vp),Ao.layoutProperty=io(jp);const Jl=Ao,Kh=Jl.light,a_=Jl.paintProperty,l_=Jl.layoutProperty;function ou(c,s){let u=!1;if(s&&s.length)for(const f of s)c.fire(new St(new Error(f.message))),u=!0;return u}class Ql{constructor(s,u,f){const y=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(u=w[1])+2*(f=w[2]);for(let C=0;C<this.d*this.d;C++){const k=w[3+C],O=w[3+C+1];y.push(k===O?null:w.subarray(k,O))}const A=w[3+y.length+1];this.keys=w.subarray(w[3+y.length],A),this.bboxes=w.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let w=0;w<this.d*this.d;w++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=f,this.scale=u/s,this.uid=0;const x=f/u*s;this.min=-x,this.max=s+x}insert(s,u,f,y,x){this._forEachCell(u,f,y,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,u,f,y,x,w){this.cells[x].push(w)}query(s,u,f,y,x){const w=this.min,A=this.max;if(s<=w&&u<=w&&A<=f&&A<=y&&!x)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(s,u,f,y,this._queryCell,C,{},x),C}}_queryCell(s,u,f,y,x,w,A,C){const k=this.cells[x];if(k!==null){const O=this.keys,N=this.bboxes;for(let H=0;H<k.length;H++){const X=k[H];if(A[X]===void 0){const Y=4*X;(C?C(N[Y+0],N[Y+1],N[Y+2],N[Y+3]):s<=N[Y+2]&&u<=N[Y+3]&&f>=N[Y+0]&&y>=N[Y+1])?(A[X]=!0,w.push(O[X])):A[X]=!1}}}}_forEachCell(s,u,f,y,x,w,A,C){const k=this._convertToCellCoord(s),O=this._convertToCellCoord(u),N=this._convertToCellCoord(f),H=this._convertToCellCoord(y);for(let X=k;X<=N;X++)for(let Y=O;Y<=H;Y++){const de=this.d*Y+X;if((!C||C(this._convertFromCellCoord(X),this._convertFromCellCoord(Y),this._convertFromCellCoord(X+1),this._convertFromCellCoord(Y+1)))&&x.call(this,s,u,f,y,de,w,A,C))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,u=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const y=new Int32Array(u+f+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let x=u;for(let w=0;w<s.length;w++){const A=s[w];y[3+w]=x,y.set(A,x),x+=A.length}return y[3+s.length]=x,y.set(this.keys,x),x+=this.keys.length,y[3+s.length+1]=x,y.set(this.bboxes,x),x+=this.bboxes.length,y.buffer}static serialize(s,u){const f=s.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(s){return new Ql(s.buffer)}}const so={};function pt(c,s,u={}){if(so[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),so[c]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}pt("Object",Object),pt("TransferableGridIndex",Ql),pt("Color",Q),pt("Error",Error),pt("AJAXError",pn),pt("ResolvedImage",ye),pt("StylePropertyFunction",nu),pt("StyleExpression",tu,{omit:["_evaluator"]}),pt("ZoomDependentExpression",Zh),pt("ZoomConstantExpression",Gl),pt("CompoundExpression",Yt,{omit:["_evaluate"]});for(const c in Ga)Ga[c]._classRegistryKey||pt(`Expression_${c}`,Ga[c]);function Hp(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function sa(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(Hp(c)||st(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const u=c;return s&&s.push(u.buffer),u}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const f of c)u.push(sa(f,s));return u}if(typeof c=="object"){const u=c.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!so[f])throw new Error(`${f} is not registered.`);const y=u.serialize?u.serialize(c,s):{};if(u.serialize){if(s&&y===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in c){if(!c.hasOwnProperty(x)||so[f].omit.indexOf(x)>=0)continue;const w=c[x];y[x]=so[f].shallow.indexOf(x)>=0?w:sa(w,s)}c instanceof Error&&(y.message=c.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(y.$name=f),y}throw new Error("can't serialize object of type "+typeof c)}function Co(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||Hp(c)||st(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Co);if(typeof c=="object"){const s=c.$name||"Object";if(!so[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:u}=so[s];if(!u)throw new Error(`can't deserialize unregistered class ${s}`);if(u.deserialize)return u.deserialize(c);const f=Object.create(u.prototype);for(const y of Object.keys(c)){if(y==="$name")continue;const x=c[y];f[y]=so[s].shallow.indexOf(y)>=0?x:Co(x)}return f}throw new Error("can't deserialize object of type "+typeof c)}class Jh{constructor(){this.first=!0}update(s,u){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const at={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function au(c){for(const s of c)if(ed(s.charCodeAt(0)))return!0;return!1}function c_(c){for(const s of c)if(!Qh(s.charCodeAt(0)))return!1;return!0}function Qh(c){return!(at.Arabic(c)||at["Arabic Supplement"](c)||at["Arabic Extended-A"](c)||at["Arabic Presentation Forms-A"](c)||at["Arabic Presentation Forms-B"](c))}function ed(c){return!(c!==746&&c!==747&&(c<4352||!(at["Bopomofo Extended"](c)||at.Bopomofo(c)||at["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||at["CJK Compatibility Ideographs"](c)||at["CJK Compatibility"](c)||at["CJK Radicals Supplement"](c)||at["CJK Strokes"](c)||!(!at["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||at["CJK Unified Ideographs Extension A"](c)||at["CJK Unified Ideographs"](c)||at["Enclosed CJK Letters and Months"](c)||at["Hangul Compatibility Jamo"](c)||at["Hangul Jamo Extended-A"](c)||at["Hangul Jamo Extended-B"](c)||at["Hangul Jamo"](c)||at["Hangul Syllables"](c)||at.Hiragana(c)||at["Ideographic Description Characters"](c)||at.Kanbun(c)||at["Kangxi Radicals"](c)||at["Katakana Phonetic Extensions"](c)||at.Katakana(c)&&c!==12540||!(!at["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!at["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||at["Unified Canadian Aboriginal Syllabics"](c)||at["Unified Canadian Aboriginal Syllabics Extended"](c)||at["Vertical Forms"](c)||at["Yijing Hexagram Symbols"](c)||at["Yi Syllables"](c)||at["Yi Radicals"](c))))}function qp(c){return!(ed(c)||function(s){return!!(at["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||at["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||at["Letterlike Symbols"](s)||at["Number Forms"](s)||at["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||at["Control Pictures"](s)&&s!==9251||at["Optical Character Recognition"](s)||at["Enclosed Alphanumerics"](s)||at["Geometric Shapes"](s)||at["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||at["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||at["CJK Symbols and Punctuation"](s)||at.Katakana(s)||at["Private Use Area"](s)||at["CJK Compatibility Forms"](s)||at["Small Form Variants"](s)||at["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function Zp(c){return c>=1424&&c<=2303||at["Arabic Presentation Forms-A"](c)||at["Arabic Presentation Forms-B"](c)}function u_(c,s){return!(!s&&Zp(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||at.Khmer(c))}function Xp(c){for(const s of c)if(Zp(s.charCodeAt(0)))return!0;return!1}const td="deferred",nd="loading",rd="loaded";let id=null,wi="unavailable",Io=null;const Yp=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(wi="error"),id&&id(c)};function Xa(){sd.fire(new Ye("pluginStateChange",{pluginStatus:wi,pluginURL:Io}))}const sd=new Rt,ec=function(){return wi},Kp=function(){if(wi!==td||!Io)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wi=nd,Xa(),Io&&Jn({url:Io},c=>{c?Yp(c):(wi=rd,Xa())})},ts={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>wi===rd||ts.applyArabicShaping!=null,isLoading:()=>wi===nd,setState(c){if(!Me())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");wi=c.pluginStatus,Io=c.pluginURL},isParsed(){if(!Me())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return ts.applyArabicShaping!=null&&ts.processBidirectionalText!=null&&ts.processStyledBidirectionalText!=null},getPluginURL(){if(!Me())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Io}};class Zn{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Jh,this.transition={})}isSupportedScript(s){return function(u,f){for(const y of u)if(!u_(y.charCodeAt(0),f))return!1;return!0}(s,ts.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,u=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class tc{constructor(s,u){this.property=s,this.value=u,this.expression=function(f,y){if(Fn(f))return new nu(f,y);if(Vl(f)){const x=Dp(f,y);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));return x.value}{let x=f;return y.type==="color"&&typeof f=="string"?x=Q.parse(f):y.type!=="padding"||typeof f!="number"&&!Array.isArray(f)||(x=ce.parse(f)),{kind:"constant",evaluate:()=>x}}}(u===void 0?s.specification.default:u,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,f){return this.property.possiblyEvaluate(this,s,u,f)}}class lu{constructor(s){this.property=s,this.value=new tc(s,void 0)}transitioned(s,u){return new Qp(this.property,this.value,u,D({},s.transition,this.transition),s.now)}untransitioned(){return new Qp(this.property,this.value,null,{},0)}}class Jp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return G(this._values[s].value.value)}setValue(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new lu(this._values[s].property)),this._values[s].value=new tc(this._values[s].property,u===null?void 0:G(u))}getTransition(s){return G(this._values[s].transition)}setTransition(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new lu(this._values[s].property)),this._values[s].transition=G(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f);const y=this.getTransition(u);y!==void 0&&(s[`${u}-transition`]=y)}return s}transitioned(s,u){const f=new em(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].transitioned(s,u._values[y]);return f}untransitioned(){const s=new em(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}}class Qp{constructor(s,u,f,y,x){this.property=s,this.value=u,this.begin=x+y.delay||0,this.end=this.begin+y.duration||0,s.specification.transition&&(y.delay||y.duration)&&(this.prior=f)}possiblyEvaluate(s,u,f){const y=s.now||0,x=this.value.possiblyEvaluate(s,u,f),w=this.prior;if(w){if(y>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(y<this.begin)return w.possiblyEvaluate(s,u,f);{const A=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(s,u,f),x,function(C){if(C<=0)return 0;if(C>=1)return 1;const k=C*C,O=k*C;return 4*(C<.5?O:3*(C-k)+O-.75)}(A))}}return x}}class em{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,f){const y=new nc(this._properties);for(const x of Object.keys(this._values))y._values[x]=this._values[x].possiblyEvaluate(s,u,f);return y}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class h_{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}getValue(s){return G(this._values[s].value)}setValue(s,u){this._values[s]=new tc(this._values[s].property,u===null?void 0:G(u))}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f)}return s}possiblyEvaluate(s,u,f){const y=new nc(this._properties);for(const x of Object.keys(this._values))y._values[x]=this._values[x].possiblyEvaluate(s,u,f);return y}}class Us{constructor(s,u,f){this.property=s,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,f,y){return this.property.evaluate(this.value,this.parameters,s,u,f,y)}}class nc{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class vt{constructor(s){this.specification=s}possiblyEvaluate(s,u){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(u)}interpolate(s,u,f){const y=_r[this.specification.type];return y?y(s,u,f):s}}class Mt{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,f,y){return new Us(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},f,y)}:s.expression,u)}interpolate(s,u,f){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new Us(this,{kind:"constant",value:void 0},s.parameters);const y=_r[this.specification.type];return y?new Us(this,{kind:"constant",value:y(s.value.value,u.value.value,f)},s.parameters):s}evaluate(s,u,f,y,x,w){return s.kind==="constant"?s.value:s.evaluate(u,f,y,x,w)}}class Ya extends Mt{possiblyEvaluate(s,u,f,y){if(s.value===void 0)return new Us(this,{kind:"constant",value:void 0},u);if(s.expression.kind==="constant"){const x=s.expression.evaluate(u,null,{},f,y),w=s.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,A=this._calculate(w,w,w,u);return new Us(this,{kind:"constant",value:A},u)}if(s.expression.kind==="camera"){const x=this._calculate(s.expression.evaluate({zoom:u.zoom-1}),s.expression.evaluate({zoom:u.zoom}),s.expression.evaluate({zoom:u.zoom+1}),u);return new Us(this,{kind:"constant",value:x},u)}return new Us(this,s.expression,u)}evaluate(s,u,f,y,x,w){if(s.kind==="source"){const A=s.evaluate(u,f,y,x,w);return this._calculate(A,A,A,u)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(u.zoom)-1},f,y),s.evaluate({zoom:Math.floor(u.zoom)},f,y),s.evaluate({zoom:Math.floor(u.zoom)+1},f,y),u):s.value}_calculate(s,u,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class od{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,y){if(s.value!==void 0){if(s.expression.kind==="constant"){const x=s.expression.evaluate(u,null,{},f,y);return this._calculate(x,x,x,u)}return this._calculate(s.expression.evaluate(new Zn(Math.floor(u.zoom-1),u)),s.expression.evaluate(new Zn(Math.floor(u.zoom),u)),s.expression.evaluate(new Zn(Math.floor(u.zoom+1),u)),u)}}_calculate(s,u,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class Mo{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,y){return!!s.expression.evaluate(u,null,{},f,y)}interpolate(){return!1}}class Yr{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in s){const f=s[u];f.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new tc(f,void 0),x=this.defaultTransitionablePropertyValues[u]=new lu(f);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}pt("DataDrivenProperty",Mt),pt("DataConstantProperty",vt),pt("CrossFadedDataDrivenProperty",Ya),pt("CrossFadedProperty",od),pt("ColorRampProperty",Mo);const ko="-transition";class Vs extends Rt{constructor(s,u){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),u.layout&&(this._unevaluatedLayout=new h_(u.layout)),u.paint)){this._transitionablePaint=new Jp(u.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nc(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u,f={}){u!=null&&this._validate(l_,`layers.${this.id}.layout.${s}`,s,u,f)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,u):this.visibility=u)}getPaintProperty(s){return s.endsWith(ko)?this._transitionablePaint.getTransition(s.slice(0,-ko.length)):this._transitionablePaint.getValue(s)}setPaintProperty(s,u,f={}){if(u!=null&&this._validate(a_,`layers.${this.id}.paint.${s}`,s,u,f))return!1;if(s.endsWith(ko))return this._transitionablePaint.setTransition(s.slice(0,-ko.length),u||void 0),!1;{const y=this._transitionablePaint._values[s],x=y.property.specification["property-type"]==="cross-faded-data-driven",w=y.value.isDataDriven(),A=y.value;this._transitionablePaint.setValue(s,u),this._handleSpecialPaintPropertyUpdate(s);const C=this._transitionablePaint._values[s].value;return C.isDataDriven()||w||x||this._handleOverridablePaintPropertyUpdate(s,A,C)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,u,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),V(s,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(s,u,f,y,x={}){return(!x||x.validate!==!1)&&ou(this,s.call(Jl,{key:u,layerType:this.type,objectKey:f,value:y,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof Us&&jn(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const tm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lo{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Tr(c,s=1){let u=0,f=0;return{members:c.map(y=>{const x=tm[y.type].BYTES_PER_ELEMENT,w=u=ad(u,Math.max(s,x)),A=y.components||1;return f=Math.max(f,x),u+=x*A,{name:y.name,type:y.type,components:A,offset:w}}),size:ad(u,Math.max(f,s)),alignment:s}}function ad(c,s){return Math.ceil(c/s)*s}class oa extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const y=2*s;return this.int16[y+0]=u,this.int16[y+1]=f,s}}oa.prototype.bytesPerElement=4,pt("StructArrayLayout2i4",oa);class g extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,u,f,y)}emplace(s,u,f,y,x){const w=4*s;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=y,this.int16[w+3]=x,s}}g.prototype.bytesPerElement=8,pt("StructArrayLayout4i8",g);class o extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,f,y,x,w)}emplace(s,u,f,y,x,w,A){const C=6*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=y,this.int16[C+3]=x,this.int16[C+4]=w,this.int16[C+5]=A,s}}o.prototype.bytesPerElement=12,pt("StructArrayLayout2i4i12",o);class d extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,f,y,x,w)}emplace(s,u,f,y,x,w,A){const C=4*s,k=8*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.uint8[k+4]=y,this.uint8[k+5]=x,this.uint8[k+6]=w,this.uint8[k+7]=A,s}}d.prototype.bytesPerElement=8,pt("StructArrayLayout2i4ub8",d);class p extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const y=2*s;return this.float32[y+0]=u,this.float32[y+1]=f,s}}p.prototype.bytesPerElement=8,pt("StructArrayLayout2f8",p);class _ extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w,A,C,k,O){const N=this.length;return this.resize(N+1),this.emplace(N,s,u,f,y,x,w,A,C,k,O)}emplace(s,u,f,y,x,w,A,C,k,O,N){const H=10*s;return this.uint16[H+0]=u,this.uint16[H+1]=f,this.uint16[H+2]=y,this.uint16[H+3]=x,this.uint16[H+4]=w,this.uint16[H+5]=A,this.uint16[H+6]=C,this.uint16[H+7]=k,this.uint16[H+8]=O,this.uint16[H+9]=N,s}}_.prototype.bytesPerElement=20,pt("StructArrayLayout10ui20",_);class b extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w,A,C,k,O,N,H){const X=this.length;return this.resize(X+1),this.emplace(X,s,u,f,y,x,w,A,C,k,O,N,H)}emplace(s,u,f,y,x,w,A,C,k,O,N,H,X){const Y=12*s;return this.int16[Y+0]=u,this.int16[Y+1]=f,this.int16[Y+2]=y,this.int16[Y+3]=x,this.uint16[Y+4]=w,this.uint16[Y+5]=A,this.uint16[Y+6]=C,this.uint16[Y+7]=k,this.int16[Y+8]=O,this.int16[Y+9]=N,this.int16[Y+10]=H,this.int16[Y+11]=X,s}}b.prototype.bytesPerElement=24,pt("StructArrayLayout4i4ui4i24",b);class P extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,s,u,f)}emplace(s,u,f,y){const x=3*s;return this.float32[x+0]=u,this.float32[x+1]=f,this.float32[x+2]=y,s}}P.prototype.bytesPerElement=12,pt("StructArrayLayout3f12",P);class I extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}I.prototype.bytesPerElement=4,pt("StructArrayLayout1ul4",I);class M extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w,A,C,k){const O=this.length;return this.resize(O+1),this.emplace(O,s,u,f,y,x,w,A,C,k)}emplace(s,u,f,y,x,w,A,C,k,O){const N=10*s,H=5*s;return this.int16[N+0]=u,this.int16[N+1]=f,this.int16[N+2]=y,this.int16[N+3]=x,this.int16[N+4]=w,this.int16[N+5]=A,this.uint32[H+3]=C,this.uint16[N+8]=k,this.uint16[N+9]=O,s}}M.prototype.bytesPerElement=20,pt("StructArrayLayout6i1ul2ui20",M);class L extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,f,y,x,w)}emplace(s,u,f,y,x,w,A){const C=6*s;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=y,this.int16[C+3]=x,this.int16[C+4]=w,this.int16[C+5]=A,s}}L.prototype.bytesPerElement=12,pt("StructArrayLayout2i2i2i12",L);class B extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,f,y,x)}emplace(s,u,f,y,x,w){const A=4*s,C=8*s;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=y,this.int16[C+6]=x,this.int16[C+7]=w,s}}B.prototype.bytesPerElement=16,pt("StructArrayLayout2f1f2i16",B);class W extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,u,f,y)}emplace(s,u,f,y,x){const w=12*s,A=3*s;return this.uint8[w+0]=u,this.uint8[w+1]=f,this.float32[A+1]=y,this.float32[A+2]=x,s}}W.prototype.bytesPerElement=12,pt("StructArrayLayout2ub2f12",W);class q extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,s,u,f)}emplace(s,u,f,y){const x=3*s;return this.uint16[x+0]=u,this.uint16[x+1]=f,this.uint16[x+2]=y,s}}q.prototype.bytesPerElement=6,pt("StructArrayLayout3ui6",q);class oe extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de,le,be){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de,le,be)}emplace(s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de,le,be,Ie){const xe=24*s,Se=12*s,Ve=48*s;return this.int16[xe+0]=u,this.int16[xe+1]=f,this.uint16[xe+2]=y,this.uint16[xe+3]=x,this.uint32[Se+2]=w,this.uint32[Se+3]=A,this.uint32[Se+4]=C,this.uint16[xe+10]=k,this.uint16[xe+11]=O,this.uint16[xe+12]=N,this.float32[Se+7]=H,this.float32[Se+8]=X,this.uint8[Ve+36]=Y,this.uint8[Ve+37]=de,this.uint8[Ve+38]=le,this.uint32[Se+10]=be,this.int16[xe+22]=Ie,s}}oe.prototype.bytesPerElement=48,pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",oe);class re extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de,le,be,Ie,xe,Se,Ve,Ue,dt,yt,lt,rt,Ke,ct){const it=this.length;return this.resize(it+1),this.emplace(it,s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de,le,be,Ie,xe,Se,Ve,Ue,dt,yt,lt,rt,Ke,ct)}emplace(s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de,le,be,Ie,xe,Se,Ve,Ue,dt,yt,lt,rt,Ke,ct,it){const qe=34*s,Ct=17*s;return this.int16[qe+0]=u,this.int16[qe+1]=f,this.int16[qe+2]=y,this.int16[qe+3]=x,this.int16[qe+4]=w,this.int16[qe+5]=A,this.int16[qe+6]=C,this.int16[qe+7]=k,this.uint16[qe+8]=O,this.uint16[qe+9]=N,this.uint16[qe+10]=H,this.uint16[qe+11]=X,this.uint16[qe+12]=Y,this.uint16[qe+13]=de,this.uint16[qe+14]=le,this.uint16[qe+15]=be,this.uint16[qe+16]=Ie,this.uint16[qe+17]=xe,this.uint16[qe+18]=Se,this.uint16[qe+19]=Ve,this.uint16[qe+20]=Ue,this.uint16[qe+21]=dt,this.uint16[qe+22]=yt,this.uint32[Ct+12]=lt,this.float32[Ct+13]=rt,this.float32[Ct+14]=Ke,this.float32[Ct+15]=ct,this.float32[Ct+16]=it,s}}re.prototype.bytesPerElement=68,pt("StructArrayLayout8i15ui1ul4f68",re);class ie extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}ie.prototype.bytesPerElement=4,pt("StructArrayLayout1f4",ie);class ge extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,s,u,f)}emplace(s,u,f,y){const x=3*s;return this.int16[x+0]=u,this.int16[x+1]=f,this.int16[x+2]=y,s}}ge.prototype.bytesPerElement=6,pt("StructArrayLayout3i6",ge);class _e extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,s,u,f)}emplace(s,u,f,y){const x=4*s;return this.uint32[2*s+0]=u,this.uint16[x+2]=f,this.uint16[x+3]=y,s}}_e.prototype.bytesPerElement=8,pt("StructArrayLayout1ul2ui8",_e);class we extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const y=2*s;return this.uint16[y+0]=u,this.uint16[y+1]=f,s}}we.prototype.bytesPerElement=4,pt("StructArrayLayout2ui4",we);class ae extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}ae.prototype.bytesPerElement=2,pt("StructArrayLayout1ui2",ae);class Ce extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,u,f,y)}emplace(s,u,f,y,x){const w=4*s;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=y,this.float32[w+3]=x,s}}Ce.prototype.bytesPerElement=16,pt("StructArrayLayout4f16",Ce);class Te extends Lo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Je(this.anchorPointX,this.anchorPointY)}}Te.prototype.size=20;class Fe extends M{get(s){return new Te(this,s)}}pt("CollisionBoxArray",Fe);class Ne extends Lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ne.prototype.size=48;class $e extends oe{get(s){return new Ne(this,s)}}pt("PlacedSymbolArray",$e);class De extends Lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}De.prototype.size=68;class ut extends re{get(s){return new De(this,s)}}pt("SymbolInstanceArray",ut);class nt extends ie{getoffsetX(s){return this.float32[1*s+0]}}pt("GlyphOffsetArray",nt);class ht extends ge{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}pt("SymbolLineVertexArray",ht);class Nt extends Lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Nt.prototype.size=8;class $t extends _e{get(s){return new Nt(this,s)}}pt("FeatureIndexArray",$t);class At extends oa{}class bn extends oa{}class wn extends oa{}class nn extends o{}class on extends d{}class Sn extends p{}class Vr extends _{}class js extends b{}class ys extends P{}class Gs extends I{}class Ro extends L{}class ns extends W{}class Ei extends q{}class oo extends we{}const cu=Tr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dr}=cu;class Zt{constructor(s=[]){this.segments=s}prepareSegment(s,u,f,y){let x=this.segments[this.segments.length-1];return s>Zt.MAX_VERTEX_ARRAY_LENGTH&&se(`Max vertices per segment is ${Zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!x||x.vertexLength+s>Zt.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==y)&&(x={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},y!==void 0&&(x.sortKey=y),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,f,y){return new Zt([{vertexOffset:s,primitiveOffset:u,vertexLength:f,primitiveLength:y,vaos:{},sortKey:0}])}}function _n(c,s){return 256*(c=S(Math.floor(c),0,255))+S(Math.floor(s),0,255)}Zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt("SegmentVector",Zt);const jr=Tr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Gr={exports:{}},Xn={exports:{}};Xn.exports=function(c,s){var u,f,y,x,w,A,C,k;for(f=c.length-(u=3&c.length),y=s,w=3432918353,A=461845907,k=0;k<f;)C=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24,++k,y=27492+(65535&(x=5*(65535&(y=(y^=C=(65535&(C=(C=(65535&C)*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*A+(((C>>>16)*A&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&c.charCodeAt(k+2))<<16;case 2:C^=(255&c.charCodeAt(k+1))<<8;case 1:y^=C=(65535&(C=(C=(65535&(C^=255&c.charCodeAt(k)))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*A+(((C>>>16)*A&65535)<<16)&4294967295}return y^=c.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var rs={exports:{}};rs.exports=function(c,s){for(var u,f=c.length,y=s^f,x=0;f>=4;)u=1540483477*(65535&(u=255&c.charCodeAt(x)|(255&c.charCodeAt(++x))<<8|(255&c.charCodeAt(++x))<<16|(255&c.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++x;switch(f){case 3:y^=(255&c.charCodeAt(x+2))<<16;case 2:y^=(255&c.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&c.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var aa=Xn.exports,ld=rs.exports;Gr.exports=aa,Gr.exports.murmur3=aa,Gr.exports.murmur2=ld;class Ka{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,u,f,y){this.ids.push(nm(s)),this.positions.push(u,f,y)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=nm(s);let f=0,y=this.ids.length-1;for(;f<y;){const w=f+y>>1;this.ids[w]>=u?y=w:f=w+1}const x=[];for(;this.ids[f]===u;)x.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return x}static serialize(s,u){const f=new Float64Array(s.ids),y=new Uint32Array(s.positions);return cd(f,y,0,f.length-1),u&&u.push(f.buffer,y.buffer),{ids:f,positions:y}}static deserialize(s){const u=new Ka;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u}}function nm(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:Gr.exports(String(c))}function cd(c,s,u,f){for(;u<f;){const y=c[u+f>>1];let x=u-1,w=f+1;for(;;){do x++;while(c[x]<y);do w--;while(c[w]>y);if(x>=w)break;zo(c,x,w),zo(s,3*x,3*w),zo(s,3*x+1,3*w+1),zo(s,3*x+2,3*w+2)}w-u<f-w?(cd(c,s,u,w),u=w+1):(cd(c,s,w+1,f),f=w)}}function zo(c,s,u){const f=c[s];c[s]=c[u],c[u]=f}pt("FeaturePositionMap",Ka);class la{constructor(s,u){this.gl=s.gl,this.location=u}}class ca extends la{constructor(s,u){super(s,u),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class uu extends la{constructor(s,u){super(s,u),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class r2 extends la{constructor(s,u){super(s,u),this.current=Q.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const C3=new Float32Array(16);function d_(c){return[_n(255*c.r,255*c.g),_n(255*c.b,255*c.a)]}class ud{constructor(s,u,f){this.value=s,this.uniformNames=u.map(y=>`u_${y}`),this.type=f}setUniform(s,u,f){s.set(f.constantOr(this.value))}getBinding(s,u,f){return this.type==="color"?new r2(s,u):new ca(s,u)}}class hu{constructor(s,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr}setUniform(s,u,f,y){const x=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&s.set(x)}getBinding(s,u,f){return f.substr(0,9)==="u_pattern"?new uu(s,u):new ca(s,u)}}class ua{constructor(s,u,f,y){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(x=>({name:`a_${x}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(s,u,f,y,x){const w=this.paintVertexArray.length,A=this.expression.evaluate(new Zn(0),u,{},y,[],x);this.paintVertexArray.resize(s),this._setPaintValue(w,s,A)}updatePaintArray(s,u,f,y){const x=this.expression.evaluate({zoom:0},f,y);this._setPaintValue(s,u,x)}_setPaintValue(s,u,f){if(this.type==="color"){const y=d_(f);for(let x=s;x<u;x++)this.paintVertexArray.emplace(x,y[0],y[1])}else{for(let y=s;y<u;y++)this.paintVertexArray.emplace(y,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(s,u,f,y,x,w){this.expression=s,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=y,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,u,f,y,x){const w=this.expression.evaluate(new Zn(this.zoom),u,{},y,[],x),A=this.expression.evaluate(new Zn(this.zoom+1),u,{},y,[],x),C=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(C,s,w,A)}updatePaintArray(s,u,f,y){const x=this.expression.evaluate({zoom:this.zoom},f,y),w=this.expression.evaluate({zoom:this.zoom+1},f,y);this._setPaintValue(s,u,x,w)}_setPaintValue(s,u,f,y){if(this.type==="color"){const x=d_(f),w=d_(y);for(let A=s;A<u;A++)this.paintVertexArray.emplace(A,x[0],x[1],w[0],w[1])}else{for(let x=s;x<u;x++)this.paintVertexArray.emplace(x,f,y);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(y))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=S(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(y)}getBinding(s,u,f){return new ca(s,u)}}class Ja{constructor(s,u,f,y,x,w){this.expression=s,this.type=u,this.useIntegerZoom=f,this.zoom=y,this.layerId=w,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(s,u,f){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(y,s,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(s,u,f,y,x){this._setPaintValues(s,u,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(s,u,f,y){if(!y||!f)return;const{min:x,mid:w,max:A}=f,C=y[x],k=y[w],O=y[A];if(C&&k&&O)for(let N=s;N<u;N++)this.zoomInPaintVertexArray.emplace(N,k.tl[0],k.tl[1],k.br[0],k.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],k.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,k.tl[0],k.tl[1],k.br[0],k.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],k.pixelRatio,O.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,jr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,jr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class i2{constructor(s,u,f){this.binders={},this._buffers=[];const y=[];for(const x in s.paint._values){if(!f(x))continue;const w=s.paint.get(x);if(!(w instanceof Us&&jn(w.property.specification)))continue;const A=I3(x,s.type),C=w.value,k=w.property.specification.type,O=w.property.useIntegerZoom,N=w.property.specification["property-type"],H=N==="cross-faded"||N==="cross-faded-data-driven";if(C.kind==="constant")this.binders[x]=H?new hu(C.value,A):new ud(C.value,A,k),y.push(`/u_${x}`);else if(C.kind==="source"||H){const X=s2(x,k,"source");this.binders[x]=H?new Ja(C,k,O,u,X,s.id):new ua(C,A,k,X),y.push(`/a_${x}`)}else{const X=s2(x,k,"composite");this.binders[x]=new ao(C,A,k,O,u,X),y.push(`/z_${x}`)}}this.cacheKey=y.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof ua||u instanceof ao?u.maxValue:0}populatePaintArrays(s,u,f,y,x){for(const w in this.binders){const A=this.binders[w];(A instanceof ua||A instanceof ao||A instanceof Ja)&&A.populatePaintArray(s,u,f,y,x)}}setConstantPatternPositions(s,u){for(const f in this.binders){const y=this.binders[f];y instanceof hu&&y.setConstantPatternPositions(s,u)}}updatePaintArrays(s,u,f,y,x){let w=!1;for(const A in s){const C=u.getPositions(A);for(const k of C){const O=f.feature(k.index);for(const N in this.binders){const H=this.binders[N];if((H instanceof ua||H instanceof ao||H instanceof Ja)&&H.expression.isStateDependent===!0){const X=y.paint.get(N);H.expression=X.value,H.updatePaintArray(k.start,k.end,O,s[A],x),w=!0}}}}return w}defines(){const s=[];for(const u in this.binders){const f=this.binders[u];(f instanceof ud||f instanceof hu)&&s.push(...f.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return s}getBinderAttributes(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ua||f instanceof ao)for(let y=0;y<f.paintVertexAttributes.length;y++)s.push(f.paintVertexAttributes[y].name);else if(f instanceof Ja)for(let y=0;y<jr.members.length;y++)s.push(jr.members[y].name)}return s}getBinderUniforms(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ud||f instanceof hu||f instanceof ao)for(const y of f.uniformNames)s.push(y)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,u){const f=[];for(const y in this.binders){const x=this.binders[y];if(x instanceof ud||x instanceof hu||x instanceof ao){for(const w of x.uniformNames)if(u[w]){const A=x.getBinding(s,u[w],w);f.push({name:w,property:y,binding:A})}}}return f}setUniforms(s,u,f,y){for(const{name:x,property:w,binding:A}of u)this.binders[w].setUniform(A,y,f.get(w),x)}updatePaintBuffers(s){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(s&&f instanceof Ja){const y=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(f instanceof ua||f instanceof ao)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const u in this.binders){const f=this.binders[u];(f instanceof ua||f instanceof ao||f instanceof Ja)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof ua||u instanceof ao||u instanceof Ja)&&u.destroy()}}}class rc{constructor(s,u,f=()=>!0){this.programConfigurations={};for(const y of s)this.programConfigurations[y.id]=new i2(y,u,f);this.needsUpload=!1,this._featureMap=new Ka,this._bufferOffset=0}populatePaintArrays(s,u,f,y,x,w){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(s,u,y,x,w);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,f,y){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(s,this._featureMap,u,x,y)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function I3(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function s2(c,s,u){const f={color:{source:p,composite:Ce},number:{source:ie,composite:p}},y=function(x){return{"line-pattern":{source:Vr,composite:Vr},"fill-pattern":{source:Vr,composite:Vr},"fill-extrusion-pattern":{source:Vr,composite:Vr}}[x]}(c);return y&&y[u]||f[s][u]}pt("ConstantBinder",ud),pt("CrossFadedConstantBinder",hu),pt("SourceExpressionBinder",ua),pt("CrossFadedCompositeBinder",Ja),pt("CompositeExpressionBinder",ao),pt("ProgramConfiguration",i2,{omit:["_buffers"]}),pt("ProgramConfigurationSet",rc);var Or=8192;const f_=Math.pow(2,14)-1,o2=-f_-1;function ic(c){const s=Or/c.extent,u=c.loadGeometry();for(let f=0;f<u.length;f++){const y=u[f];for(let x=0;x<y.length;x++){const w=y[x],A=Math.round(w.x*s),C=Math.round(w.y*s);w.x=S(A,o2,f_),w.y=S(C,o2,f_),(A<w.x||A>w.x+1||C<w.y||C>w.y+1)&&se("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function sc(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?ic(c):[]}}function rm(c,s,u,f,y){c.emplaceBack(2*s+(f+1)/2,2*u+(y+1)/2)}class p_{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new bn,this.indexArray=new Ei,this.segments=new Zt,this.programConfigurations=new rc(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){const y=this.layers[0],x=[];let w=null,A=!1;y.type==="circle"&&(w=y.layout.get("circle-sort-key"),A=!w.isConstant());for(const{feature:C,id:k,index:O,sourceLayerIndex:N}of s){const H=this.layers[0]._featureFilter.needGeometry,X=sc(C,H);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),X,f))continue;const Y=A?w.evaluate(X,{},f):void 0,de={id:k,properties:C.properties,type:C.type,sourceLayerIndex:N,index:O,geometry:H?X.geometry:ic(C),patterns:{},sortKey:Y};x.push(de)}A&&x.sort((C,k)=>C.sortKey-k.sortKey);for(const C of x){const{geometry:k,index:O,sourceLayerIndex:N}=C,H=s[O].feature;this.addFeature(C,k,O,f),u.featureIndex.insert(H,k,O,N,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Dr),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,f,y){for(const x of u)for(const w of x){const A=w.x,C=w.y;if(A<0||A>=Or||C<0||C>=Or)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),O=k.vertexLength;rm(this.layoutVertexArray,A,C,-1,-1),rm(this.layoutVertexArray,A,C,1,-1),rm(this.layoutVertexArray,A,C,1,1),rm(this.layoutVertexArray,A,C,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},y)}}function a2(c,s){for(let u=0;u<c.length;u++)if(du(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(du(c,s[u]))return!0;return!!m_(c,s)}function M3(c,s,u){return!!du(c,s)||!!g_(s,c,u)}function l2(c,s){if(c.length===1)return u2(s,c[0]);for(let u=0;u<s.length;u++){const f=s[u];for(let y=0;y<f.length;y++)if(du(c,f[y]))return!0}for(let u=0;u<c.length;u++)if(u2(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(m_(c,s[u]))return!0;return!1}function k3(c,s,u){if(c.length>1){if(m_(c,s))return!0;for(let f=0;f<s.length;f++)if(g_(s[f],c,u))return!0}for(let f=0;f<c.length;f++)if(g_(c[f],s,u))return!0;return!1}function m_(c,s){if(c.length===0||s.length===0)return!1;for(let u=0;u<c.length-1;u++){const f=c[u],y=c[u+1];for(let x=0;x<s.length-1;x++)if(L3(f,y,s[x],s[x+1]))return!0}return!1}function L3(c,s,u,f){return me(c,u,f)!==me(s,u,f)&&me(c,s,u)!==me(c,s,f)}function g_(c,s,u){const f=u*u;if(s.length===1)return c.distSqr(s[0])<f;for(let y=1;y<s.length;y++)if(c2(c,s[y-1],s[y])<f)return!0;return!1}function c2(c,s,u){const f=s.distSqr(u);if(f===0)return c.distSqr(s);const y=((c.x-s.x)*(u.x-s.x)+(c.y-s.y)*(u.y-s.y))/f;return c.distSqr(y<0?s:y>1?u:u.sub(s)._mult(y)._add(s))}function u2(c,s){let u,f,y,x=!1;for(let w=0;w<c.length;w++){u=c[w];for(let A=0,C=u.length-1;A<u.length;C=A++)f=u[A],y=u[C],f.y>s.y!=y.y>s.y&&s.x<(y.x-f.x)*(s.y-f.y)/(y.y-f.y)+f.x&&(x=!x)}return x}function du(c,s){let u=!1;for(let f=0,y=c.length-1;f<c.length;y=f++){const x=c[f],w=c[y];x.y>s.y!=w.y>s.y&&s.x<(w.x-x.x)*(s.y-x.y)/(w.y-x.y)+x.x&&(u=!u)}return u}function R3(c,s,u){const f=u[0],y=u[2];if(c.x<f.x&&s.x<f.x||c.x>y.x&&s.x>y.x||c.y<f.y&&s.y<f.y||c.y>y.y&&s.y>y.y)return!1;const x=me(c,s,u[0]);return x!==me(c,s,u[1])||x!==me(c,s,u[2])||x!==me(c,s,u[3])}function hd(c,s,u){const f=s.paint.get(c).value;return f.kind==="constant"?f.value:u.programConfigurations.get(s.id).getMaxValue(c)}function im(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function sm(c,s,u,f,y){if(!s[0]&&!s[1])return c;const x=Je.convert(s)._mult(y);u==="viewport"&&x._rotate(-f);const w=[];for(let A=0;A<c.length;A++)w.push(c[A].sub(x));return w}pt("CircleBucket",p_,{omit:["layers"]});const z3=new Yr({"circle-sort-key":new Mt(Ee.layout_circle["circle-sort-key"])});var D3={paint:new Yr({"circle-radius":new Mt(Ee.paint_circle["circle-radius"]),"circle-color":new Mt(Ee.paint_circle["circle-color"]),"circle-blur":new Mt(Ee.paint_circle["circle-blur"]),"circle-opacity":new Mt(Ee.paint_circle["circle-opacity"]),"circle-translate":new vt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new vt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mt(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mt(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mt(Ee.paint_circle["circle-stroke-opacity"])}),layout:z3},Ti=1e-6,Si=typeof Float32Array<"u"?Float32Array:Array;function h2(){var c=new Si(9);return Si!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function y_(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function d2(c,s,u){var f=s[0],y=s[1],x=s[2],w=s[3],A=s[4],C=s[5],k=s[6],O=s[7],N=s[8],H=s[9],X=s[10],Y=s[11],de=s[12],le=s[13],be=s[14],Ie=s[15],xe=u[0],Se=u[1],Ve=u[2],Ue=u[3];return c[0]=xe*f+Se*A+Ve*N+Ue*de,c[1]=xe*y+Se*C+Ve*H+Ue*le,c[2]=xe*x+Se*k+Ve*X+Ue*be,c[3]=xe*w+Se*O+Ve*Y+Ue*Ie,c[4]=(xe=u[4])*f+(Se=u[5])*A+(Ve=u[6])*N+(Ue=u[7])*de,c[5]=xe*y+Se*C+Ve*H+Ue*le,c[6]=xe*x+Se*k+Ve*X+Ue*be,c[7]=xe*w+Se*O+Ve*Y+Ue*Ie,c[8]=(xe=u[8])*f+(Se=u[9])*A+(Ve=u[10])*N+(Ue=u[11])*de,c[9]=xe*y+Se*C+Ve*H+Ue*le,c[10]=xe*x+Se*k+Ve*X+Ue*be,c[11]=xe*w+Se*O+Ve*Y+Ue*Ie,c[12]=(xe=u[12])*f+(Se=u[13])*A+(Ve=u[14])*N+(Ue=u[15])*de,c[13]=xe*y+Se*C+Ve*H+Ue*le,c[14]=xe*x+Se*k+Ve*X+Ue*be,c[15]=xe*w+Se*O+Ve*Y+Ue*Ie,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var dd,O3=d2;function f2(){var c=new Si(3);return Si!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function p2(c,s,u){var f=new Si(3);return f[0]=c,f[1]=s,f[2]=u,f}function om(c,s,u){var f=s[0],y=s[1],x=s[2],w=s[3];return c[0]=u[0]*f+u[4]*y+u[8]*x+u[12]*w,c[1]=u[1]*f+u[5]*y+u[9]*x+u[13]*w,c[2]=u[2]*f+u[6]*y+u[10]*x+u[14]*w,c[3]=u[3]*f+u[7]*y+u[11]*x+u[15]*w,c}function m2(){var c=new Si(4);return Si!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function g2(c,s){const u=om([],[c.x,c.y,0,1],s);return new Je(u[0]/u[3],u[1]/u[3])}f2(),dd=new Si(4),Si!=Float32Array&&(dd[0]=0,dd[1]=0,dd[2]=0,dd[3]=0),f2(),p2(1,0,0),p2(0,1,0),m2(),m2(),h2(),function(){var c;c=new Si(2),Si!=Float32Array&&(c[0]=0,c[1]=0)}();class y2 extends p_{}pt("HeatmapBucket",y2,{omit:["layers"]});var F3={paint:new Yr({"heatmap-radius":new Mt(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mt(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mo(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vt(Ee.paint_heatmap["heatmap-opacity"])})};function __(c,{width:s,height:u},f,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==s*u*f)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${s*u*f}`)}else y=new Uint8Array(s*u*f);return c.width=s,c.height=u,c.data=y,c}function _2(c,{width:s,height:u},f){if(s===c.width&&u===c.height)return;const y=__({},{width:s,height:u},f);v_(c,y,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,u)},f),c.width=s,c.height=u,c.data=y.data}function v_(c,s,u,f,y,x){if(y.width===0||y.height===0)return s;if(y.width>c.width||y.height>c.height||u.x>c.width-y.width||u.y>c.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>s.width||y.height>s.height||f.x>s.width-y.width||f.y>s.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const w=c.data,A=s.data;if(w===A)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<y.height;C++){const k=((u.y+C)*c.width+u.x)*x,O=((f.y+C)*s.width+f.x)*x;for(let N=0;N<y.width*x;N++)A[O+N]=w[k+N]}return s}class fd{constructor(s,u){__(this,s,1,u)}resize(s){_2(this,s,1)}clone(){return new fd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,y,x){v_(s,u,f,y,x,1)}}class _s{constructor(s,u){__(this,s,4,u)}resize(s){_2(this,s,4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,y,x){v_(s,u,f,y,x,4)}}function v2(c){const s={},u=c.resolution||256,f=c.clips?c.clips.length:1,y=c.image||new _s({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const x=(w,A,C)=>{s[c.evaluationKey]=C;const k=c.expression.evaluate(s);y.data[w+A+0]=Math.floor(255*k.r/k.a),y.data[w+A+1]=Math.floor(255*k.g/k.a),y.data[w+A+2]=Math.floor(255*k.b/k.a),y.data[w+A+3]=Math.floor(255*k.a)};if(c.clips)for(let w=0,A=0;w<f;++w,A+=4*u)for(let C=0,k=0;C<u;C++,k+=4){const O=C/(u-1),{start:N,end:H}=c.clips[w];x(A,k,N*(1-O)+H*O)}else for(let w=0,A=0;w<u;w++,A+=4)x(0,A,w/(u-1));return y}pt("AlphaImage",fd),pt("RGBAImage",_s);var B3={paint:new Yr({"hillshade-illumination-direction":new vt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vt(Ee.paint_hillshade["hillshade-accent-color"])})};const N3=Tr([{name:"a_pos",components:2,type:"Int16"}],4),{members:U3}=N3;var am={exports:{}};function lm(c,s,u){u=u||2;var f,y,x,w,A,C,k,O=s&&s.length,N=O?s[0]*u:c.length,H=x2(c,0,N,u,!0),X=[];if(!H||H.next===H.prev)return X;if(O&&(H=function(de,le,be,Ie){var xe,Se,Ve,Ue=[];for(xe=0,Se=le.length;xe<Se;xe++)(Ve=x2(de,le[xe]*Ie,xe<Se-1?le[xe+1]*Ie:de.length,Ie,!1))===Ve.next&&(Ve.steiner=!0),Ue.push(Z3(Ve));for(Ue.sort(W3),xe=0;xe<Ue.length;xe++)be=H3(Ue[xe],be);return be}(c,s,H,u)),c.length>80*u){f=x=c[0],y=w=c[1];for(var Y=u;Y<N;Y+=u)(A=c[Y])<f&&(f=A),(C=c[Y+1])<y&&(y=C),A>x&&(x=A),C>w&&(w=C);k=(k=Math.max(x-f,w-y))!==0?32767/k:0}return pd(H,X,u,f,y,k,0),X}function x2(c,s,u,f,y){var x,w;if(y===w_(c,s,u,f)>0)for(x=s;x<u;x+=f)w=E2(x,c[x],c[x+1],w);else for(x=u-f;x>=s;x-=f)w=E2(x,c[x],c[x+1],w);return w&&cm(w,w.next)&&(gd(w),w=w.next),w}function oc(c,s){if(!c)return c;s||(s=c);var u,f=c;do if(u=!1,f.steiner||!cm(f,f.next)&&vr(f.prev,f,f.next)!==0)f=f.next;else{if(gd(f),(f=s=f.prev)===f.next)break;u=!0}while(u||f!==s);return s}function pd(c,s,u,f,y,x,w){if(c){!w&&x&&function(O,N,H,X){var Y=O;do Y.z===0&&(Y.z=x_(Y.x,Y.y,N,H,X)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==O);Y.prevZ.nextZ=null,Y.prevZ=null,function(de){var le,be,Ie,xe,Se,Ve,Ue,dt,yt=1;do{for(be=de,de=null,Se=null,Ve=0;be;){for(Ve++,Ie=be,Ue=0,le=0;le<yt&&(Ue++,Ie=Ie.nextZ);le++);for(dt=yt;Ue>0||dt>0&&Ie;)Ue!==0&&(dt===0||!Ie||be.z<=Ie.z)?(xe=be,be=be.nextZ,Ue--):(xe=Ie,Ie=Ie.nextZ,dt--),Se?Se.nextZ=xe:de=xe,xe.prevZ=Se,Se=xe;be=Ie}Se.nextZ=null,yt*=2}while(Ve>1)}(Y)}(c,f,y,x);for(var A,C,k=c;c.prev!==c.next;)if(A=c.prev,C=c.next,x?j3(c,f,y,x):V3(c))s.push(A.i/u|0),s.push(c.i/u|0),s.push(C.i/u|0),gd(c),c=C.next,k=C.next;else if((c=C)===k){w?w===1?pd(c=G3(oc(c),s,u),s,u,f,y,x,2):w===2&&$3(c,s,u,f,y,x):pd(oc(c),s,u,f,y,x,1);break}}}function V3(c){var s=c.prev,u=c,f=c.next;if(vr(s,u,f)>=0)return!1;for(var y=s.x,x=u.x,w=f.x,A=s.y,C=u.y,k=f.y,O=y<x?y<w?y:w:x<w?x:w,N=A<C?A<k?A:k:C<k?C:k,H=y>x?y>w?y:w:x>w?x:w,X=A>C?A>k?A:k:C>k?C:k,Y=f.next;Y!==s;){if(Y.x>=O&&Y.x<=H&&Y.y>=N&&Y.y<=X&&fu(y,A,x,C,w,k,Y.x,Y.y)&&vr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function j3(c,s,u,f){var y=c.prev,x=c,w=c.next;if(vr(y,x,w)>=0)return!1;for(var A=y.x,C=x.x,k=w.x,O=y.y,N=x.y,H=w.y,X=A<C?A<k?A:k:C<k?C:k,Y=O<N?O<H?O:H:N<H?N:H,de=A>C?A>k?A:k:C>k?C:k,le=O>N?O>H?O:H:N>H?N:H,be=x_(X,Y,s,u,f),Ie=x_(de,le,s,u,f),xe=c.prevZ,Se=c.nextZ;xe&&xe.z>=be&&Se&&Se.z<=Ie;){if(xe.x>=X&&xe.x<=de&&xe.y>=Y&&xe.y<=le&&xe!==y&&xe!==w&&fu(A,O,C,N,k,H,xe.x,xe.y)&&vr(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Se.x>=X&&Se.x<=de&&Se.y>=Y&&Se.y<=le&&Se!==y&&Se!==w&&fu(A,O,C,N,k,H,Se.x,Se.y)&&vr(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;xe&&xe.z>=be;){if(xe.x>=X&&xe.x<=de&&xe.y>=Y&&xe.y<=le&&xe!==y&&xe!==w&&fu(A,O,C,N,k,H,xe.x,xe.y)&&vr(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Se&&Se.z<=Ie;){if(Se.x>=X&&Se.x<=de&&Se.y>=Y&&Se.y<=le&&Se!==y&&Se!==w&&fu(A,O,C,N,k,H,Se.x,Se.y)&&vr(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function G3(c,s,u){var f=c;do{var y=f.prev,x=f.next.next;!cm(y,x)&&b2(y,f,f.next,x)&&md(y,x)&&md(x,y)&&(s.push(y.i/u|0),s.push(f.i/u|0),s.push(x.i/u|0),gd(f),gd(f.next),f=c=x),f=f.next}while(f!==c);return oc(f)}function $3(c,s,u,f,y,x){var w=c;do{for(var A=w.next.next;A!==w.prev;){if(w.i!==A.i&&X3(w,A)){var C=w2(w,A);return w=oc(w,w.next),C=oc(C,C.next),pd(w,s,u,f,y,x,0),void pd(C,s,u,f,y,x,0)}A=A.next}w=w.next}while(w!==c)}function W3(c,s){return c.x-s.x}function H3(c,s){var u=function(y,x){var w,A=x,C=y.x,k=y.y,O=-1/0;do{if(k<=A.y&&k>=A.next.y&&A.next.y!==A.y){var N=A.x+(k-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(N<=C&&N>O&&(O=N,w=A.x<A.next.x?A:A.next,N===C))return w}A=A.next}while(A!==x);if(!w)return null;var H,X=w,Y=w.x,de=w.y,le=1/0;A=w;do C>=A.x&&A.x>=Y&&C!==A.x&&fu(k<de?C:O,k,Y,de,k<de?O:C,k,A.x,A.y)&&(H=Math.abs(k-A.y)/(C-A.x),md(A,y)&&(H<le||H===le&&(A.x>w.x||A.x===w.x&&q3(w,A)))&&(w=A,le=H)),A=A.next;while(A!==X);return w}(c,s);if(!u)return s;var f=w2(u,c);return oc(f,f.next),oc(u,u.next)}function q3(c,s){return vr(c.prev,c,s.prev)<0&&vr(s.next,c,c.next)<0}function x_(c,s,u,f,y){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*y|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*y|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Z3(c){var s=c,u=c;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==c);return u}function fu(c,s,u,f,y,x,w,A){return(y-w)*(s-A)>=(c-w)*(x-A)&&(c-w)*(f-A)>=(u-w)*(s-A)&&(u-w)*(x-A)>=(y-w)*(f-A)}function X3(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(u,f){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==f.i&&y.next.i!==f.i&&b2(y,y.next,u,f))return!0;y=y.next}while(y!==u);return!1}(c,s)&&(md(c,s)&&md(s,c)&&function(u,f){var y=u,x=!1,w=(u.x+f.x)/2,A=(u.y+f.y)/2;do y.y>A!=y.next.y>A&&y.next.y!==y.y&&w<(y.next.x-y.x)*(A-y.y)/(y.next.y-y.y)+y.x&&(x=!x),y=y.next;while(y!==u);return x}(c,s)&&(vr(c.prev,c,s.prev)||vr(c,s.prev,s))||cm(c,s)&&vr(c.prev,c,c.next)>0&&vr(s.prev,s,s.next)>0)}function vr(c,s,u){return(s.y-c.y)*(u.x-s.x)-(s.x-c.x)*(u.y-s.y)}function cm(c,s){return c.x===s.x&&c.y===s.y}function b2(c,s,u,f){var y=hm(vr(c,s,u)),x=hm(vr(c,s,f)),w=hm(vr(u,f,c)),A=hm(vr(u,f,s));return y!==x&&w!==A||!(y!==0||!um(c,u,s))||!(x!==0||!um(c,f,s))||!(w!==0||!um(u,c,f))||!(A!==0||!um(u,s,f))}function um(c,s,u){return s.x<=Math.max(c.x,u.x)&&s.x>=Math.min(c.x,u.x)&&s.y<=Math.max(c.y,u.y)&&s.y>=Math.min(c.y,u.y)}function hm(c){return c>0?1:c<0?-1:0}function md(c,s){return vr(c.prev,c,c.next)<0?vr(c,s,c.next)>=0&&vr(c,c.prev,s)>=0:vr(c,s,c.prev)<0||vr(c,c.next,s)<0}function w2(c,s){var u=new b_(c.i,c.x,c.y),f=new b_(s.i,s.x,s.y),y=c.next,x=s.prev;return c.next=s,s.prev=c,u.next=y,y.prev=u,f.next=u,u.prev=f,x.next=f,f.prev=x,f}function E2(c,s,u,f){var y=new b_(c,s,u);return f?(y.next=f.next,y.prev=f,f.next.prev=y,f.next=y):(y.prev=y,y.next=y),y}function gd(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function b_(c,s,u){this.i=c,this.x=s,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function w_(c,s,u,f){for(var y=0,x=s,w=u-f;x<u;x+=f)y+=(c[w]-c[x])*(c[x+1]+c[w+1]),w=x;return y}function Y3(c,s,u,f,y){T2(c,s,u||0,f||c.length-1,y||K3)}function T2(c,s,u,f,y){for(;f>u;){if(f-u>600){var x=f-u+1,w=s-u+1,A=Math.log(x),C=.5*Math.exp(2*A/3),k=.5*Math.sqrt(A*C*(x-C)/x)*(w-x/2<0?-1:1);T2(c,s,Math.max(u,Math.floor(s-w*C/x+k)),Math.min(f,Math.floor(s+(x-w)*C/x+k)),y)}var O=c[s],N=u,H=f;for(yd(c,u,s),y(c[f],O)>0&&yd(c,u,f);N<H;){for(yd(c,N,H),N++,H--;y(c[N],O)<0;)N++;for(;y(c[H],O)>0;)H--}y(c[u],O)===0?yd(c,u,H):yd(c,++H,f),H<=s&&(u=H+1),s<=H&&(f=H-1)}}function yd(c,s,u){var f=c[s];c[s]=c[u],c[u]=f}function K3(c,s){return c<s?-1:c>s?1:0}function E_(c,s){const u=c.length;if(u<=1)return[c];const f=[];let y,x;for(let w=0;w<u;w++){const A=ve(c[w]);A!==0&&(c[w].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(y&&f.push(y),y=[c[w]]):y.push(c[w]))}if(y&&f.push(y),s>1)for(let w=0;w<f.length;w++)f[w].length<=s||(Y3(f[w],s,1,f[w].length-1,J3),f[w]=f[w].slice(0,s));return f}function J3(c,s){return s.area-c.area}function T_(c,s,u){const f=u.patternDependencies;let y=!1;for(const x of s){const w=x.paint.get(`${c}-pattern`);w.isConstant()||(y=!0);const A=w.constantOr(null);A&&(y=!0,f[A.to]=!0,f[A.from]=!0)}return y}function S_(c,s,u,f,y){const x=y.patternDependencies;for(const w of s){const A=w.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let C=A.evaluate({zoom:f-1},u,{},y.availableImages),k=A.evaluate({zoom:f},u,{},y.availableImages),O=A.evaluate({zoom:f+1},u,{},y.availableImages);C=C&&C.name?C.name:C,k=k&&k.name?k.name:k,O=O&&O.name?O.name:O,x[C]=!0,x[k]=!0,x[O]=!0,u.patterns[w.id]={min:C,mid:k,max:O}}}return u}am.exports=lm,am.exports.default=lm,lm.deviation=function(c,s,u,f){var y=s&&s.length,x=Math.abs(w_(c,0,y?s[0]*u:c.length,u));if(y)for(var w=0,A=s.length;w<A;w++)x-=Math.abs(w_(c,s[w]*u,w<A-1?s[w+1]*u:c.length,u));var C=0;for(w=0;w<f.length;w+=3){var k=f[w]*u,O=f[w+1]*u,N=f[w+2]*u;C+=Math.abs((c[k]-c[N])*(c[O+1]-c[k+1])-(c[k]-c[O])*(c[N+1]-c[k+1]))}return x===0&&C===0?0:Math.abs((C-x)/x)},lm.flatten=function(c){for(var s=c[0][0].length,u={vertices:[],holes:[],dimensions:s},f=0,y=0;y<c.length;y++){for(var x=0;x<c[y].length;x++)for(var w=0;w<s;w++)u.vertices.push(c[y][x][w]);y>0&&u.holes.push(f+=c[y-1].length)}return u};class P_{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wn,this.indexArray=new Ei,this.indexArray2=new oo,this.programConfigurations=new rc(s.layers,s.zoom),this.segments=new Zt,this.segments2=new Zt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=T_("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),x=!y.isConstant(),w=[];for(const{feature:A,id:C,index:k,sourceLayerIndex:O}of s){const N=this.layers[0]._featureFilter.needGeometry,H=sc(A,N);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),H,f))continue;const X=x?y.evaluate(H,{},f,u.availableImages):void 0,Y={id:C,properties:A.properties,type:A.type,sourceLayerIndex:O,index:k,geometry:N?H.geometry:ic(A),patterns:{},sortKey:X};w.push(Y)}x&&w.sort((A,C)=>A.sortKey-C.sortKey);for(const A of w){const{geometry:C,index:k,sourceLayerIndex:O}=A;if(this.hasPattern){const N=S_("fill",this.layers,A,this.zoom,u);this.patternFeatures.push(N)}else this.addFeature(A,C,k,f,{});u.featureIndex.insert(s[k].feature,C,k,O,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,U3),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,u,f,y,x){for(const w of E_(u,500)){let A=0;for(const X of w)A+=X.length;const C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),k=C.vertexLength,O=[],N=[];for(const X of w){if(X.length===0)continue;X!==w[0]&&N.push(O.length/2);const Y=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),de=Y.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(de+X.length-1,de),O.push(X[0].x),O.push(X[0].y);for(let le=1;le<X.length;le++)this.layoutVertexArray.emplaceBack(X[le].x,X[le].y),this.indexArray2.emplaceBack(de+le-1,de+le),O.push(X[le].x),O.push(X[le].y);Y.vertexLength+=X.length,Y.primitiveLength+=X.length}const H=am.exports(O,N);for(let X=0;X<H.length;X+=3)this.indexArray.emplaceBack(k+H[X],k+H[X+1],k+H[X+2]);C.vertexLength+=A,C.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,x,y)}}pt("FillBucket",P_,{omit:["layers","patternFeatures"]});const Q3=new Yr({"fill-sort-key":new Mt(Ee.layout_fill["fill-sort-key"])});var eR={paint:new Yr({"fill-antialias":new vt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new Mt(Ee.paint_fill["fill-opacity"]),"fill-color":new Mt(Ee.paint_fill["fill-color"]),"fill-outline-color":new Mt(Ee.paint_fill["fill-outline-color"]),"fill-translate":new vt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new vt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ya(Ee.paint_fill["fill-pattern"])}),layout:Q3};const tR=Tr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),nR=Tr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rR}=tR;var Qa={},iR=Je,S2=pu;function pu(c,s,u,f,y){this.properties={},this.extent=u,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=y,c.readFields(sR,this,s)}function sR(c,s,u){c==1?s.id=u.readVarint():c==2?function(f,y){for(var x=f.readVarint()+f.pos;f.pos<x;){var w=y._keys[f.readVarint()],A=y._values[f.readVarint()];y.properties[w]=A}}(u,s):c==3?s.type=u.readVarint():c==4&&(s._geometry=u.pos)}function oR(c){for(var s,u,f=0,y=0,x=c.length,w=x-1;y<x;w=y++)f+=((u=c[w]).x-(s=c[y]).x)*(s.y+u.y);return f}pu.types=["Unknown","Point","LineString","Polygon"],pu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,u=c.readVarint()+c.pos,f=1,y=0,x=0,w=0,A=[];c.pos<u;){if(y<=0){var C=c.readVarint();f=7&C,y=C>>3}if(y--,f===1||f===2)x+=c.readSVarint(),w+=c.readSVarint(),f===1&&(s&&A.push(s),s=[]),s.push(new iR(x,w));else{if(f!==7)throw new Error("unknown command "+f);s&&s.push(s[0].clone())}}return s&&A.push(s),A},pu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,u=1,f=0,y=0,x=0,w=1/0,A=-1/0,C=1/0,k=-1/0;c.pos<s;){if(f<=0){var O=c.readVarint();u=7&O,f=O>>3}if(f--,u===1||u===2)(y+=c.readSVarint())<w&&(w=y),y>A&&(A=y),(x+=c.readSVarint())<C&&(C=x),x>k&&(k=x);else if(u!==7)throw new Error("unknown command "+u)}return[w,C,A,k]},pu.prototype.toGeoJSON=function(c,s,u){var f,y,x=this.extent*Math.pow(2,u),w=this.extent*c,A=this.extent*s,C=this.loadGeometry(),k=pu.types[this.type];function O(X){for(var Y=0;Y<X.length;Y++){var de=X[Y];X[Y]=[360*(de.x+w)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(f=0;f<C.length;f++)N[f]=C[f][0];O(C=N);break;case 2:for(f=0;f<C.length;f++)O(C[f]);break;case 3:for(C=function(X){var Y=X.length;if(Y<=1)return[X];for(var de,le,be=[],Ie=0;Ie<Y;Ie++){var xe=oR(X[Ie]);xe!==0&&(le===void 0&&(le=xe<0),le===xe<0?(de&&be.push(de),de=[X[Ie]]):de.push(X[Ie]))}return de&&be.push(de),be}(C),f=0;f<C.length;f++)for(y=0;y<C[f].length;y++)O(C[f][y])}C.length===1?C=C[0]:k="Multi"+k;var H={type:"Feature",geometry:{type:k,coordinates:C},properties:this.properties};return"id"in this&&(H.id=this.id),H};var aR=S2,P2=A2;function A2(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(lR,this,s),this.length=this._features.length}function lR(c,s,u){c===15?s.version=u.readVarint():c===1?s.name=u.readString():c===5?s.extent=u.readVarint():c===2?s._features.push(u.pos):c===3?s._keys.push(u.readString()):c===4&&s._values.push(function(f){for(var y=null,x=f.readVarint()+f.pos;f.pos<x;){var w=f.readVarint()>>3;y=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return y}(u))}A2.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new aR(this._pbf,s,this.extent,this._keys,this._values)};var cR=P2;function uR(c,s,u){if(c===3){var f=new cR(u,u.readVarint()+u.pos);f.length&&(s[f.name]=f)}}Qa.VectorTile=function(c,s){this.layers=c.readFields(uR,{},s)},Qa.VectorTileFeature=S2,Qa.VectorTileLayer=P2;const hR=Qa.VectorTileFeature.types,A_=Math.pow(2,13);function _d(c,s,u,f,y,x,w,A){c.emplaceBack(s,u,2*Math.floor(f*A_)+w,y*A_*2,x*A_*2,Math.round(A))}class C_{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new nn,this.centroidVertexArray=new At,this.indexArray=new Ei,this.programConfigurations=new rc(s.layers,s.zoom),this.segments=new Zt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.features=[],this.hasPattern=T_("fill-extrusion",this.layers,u);for(const{feature:y,id:x,index:w,sourceLayerIndex:A}of s){const C=this.layers[0]._featureFilter.needGeometry,k=sc(y,C);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),k,f))continue;const O={id:x,sourceLayerIndex:A,index:w,geometry:C?k.geometry:ic(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(S_("fill-extrusion",this.layers,O,this.zoom,u)):this.addFeature(O,O.geometry,w,f,{}),u.featureIndex.insert(y,O.geometry,w,A,this.index,!0)}}addFeatures(s,u,f){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,u,f)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,rR),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,nR.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,u,f,y,x){const w={x:0,y:0,vertexCount:0};for(const A of E_(u,500)){let C=0;for(const Y of A)C+=Y.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Y of A){if(Y.length===0||fR(Y))continue;let de=0;for(let le=0;le<Y.length;le++){const be=Y[le];if(le>=1){const Ie=Y[le-1];if(!dR(be,Ie)){k.vertexLength+4>Zt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const xe=be.sub(Ie)._perp()._unit(),Se=Ie.dist(be);de+Se>32768&&(de=0),_d(this.layoutVertexArray,be.x,be.y,xe.x,xe.y,0,0,de),_d(this.layoutVertexArray,be.x,be.y,xe.x,xe.y,0,1,de),w.x+=2*be.x,w.y+=2*be.y,w.vertexCount+=2,de+=Se,_d(this.layoutVertexArray,Ie.x,Ie.y,xe.x,xe.y,0,0,de),_d(this.layoutVertexArray,Ie.x,Ie.y,xe.x,xe.y,0,1,de),w.x+=2*Ie.x,w.y+=2*Ie.y,w.vertexCount+=2;const Ve=k.vertexLength;this.indexArray.emplaceBack(Ve,Ve+2,Ve+1),this.indexArray.emplaceBack(Ve+1,Ve+2,Ve+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+C>Zt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),hR[s.type]!=="Polygon")continue;const O=[],N=[],H=k.vertexLength;for(const Y of A)if(Y.length!==0){Y!==A[0]&&N.push(O.length/2);for(let de=0;de<Y.length;de++){const le=Y[de];_d(this.layoutVertexArray,le.x,le.y,0,0,1,1,0),w.x+=le.x,w.y+=le.y,w.vertexCount+=1,O.push(le.x),O.push(le.y)}}const X=am.exports(O,N);for(let Y=0;Y<X.length;Y+=3)this.indexArray.emplaceBack(H+X[Y],H+X[Y+2],H+X[Y+1]);k.primitiveLength+=X.length/3,k.vertexLength+=C}for(let A=0;A<w.vertexCount;A++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,x,y)}}function dR(c,s){return c.x===s.x&&(c.x<0||c.x>Or)||c.y===s.y&&(c.y<0||c.y>Or)}function fR(c){return c.every(s=>s.x<0)||c.every(s=>s.x>Or)||c.every(s=>s.y<0)||c.every(s=>s.y>Or)}pt("FillExtrusionBucket",C_,{omit:["layers","features"]});var pR={paint:new Yr({"fill-extrusion-opacity":new vt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mt(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ya(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mt(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mt(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function vd(c,s){return c.x*s.x+c.y*s.y}function C2(c,s){if(c.length===1){let u=0;const f=s[u++];let y;for(;!y||f.equals(y);)if(y=s[u++],!y)return 1/0;for(;u<s.length;u++){const x=s[u],w=c[0],A=y.sub(f),C=x.sub(f),k=w.sub(f),O=vd(A,A),N=vd(A,C),H=vd(C,C),X=vd(k,A),Y=vd(k,C),de=O*H-N*N,le=(H*X-N*Y)/de,be=(O*Y-N*X)/de,Ie=f.z*(1-le-be)+y.z*le+x.z*be;if(isFinite(Ie))return Ie}return 1/0}{let u=1/0;for(const f of s)u=Math.min(u,f.z);return u}}const mR=Tr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gR}=mR,yR=Tr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_R}=yR,vR=Qa.VectorTileFeature.types,xR=Math.cos(Math.PI/180*37.5),I2=Math.pow(2,14)/.5;class I_{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new on,this.layoutVertexArray2=new Sn,this.indexArray=new Ei,this.programConfigurations=new rc(s.layers,s.zoom),this.segments=new Zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=T_("line",this.layers,u);const y=this.layers[0].layout.get("line-sort-key"),x=!y.isConstant(),w=[];for(const{feature:A,id:C,index:k,sourceLayerIndex:O}of s){const N=this.layers[0]._featureFilter.needGeometry,H=sc(A,N);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),H,f))continue;const X=x?y.evaluate(H,{},f):void 0,Y={id:C,properties:A.properties,type:A.type,sourceLayerIndex:O,index:k,geometry:N?H.geometry:ic(A),patterns:{},sortKey:X};w.push(Y)}x&&w.sort((A,C)=>A.sortKey-C.sortKey);for(const A of w){const{geometry:C,index:k,sourceLayerIndex:O}=A;if(this.hasPattern){const N=S_("line",this.layers,A,this.zoom,u);this.patternFeatures.push(N)}else this.addFeature(A,C,k,f,{});u.featureIndex.insert(s[k].feature,C,k,O,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,_R)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,gR),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,u,f,y,x){const w=this.layers[0].layout,A=w.get("line-join").evaluate(s,{}),C=w.get("line-cap"),k=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const N of u)this.addLine(N,s,A,C,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,x,y)}addLine(s,u,f,y,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<s.length-1;be++)this.totalDistance+=s[be].dist(s[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=vR[u.type]==="Polygon";let C=s.length;for(;C>=2&&s[C-1].equals(s[C-2]);)C--;let k=0;for(;k<C-1&&s[k].equals(s[k+1]);)k++;if(C<(A?3:2))return;f==="bevel"&&(x=1.05);const O=this.overscaling<=16?122880/(512*this.overscaling):0,N=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let H,X,Y,de,le;this.e1=this.e2=-1,A&&(H=s[C-2],le=s[k].sub(H)._unit()._perp());for(let be=k;be<C;be++){if(Y=be===C-1?A?s[k+1]:void 0:s[be+1],Y&&s[be].equals(Y))continue;le&&(de=le),H&&(X=H),H=s[be],le=Y?Y.sub(H)._unit()._perp():de,de=de||le;let Ie=de.add(le);Ie.x===0&&Ie.y===0||Ie._unit();const xe=de.x*le.x+de.y*le.y,Se=Ie.x*le.x+Ie.y*le.y,Ve=Se!==0?1/Se:1/0,Ue=2*Math.sqrt(2-2*Se),dt=Se<xR&&X&&Y,yt=de.x*le.y-de.y*le.x>0;if(dt&&be>k){const Ke=H.dist(X);if(Ke>2*O){const ct=H.sub(H.sub(X)._mult(O/Ke)._round());this.updateDistance(X,ct),this.addCurrentVertex(ct,de,0,0,N),X=ct}}const lt=X&&Y;let rt=lt?f:A?"butt":y;if(lt&&rt==="round"&&(Ve<w?rt="miter":Ve<=2&&(rt="fakeround")),rt==="miter"&&Ve>x&&(rt="bevel"),rt==="bevel"&&(Ve>2&&(rt="flipbevel"),Ve<x&&(rt="miter")),X&&this.updateDistance(X,H),rt==="miter")Ie._mult(Ve),this.addCurrentVertex(H,Ie,0,0,N);else if(rt==="flipbevel"){if(Ve>100)Ie=le.mult(-1);else{const Ke=Ve*de.add(le).mag()/de.sub(le).mag();Ie._perp()._mult(Ke*(yt?-1:1))}this.addCurrentVertex(H,Ie,0,0,N),this.addCurrentVertex(H,Ie.mult(-1),0,0,N)}else if(rt==="bevel"||rt==="fakeround"){const Ke=-Math.sqrt(Ve*Ve-1),ct=yt?Ke:0,it=yt?0:Ke;if(X&&this.addCurrentVertex(H,de,ct,it,N),rt==="fakeround"){const qe=Math.round(180*Ue/Math.PI/20);for(let Ct=1;Ct<qe;Ct++){let wt=Ct/qe;if(wt!==.5){const Gn=wt-.5;wt+=wt*Gn*(wt-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*Gn*Gn+(.848013+xe*(.215638*xe-1.06021)))}const Wt=le.sub(de)._mult(wt)._add(de)._unit()._mult(yt?-1:1);this.addHalfVertex(H,Wt.x,Wt.y,!1,yt,0,N)}}Y&&this.addCurrentVertex(H,le,-ct,-it,N)}else if(rt==="butt")this.addCurrentVertex(H,Ie,0,0,N);else if(rt==="square"){const Ke=X?1:-1;this.addCurrentVertex(H,Ie,Ke,Ke,N)}else rt==="round"&&(X&&(this.addCurrentVertex(H,de,0,0,N),this.addCurrentVertex(H,de,1,1,N,!0)),Y&&(this.addCurrentVertex(H,le,-1,-1,N,!0),this.addCurrentVertex(H,le,0,0,N)));if(dt&&be<C-1){const Ke=H.dist(Y);if(Ke>2*O){const ct=H.add(Y.sub(H)._mult(O/Ke)._round());this.updateDistance(H,ct),this.addCurrentVertex(ct,le,0,0,N),H=ct}}}}addCurrentVertex(s,u,f,y,x,w=!1){const A=u.y*y-u.x,C=-u.y-u.x*y;this.addHalfVertex(s,u.x+u.y*f,u.y-u.x*f,w,!1,f,x),this.addHalfVertex(s,A,C,w,!0,-y,x),this.distance>I2/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,u,f,y,x,w))}addHalfVertex({x:s,y:u},f,y,x,w,A,C){const k=.5*(this.lineClips?this.scaledDistance*(I2-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(x?1:0),(u<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*y)+128,1+(A===0?0:A<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),C.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,u){this.distance+=s.dist(u),this.updateScaledDistance()}}pt("LineBucket",I_,{omit:["layers","patternFeatures"]});const bR=new Yr({"line-cap":new vt(Ee.layout_line["line-cap"]),"line-join":new Mt(Ee.layout_line["line-join"]),"line-miter-limit":new vt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new vt(Ee.layout_line["line-round-limit"]),"line-sort-key":new Mt(Ee.layout_line["line-sort-key"])});var M2={paint:new Yr({"line-opacity":new Mt(Ee.paint_line["line-opacity"]),"line-color":new Mt(Ee.paint_line["line-color"]),"line-translate":new vt(Ee.paint_line["line-translate"]),"line-translate-anchor":new vt(Ee.paint_line["line-translate-anchor"]),"line-width":new Mt(Ee.paint_line["line-width"]),"line-gap-width":new Mt(Ee.paint_line["line-gap-width"]),"line-offset":new Mt(Ee.paint_line["line-offset"]),"line-blur":new Mt(Ee.paint_line["line-blur"]),"line-dasharray":new od(Ee.paint_line["line-dasharray"]),"line-pattern":new Ya(Ee.paint_line["line-pattern"]),"line-gradient":new Mo(Ee.paint_line["line-gradient"])}),layout:bR};const k2=new class extends Mt{possiblyEvaluate(c,s){return s=new Zn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(c,s)}evaluate(c,s,u,f){return s=D({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(c,s,u,f)}}(M2.paint.properties["line-width"].specification);function L2(c,s){return s>0?s+2*c:c}k2.useIntegerZoom=!0;const wR=Tr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ER=Tr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Tr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const TR=Tr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Tr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const R2=Tr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),SR=Tr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function PR(c,s,u){return c.sections.forEach(f=>{f.text=function(y,x,w){const A=x.layout.get("text-transform").evaluate(w,{});return A==="uppercase"?y=y.toLocaleUpperCase():A==="lowercase"&&(y=y.toLocaleLowerCase()),ts.applyArabicShaping&&(y=ts.applyArabicShaping(y)),y}(f.text,s,u)}),c}Tr([{name:"triangle",components:3,type:"Uint16"}]),Tr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Tr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Tr([{type:"Float32",name:"offsetX"}]),Tr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const xd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Kr=24,M_=Cn,z2=function(c,s,u,f,y){var x,w,A=8*y-f-1,C=(1<<A)-1,k=C>>1,O=-7,N=u?y-1:0,H=u?-1:1,X=c[s+N];for(N+=H,x=X&(1<<-O)-1,X>>=-O,O+=A;O>0;x=256*x+c[s+N],N+=H,O-=8);for(w=x&(1<<-O)-1,x>>=-O,O+=f;O>0;w=256*w+c[s+N],N+=H,O-=8);if(x===0)x=1-k;else{if(x===C)return w?NaN:1/0*(X?-1:1);w+=Math.pow(2,f),x-=k}return(X?-1:1)*w*Math.pow(2,x-f)},D2=function(c,s,u,f,y,x){var w,A,C,k=8*x-y-1,O=(1<<k)-1,N=O>>1,H=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=f?0:x-1,Y=f?1:-1,de=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(A=isNaN(s)?1:0,w=O):(w=Math.floor(Math.log(s)/Math.LN2),s*(C=Math.pow(2,-w))<1&&(w--,C*=2),(s+=w+N>=1?H/C:H*Math.pow(2,1-N))*C>=2&&(w++,C/=2),w+N>=O?(A=0,w=O):w+N>=1?(A=(s*C-1)*Math.pow(2,y),w+=N):(A=s*Math.pow(2,N-1)*Math.pow(2,y),w=0));y>=8;c[u+X]=255&A,X+=Y,A/=256,y-=8);for(w=w<<y|A,k+=y;k>0;c[u+X]=255&w,X+=Y,w/=256,k-=8);c[u+X-Y]|=128*de};function Cn(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Cn.Varint=0,Cn.Fixed64=1,Cn.Bytes=2,Cn.Fixed32=5;var el,k_=4294967296,O2=1/k_,F2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ha(c){return c.type===Cn.Bytes?c.readVarint()+c.pos:c.pos+1}function mu(c,s,u){return u?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function B2(c,s,u){var f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));u.realloc(f);for(var y=u.pos-1;y>=c;y--)u.buf[y+f]=u.buf[y]}function AR(c,s){for(var u=0;u<c.length;u++)s.writeVarint(c[u])}function CR(c,s){for(var u=0;u<c.length;u++)s.writeSVarint(c[u])}function IR(c,s){for(var u=0;u<c.length;u++)s.writeFloat(c[u])}function MR(c,s){for(var u=0;u<c.length;u++)s.writeDouble(c[u])}function kR(c,s){for(var u=0;u<c.length;u++)s.writeBoolean(c[u])}function LR(c,s){for(var u=0;u<c.length;u++)s.writeFixed32(c[u])}function RR(c,s){for(var u=0;u<c.length;u++)s.writeSFixed32(c[u])}function zR(c,s){for(var u=0;u<c.length;u++)s.writeFixed64(c[u])}function DR(c,s){for(var u=0;u<c.length;u++)s.writeSFixed64(c[u])}function dm(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function gu(c,s,u){c[u]=s,c[u+1]=s>>>8,c[u+2]=s>>>16,c[u+3]=s>>>24}function N2(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}function OR(c,s,u){c===1&&u.readMessage(FR,s)}function FR(c,s,u){if(c===3){const{id:f,bitmap:y,width:x,height:w,left:A,top:C,advance:k}=u.readMessage(BR,{});s.push({id:f,bitmap:new fd({width:x+6,height:w+6},y),metrics:{width:x,height:w,left:A,top:C,advance:k}})}}function BR(c,s,u){c===1?s.id=u.readVarint():c===2?s.bitmap=u.readBytes():c===3?s.width=u.readVarint():c===4?s.height=u.readVarint():c===5?s.left=u.readSVarint():c===6?s.top=u.readSVarint():c===7&&(s.advance=u.readVarint())}function U2(c){let s=0,u=0;for(const w of c)s+=w.w*w.h,u=Math.max(u,w.w);c.sort((w,A)=>A.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let y=0,x=0;for(const w of c)for(let A=f.length-1;A>=0;A--){const C=f[A];if(!(w.w>C.w||w.h>C.h)){if(w.x=C.x,w.y=C.y,x=Math.max(x,w.y+w.h),y=Math.max(y,w.x+w.w),w.w===C.w&&w.h===C.h){const k=f.pop();A<f.length&&(f[A]=k)}else w.h===C.h?(C.x+=w.w,C.w-=w.w):w.w===C.w?(C.y+=w.h,C.h-=w.h):(f.push({x:C.x+w.w,y:C.y,w:C.w-w.w,h:w.h}),C.y+=w.h,C.h-=w.h);break}}return{w:y,h:x,fill:s/(y*x)||0}}Cn.prototype={destroy:function(){this.buf=null},readFields:function(c,s,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),y=f>>3,x=this.pos;this.type=7&f,c(y,s,this),this.pos===x&&this.skip(f)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=dm(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=N2(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=dm(this.buf,this.pos)+dm(this.buf,this.pos+4)*k_;return this.pos+=8,c},readSFixed64:function(){var c=dm(this.buf,this.pos)+N2(this.buf,this.pos+4)*k_;return this.pos+=8,c},readFloat:function(){var c=z2(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=z2(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,u,f=this.buf;return s=127&(u=f[this.pos++]),u<128?s:(s|=(127&(u=f[this.pos++]))<<7,u<128?s:(s|=(127&(u=f[this.pos++]))<<14,u<128?s:(s|=(127&(u=f[this.pos++]))<<21,u<128?s:function(y,x,w){var A,C,k=w.buf;if(A=(112&(C=k[w.pos++]))>>4,C<128||(A|=(127&(C=k[w.pos++]))<<3,C<128)||(A|=(127&(C=k[w.pos++]))<<10,C<128)||(A|=(127&(C=k[w.pos++]))<<17,C<128)||(A|=(127&(C=k[w.pos++]))<<24,C<128)||(A|=(1&(C=k[w.pos++]))<<31,C<128))return mu(y,A,x);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(u=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&F2?function(u,f,y){return F2.decode(u.subarray(f,y))}(this.buf,s,c):function(u,f,y){for(var x="",w=f;w<y;){var A,C,k,O=u[w],N=null,H=O>239?4:O>223?3:O>191?2:1;if(w+H>y)break;H===1?O<128&&(N=O):H===2?(192&(A=u[w+1]))==128&&(N=(31&O)<<6|63&A)<=127&&(N=null):H===3?(C=u[w+2],(192&(A=u[w+1]))==128&&(192&C)==128&&((N=(15&O)<<12|(63&A)<<6|63&C)<=2047||N>=55296&&N<=57343)&&(N=null)):H===4&&(C=u[w+2],k=u[w+3],(192&(A=u[w+1]))==128&&(192&C)==128&&(192&k)==128&&((N=(15&O)<<18|(63&A)<<12|(63&C)<<6|63&k)<=65535||N>=1114112)&&(N=null)),N===null?(N=65533,H=1):N>65535&&(N-=65536,x+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),x+=String.fromCharCode(N),w+=H}return x}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==Cn.Bytes)return c.push(this.readVarint(s));var u=ha(this);for(c=c||[];this.pos<u;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==Cn.Bytes)return c.push(this.readSVarint());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Cn.Bytes)return c.push(this.readBoolean());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Cn.Bytes)return c.push(this.readFloat());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Cn.Bytes)return c.push(this.readDouble());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Cn.Bytes)return c.push(this.readFixed32());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Cn.Bytes)return c.push(this.readSFixed32());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Cn.Bytes)return c.push(this.readFixed64());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Cn.Bytes)return c.push(this.readSFixed64());var s=ha(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===Cn.Varint)for(;this.buf[this.pos++]>127;);else if(s===Cn.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Cn.Fixed32)this.pos+=4;else{if(s!==Cn.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),gu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),gu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),gu(this.buf,-1&c,this.pos),gu(this.buf,Math.floor(c*O2),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),gu(this.buf,-1&c,this.pos),gu(this.buf,Math.floor(c*O2),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,u){var f,y;if(s>=0?(f=s%4294967296|0,y=s/4294967296|0):(y=~(-s/4294967296),4294967295^(f=~(-s%4294967296))?f=f+1|0:(f=0,y=y+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,w,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)}(f,0,u),function(x,w){var A=(7&x)<<4;w.buf[w.pos++]|=A|((x>>>=3)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x)))))}(y,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(f,y,x){for(var w,A,C=0;C<y.length;C++){if((w=y.charCodeAt(C))>55295&&w<57344){if(!A){w>56319||C+1===y.length?(f[x++]=239,f[x++]=191,f[x++]=189):A=w;continue}if(w<56320){f[x++]=239,f[x++]=191,f[x++]=189,A=w;continue}w=A-55296<<10|w-56320|65536,A=null}else A&&(f[x++]=239,f[x++]=191,f[x++]=189,A=null);w<128?f[x++]=w:(w<2048?f[x++]=w>>6|192:(w<65536?f[x++]=w>>12|224:(f[x++]=w>>18|240,f[x++]=w>>12&63|128),f[x++]=w>>6&63|128),f[x++]=63&w|128)}return x}(this.buf,c,this.pos);var u=this.pos-s;u>=128&&B2(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeFloat:function(c){this.realloc(4),D2(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),D2(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var u=0;u<s;u++)this.buf[this.pos++]=c[u]},writeRawMessage:function(c,s){this.pos++;var u=this.pos;c(s,this);var f=this.pos-u;f>=128&&B2(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,s,u){this.writeTag(c,Cn.Bytes),this.writeRawMessage(s,u)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,AR,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,CR,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,kR,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,IR,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,MR,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,LR,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,RR,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,zR,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,DR,s)},writeBytesField:function(c,s){this.writeTag(c,Cn.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,Cn.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,Cn.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,Cn.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,Cn.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,Cn.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,Cn.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,Cn.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,Cn.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,Cn.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};class L_{constructor(s,{pixelRatio:u,version:f,stretchX:y,stretchY:x,content:w}){this.paddedRect=s,this.pixelRatio=u,this.stretchX=y,this.stretchY=x,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class V2{constructor(s,u){const f={},y={};this.haveRenderCallbacks=[];const x=[];this.addImages(s,f,x),this.addImages(u,y,x);const{w,h:A}=U2(x),C=new _s({width:w||1,height:A||1});for(const k in s){const O=s[k],N=f[k].paddedRect;_s.copy(O.data,C,{x:0,y:0},{x:N.x+1,y:N.y+1},O.data)}for(const k in u){const O=u[k],N=y[k].paddedRect,H=N.x+1,X=N.y+1,Y=O.data.width,de=O.data.height;_s.copy(O.data,C,{x:0,y:0},{x:H,y:X},O.data),_s.copy(O.data,C,{x:0,y:de-1},{x:H,y:X-1},{width:Y,height:1}),_s.copy(O.data,C,{x:0,y:0},{x:H,y:X+de},{width:Y,height:1}),_s.copy(O.data,C,{x:Y-1,y:0},{x:H-1,y:X},{width:1,height:de}),_s.copy(O.data,C,{x:0,y:0},{x:H+Y,y:X},{width:1,height:de})}this.image=C,this.iconPositions=f,this.patternPositions=y}addImages(s,u,f){for(const y in s){const x=s[y],w={x:0,y:0,w:x.data.width+2,h:x.data.height+2};f.push(w),u[y]=new L_(w,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(s,u){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),u)}patchUpdatedImage(s,u,f){if(!s||!u||s.version===u.version)return;s.version=u.version;const[y,x]=s.tl;f.update(u.data,void 0,{x:y,y:x})}}pt("ImagePosition",L_),pt("ImageAtlas",V2),l.WritingMode=void 0,(el=l.WritingMode||(l.WritingMode={}))[el.none=0]="none",el[el.horizontal=1]="horizontal",el[el.vertical=2]="vertical",el[el.horizontalOnly=3]="horizontalOnly";const fm=-17;class bd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,u){const f=new bd;return f.scale=s||1,f.fontStack=u,f}static forImage(s){const u=new bd;return u.imageName=s,u}}class yu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u){const f=new yu;for(let y=0;y<s.sections.length;y++){const x=s.sections[y];x.image?f.addImageSection(x):f.addTextSection(x,u)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let u="";for(let f=0;f<s.length;f++){const y=s.charCodeAt(f+1)||null,x=s.charCodeAt(f-1)||null;u+=y&&qp(y)&&!xd[s[f+1]]||x&&qp(x)&&!xd[s[f-1]]||!xd[s[f]]?s[f]:xd[s[f]]}return u}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&mm[this.text.charCodeAt(f)];f++)s++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&mm[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const f=new yu;return f.text=this.text.substring(s,u),f.sectionIndex=this.sectionIndex.slice(s,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}addTextSection(s,u){this.text+=s.text,this.sections.push(bd.forText(s.scale,s.fontStack||u));const f=this.sections.length-1;for(let y=0;y<s.text.length;++y)this.sectionIndex.push(f)}addImageSection(s){const u=s.image?s.image.name:"";if(u.length===0)return void se("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(bd.forImage(u)),this.sectionIndex.push(this.sections.length-1)):se("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pm(c,s,u,f,y,x,w,A,C,k,O,N,H,X,Y,de){const le=yu.fromFeature(c,y);let be;N===l.WritingMode.vertical&&le.verticalizePunctuation();const{processBidirectionalText:Ie,processStyledBidirectionalText:xe}=ts;if(Ie&&le.sections.length===1){be=[];const Ue=Ie(le.toString(),R_(le,k,x,s,f,X,Y));for(const dt of Ue){const yt=new yu;yt.text=dt,yt.sections=le.sections;for(let lt=0;lt<dt.length;lt++)yt.sectionIndex.push(0);be.push(yt)}}else if(xe){be=[];const Ue=xe(le.text,le.sectionIndex,R_(le,k,x,s,f,X,Y));for(const dt of Ue){const yt=new yu;yt.text=dt[0],yt.sectionIndex=dt[1],yt.sections=le.sections,be.push(yt)}}else be=function(Ue,dt){const yt=[],lt=Ue.text;let rt=0;for(const Ke of dt)yt.push(Ue.substring(rt,Ke)),rt=Ke;return rt<lt.length&&yt.push(Ue.substring(rt,lt.length)),yt}(le,R_(le,k,x,s,f,X,Y));const Se=[],Ve={positionedLines:Se,text:le.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(Ue,dt,yt,lt,rt,Ke,ct,it,qe,Ct,wt,Wt){let Gn=0,Yn=fm,Fr=0,xs=0;const ni=it==="right"?1:it==="left"?0:.5;let Sr=0;for(const Pr of rt){Pr.trim();const ii=Pr.getMaxScale(),di=(ii-1)*Kr,Pi={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[Sr]=Pi;const Ui=Pi.positionedGlyphs;let Vi=0;if(!Pr.length()){Yn+=Ke,++Sr;continue}for(let Wr=0;Wr<Pr.length();Wr++){const Kt=Pr.getSection(Wr),is=Pr.getSectionIndex(Wr),si=Pr.getCharCode(Wr);let fi=0,$s=null,lo=null,co=null,fa=Kr;const Ws=!(qe===l.WritingMode.horizontal||!wt&&!ed(si)||wt&&(mm[si]||($r=si,at.Arabic($r)||at["Arabic Supplement"]($r)||at["Arabic Extended-A"]($r)||at["Arabic Presentation Forms-A"]($r)||at["Arabic Presentation Forms-B"]($r))));if(Kt.imageName){const bs=lt[Kt.imageName];if(!bs)continue;co=Kt.imageName,Ue.iconsInText=Ue.iconsInText||!0,lo=bs.paddedRect;const ji=bs.displaySize;Kt.scale=Kt.scale*Kr/Wt,$s={width:ji[0],height:ji[1],left:1,top:-3,advance:Ws?ji[1]:ji[0]},fi=di+(Kr-ji[1]*Kt.scale),fa=$s.advance;const pa=Ws?ji[0]*Kt.scale-Kr*ii:ji[1]*Kt.scale-Kr*ii;pa>0&&pa>Vi&&(Vi=pa)}else{const bs=yt[Kt.fontStack],ji=bs&&bs[si];if(ji&&ji.rect)lo=ji.rect,$s=ji.metrics;else{const pa=dt[Kt.fontStack],Td=pa&&pa[si];if(!Td)continue;$s=Td.metrics}fi=(ii-Kt.scale)*Kr}Ws?(Ue.verticalizable=!0,Ui.push({glyph:si,imageName:co,x:Gn,y:Yn+fi,vertical:Ws,scale:Kt.scale,fontStack:Kt.fontStack,sectionIndex:is,metrics:$s,rect:lo}),Gn+=fa*Kt.scale+Ct):(Ui.push({glyph:si,imageName:co,x:Gn,y:Yn+fi,vertical:Ws,scale:Kt.scale,fontStack:Kt.fontStack,sectionIndex:is,metrics:$s,rect:lo}),Gn+=$s.advance*Kt.scale+Ct)}Ui.length!==0&&(Fr=Math.max(Gn-Ct,Fr),VR(Ui,0,Ui.length-1,ni,Vi)),Gn=0;const nr=Ke*ii+Vi;Pi.lineOffset=Math.max(Vi,di),Yn+=nr,xs=Math.max(nr,xs),++Sr}var $r;const ri=Yn-fm,{horizontalAlign:hi,verticalAlign:Ni}=z_(ct);(function(Pr,ii,di,Pi,Ui,Vi,nr,Wr,Kt){const is=(ii-di)*Ui;let si=0;si=Vi!==nr?-Wr*Pi-fm:(-Pi*Kt+.5)*nr;for(const fi of Pr)for(const $s of fi.positionedGlyphs)$s.x+=is,$s.y+=si})(Ue.positionedLines,ni,hi,Ni,Fr,xs,Ke,ri,rt.length),Ue.top+=-Ni*ri,Ue.bottom=Ue.top+ri,Ue.left+=-hi*Fr,Ue.right=Ue.left+Fr}(Ve,s,u,f,be,w,A,C,N,k,H,de),!function(Ue){for(const dt of Ue)if(dt.positionedGlyphs.length!==0)return!1;return!0}(Se)&&Ve}const mm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},NR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function j2(c,s,u,f,y,x){if(s.imageName){const w=f[s.imageName];return w?w.displaySize[0]*s.scale*Kr/x+y:0}{const w=u[s.fontStack],A=w&&w[c];return A?A.metrics.advance*s.scale+y:0}}function G2(c,s,u,f){const y=Math.pow(c-s,2);return f?c<s?y/2:2*y:y+Math.abs(u)*u}function UR(c,s,u){let f=0;return c===10&&(f-=1e4),u&&(f+=150),c!==40&&c!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function $2(c,s,u,f,y,x){let w=null,A=G2(s,u,y,x);for(const C of f){const k=G2(s-C.x,u,y,x)+C.badness;k<=A&&(w=C,A=k)}return{index:c,x:s,priorBreak:w,badness:A}}function W2(c){return c?W2(c.priorBreak).concat(c.index):[]}function R_(c,s,u,f,y,x,w){if(x!=="point")return[];if(!c)return[];const A=[],C=function(H,X,Y,de,le,be){let Ie=0;for(let xe=0;xe<H.length();xe++){const Se=H.getSection(xe);Ie+=j2(H.getCharCode(xe),Se,de,le,X,be)}return Ie/Math.max(1,Math.ceil(Ie/Y))}(c,s,u,f,y,w),k=c.text.indexOf("​")>=0;let O=0;for(let H=0;H<c.length();H++){const X=c.getSection(H),Y=c.getCharCode(H);if(mm[Y]||(O+=j2(Y,X,f,y,s,w)),H<c.length()-1){const de=!((N=Y)<11904||!(at["Bopomofo Extended"](N)||at.Bopomofo(N)||at["CJK Compatibility Forms"](N)||at["CJK Compatibility Ideographs"](N)||at["CJK Compatibility"](N)||at["CJK Radicals Supplement"](N)||at["CJK Strokes"](N)||at["CJK Symbols and Punctuation"](N)||at["CJK Unified Ideographs Extension A"](N)||at["CJK Unified Ideographs"](N)||at["Enclosed CJK Letters and Months"](N)||at["Halfwidth and Fullwidth Forms"](N)||at.Hiragana(N)||at["Ideographic Description Characters"](N)||at["Kangxi Radicals"](N)||at["Katakana Phonetic Extensions"](N)||at.Katakana(N)||at["Vertical Forms"](N)||at["Yi Radicals"](N)||at["Yi Syllables"](N)));(NR[Y]||de||X.imageName)&&A.push($2(H+1,O,C,A,UR(Y,c.getCharCode(H+1),de&&k),!1))}}var N;return W2($2(c.length(),O,C,A,0,!0))}function z_(c){let s=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function VR(c,s,u,f,y){if(!f&&!y)return;const x=c[u],w=(c[u].x+x.metrics.advance*x.scale)*f;for(let A=s;A<=u;A++)c[A].x-=w,c[A].y+=y}function jR(c,s,u){const{horizontalAlign:f,verticalAlign:y}=z_(u),x=s[0]-c.displaySize[0]*f,w=s[1]-c.displaySize[1]*y;return{image:c,top:w,bottom:w+c.displaySize[1],left:x,right:x+c.displaySize[0]}}function H2(c,s,u,f,y,x){const w=c.image;let A;if(w.content){const le=w.content,be=w.pixelRatio||1;A=[le[0]/be,le[1]/be,w.displaySize[0]-le[2]/be,w.displaySize[1]-le[3]/be]}const C=s.left*x,k=s.right*x;let O,N,H,X;u==="width"||u==="both"?(X=y[0]+C-f[3],N=y[0]+k+f[1]):(X=y[0]+(C+k-w.displaySize[0])/2,N=X+w.displaySize[0]);const Y=s.top*x,de=s.bottom*x;return u==="height"||u==="both"?(O=y[1]+Y-f[0],H=y[1]+de+f[2]):(O=y[1]+(Y+de-w.displaySize[1])/2,H=O+w.displaySize[1]),{image:w,top:O,right:N,bottom:H,left:X,collisionPadding:A}}const da=128;function q2(c,s){const{expression:u}=s;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Zn(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:y}=u;let x=0;for(;x<f.length&&f[x]<=c;)x++;x=Math.max(0,x-1);let w=x;for(;w<f.length&&f[w]<c+1;)w++;w=Math.min(f.length-1,w);const A=f[x],C=f[w];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:C,interpolationType:y}:{kind:"camera",minZoom:A,maxZoom:C,minSize:u.evaluate(new Zn(A)),maxSize:u.evaluate(new Zn(C)),interpolationType:y}}}class tl extends Je{constructor(s,u,f,y){super(s,u),this.angle=f,y!==void 0&&(this.segment=y)}clone(){return new tl(this.x,this.y,this.angle,this.segment)}}function Z2(c,s,u,f,y){if(s.segment===void 0)return!0;let x=s,w=s.segment+1,A=0;for(;A>-u/2;){if(w--,w<0)return!1;A-=c[w].dist(x),x=c[w]}A+=c[w].dist(c[w+1]),w++;const C=[];let k=0;for(;A<u/2;){const O=c[w],N=c[w+1];if(!N)return!1;let H=c[w-1].angleTo(O)-O.angleTo(N);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:A,angleDelta:H}),k+=H;A-C[0].distance>f;)k-=C.shift().angleDelta;if(k>y)return!1;w++,A+=O.dist(N)}return!0}function X2(c){let s=0;for(let u=0;u<c.length-1;u++)s+=c[u].dist(c[u+1]);return s}function Y2(c,s,u){return c?.6*s*u:0}function K2(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function GR(c,s,u,f,y,x){const w=Y2(u,y,x),A=K2(u,f)*x;let C=0;const k=X2(c)/2;for(let O=0;O<c.length-1;O++){const N=c[O],H=c[O+1],X=N.dist(H);if(C+X>k){const Y=(k-C)/X,de=Gt(N.x,H.x,Y),le=Gt(N.y,H.y,Y),be=new tl(de,le,H.angleTo(N),O);return be._round(),!w||Z2(c,be,A,w,s)?be:void 0}C+=X}}function $R(c,s,u,f,y,x,w,A,C){const k=Y2(f,x,w),O=K2(f,y),N=O*w,H=c[0].x===0||c[0].x===C||c[0].y===0||c[0].y===C;return s-N<s/4&&(s=N+s/4),J2(c,H?s/2*A%s:(O/2+2*x)*w*A%s,s,k,u,N,H,!1,C)}function J2(c,s,u,f,y,x,w,A,C){const k=x/2,O=X2(c);let N=0,H=s-u,X=[];for(let Y=0;Y<c.length-1;Y++){const de=c[Y],le=c[Y+1],be=de.dist(le),Ie=le.angleTo(de);for(;H+u<N+be;){H+=u;const xe=(H-N)/be,Se=Gt(de.x,le.x,xe),Ve=Gt(de.y,le.y,xe);if(Se>=0&&Se<C&&Ve>=0&&Ve<C&&H-k>=0&&H+k<=O){const Ue=new tl(Se,Ve,Ie,Y);Ue._round(),f&&!Z2(c,Ue,x,f,y)||X.push(Ue)}}N+=be}return A||X.length||w||(X=J2(c,N/2,u,f,y,x,w,!0,C)),X}function Q2(c,s,u,f,y){const x=[];for(let w=0;w<c.length;w++){const A=c[w];let C;for(let k=0;k<A.length-1;k++){let O=A[k],N=A[k+1];O.x<s&&N.x<s||(O.x<s?O=new Je(s,O.y+(s-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x<s&&(N=new Je(s,O.y+(s-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y<u&&N.y<u||(O.y<u?O=new Je(O.x+(u-O.y)/(N.y-O.y)*(N.x-O.x),u)._round():N.y<u&&(N=new Je(O.x+(u-O.y)/(N.y-O.y)*(N.x-O.x),u)._round()),O.x>=f&&N.x>=f||(O.x>=f?O=new Je(f,O.y+(f-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x>=f&&(N=new Je(f,O.y+(f-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y>=y&&N.y>=y||(O.y>=y?O=new Je(O.x+(y-O.y)/(N.y-O.y)*(N.x-O.x),y)._round():N.y>=y&&(N=new Je(O.x+(y-O.y)/(N.y-O.y)*(N.x-O.x),y)._round()),C&&O.equals(C[C.length-1])||(C=[O],x.push(C)),C.push(N)))))}}return x}function eE(c,s,u,f){const y=[],x=c.image,w=x.pixelRatio,A=x.paddedRect.w-2,C=x.paddedRect.h-2,k=c.right-c.left,O=c.bottom-c.top,N=x.stretchX||[[0,A]],H=x.stretchY||[[0,C]],X=(Ke,ct)=>Ke+ct[1]-ct[0],Y=N.reduce(X,0),de=H.reduce(X,0),le=A-Y,be=C-de;let Ie=0,xe=Y,Se=0,Ve=de,Ue=0,dt=le,yt=0,lt=be;if(x.content&&f){const Ke=x.content;Ie=gm(N,0,Ke[0]),Se=gm(H,0,Ke[1]),xe=gm(N,Ke[0],Ke[2]),Ve=gm(H,Ke[1],Ke[3]),Ue=Ke[0]-Ie,yt=Ke[1]-Se,dt=Ke[2]-Ke[0]-xe,lt=Ke[3]-Ke[1]-Ve}const rt=(Ke,ct,it,qe)=>{const Ct=ym(Ke.stretch-Ie,xe,k,c.left),wt=_m(Ke.fixed-Ue,dt,Ke.stretch,Y),Wt=ym(ct.stretch-Se,Ve,O,c.top),Gn=_m(ct.fixed-yt,lt,ct.stretch,de),Yn=ym(it.stretch-Ie,xe,k,c.left),Fr=_m(it.fixed-Ue,dt,it.stretch,Y),xs=ym(qe.stretch-Se,Ve,O,c.top),ni=_m(qe.fixed-yt,lt,qe.stretch,de),Sr=new Je(Ct,Wt),$r=new Je(Yn,Wt),ri=new Je(Yn,xs),hi=new Je(Ct,xs),Ni=new Je(wt/w,Gn/w),Pr=new Je(Fr/w,ni/w),ii=s*Math.PI/180;if(ii){const Ui=Math.sin(ii),Vi=Math.cos(ii),nr=[Vi,-Ui,Ui,Vi];Sr._matMult(nr),$r._matMult(nr),hi._matMult(nr),ri._matMult(nr)}const di=Ke.stretch+Ke.fixed,Pi=ct.stretch+ct.fixed;return{tl:Sr,tr:$r,bl:hi,br:ri,tex:{x:x.paddedRect.x+1+di,y:x.paddedRect.y+1+Pi,w:it.stretch+it.fixed-di,h:qe.stretch+qe.fixed-Pi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ni,pixelOffsetBR:Pr,minFontScaleX:dt/w/k,minFontScaleY:lt/w/O,isSDF:u}};if(f&&(x.stretchX||x.stretchY)){const Ke=tE(N,le,Y),ct=tE(H,be,de);for(let it=0;it<Ke.length-1;it++){const qe=Ke[it],Ct=Ke[it+1];for(let wt=0;wt<ct.length-1;wt++)y.push(rt(qe,ct[wt],Ct,ct[wt+1]))}}else y.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:C+1}));return y}function gm(c,s,u){let f=0;for(const y of c)f+=Math.max(s,Math.min(u,y[1]))-Math.max(s,Math.min(u,y[0]));return f}function tE(c,s,u){const f=[{fixed:-1,stretch:0}];for(const[y,x]of c){const w=f[f.length-1];f.push({fixed:y-w.stretch,stretch:w.stretch}),f.push({fixed:y-w.stretch,stretch:w.stretch+(x-y)})}return f.push({fixed:s+1,stretch:u}),f}function ym(c,s,u,f){return c/s*u+f}function _m(c,s,u,f){return c-s*u/f}pt("Anchor",tl);class vm{constructor(s,u,f,y,x,w,A,C,k,O){if(this.boxStartIndex=s.length,k){let N=w.top,H=w.bottom;const X=w.collisionPadding;X&&(N-=X[1],H+=X[3]);let Y=H-N;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let N=w.top*A-C[0],H=w.bottom*A+C[2],X=w.left*A-C[3],Y=w.right*A+C[1];const de=w.collisionPadding;if(de&&(X-=de[0]*A,N-=de[1]*A,Y+=de[2]*A,H+=de[3]*A),O){const le=new Je(X,N),be=new Je(Y,N),Ie=new Je(X,H),xe=new Je(Y,H),Se=O*Math.PI/180;le._rotate(Se),be._rotate(Se),Ie._rotate(Se),xe._rotate(Se),X=Math.min(le.x,be.x,Ie.x,xe.x),Y=Math.max(le.x,be.x,Ie.x,xe.x),N=Math.min(le.y,be.y,Ie.y,xe.y),H=Math.max(le.y,be.y,Ie.y,xe.y)}s.emplaceBack(u.x,u.y,X,N,Y,H,f,y,x)}this.boxEndIndex=s.length}}class WR{constructor(s=[],u=HR){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:f}=this,y=u[s];for(;s>0;){const x=s-1>>1,w=u[x];if(f(y,w)>=0)break;u[s]=w,s=x}u[s]=y}_down(s){const{data:u,compare:f}=this,y=this.length>>1,x=u[s];for(;s<y;){let w=1+(s<<1),A=u[w];const C=w+1;if(C<this.length&&f(u[C],A)<0&&(w=C,A=u[C]),f(A,x)>=0)break;u[s]=A,s=w}u[s]=x}}function HR(c,s){return c<s?-1:c>s?1:0}function qR(c,s=1,u=!1){let f=1/0,y=1/0,x=-1/0,w=-1/0;const A=c[0];for(let X=0;X<A.length;X++){const Y=A[X];(!X||Y.x<f)&&(f=Y.x),(!X||Y.y<y)&&(y=Y.y),(!X||Y.x>x)&&(x=Y.x),(!X||Y.y>w)&&(w=Y.y)}const C=Math.min(x-f,w-y);let k=C/2;const O=new WR([],ZR);if(C===0)return new Je(f,y);for(let X=f;X<x;X+=C)for(let Y=y;Y<w;Y+=C)O.push(new _u(X+k,Y+k,k,c));let N=function(X){let Y=0,de=0,le=0;const be=X[0];for(let Ie=0,xe=be.length,Se=xe-1;Ie<xe;Se=Ie++){const Ve=be[Ie],Ue=be[Se],dt=Ve.x*Ue.y-Ue.x*Ve.y;de+=(Ve.x+Ue.x)*dt,le+=(Ve.y+Ue.y)*dt,Y+=3*dt}return new _u(de/Y,le/Y,0,X)}(c),H=O.length;for(;O.length;){const X=O.pop();(X.d>N.d||!N.d)&&(N=X,u&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,H)),X.max-N.d<=s||(k=X.h/2,O.push(new _u(X.p.x-k,X.p.y-k,k,c)),O.push(new _u(X.p.x+k,X.p.y-k,k,c)),O.push(new _u(X.p.x-k,X.p.y+k,k,c)),O.push(new _u(X.p.x+k,X.p.y+k,k,c)),H+=4)}return u&&(console.log(`num probes: ${H}`),console.log(`best distance: ${N.d}`)),N.p}function ZR(c,s){return s.max-c.max}function _u(c,s,u,f){this.p=new Je(c,s),this.h=u,this.d=function(y,x){let w=!1,A=1/0;for(let C=0;C<x.length;C++){const k=x[C];for(let O=0,N=k.length,H=N-1;O<N;H=O++){const X=k[O],Y=k[H];X.y>y.y!=Y.y>y.y&&y.x<(Y.x-X.x)*(y.y-X.y)/(Y.y-X.y)+X.x&&(w=!w),A=Math.min(A,c2(y,X,Y))}}return(w?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const D_=Number.POSITIVE_INFINITY;function nE(c,s){return s[1]!==D_?function(u,f,y){let x=0,w=0;switch(f=Math.abs(f),y=Math.abs(y),u){case"top-right":case"top-left":case"top":w=y-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-y}switch(u){case"top-right":case"bottom-right":case"right":x=-f;break;case"top-left":case"bottom-left":case"left":x=f}return[x,w]}(c,s[0],s[1]):function(u,f){let y=0,x=0;f<0&&(f=0);const w=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":x=w-7;break;case"bottom-right":case"bottom-left":x=7-w;break;case"bottom":x=7-f;break;case"top":x=f-7}switch(u){case"top-right":case"bottom-right":y=-w;break;case"top-left":case"bottom-left":y=w;break;case"left":y=f;break;case"right":y=-f}return[y,x]}(c,s[0])}function O_(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function XR(c,s,u,f,y,x,w,A,C,k,O){let N=x.textMaxSize.evaluate(s,{});N===void 0&&(N=w);const H=c.layers[0].layout,X=H.get("icon-offset").evaluate(s,{},O),Y=iE(u.horizontal),de=w/24,le=c.tilePixelRatio*de,be=c.tilePixelRatio*N/24,Ie=c.tilePixelRatio*A,xe=c.tilePixelRatio*H.get("symbol-spacing"),Se=H.get("text-padding")*c.tilePixelRatio,Ve=function(qe,Ct,wt,Wt=1){const Gn=qe.get("icon-padding").evaluate(Ct,{},wt),Yn=Gn&&Gn.values;return[Yn[0]*Wt,Yn[1]*Wt,Yn[2]*Wt,Yn[3]*Wt]}(H,s,O,c.tilePixelRatio),Ue=H.get("text-max-angle")/180*Math.PI,dt=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",yt=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",lt=H.get("symbol-placement"),rt=xe/2,Ke=H.get("icon-text-fit");let ct;f&&Ke!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(ct=H2(f,u.vertical,Ke,H.get("icon-text-fit-padding"),X,de)),Y&&(f=H2(f,Y,Ke,H.get("icon-text-fit-padding"),X,de)));const it=(qe,Ct)=>{Ct.x<0||Ct.x>=Or||Ct.y<0||Ct.y>=Or||function(wt,Wt,Gn,Yn,Fr,xs,ni,Sr,$r,ri,hi,Ni,Pr,ii,di,Pi,Ui,Vi,nr,Wr,Kt,is,si,fi,$s){const lo=wt.addToLineVertexArray(Wt,Gn);let co,fa,Ws,bs,ji=0,pa=0,Td=0,xE=0,H_=-1,q_=-1;const ma={};let bE=Gr.exports(""),Z_=0,X_=0;if(Sr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Z_,X_]=Sr.layout.get("text-offset").evaluate(Kt,{},fi).map(Gi=>Gi*Kr):(Z_=Sr.layout.get("text-radial-offset").evaluate(Kt,{},fi)*Kr,X_=D_),wt.allowVerticalPlacement&&Yn.vertical){const Gi=Sr.layout.get("text-rotate").evaluate(Kt,{},fi)+90;Ws=new vm($r,Wt,ri,hi,Ni,Yn.vertical,Pr,ii,di,Gi),ni&&(bs=new vm($r,Wt,ri,hi,Ni,ni,Ui,Vi,di,Gi))}if(Fr){const Gi=Sr.layout.get("icon-rotate").evaluate(Kt,{}),Do=Sr.layout.get("icon-text-fit")!=="none",Sd=eE(Fr,Gi,si,Do),Pd=ni?eE(ni,Gi,si,Do):void 0;fa=new vm($r,Wt,ri,hi,Ni,Fr,Ui,Vi,!1,Gi),ji=4*Sd.length;const TE=wt.iconSizeData;let lc=null;TE.kind==="source"?(lc=[da*Sr.layout.get("icon-size").evaluate(Kt,{})],lc[0]>nl&&se(`${wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):TE.kind==="composite"&&(lc=[da*is.compositeIconSizes[0].evaluate(Kt,{},fi),da*is.compositeIconSizes[1].evaluate(Kt,{},fi)],(lc[0]>nl||lc[1]>nl)&&se(`${wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,Sd,lc,Wr,nr,Kt,l.WritingMode.none,Wt,lo.lineStartIndex,lo.lineLength,-1,fi),H_=wt.icon.placedSymbolArray.length-1,Pd&&(pa=4*Pd.length,wt.addSymbols(wt.icon,Pd,lc,Wr,nr,Kt,l.WritingMode.vertical,Wt,lo.lineStartIndex,lo.lineLength,-1,fi),q_=wt.icon.placedSymbolArray.length-1)}const wE=Object.keys(Yn.horizontal);for(const Gi of wE){const Do=Yn.horizontal[Gi];if(!co){bE=Gr.exports(Do.text);const Pd=Sr.layout.get("text-rotate").evaluate(Kt,{},fi);co=new vm($r,Wt,ri,hi,Ni,Do,Pr,ii,di,Pd)}const Sd=Do.positionedLines.length===1;if(Td+=rE(wt,Wt,Do,xs,Sr,di,Kt,Pi,lo,Yn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,Sd?wE:[Gi],ma,H_,is,fi),Sd)break}Yn.vertical&&(xE+=rE(wt,Wt,Yn.vertical,xs,Sr,di,Kt,Pi,lo,l.WritingMode.vertical,["vertical"],ma,q_,is,fi));const l4=co?co.boxStartIndex:wt.collisionBoxArray.length,c4=co?co.boxEndIndex:wt.collisionBoxArray.length,u4=Ws?Ws.boxStartIndex:wt.collisionBoxArray.length,h4=Ws?Ws.boxEndIndex:wt.collisionBoxArray.length,d4=fa?fa.boxStartIndex:wt.collisionBoxArray.length,f4=fa?fa.boxEndIndex:wt.collisionBoxArray.length,p4=bs?bs.boxStartIndex:wt.collisionBoxArray.length,m4=bs?bs.boxEndIndex:wt.collisionBoxArray.length;let uo=-1;const Tm=(Gi,Do)=>Gi&&Gi.circleDiameter?Math.max(Gi.circleDiameter,Do):Do;uo=Tm(co,uo),uo=Tm(Ws,uo),uo=Tm(fa,uo),uo=Tm(bs,uo);const EE=uo>-1?1:0;EE&&(uo*=$s/Kr),wt.glyphOffsetArray.length>=vu.MAX_GLYPHS&&se("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Kt.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,Kt.sortKey),wt.symbolInstances.emplaceBack(Wt.x,Wt.y,ma.right>=0?ma.right:-1,ma.center>=0?ma.center:-1,ma.left>=0?ma.left:-1,ma.vertical||-1,H_,q_,bE,l4,c4,u4,h4,d4,f4,p4,m4,ri,Td,xE,ji,pa,EE,0,Pr,Z_,X_,uo)}(c,Ct,qe,u,f,y,ct,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,le,[Se,Se,Se,Se],dt,C,Ie,Ve,yt,X,s,x,k,O,w)};if(lt==="line")for(const qe of Q2(s.geometry,0,0,Or,Or)){const Ct=$R(qe,xe,Ue,u.vertical||Y,f,24,be,c.overscaling,Or);for(const wt of Ct){const Wt=Y;Wt&&YR(c,Wt.text,rt,wt)||it(qe,wt)}}else if(lt==="line-center"){for(const qe of s.geometry)if(qe.length>1){const Ct=GR(qe,Ue,u.vertical||Y,f,24,be);Ct&&it(qe,Ct)}}else if(s.type==="Polygon")for(const qe of E_(s.geometry,0)){const Ct=qR(qe,16);it(qe[0],new tl(Ct.x,Ct.y,0))}else if(s.type==="LineString")for(const qe of s.geometry)it(qe,new tl(qe[0].x,qe[0].y,0));else if(s.type==="Point")for(const qe of s.geometry)for(const Ct of qe)it([Ct],new tl(Ct.x,Ct.y,0))}const nl=32640;function rE(c,s,u,f,y,x,w,A,C,k,O,N,H,X,Y){const de=function(Ie,xe,Se,Ve,Ue,dt,yt,lt){const rt=Ve.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,Ke=[];for(const ct of xe.positionedLines)for(const it of ct.positionedGlyphs){if(!it.rect)continue;const qe=it.rect||{};let Ct=4,wt=!0,Wt=1,Gn=0;const Yn=(Ue||lt)&&it.vertical,Fr=it.metrics.advance*it.scale/2;if(lt&&xe.verticalizable){const nr=(it.scale-1)*Kr,Wr=(Kr-it.metrics.width*it.scale)/2;Gn=ct.lineOffset/2-(it.imageName?-Wr:nr)}if(it.imageName){const nr=yt[it.imageName];wt=nr.sdf,Wt=nr.pixelRatio,Ct=1/Wt}const xs=Ue?[it.x+Fr,it.y]:[0,0];let ni=Ue?[0,0]:[it.x+Fr+Se[0],it.y+Se[1]-Gn],Sr=[0,0];Yn&&(Sr=ni,ni=[0,0]);const $r=(it.metrics.left-Ct)*it.scale-Fr+ni[0],ri=(-it.metrics.top-Ct)*it.scale+ni[1],hi=$r+qe.w*it.scale/Wt,Ni=ri+qe.h*it.scale/Wt,Pr=new Je($r,ri),ii=new Je(hi,ri),di=new Je($r,Ni),Pi=new Je(hi,Ni);if(Yn){const nr=new Je(-Fr,Fr-fm),Wr=-Math.PI/2,Kt=12-Fr,is=new Je(22-Kt,-(it.imageName?Kt:0)),si=new Je(...Sr);Pr._rotateAround(Wr,nr)._add(is)._add(si),ii._rotateAround(Wr,nr)._add(is)._add(si),di._rotateAround(Wr,nr)._add(is)._add(si),Pi._rotateAround(Wr,nr)._add(is)._add(si)}if(rt){const nr=Math.sin(rt),Wr=Math.cos(rt),Kt=[Wr,-nr,nr,Wr];Pr._matMult(Kt),ii._matMult(Kt),di._matMult(Kt),Pi._matMult(Kt)}const Ui=new Je(0,0),Vi=new Je(0,0);Ke.push({tl:Pr,tr:ii,bl:di,br:Pi,tex:qe,writingMode:xe.writingMode,glyphOffset:xs,sectionIndex:it.sectionIndex,isSDF:wt,pixelOffsetTL:Ui,pixelOffsetBR:Vi,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,u,A,y,x,w,f,c.allowVerticalPlacement),le=c.textSizeData;let be=null;le.kind==="source"?(be=[da*y.layout.get("text-size").evaluate(w,{})],be[0]>nl&&se(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(be=[da*X.compositeTextSizes[0].evaluate(w,{},Y),da*X.compositeTextSizes[1].evaluate(w,{},Y)],(be[0]>nl||be[1]>nl)&&se(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,de,be,A,x,w,k,s,C.lineStartIndex,C.lineLength,H,Y);for(const Ie of O)N[Ie]=c.text.placedSymbolArray.length-1;return 4*de.length}function iE(c){for(const s in c)return c[s];return null}function YR(c,s,u,f){const y=c.compareText;if(s in y){const x=y[s];for(let w=x.length-1;w>=0;w--)if(f.dist(x[w])<u)return!0}else y[s]=[];return y[s].push(f),!1}const KR=Qa.VectorTileFeature.types,JR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xm(c,s,u,f,y,x,w,A,C,k,O,N,H){const X=A?Math.min(nl,Math.round(A[0])):0,Y=A?Math.min(nl,Math.round(A[1])):0;c.emplaceBack(s,u,Math.round(32*f),Math.round(32*y),x,w,(X<<1)+(C?1:0),Y,16*k,16*O,256*N,256*H)}function F_(c,s,u){c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u)}function QR(c){for(const s of c.sections)if(Xp(s.text))return!0;return!1}class B_{constructor(s){this.layoutVertexArray=new js,this.indexArray=new Ei,this.programConfigurations=s,this.segments=new Zt,this.dynamicLayoutVertexArray=new ys,this.opacityVertexArray=new Gs,this.placedSymbolArray=new $e}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,u,f,y){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,wR.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,ER.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,JR,!0),this.opacityVertexBuffer.itemSize=1),(f||y)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pt("SymbolBuffers",B_);class N_{constructor(s,u,f){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Zt,this.collisionVertexArray=new ns}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,TR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pt("CollisionBuffers",N_);class vu{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(w=>w.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=y_([]),this.placementViewportMatrix=y_([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=q2(this.zoom,u["text-size"]),this.iconSizeData=q2(this.zoom,u["icon-size"]);const f=this.layers[0].layout,y=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=V_(f,"text-overlap","text-allow-overlap")!=="never"||V_(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>l.WritingMode[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=s.sourceID}createArrays(){this.text=new B_(new rc(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new B_(new rc(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new nt,this.lineVertexArray=new ht,this.symbolInstances=new ut}calculateGlyphDependencies(s,u,f,y,x){for(let w=0;w<s.length;w++)if(u[s.charCodeAt(w)]=!0,(f||y)&&x){const A=xd[s.charAt(w)];A&&(u[A.charCodeAt(0)]=!0)}}populate(s,u,f){const y=this.layers[0],x=y.layout,w=x.get("text-font"),A=x.get("text-field"),C=x.get("icon-image"),k=(A.value.kind!=="constant"||A.value.value instanceof ue&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,N=x.get("symbol-sort-key");if(this.features=[],!k&&!O)return;const H=u.iconDependencies,X=u.glyphDependencies,Y=u.availableImages,de=new Zn(this.zoom);for(const{feature:le,id:be,index:Ie,sourceLayerIndex:xe}of s){const Se=y._featureFilter.needGeometry,Ve=sc(le,Se);if(!y._featureFilter.filter(de,Ve,f))continue;let Ue,dt;if(Se||(Ve.geometry=ic(le)),k){const lt=y.getValueAndResolveTokens("text-field",Ve,f,Y),rt=ue.factory(lt);QR(rt)&&(this.hasRTLText=!0),(!this.hasRTLText||ec()==="unavailable"||this.hasRTLText&&ts.isParsed())&&(Ue=PR(rt,y,Ve))}if(O){const lt=y.getValueAndResolveTokens("icon-image",Ve,f,Y);dt=lt instanceof ye?lt:ye.fromString(lt)}if(!Ue&&!dt)continue;const yt=this.sortFeaturesByKey?N.evaluate(Ve,{},f):void 0;if(this.features.push({id:be,text:Ue,icon:dt,index:Ie,sourceLayerIndex:xe,geometry:Ve.geometry,properties:le.properties,type:KR[le.type],sortKey:yt}),dt&&(H[dt.name]=!0),Ue){const lt=w.evaluate(Ve,{},f).join(","),rt=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const Ke of Ue.sections)if(Ke.image)H[Ke.image.name]=!0;else{const ct=au(Ue.toString()),it=Ke.fontStack||lt,qe=X[it]=X[it]||{};this.calculateGlyphDependencies(Ke.text,qe,rt,this.allowVerticalPlacement,ct)}}}x.get("symbol-placement")==="line"&&(this.features=function(le){const be={},Ie={},xe=[];let Se=0;function Ve(lt){xe.push(le[lt]),Se++}function Ue(lt,rt,Ke){const ct=Ie[lt];return delete Ie[lt],Ie[rt]=ct,xe[ct].geometry[0].pop(),xe[ct].geometry[0]=xe[ct].geometry[0].concat(Ke[0]),ct}function dt(lt,rt,Ke){const ct=be[rt];return delete be[rt],be[lt]=ct,xe[ct].geometry[0].shift(),xe[ct].geometry[0]=Ke[0].concat(xe[ct].geometry[0]),ct}function yt(lt,rt,Ke){const ct=Ke?rt[0][rt[0].length-1]:rt[0][0];return`${lt}:${ct.x}:${ct.y}`}for(let lt=0;lt<le.length;lt++){const rt=le[lt],Ke=rt.geometry,ct=rt.text?rt.text.toString():null;if(!ct){Ve(lt);continue}const it=yt(ct,Ke),qe=yt(ct,Ke,!0);if(it in Ie&&qe in be&&Ie[it]!==be[qe]){const Ct=dt(it,qe,Ke),wt=Ue(it,qe,xe[Ct].geometry);delete be[it],delete Ie[qe],Ie[yt(ct,xe[wt].geometry,!0)]=wt,xe[Ct].geometry=null}else it in Ie?Ue(it,qe,Ke):qe in be?dt(it,qe,Ke):(Ve(lt),be[it]=Se-1,Ie[qe]=Se-1)}return xe.filter(lt=>lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,be)=>le.sortKey-be.sortKey)}update(s,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const f=this.lineVertexArray.length;if(s.segment!==void 0){let y=s.dist(u[s.segment+1]),x=s.dist(u[s.segment]);const w={};for(let A=s.segment+1;A<u.length;A++)w[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:y},A<u.length-1&&(y+=u[A+1].dist(u[A]));for(let A=s.segment||0;A>=0;A--)w[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:x},A>0&&(x+=u[A-1].dist(u[A]));for(let A=0;A<u.length;A++){const C=w[A];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,u,f,y,x,w,A,C,k,O,N,H){const X=s.indexArray,Y=s.layoutVertexArray,de=s.segments.prepareSegment(4*u.length,Y,X,this.canOverlap?w.sortKey:void 0),le=this.glyphOffsetArray.length,be=de.vertexLength,Ie=this.allowVerticalPlacement&&A===l.WritingMode.vertical?Math.PI/2:0,xe=w.text&&w.text.sections;for(let Se=0;Se<u.length;Se++){const{tl:Ve,tr:Ue,bl:dt,br:yt,tex:lt,pixelOffsetTL:rt,pixelOffsetBR:Ke,minFontScaleX:ct,minFontScaleY:it,glyphOffset:qe,isSDF:Ct,sectionIndex:wt}=u[Se],Wt=de.vertexLength,Gn=qe[1];xm(Y,C.x,C.y,Ve.x,Gn+Ve.y,lt.x,lt.y,f,Ct,rt.x,rt.y,ct,it),xm(Y,C.x,C.y,Ue.x,Gn+Ue.y,lt.x+lt.w,lt.y,f,Ct,Ke.x,rt.y,ct,it),xm(Y,C.x,C.y,dt.x,Gn+dt.y,lt.x,lt.y+lt.h,f,Ct,rt.x,Ke.y,ct,it),xm(Y,C.x,C.y,yt.x,Gn+yt.y,lt.x+lt.w,lt.y+lt.h,f,Ct,Ke.x,Ke.y,ct,it),F_(s.dynamicLayoutVertexArray,C,Ie),X.emplaceBack(Wt,Wt+1,Wt+2),X.emplaceBack(Wt+1,Wt+2,Wt+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qe[0]),Se!==u.length-1&&wt===u[Se+1].sectionIndex||s.programConfigurations.populatePaintArrays(Y.length,w,w.index,{},H,xe&&xe[wt])}s.placedSymbolArray.emplaceBack(C.x,C.y,le,this.glyphOffsetArray.length-le,be,k,O,C.segment,f?f[0]:0,f?f[1]:0,y[0],y[1],A,0,!1,0,N)}_addCollisionDebugVertex(s,u,f,y,x,w){return u.emplaceBack(0,0),s.emplaceBack(f.x,f.y,y,x,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(s,u,f,y,x,w,A){const C=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),k=C.vertexLength,O=x.layoutVertexArray,N=x.collisionVertexArray,H=A.anchorX,X=A.anchorY;this._addCollisionDebugVertex(O,N,w,H,X,new Je(s,u)),this._addCollisionDebugVertex(O,N,w,H,X,new Je(f,u)),this._addCollisionDebugVertex(O,N,w,H,X,new Je(f,y)),this._addCollisionDebugVertex(O,N,w,H,X,new Je(s,y)),C.vertexLength+=4;const Y=x.indexArray;Y.emplaceBack(k,k+1),Y.emplaceBack(k+1,k+2),Y.emplaceBack(k+2,k+3),Y.emplaceBack(k+3,k),C.primitiveLength+=4}addDebugCollisionBoxes(s,u,f,y){for(let x=s;x<u;x++){const w=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,y?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new N_(Ro,R2.members,oo),this.iconCollisionBox=new N_(Ro,R2.members,oo);for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(s,u,f,y,x,w,A,C,k){const O={};for(let N=u;N<f;N++){const H=s.get(N);O.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.textFeatureIndex=H.featureIndex;break}for(let N=y;N<x;N++){const H=s.get(N);O.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalTextFeatureIndex=H.featureIndex;break}for(let N=w;N<A;N++){const H=s.get(N);O.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.iconFeatureIndex=H.featureIndex;break}for(let N=C;N<k;N++){const H=s.get(N);O.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalIconFeatureIndex=H.featureIndex;break}return O}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,u){const f=s.placedSymbolArray.get(u),y=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<y;x+=4)s.indexArray.emplaceBack(x,x+1,x+2),s.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),f=Math.cos(s),y=[],x=[],w=[];for(let A=0;A<this.symbolInstances.length;++A){w.push(A);const C=this.symbolInstances.get(A);y.push(0|Math.round(u*C.anchorX+f*C.anchorY)),x.push(C.featureIndex)}return w.sort((A,C)=>y[A]-y[C]||x[C]-x[A]),w}addToSortKeyRanges(s,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((y,x,w)=>{y>=0&&w.indexOf(y)===x&&this.addIndicesForPlacedSymbol(this.text,y)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt("SymbolBucket",vu,{omit:["layers","collisionBoxArray","features","compareText"]}),vu.MAX_GLYPHS=65535,vu.addDynamicAttributes=F_;const e4=new Yr({"symbol-placement":new vt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new vt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mt(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vt(Ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new vt(Ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new vt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new vt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mt(Ee.layout_symbol["icon-size"]),"icon-text-fit":new vt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mt(Ee.layout_symbol["icon-image"]),"icon-rotate":new Mt(Ee.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new vt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new Mt(Ee.layout_symbol["icon-offset"]),"icon-anchor":new Mt(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new Mt(Ee.layout_symbol["text-field"]),"text-font":new Mt(Ee.layout_symbol["text-font"]),"text-size":new Mt(Ee.layout_symbol["text-size"]),"text-max-width":new Mt(Ee.layout_symbol["text-max-width"]),"text-line-height":new vt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new Mt(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new Mt(Ee.layout_symbol["text-justify"]),"text-radial-offset":new Mt(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vt(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new Mt(Ee.layout_symbol["text-anchor"]),"text-max-angle":new vt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new vt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new Mt(Ee.layout_symbol["text-rotate"]),"text-padding":new vt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new vt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new Mt(Ee.layout_symbol["text-transform"]),"text-offset":new Mt(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new vt(Ee.layout_symbol["text-allow-overlap"]),"text-overlap":new vt(Ee.layout_symbol["text-overlap"]),"text-ignore-placement":new vt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new vt(Ee.layout_symbol["text-optional"])});var U_={paint:new Yr({"icon-opacity":new Mt(Ee.paint_symbol["icon-opacity"]),"icon-color":new Mt(Ee.paint_symbol["icon-color"]),"icon-halo-color":new Mt(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mt(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mt(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new vt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new vt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mt(Ee.paint_symbol["text-opacity"]),"text-color":new Mt(Ee.paint_symbol["text-color"],{runtimeType:hr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Mt(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new Mt(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new Mt(Ee.paint_symbol["text-halo-blur"]),"text-translate":new vt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new vt(Ee.paint_symbol["text-translate-anchor"])}),layout:e4};class sE{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Qn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt("FormatSectionOverride",sE,{omit:["defaultValue"]});class bm extends Vs{constructor(s){super(s,U_)}recalculate(s,u){if(super.recalculate(s,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const y=[];for(const x of f)y.indexOf(x)<0&&y.push(x);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,u,f,y){const x=this.layout.get(s).evaluate(u,{},f,y),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||Vl(w.value)||!x?x:function(A,C){return C.replace(/{([^{}]+)}/g,(k,O)=>O in A?String(A[O]):"")}(u.properties,x)}createBucket(s){return new vu(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of U_.paint.overridableProperties){if(!bm.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),f=new sE(u),y=new tu(f,u.property.specification);let x=null;x=u.value.kind==="constant"||u.value.kind==="source"?new Gl("source",y):new Zh("composite",y,u.value.zoomStops),this.paint._values[s]=new Us(u.property,x,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&bm.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const f=s.get("text-field"),y=U_.paint.properties[u];let x=!1;const w=A=>{for(const C of A)if(y.overrides&&y.overrides.hasOverride(C))return void(x=!0)};if(f.value.kind==="constant"&&f.value.value instanceof ue)w(f.value.value.sections);else if(f.value.kind==="source"){const A=k=>{x||(k instanceof gt&&Le(k.value)===or?w(k.value.sections):k instanceof Qc?w(k.sections):k.eachChild(A))},C=f.value;C._styleExpression&&A(C._styleExpression.expression)}return x}}function V_(c,s,u){let f="never";const y=c.get(s);return y?f=y:c.get(u)&&(f="always"),f}var t4={paint:new Yr({"background-color":new vt(Ee.paint_background["background-color"]),"background-pattern":new od(Ee.paint_background["background-pattern"]),"background-opacity":new vt(Ee.paint_background["background-opacity"])})},n4={paint:new Yr({"raster-opacity":new vt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new vt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new vt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new vt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new vt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new vt(Ee.paint_raster["raster-fade-duration"])})};class r4 extends Vs{constructor(s){super(s,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const i4={circle:class extends Vs{constructor(c){super(c,D3)}createBucket(c){return new p_(c)}queryRadius(c){const s=c;return hd("circle-radius",this,s)+hd("circle-stroke-width",this,s)+im(this.paint.get("circle-translate"))}queryIntersectsFeature(c,s,u,f,y,x,w,A){const C=sm(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),k=this.paint.get("circle-radius").evaluate(s,u)+this.paint.get("circle-stroke-width").evaluate(s,u),O=this.paint.get("circle-pitch-alignment")==="map",N=O?C:function(X,Y){return X.map(de=>g2(de,Y))}(C,A),H=O?k*w:k;for(const X of f)for(const Y of X){const de=O?Y:g2(Y,A);let le=H;const be=om([],[Y.x,Y.y,0,1],A);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=be[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=x.cameraToCenterDistance/be[3]),M3(N,de,le))return!0}return!1}},heatmap:class extends Vs{constructor(c){super(c,F3),this._updateColorRamp()}createBucket(c){return new y2(c)}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=v2({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Vs{constructor(c){super(c,B3)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Vs{constructor(c){super(c,eR)}recalculate(c,s){super.recalculate(c,s);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new P_(c)}queryRadius(){return im(this.paint.get("fill-translate"))}queryIntersectsFeature(c,s,u,f,y,x,w){return l2(sm(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),f)}isTileClipped(){return!0}},"fill-extrusion":class extends Vs{constructor(c){super(c,pR)}createBucket(c){return new C_(c)}queryRadius(){return im(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,s,u,f,y,x,w,A){const C=sm(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),k=this.paint.get("fill-extrusion-height").evaluate(s,u),O=this.paint.get("fill-extrusion-base").evaluate(s,u),N=function(X,Y,de,le){const be=[];for(const Ie of X){const xe=[Ie.x,Ie.y,0,1];om(xe,xe,Y),be.push(new Je(xe[0]/xe[3],xe[1]/xe[3]))}return be}(C,A),H=function(X,Y,de,le){const be=[],Ie=[],xe=le[8]*Y,Se=le[9]*Y,Ve=le[10]*Y,Ue=le[11]*Y,dt=le[8]*de,yt=le[9]*de,lt=le[10]*de,rt=le[11]*de;for(const Ke of X){const ct=[],it=[];for(const qe of Ke){const Ct=qe.x,wt=qe.y,Wt=le[0]*Ct+le[4]*wt+le[12],Gn=le[1]*Ct+le[5]*wt+le[13],Yn=le[2]*Ct+le[6]*wt+le[14],Fr=le[3]*Ct+le[7]*wt+le[15],xs=Yn+Ve,ni=Fr+Ue,Sr=Wt+dt,$r=Gn+yt,ri=Yn+lt,hi=Fr+rt,Ni=new Je((Wt+xe)/ni,(Gn+Se)/ni);Ni.z=xs/ni,ct.push(Ni);const Pr=new Je(Sr/hi,$r/hi);Pr.z=ri/hi,it.push(Pr)}be.push(ct),Ie.push(it)}return[be,Ie]}(f,O,k,A);return function(X,Y,de){let le=1/0;l2(de,Y)&&(le=C2(de,Y[0]));for(let be=0;be<Y.length;be++){const Ie=Y[be],xe=X[be];for(let Se=0;Se<Ie.length-1;Se++){const Ve=Ie[Se],Ue=[Ve,Ie[Se+1],xe[Se+1],xe[Se],Ve];a2(de,Ue)&&(le=Math.min(le,C2(de,Ue)))}}return le!==1/0&&le}(H[0],H[1],N)}},line:class extends Vs{constructor(c){super(c,M2),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof tr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,s){super.recalculate(c,s),this.paint._values["line-floorwidth"]=k2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new I_(c)}queryRadius(c){const s=c,u=L2(hd("line-width",this,s),hd("line-gap-width",this,s)),f=hd("line-offset",this,s);return u/2+Math.abs(f)+im(this.paint.get("line-translate"))}queryIntersectsFeature(c,s,u,f,y,x,w){const A=sm(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),C=w/2*L2(this.paint.get("line-width").evaluate(s,u),this.paint.get("line-gap-width").evaluate(s,u)),k=this.paint.get("line-offset").evaluate(s,u);return k&&(f=function(O,N){const H=[];for(let X=0;X<O.length;X++){const Y=O[X],de=[];for(let le=0;le<Y.length;le++){const be=Y[le-1],Ie=Y[le],xe=Y[le+1],Se=le===0?new Je(0,0):Ie.sub(be)._unit()._perp(),Ve=le===Y.length-1?new Je(0,0):xe.sub(Ie)._unit()._perp(),Ue=Se._add(Ve)._unit(),dt=Ue.x*Ve.x+Ue.y*Ve.y;dt!==0&&Ue._mult(1/dt),de.push(Ue._mult(N)._add(Ie))}H.push(de)}return H}(f,k*w)),function(O,N,H){for(let X=0;X<N.length;X++){const Y=N[X];if(O.length>=3){for(let de=0;de<Y.length;de++)if(du(O,Y[de]))return!0}if(k3(O,Y,H))return!0}return!1}(A,f,C)}isTileClipped(){return!0}},symbol:bm,background:class extends Vs{constructor(c){super(c,t4)}},raster:class extends Vs{constructor(c){super(c,n4)}}};class s4{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const oE=63710088e-1;class pr{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pr(z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,f=this.lat*u,y=s.lat*u,x=Math.sin(f)*Math.sin(y)+Math.cos(f)*Math.cos(y)*Math.cos((s.lng-this.lng)*u);return oE*Math.acos(Math.min(x,1))}toBounds(s=0){const u=360*s/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new ac(new pr(this.lng-f,this.lat-u),new pr(this.lng+f,this.lat+u))}static convert(s){if(s instanceof pr)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new pr(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new pr(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ac{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof pr?new pr(s.lng,s.lat):pr.convert(s),this}setSouthWest(s){return this._sw=s instanceof pr?new pr(s.lng,s.lat):pr.convert(s),this}extend(s){const u=this._sw,f=this._ne;let y,x;if(s instanceof pr)y=s,x=s;else{if(!(s instanceof ac))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(ac.convert(s)):this.extend(pr.convert(s)):this;if(y=s._sw,x=s._ne,!y||!x)return this}return u||f?(u.lng=Math.min(y.lng,u.lng),u.lat=Math.min(y.lat,u.lat),f.lng=Math.max(x.lng,f.lng),f.lat=Math.max(x.lat,f.lat)):(this._sw=new pr(y.lng,y.lat),this._ne=new pr(x.lng,x.lat)),this}getCenter(){return new pr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pr(this.getWest(),this.getNorth())}getSouthEast(){return new pr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:u,lat:f}=pr.convert(s);let y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&y}static convert(s){return s instanceof ac?s:s&&new ac(s)}}const aE=2*Math.PI*oE;function lE(c){return aE*Math.cos(c*Math.PI/180)}function cE(c){return(180+c)/360}function uE(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function hE(c,s){return c/lE(s)}function j_(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class wm{constructor(s,u,f=0){this.x=+s,this.y=+u,this.z=+f}static fromLngLat(s,u=0){const f=pr.convert(s);return new wm(cE(f.lng),uE(f.lat),hE(u,f.lat))}toLngLat(){return new pr(360*this.x-180,j_(this.y))}toAltitude(){return this.z*lE(j_(this.y))}meterInMercatorCoordinateUnits(){return 1/aE*(s=j_(this.y),1/Math.cos(s*Math.PI/180));var s}}function dE(c,s,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[c*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class G_{constructor(s,u,f){if(s<0||s>25||f<0||f>=Math.pow(2,s)||u<0||u>=Math.pow(2,s))throw new Error(`x=${u}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=u,this.y=f,this.key=wd(0,s,s,u,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,u,f){const y=(w=this.y,A=this.z,C=dE(256*(x=this.x),256*(w=Math.pow(2,A)-w-1),A),k=dE(256*(x+1),256*(w+1),A),C[0]+","+C[1]+","+k[0]+","+k[1]);var x,w,A,C,k;const O=function(N,H,X){let Y,de="";for(let le=N;le>0;le--)Y=1<<le-1,de+=(H&Y?1:0)+(X&Y?2:0);return de}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,y)}isChildOf(s){const u=this.z-s.z;return u>0&&s.x===this.x>>u&&s.y===this.y>>u}getTilePoint(s){const u=Math.pow(2,this.z);return new Je((s.x*u-this.x)*Or,(s.y*u-this.y)*Or)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fE{constructor(s,u){this.wrap=s,this.canonical=u,this.key=wd(s,u.z,u.z,u.x,u.y)}}class vs{constructor(s,u,f,y,x){if(s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=u,this.canonical=new G_(f,+y,+x),this.key=wd(u,s,f,y,x)}clone(){return new vs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-s;return s>this.canonical.z?new vs(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vs(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?wd(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):wd(this.wrap*+u,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,y=2*this.canonical.y;return[new vs(u,this.wrap,u,f,y),new vs(u,this.wrap,u,f+1,y),new vs(u,this.wrap,u,f,y+1),new vs(u,this.wrap,u,f+1,y+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new vs(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new wm(s.x-this.wrap,s.y))}}function wd(c,s,u,f,y){(c*=2)<0&&(c=-1*c-1);const x=1<<u;return(x*x*c+x*y+f).toString(36)+u.toString(36)+s.toString(36)}pt("CanonicalTileID",G_),pt("OverscaledTileID",vs,{omit:["posMatrix"]});class pE{constructor(s,u,f){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void se(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const y=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let x=0;x<y;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(y,x)]=this.data[this._idx(y-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,y)]=this.data[this._idx(x,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<y;x++)for(let w=0;w<y;w++){const A=this.get(x,w);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(s,u){const f=new Uint8Array(this.data.buffer),y=4*this._idx(s,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[y],f[y+1],f[y+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}_unpackMapbox(s,u,f){return(256*s*256+256*u+f)/10-1e4}_unpackTerrarium(s,u,f){return 256*s+u+f/256-32768}getPixels(){return new _s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,u,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,x=u*this.dim+this.dim,w=f*this.dim,A=f*this.dim+this.dim;switch(u){case-1:y=x-1;break;case 1:x=y+1}switch(f){case-1:w=A-1;break;case 1:A=w+1}const C=-u*this.dim,k=-f*this.dim;for(let O=w;O<A;O++)for(let N=y;N<x;N++)this.data[this._idx(N,O)]=s.data[this._idx(N+C,O+k)]}}pt("DEMData",pE);class mE{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const f=s[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class gE{constructor(s,u,f,y,x){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=f,s._y=y,this.properties=s.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s}}class yE{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Ql(Or,16,0),this.grid3D=new Ql(Or,16,0),this.featureIndexArray=new $t,this.promoteId=u}insert(s,u,f,y,x,w){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,y,x);const C=w?this.grid3D:this.grid;for(let k=0;k<u.length;k++){const O=u[k],N=[1/0,1/0,-1/0,-1/0];for(let H=0;H<O.length;H++){const X=O[H];N[0]=Math.min(N[0],X.x),N[1]=Math.min(N[1],X.y),N[2]=Math.max(N[2],X.x),N[3]=Math.max(N[3],X.y)}N[0]<Or&&N[1]<Or&&N[2]>=0&&N[3]>=0&&C.insert(A,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Qa.VectorTile(new M_(this.rawTileData)).layers,this.sourceLayerCoder=new mE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,u,f,y){this.loadVTLayers();const x=s.params||{},w=Or/s.tileSize/s.scale,A=iu(x.filter),C=s.queryGeometry,k=s.queryPadding*w,O=vE(C),N=this.grid.query(O.minX-k,O.minY-k,O.maxX+k,O.maxY+k),H=vE(s.cameraQueryGeometry),X=this.grid3D.query(H.minX-k,H.minY-k,H.maxX+k,H.maxY+k,(le,be,Ie,xe)=>function(Se,Ve,Ue,dt,yt){for(const rt of Se)if(Ve<=rt.x&&Ue<=rt.y&&dt>=rt.x&&yt>=rt.y)return!0;const lt=[new Je(Ve,Ue),new Je(Ve,yt),new Je(dt,yt),new Je(dt,Ue)];if(Se.length>2){for(const rt of lt)if(du(Se,rt))return!0}for(let rt=0;rt<Se.length-1;rt++)if(R3(Se[rt],Se[rt+1],lt))return!0;return!1}(s.cameraQueryGeometry,le-k,be-k,Ie+k,xe+k));for(const le of X)N.push(le);N.sort(o4);const Y={};let de;for(let le=0;le<N.length;le++){const be=N[le];if(be===de)continue;de=be;const Ie=this.featureIndexArray.get(be);let xe=null;this.loadMatchingFeature(Y,Ie.bucketIndex,Ie.sourceLayerIndex,Ie.featureIndex,A,x.layers,x.availableImages,u,f,y,(Se,Ve,Ue)=>(xe||(xe=ic(Se)),Ve.queryIntersectsFeature(C,Se,Ue,xe,this.z,s.transform,w,s.pixelPosMatrix)))}return Y}loadMatchingFeature(s,u,f,y,x,w,A,C,k,O,N){const H=this.bucketLayerIDs[u];if(w&&!function(le,be){for(let Ie=0;Ie<le.length;Ie++)if(be.indexOf(le[Ie])>=0)return!0;return!1}(w,H))return;const X=this.sourceLayerCoder.decode(f),Y=this.vtLayers[X].feature(y);if(x.needGeometry){const le=sc(Y,!0);if(!x.filter(new Zn(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!x.filter(new Zn(this.tileID.overscaledZ),Y))return;const de=this.getId(Y,X);for(let le=0;le<H.length;le++){const be=H[le];if(w&&w.indexOf(be)<0)continue;const Ie=C[be];if(!Ie)continue;let xe={};de&&O&&(xe=O.getState(Ie.sourceLayer||"_geojsonTileLayer",de));const Se=D({},k[be]);Se.paint=_E(Se.paint,Ie.paint,Y,xe,A),Se.layout=_E(Se.layout,Ie.layout,Y,xe,A);const Ve=!N||N(Y,Ie,xe);if(!Ve)continue;const Ue=new gE(Y,this.z,this.x,this.y,de);Ue.layer=Se;let dt=s[be];dt===void 0&&(dt=s[be]=[]),dt.push({featureIndex:y,feature:Ue,intersectionZ:Ve})}}lookupSymbolFeatures(s,u,f,y,x,w,A,C){const k={};this.loadVTLayers();const O=iu(x);for(const N of s)this.loadMatchingFeature(k,f,y,N,O,w,A,C,u);return k}hasLayer(s){for(const u of this.bucketLayerIDs)for(const f of u)if(s===f)return!0;return!1}getId(s,u){let f=s.id;return this.promoteId&&(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function _E(c,s,u,f,y){return U(c,(x,w)=>{const A=s instanceof nc?s.get(w):null;return A&&A.evaluate?A.evaluate(u,f,y):A})}function vE(c){let s=1/0,u=1/0,f=-1/0,y=-1/0;for(const x of c)s=Math.min(s,x.x),u=Math.min(u,x.y),f=Math.max(f,x.x),y=Math.max(y,x.y);return{minX:s,minY:u,maxX:f,maxY:y}}function o4(c,s){return s-c}var $_;pt("FeatureIndex",yE,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,($_=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",$_.load="load",$_.fullLoad="fullLoad";let Em=null,Ed=[];const W_=1e3/30,a4={mark(c){performance.mark(c)},frame(c){const s=c;Em!=null&&Ed.push(s-Em),Em=s},clearMetrics(){Em=null,Ed=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const c in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[c])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const c=performance.getEntriesByName("loadTime")[0].duration,s=performance.getEntriesByName("fullLoadTime")[0].duration,u=Ed.length,f=1/(Ed.reduce((x,w)=>x+w,0)/u/1e3),y=Ed.filter(x=>x>W_).reduce((x,w)=>x+(w-W_)/W_,0);return{loadTime:c,fullLoadTime:s,fps:f,percentDroppedFrames:y/(u+y)*100}}};l.AJAXError=pn,l.ARRAY_TYPE=Si,l.Actor=class{constructor(c,s,u){this.target=c,this.parent=s,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},J(["receive","process"],this),this.invoker=new s4(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Me()?c:window}send(c,s,u,f,y=!1){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[x]=u);const w=et(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:c,hasCallback:!!u,targetMapId:f,mustQueue:y,sourceMapId:this.mapId,data:sa(s,w)},w),{cancel:()=>{u&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(c){const s=c.data,u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else Me()||s.mustQueue?(this.tasks[u]=s,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,s)}process(){if(!this.taskQueue.length)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){if(s.type==="<response>"){const u=this.callbacks[c];delete this.callbacks[c],u&&(s.error?u(Co(s.error)):u(null,Co(s.data)))}else{let u=!1;const f=et(this.globalScope)?void 0:[],y=s.hasCallback?(A,C)=>{u=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:A?sa(A):null,data:sa(C,f)},f)}:A=>{u=!0};let x=null;const w=Co(s.data);if(this.parent[s.type])x=this.parent[s.type](s.sourceMapId,w,y);else if(this.parent.getWorkerSource){const A=s.type.split(".");x=this.parent.getWorkerSource(s.sourceMapId,A[0],w.source)[A[1]](w,y)}else y(new Error(`Could not find function ${s.type}`));!u&&x&&x.cancel&&(this.cancelCallbacks[c]=x.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=fd,l.CanonicalTileID=G_,l.CollisionBoxArray=Fe,l.CollisionCircleLayoutArray=class extends B{},l.Color=Q,l.DEMData=pE,l.DataConstantProperty=vt,l.DictionaryCoder=mE,l.EXTENT=Or,l.ErrorEvent=St,l.EvaluationParameters=Zn,l.Event=Ye,l.Evented=Rt,l.FeatureIndex=yE,l.FillBucket=P_,l.FillExtrusionBucket=C_,l.GeoJSONFeature=gE,l.ImageAtlas=V2,l.ImagePosition=L_,l.LineBucket=I_,l.LineStripIndexArray=class extends ae{},l.LngLat=pr,l.LngLatBounds=ac,l.MercatorCoordinate=wm,l.ONE_EM=Kr,l.OverscaledTileID=vs,l.PerformanceUtils=a4,l.PosArray=At,l.Properties=Yr,l.QuadTriangleArray=class extends q{},l.RGBAImage=_s,l.RasterBoundsArray=class extends g{},l.RequestPerformance=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},l.ResourceType=Hn,l.SegmentVector=Zt,l.SymbolBucket=vu,l.Transitionable=Jp,l.TriangleIndexArray=Ei,l.Uniform1f=ca,l.Uniform1i=class extends la{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},l.Uniform2f=class extends la{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},l.Uniform3f=class extends la{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},l.Uniform4f=uu,l.UniformColor=r2,l.UniformMatrix4f=class extends la{constructor(c,s){super(c,s),this.current=C3}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},l.UnwrappedTileID=fE,l.ValidationError=Re,l.ZoomHistory=Jh,l.add=function(c,s,u){return c[0]=s[0]+u[0],c[1]=s[1]+u[1],c[2]=s[2]+u[2],c},l.addDynamicAttributes=F_,l.asyncAll=function(c,s,u){if(!c.length)return u(null,[]);let f=c.length;const y=new Array(c.length);let x=null;c.forEach((w,A)=>{s(w,(C,k)=>{C&&(x=C),y[A]=k,--f==0&&u(x,y)})})},l.bezier=E,l.bindAll=J,l.cacheEntryPossiblyAdded=function(c){zn++,zn>An&&(c.getActor().send("enforceCacheSizeLimit",Xt),zn=0)},l.clamp=S,l.clearTileCache=function(c){const s=caches.delete(Qe);c&&s.catch(c).then(()=>c())},l.clipLine=Q2,l.clone=function(c){var s=new Si(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},l.clone$1=G,l.clone$2=function(c){var s=new Si(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s},l.collisionCircleLayout=SR,l.config=We,l.copy=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.create=function(){var c=new Si(16);return Si!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},l.create$1=h2,l.createExpression=jl,l.createFilter=iu,l.createLayout=Tr,l.createStyleLayer=function(c){return c.type==="custom"?new r4(c):new i4[c.type](c)},l.cross=function(c,s,u){var f=s[0],y=s[1],x=s[2],w=u[0],A=u[1],C=u[2];return c[0]=y*C-x*A,c[1]=x*w-f*C,c[2]=f*A-y*w,c},l.dot=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]},l.dot$1=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},l.ease=T,l.emitValidationErrors=ou,l.enforceCacheSizeLimit=function(c){xn(),Tt&&Tt.then(s=>{s.keys().then(u=>{for(let f=0;f<u.length-c;f++)s.delete(u[f])})})},l.equals=function(c,s){var u=c[0],f=c[1],y=c[2],x=c[3],w=c[4],A=c[5],C=c[6],k=c[7],O=c[8],N=c[9],H=c[10],X=c[11],Y=c[12],de=c[13],le=c[14],be=c[15],Ie=s[0],xe=s[1],Se=s[2],Ve=s[3],Ue=s[4],dt=s[5],yt=s[6],lt=s[7],rt=s[8],Ke=s[9],ct=s[10],it=s[11],qe=s[12],Ct=s[13],wt=s[14],Wt=s[15];return Math.abs(u-Ie)<=Ti*Math.max(1,Math.abs(u),Math.abs(Ie))&&Math.abs(f-xe)<=Ti*Math.max(1,Math.abs(f),Math.abs(xe))&&Math.abs(y-Se)<=Ti*Math.max(1,Math.abs(y),Math.abs(Se))&&Math.abs(x-Ve)<=Ti*Math.max(1,Math.abs(x),Math.abs(Ve))&&Math.abs(w-Ue)<=Ti*Math.max(1,Math.abs(w),Math.abs(Ue))&&Math.abs(A-dt)<=Ti*Math.max(1,Math.abs(A),Math.abs(dt))&&Math.abs(C-yt)<=Ti*Math.max(1,Math.abs(C),Math.abs(yt))&&Math.abs(k-lt)<=Ti*Math.max(1,Math.abs(k),Math.abs(lt))&&Math.abs(O-rt)<=Ti*Math.max(1,Math.abs(O),Math.abs(rt))&&Math.abs(N-Ke)<=Ti*Math.max(1,Math.abs(N),Math.abs(Ke))&&Math.abs(H-ct)<=Ti*Math.max(1,Math.abs(H),Math.abs(ct))&&Math.abs(X-it)<=Ti*Math.max(1,Math.abs(X),Math.abs(it))&&Math.abs(Y-qe)<=Ti*Math.max(1,Math.abs(Y),Math.abs(qe))&&Math.abs(de-Ct)<=Ti*Math.max(1,Math.abs(de),Math.abs(Ct))&&Math.abs(le-wt)<=Ti*Math.max(1,Math.abs(le),Math.abs(wt))&&Math.abs(be-Wt)<=Ti*Math.max(1,Math.abs(be),Math.abs(Wt))},l.evaluateSizeForFeature=function(c,{uSize:s,uSizeT:u},{lowerSize:f,upperSize:y}){return c.kind==="source"?f/da:c.kind==="composite"?Gt(f/da,y/da,u):s},l.evaluateSizeForZoom=function(c,s){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:y,minZoom:x,maxZoom:w}=c,A=y?S(Oi.interpolationFactor(y,s,x,w),0,1):0;c.kind==="camera"?f=Gt(c.minSize,c.maxSize,A):u=A}return{uSizeT:u,uSize:f}},l.evaluateVariableOffset=nE,l.evented=sd,l.exported=Bt,l.exported$1=Dn,l.extend=D,l.filterObject=V,l.fromRotation=function(c,s){var u=Math.sin(s),f=Math.cos(s);return c[0]=f,c[1]=u,c[2]=0,c[3]=-u,c[4]=f,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},l.fromScaling=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},l.getAnchorAlignment=z_,l.getAnchorJustification=O_,l.getArrayBuffer=Jn,l.getImage=ui,l.getJSON=function(c,s){return Un(D(c,{type:"json"}),s)},l.getOverlapMode=V_,l.getRTLTextPluginStatus=ec,l.getReferrer=un,l.getVideo=function(c,s){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){s(null,u)};for(let f=0;f<c.length;f++){const y=window.document.createElement("source");Ur(c[f])||(u.crossOrigin="Anonymous"),y.src=c[f],u.appendChild(y)}return{cancel:()=>{}}},l.identity=y_,l.invert=function(c,s){var u=s[0],f=s[1],y=s[2],x=s[3],w=s[4],A=s[5],C=s[6],k=s[7],O=s[8],N=s[9],H=s[10],X=s[11],Y=s[12],de=s[13],le=s[14],be=s[15],Ie=u*A-f*w,xe=u*C-y*w,Se=u*k-x*w,Ve=f*C-y*A,Ue=f*k-x*A,dt=y*k-x*C,yt=O*de-N*Y,lt=O*le-H*Y,rt=O*be-X*Y,Ke=N*le-H*de,ct=N*be-X*de,it=H*be-X*le,qe=Ie*it-xe*ct+Se*Ke+Ve*rt-Ue*lt+dt*yt;return qe?(c[0]=(A*it-C*ct+k*Ke)*(qe=1/qe),c[1]=(y*ct-f*it-x*Ke)*qe,c[2]=(de*dt-le*Ue+be*Ve)*qe,c[3]=(H*Ue-N*dt-X*Ve)*qe,c[4]=(C*rt-w*it-k*lt)*qe,c[5]=(u*it-y*rt+x*lt)*qe,c[6]=(le*Se-Y*dt-be*xe)*qe,c[7]=(O*dt-H*Se+X*xe)*qe,c[8]=(w*ct-A*rt+k*yt)*qe,c[9]=(f*rt-u*ct-x*yt)*qe,c[10]=(Y*Ue-de*Se+be*Ie)*qe,c[11]=(N*Se-O*Ue-X*Ie)*qe,c[12]=(A*lt-w*Ke-C*yt)*qe,c[13]=(u*Ke-f*lt+y*yt)*qe,c[14]=(de*xe-Y*Ve-le*Ie)*qe,c[15]=(O*Ve-N*xe+H*Ie)*qe,c):null},l.isImageBitmap=st,l.isSafari=et,l.isWorker=Me,l.keysDifference=function(c,s){const u=[];for(const f in c)f in s||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){ts.isLoading()||ts.isLoaded()||ec()!=="deferred"||Kp()},l.makeRequest=Un,l.mapObject=U,l.mercatorXfromLng=cE,l.mercatorYfromLat=uE,l.mercatorZfromAltitude=hE,l.mul=O3,l.mul$1=function(c,s,u){return c[0]=s[0]*u[0],c[1]=s[1]*u[1],c[2]=s[2]*u[2],c[3]=s[3]*u[3],c},l.multiply=d2,l.nextPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},l.normalize=function(c,s){var u=s[0],f=s[1],y=s[2],x=u*u+f*f+y*y;return x>0&&(x=1/Math.sqrt(x)),c[0]=s[0]*x,c[1]=s[1]*x,c[2]=s[2]*x,c},l.number=Gt,l.ortho=function(c,s,u,f,y,x,w){var A=1/(s-u),C=1/(f-y),k=1/(x-w);return c[0]=-2*A,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*k,c[11]=0,c[12]=(s+u)*A,c[13]=(y+f)*C,c[14]=(w+x)*k,c[15]=1,c},l.parseCacheControl=Be,l.parseGlyphPbf=function(c){return new M_(c).readFields(OR,[])},l.pbf=M_,l.performSymbolLayout=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Or/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0].layout,u=c.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new Zn(c.bucket.zoom+1),c.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new Zn(c.bucket.zoom+1),c.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new Zn(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:k}=c.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Zn(C),c.canonical),u["text-size"].possiblyEvaluate(new Zn(k),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:k}=c.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Zn(C),c.canonical),u["icon-size"].possiblyEvaluate(new Zn(k),c.canonical)]}const y=s.get("text-line-height")*Kr,x=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),A=s.get("text-size");for(const C of c.bucket.features){const k=s.get("text-font").evaluate(C,{},c.canonical).join(","),O=A.evaluate(C,{},c.canonical),N=f.layoutTextSize.evaluate(C,{},c.canonical),H=f.layoutIconSize.evaluate(C,{},c.canonical),X={horizontal:{},vertical:void 0},Y=C.text;let de,le=[0,0];if(Y){const xe=Y.toString(),Se=s.get("text-letter-spacing").evaluate(C,{},c.canonical)*Kr,Ve=c_(xe)?Se:0,Ue=s.get("text-anchor").evaluate(C,{},c.canonical),dt=s.get("text-variable-anchor");if(!dt){const ct=s.get("text-radial-offset").evaluate(C,{},c.canonical);le=ct?nE(Ue,[ct*Kr,D_]):s.get("text-offset").evaluate(C,{},c.canonical).map(it=>it*Kr)}let yt=x?"center":s.get("text-justify").evaluate(C,{},c.canonical);const lt=s.get("symbol-placement"),rt=lt==="point"?s.get("text-max-width").evaluate(C,{},c.canonical)*Kr:0,Ke=()=>{c.bucket.allowVerticalPlacement&&au(xe)&&(X.vertical=pm(Y,c.glyphMap,c.glyphPositions,c.imagePositions,k,rt,y,Ue,"left",Ve,le,l.WritingMode.vertical,!0,lt,N,O))};if(!x&&dt){const ct=yt==="auto"?dt.map(qe=>O_(qe)):[yt];let it=!1;for(let qe=0;qe<ct.length;qe++){const Ct=ct[qe];if(!X.horizontal[Ct])if(it)X.horizontal[Ct]=X.horizontal[0];else{const wt=pm(Y,c.glyphMap,c.glyphPositions,c.imagePositions,k,rt,y,"center",Ct,Ve,le,l.WritingMode.horizontal,!1,lt,N,O);wt&&(X.horizontal[Ct]=wt,it=wt.positionedLines.length===1)}}Ke()}else{yt==="auto"&&(yt=O_(Ue));const ct=pm(Y,c.glyphMap,c.glyphPositions,c.imagePositions,k,rt,y,Ue,yt,Ve,le,l.WritingMode.horizontal,!1,lt,N,O);ct&&(X.horizontal[yt]=ct),Ke(),au(xe)&&x&&w&&(X.vertical=pm(Y,c.glyphMap,c.glyphPositions,c.imagePositions,k,rt,y,Ue,yt,Ve,le,l.WritingMode.vertical,!1,lt,N,O))}}let be=!1;if(C.icon&&C.icon.name){const xe=c.imageMap[C.icon.name];xe&&(de=jR(c.imagePositions[C.icon.name],s.get("icon-offset").evaluate(C,{},c.canonical),s.get("icon-anchor").evaluate(C,{},c.canonical)),be=!!xe.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=be:c.bucket.sdfIcons!==be&&se("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==c.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Ie=iE(X.horizontal)||X.vertical;c.bucket.iconsInText=!!Ie&&Ie.iconsInText,(Ie||de)&&XR(c.bucket,C,X,de,c.imageMap,f,N,H,le,be,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},l.perspective=function(c,s,u,f,y){var x,w=1/Math.tan(s/2);return c[0]=w/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=w,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,y!=null&&y!==1/0?(c[10]=(y+f)*(x=1/(f-y)),c[14]=2*y*f*x):(c[10]=-1,c[14]=-2*f),c},l.pick=function(c,s){const u={};for(let f=0;f<s.length;f++){const y=s[f];y in c&&(u[y]=c[y])}return u},l.plugin=ts,l.pointGeometry=Je,l.polygonIntersectsPolygon=a2,l.potpack=U2,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=pt,l.registerForPluginStateChange=function(c){return c({pluginStatus:wi,pluginURL:Io}),sd.on("pluginStateChange",c),c},l.renderColorRamp=v2,l.rotateX=function(c,s,u){var f=Math.sin(u),y=Math.cos(u),x=s[4],w=s[5],A=s[6],C=s[7],k=s[8],O=s[9],N=s[10],H=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=x*y+k*f,c[5]=w*y+O*f,c[6]=A*y+N*f,c[7]=C*y+H*f,c[8]=k*y-x*f,c[9]=O*y-w*f,c[10]=N*y-A*f,c[11]=H*y-C*f,c},l.rotateZ=function(c,s,u){var f=Math.sin(u),y=Math.cos(u),x=s[0],w=s[1],A=s[2],C=s[3],k=s[4],O=s[5],N=s[6],H=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=x*y+k*f,c[1]=w*y+O*f,c[2]=A*y+N*f,c[3]=C*y+H*f,c[4]=k*y-x*f,c[5]=O*y-w*f,c[6]=N*y-A*f,c[7]=H*y-C*f,c},l.scale=function(c,s,u){var f=u[0],y=u[1],x=u[2];return c[0]=s[0]*f,c[1]=s[1]*f,c[2]=s[2]*f,c[3]=s[3]*f,c[4]=s[4]*y,c[5]=s[5]*y,c[6]=s[6]*y,c[7]=s[7]*y,c[8]=s[8]*x,c[9]=s[9]*x,c[10]=s[10]*x,c[11]=s[11]*x,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.scale$1=function(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c[2]=s[2]*u,c},l.setCacheLimits=function(c,s){Xt=c,An=s},l.setRTLTextPlugin=function(c,s,u=!1){if(wi===td||wi===nd||wi===rd)throw new Error("setRTLTextPlugin cannot be called multiple times.");Io=Bt.resolveURL(c),wi=td,id=s,Xa(),u||Kp()},l.spec=Ee,l.sphericalToCartesian=function([c,s,u]){return s+=90,s*=Math.PI/180,u*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(u),y:c*Math.sin(s)*Math.sin(u),z:c*Math.cos(u)}},l.sqrLen=function(c){var s=c[0],u=c[1];return s*s+u*u},l.sub=function(c,s,u){return c[0]=s[0]-u[0],c[1]=s[1]-u[1],c[2]=s[2]-u[2],c},l.toEvaluationFeature=sc,l.transformMat3=function(c,s,u){var f=s[0],y=s[1],x=s[2];return c[0]=f*u[0]+y*u[3]+x*u[6],c[1]=f*u[1]+y*u[4]+x*u[7],c[2]=f*u[2]+y*u[5]+x*u[8],c},l.transformMat4=om,l.transformMat4$1=function(c,s,u){var f=s[0],y=s[1];return c[0]=u[0]*f+u[4]*y+u[12],c[1]=u[1]*f+u[5]*y+u[13],c},l.translate=function(c,s,u){var f,y,x,w,A,C,k,O,N,H,X,Y,de=u[0],le=u[1],be=u[2];return s===c?(c[12]=s[0]*de+s[4]*le+s[8]*be+s[12],c[13]=s[1]*de+s[5]*le+s[9]*be+s[13],c[14]=s[2]*de+s[6]*le+s[10]*be+s[14],c[15]=s[3]*de+s[7]*le+s[11]*be+s[15]):(y=s[1],x=s[2],w=s[3],A=s[4],C=s[5],k=s[6],O=s[7],N=s[8],H=s[9],X=s[10],Y=s[11],c[0]=f=s[0],c[1]=y,c[2]=x,c[3]=w,c[4]=A,c[5]=C,c[6]=k,c[7]=O,c[8]=N,c[9]=H,c[10]=X,c[11]=Y,c[12]=f*de+A*le+N*be+s[12],c[13]=y*de+C*le+H*be+s[13],c[14]=x*de+k*le+X*be+s[14],c[15]=w*de+O*le+Y*be+s[15]),c},l.triggerPluginCompletionEvent=Yp,l.unicodeBlockLookup=at,l.uniqueId=function(){return F++},l.validateCustomStyleLayer=function(c){const s=[],u=c.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},l.validateLight=Kh,l.validateStyle=Jl,l.vectorTile=Qa,l.warnOnce=se,l.wrap=z}),a(["./shared"],function(l){function m(te){const R=typeof te;if(R==="number"||R==="boolean"||R==="string"||te==null)return JSON.stringify(te);if(Array.isArray(te)){let Q="[";for(const he of te)Q+=`${m(he)},`;return`${Q}]`}const j=Object.keys(te).sort();let K="{";for(let Q=0;Q<j.length;Q++)K+=`${JSON.stringify(j[Q])}:${m(te[j[Q]])},`;return`${K}}`}function v(te){let R="";for(const j of l.refProperties)R+=`/${m(te[j])}`;return R}class E{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,j){for(const Q of R){this._layerConfigs[Q.id]=Q;const he=this._layers[Q.id]=l.createStyleLayer(Q);he._featureFilter=l.createFilter(he.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(const Q of j)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const K=function(Q,he){const fe={};for(let ce=0;ce<Q.length;ce++){const ye=he&&he[Q[ce].id]||v(Q[ce]);he&&(he[Q[ce].id]=ye);let Ae=fe[ye];Ae||(Ae=fe[ye]=[]),Ae.push(Q[ce])}const ue=[];for(const ce in fe)ue.push(fe[ce]);return ue}(Object.values(this._layerConfigs),this.keyCache);for(const Q of K){const he=Q.map(je=>this._layers[je.id]),fe=he[0];if(fe.visibility==="none")continue;const ue=fe.source||"";let ce=this.familiesBySource[ue];ce||(ce=this.familiesBySource[ue]={});const ye=fe.sourceLayer||"_geojsonTileLayer";let Ae=ce[ye];Ae||(Ae=ce[ye]=[]),Ae.push(he)}}}class T{constructor(R){const j={},K=[];for(const ue in R){const ce=R[ue],ye=j[ue]={};for(const Ae in ce){const je=ce[+Ae];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Le={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};K.push(Le),ye[Ae]={rect:Le,metrics:je.metrics}}}const{w:Q,h:he}=l.potpack(K),fe=new l.AlphaImage({width:Q||1,height:he||1});for(const ue in R){const ce=R[ue];for(const ye in ce){const Ae=ce[+ye];if(!Ae||Ae.bitmap.width===0||Ae.bitmap.height===0)continue;const je=j[ue][ye].rect;l.AlphaImage.copy(Ae.bitmap,fe,{x:0,y:0},{x:je.x+1,y:je.y+1},Ae.bitmap)}}this.image=fe,this.positions=j}}l.register("GlyphAtlas",T);class S{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,j,K,Q,he){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const fe=new l.DictionaryCoder(Object.keys(R.layers).sort()),ue=new l.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];const ce={},ye={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},Ae=j.familiesBySource[this.source];for(const It in Ae){const Dt=R.layers[It];if(!Dt)continue;Dt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=fe.encode(It),Yt=[];for(let kn=0;kn<Dt.length;kn++){const Ln=Dt.feature(kn),zr=ue.getId(Ln,It);Yt.push({feature:Ln,id:zr,index:kn,sourceLayerIndex:Ht})}for(const kn of Ae[It]){const Ln=kn[0];Ln.source!==this.source&&l.warnOnce(`layer.source = ${Ln.source} does not equal this.source = ${this.source}`),Ln.minzoom&&this.zoom<Math.floor(Ln.minzoom)||Ln.maxzoom&&this.zoom>=Ln.maxzoom||Ln.visibility!=="none"&&(z(kn,this.zoom,K),(ce[Ln.id]=Ln.createBucket({index:ue.bucketLayerIDs.length,layers:kn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source})).populate(Yt,ye,this.tileID.canonical),ue.bucketLayerIDs.push(kn.map(zr=>zr.id)))}}let je,Le,ft,gt;const ot=l.mapObject(ye.glyphDependencies,It=>Object.keys(It).map(Number));Object.keys(ot).length?Q.send("getGlyphs",{uid:this.uid,stacks:ot},(It,Dt)=>{je||(je=It,Le=Dt,jt.call(this))}):Le={};const Pt=Object.keys(ye.iconDependencies);Pt.length?Q.send("getImages",{icons:Pt,source:this.source,tileID:this.tileID,type:"icons"},(It,Dt)=>{je||(je=It,ft=Dt,jt.call(this))}):ft={};const bt=Object.keys(ye.patternDependencies);function jt(){if(je)return he(je);if(Le&&ft&&gt){const It=new T(Le),Dt=new l.ImageAtlas(ft,gt);for(const Ht in ce){const Yt=ce[Ht];Yt instanceof l.SymbolBucket?(z(Yt.layers,this.zoom,K),l.performSymbolLayout({bucket:Yt,glyphMap:Le,glyphPositions:It.positions,imageMap:ft,imagePositions:Dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Yt.hasPattern&&(Yt instanceof l.LineBucket||Yt instanceof l.FillBucket||Yt instanceof l.FillExtrusionBucket)&&(z(Yt.layers,this.zoom,K),Yt.addFeatures(ye,this.tileID.canonical,Dt.patternPositions))}this.status="done",he(null,{buckets:Object.values(ce).filter(Ht=>!Ht.isEmpty()),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:It.image,imageAtlas:Dt,glyphMap:this.returnDependencies?Le:null,iconMap:this.returnDependencies?ft:null,glyphPositions:this.returnDependencies?It.positions:null})}}bt.length?Q.send("getImages",{icons:bt,source:this.source,tileID:this.tileID,type:"patterns"},(It,Dt)=>{je||(je=It,gt=Dt,jt.call(this))}):gt={},jt.call(this)}}function z(te,R,j){const K=new l.EvaluationParameters(R);for(const Q of te)Q.recalculate(K,j)}function D(te,R){const j=l.getArrayBuffer(te.request,(K,Q,he,fe)=>{K?R(K):Q&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(Q)),rawData:Q,cacheControl:he,expires:fe})});return()=>{j.cancel(),R()}}class F{constructor(R,j,K,Q){this.actor=R,this.layerIndex=j,this.availableImages=K,this.loadVectorData=Q||D,this.loading={},this.loaded={}}loadTile(R,j){const K=R.uid;this.loading||(this.loading={});const Q=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),he=this.loading[K]=new S(R);he.abort=this.loadVectorData(R,(fe,ue)=>{if(delete this.loading[K],fe||!ue)return he.status="done",this.loaded[K]=he,j(fe);const ce=ue.rawData,ye={};ue.expires&&(ye.expires=ue.expires),ue.cacheControl&&(ye.cacheControl=ue.cacheControl);const Ae={};if(Q){const je=Q.finish();je&&(Ae.resourceTiming=JSON.parse(JSON.stringify(je)))}he.vectorTile=ue.vectorTile,he.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(je,Le)=>{if(je||!Le)return j(je);j(null,l.extend({rawTileData:ce.slice(0)},Le,ye,Ae))}),this.loaded=this.loaded||{},this.loaded[K]=he})}reloadTile(R,j){const K=this.loaded,Q=R.uid,he=this;if(K&&K[Q]){const fe=K[Q];fe.showCollisionBoxes=R.showCollisionBoxes;const ue=(ce,ye)=>{const Ae=fe.reloadCallback;Ae&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,he.layerIndex,this.availableImages,he.actor,Ae)),j(ce,ye)};fe.status==="parsing"?fe.reloadCallback=ue:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}}abortTile(R,j){const K=this.loading,Q=R.uid;K&&K[Q]&&K[Q].abort&&(K[Q].abort(),delete K[Q]),j()}removeTile(R,j){const K=this.loaded,Q=R.uid;K&&K[Q]&&delete K[Q],j()}}class J{constructor(){this.loaded={}}loadTile(R,j){const{uid:K,encoding:Q,rawImageData:he}=R,fe=l.isImageBitmap(he)?this.getImageData(he):he,ue=new l.DEMData(K,fe,Q);this.loaded=this.loaded||{},this.loaded[K]=ue,j(null,ue)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const j=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:j.width,height:j.height},j.data)}removeTile(R){const j=this.loaded,K=R.uid;j&&j[K]&&delete j[K]}}var U=function te(R,j){var K,Q=R&&R.type;if(Q==="FeatureCollection")for(K=0;K<R.features.length;K++)te(R.features[K],j);else if(Q==="GeometryCollection")for(K=0;K<R.geometries.length;K++)te(R.geometries[K],j);else if(Q==="Feature")te(R.geometry,j);else if(Q==="Polygon")V(R.coordinates,j);else if(Q==="MultiPolygon")for(K=0;K<R.coordinates.length;K++)V(R.coordinates[K],j);return R};function V(te,R){if(te.length!==0){G(te[0],R);for(var j=1;j<te.length;j++)G(te[j],!R)}}function G(te,R){for(var j=0,K=0,Q=0,he=te.length,fe=he-1;Q<he;fe=Q++){var ue=(te[Q][0]-te[fe][0])*(te[fe][1]+te[Q][1]),ce=j+ue;K+=Math.abs(j)>=Math.abs(ue)?j-ce+ue:ue-ce+j,j=ce}j+K>=0!=!!R&&te.reverse()}const ee=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class se{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const j of this._feature.geometry)R.push([new l.pointGeometry(j[0],j[1])]);return R}{const R=[];for(const j of this._feature.geometry){const K=[];for(const Q of j)K.push(new l.pointGeometry(Q[0],Q[1]));R.push(K)}return R}}toGeoJSON(R,j,K){return ee.call(this,R,j,K)}}class me{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new se(this._features[R])}}var ve={exports:{}},Me=l.pointGeometry,Be=l.vectorTile.VectorTileFeature,ze=Oe;function Oe(te,R){this.options=R||{},this.features=te,this.length=te.length}function tt(te,R){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=R||4096}Oe.prototype.feature=function(te){return new tt(this.features[te],this.options.extent)},tt.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var R=0;R<te.length;R++){for(var j=te[R],K=[],Q=0;Q<j.length;Q++)K.push(new Me(j[Q][0],j[Q][1]));this.geometry.push(K)}return this.geometry},tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,R=1/0,j=-1/0,K=1/0,Q=-1/0,he=0;he<te.length;he++)for(var fe=te[he],ue=0;ue<fe.length;ue++){var ce=fe[ue];R=Math.min(R,ce.x),j=Math.max(j,ce.x),K=Math.min(K,ce.y),Q=Math.max(Q,ce.y)}return[R,K,j,Q]},tt.prototype.toGeoJSON=Be.prototype.toGeoJSON;var et=l.pbf,st=ze;function Bt(te){var R=new et;return function(j,K){for(var Q in j.layers)K.writeMessage(3,Je,j.layers[Q])}(te,R),R.finish()}function Je(te,R){var j;R.writeVarintField(15,te.version||1),R.writeStringField(1,te.name||""),R.writeVarintField(5,te.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<te.length;j++)K.feature=te.feature(j),R.writeMessage(2,en,K);var Q=K.keys;for(j=0;j<Q.length;j++)R.writeStringField(3,Q[j]);var he=K.values;for(j=0;j<he.length;j++)R.writeMessage(4,Xt,he[j])}function en(te,R){var j=te.feature;j.id!==void 0&&R.writeVarintField(1,j.id),R.writeMessage(2,We,te),R.writeVarintField(3,j.type),R.writeMessage(4,tn,j)}function We(te,R){var j=te.feature,K=te.keys,Q=te.values,he=te.keycache,fe=te.valuecache;for(var ue in j.properties){var ce=j.properties[ue],ye=he[ue];if(ce!==null){ye===void 0&&(K.push(ue),he[ue]=ye=K.length-1),R.writeVarint(ye);var Ae=typeof ce;Ae!=="string"&&Ae!=="boolean"&&Ae!=="number"&&(ce=JSON.stringify(ce));var je=Ae+":"+ce,Le=fe[je];Le===void 0&&(Q.push(ce),fe[je]=Le=Q.length-1),R.writeVarint(Le)}}}function Qe(te,R){return(R<<3)+(7&te)}function Tt(te){return te<<1^te>>31}function tn(te,R){for(var j=te.loadGeometry(),K=te.type,Q=0,he=0,fe=j.length,ue=0;ue<fe;ue++){var ce=j[ue],ye=1;K===1&&(ye=ce.length),R.writeVarint(Qe(1,ye));for(var Ae=K===3?ce.length-1:ce.length,je=0;je<Ae;je++){je===1&&K!==1&&R.writeVarint(Qe(2,Ae-1));var Le=ce[je].x-Q,ft=ce[je].y-he;R.writeVarint(Tt(Le)),R.writeVarint(Tt(ft)),Q+=Le,he+=ft}K===3&&R.writeVarint(Qe(7,1))}}function Xt(te,R){var j=typeof te;j==="string"?R.writeStringField(1,te):j==="boolean"?R.writeBooleanField(7,te):j==="number"&&(te%1!=0?R.writeDoubleField(3,te):te<0?R.writeSVarintField(6,te):R.writeVarintField(5,te))}function An(te,R,j,K,Q,he){if(Q-K<=j)return;const fe=K+Q>>1;xn(te,R,fe,K,Q,he%2),An(te,R,j,K,fe-1,he+1),An(te,R,j,fe+1,Q,he+1)}function xn(te,R,j,K,Q,he){for(;Q>K;){if(Q-K>600){const ye=Q-K+1,Ae=j-K+1,je=Math.log(ye),Le=.5*Math.exp(2*je/3),ft=.5*Math.sqrt(je*Le*(ye-Le)/ye)*(Ae-ye/2<0?-1:1);xn(te,R,j,Math.max(K,Math.floor(j-Ae*Le/ye+ft)),Math.min(Q,Math.floor(j+(ye-Ae)*Le/ye+ft)),he)}const fe=R[2*j+he];let ue=K,ce=Q;for(zn(te,R,K,j),R[2*Q+he]>fe&&zn(te,R,K,Q);ue<ce;){for(zn(te,R,ue,ce),ue++,ce--;R[2*ue+he]<fe;)ue++;for(;R[2*ce+he]>fe;)ce--}R[2*K+he]===fe?zn(te,R,K,ce):(ce++,zn(te,R,ce,Q)),ce<=j&&(K=ce+1),j<=ce&&(Q=ce-1)}}function zn(te,R,j,K){Dn(te,j,K),Dn(R,2*j,2*K),Dn(R,2*j+1,2*K+1)}function Dn(te,R,j){const K=te[R];te[R]=te[j],te[j]=K}function ln(te,R,j,K){const Q=te-j,he=R-K;return Q*Q+he*he}ve.exports=Bt,ve.exports.fromVectorTileJs=Bt,ve.exports.fromGeojsonVt=function(te,R){R=R||{};var j={};for(var K in te)j[K]=new st(te[K].features,R),j[K].name=K,j[K].version=R.version,j[K].extent=R.extent;return Bt({layers:j})},ve.exports.GeoJSONWrapper=st;const Wn=te=>te[0],zt=te=>te[1];class Tn{constructor(R,j=Wn,K=zt,Q=64,he=Float64Array){this.nodeSize=Q,this.points=R;const fe=R.length<65536?Uint16Array:Uint32Array,ue=this.ids=new fe(R.length),ce=this.coords=new he(2*R.length);for(let ye=0;ye<R.length;ye++)ue[ye]=ye,ce[2*ye]=j(R[ye]),ce[2*ye+1]=K(R[ye]);An(ue,ce,Q,0,ue.length-1,0)}range(R,j,K,Q){return function(he,fe,ue,ce,ye,Ae,je){const Le=[0,he.length-1,0],ft=[];let gt,ot;for(;Le.length;){const Pt=Le.pop(),bt=Le.pop(),jt=Le.pop();if(bt-jt<=je){for(let Ht=jt;Ht<=bt;Ht++)gt=fe[2*Ht],ot=fe[2*Ht+1],gt>=ue&&gt<=ye&&ot>=ce&&ot<=Ae&&ft.push(he[Ht]);continue}const It=Math.floor((jt+bt)/2);gt=fe[2*It],ot=fe[2*It+1],gt>=ue&&gt<=ye&&ot>=ce&&ot<=Ae&&ft.push(he[It]);const Dt=(Pt+1)%2;(Pt===0?ue<=gt:ce<=ot)&&(Le.push(jt),Le.push(It-1),Le.push(Dt)),(Pt===0?ye>=gt:Ae>=ot)&&(Le.push(It+1),Le.push(bt),Le.push(Dt))}return ft}(this.ids,this.coords,R,j,K,Q,this.nodeSize)}within(R,j,K){return function(Q,he,fe,ue,ce,ye){const Ae=[0,Q.length-1,0],je=[],Le=ce*ce;for(;Ae.length;){const ft=Ae.pop(),gt=Ae.pop(),ot=Ae.pop();if(gt-ot<=ye){for(let Dt=ot;Dt<=gt;Dt++)ln(he[2*Dt],he[2*Dt+1],fe,ue)<=Le&&je.push(Q[Dt]);continue}const Pt=Math.floor((ot+gt)/2),bt=he[2*Pt],jt=he[2*Pt+1];ln(bt,jt,fe,ue)<=Le&&je.push(Q[Pt]);const It=(ft+1)%2;(ft===0?fe-ce<=bt:ue-ce<=jt)&&(Ae.push(ot),Ae.push(Pt-1),Ae.push(It)),(ft===0?fe+ce>=bt:ue+ce>=jt)&&(Ae.push(Pt+1),Ae.push(gt),Ae.push(It))}return je}(this.ids,this.coords,R,j,K,this.nodeSize)}}const Lr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},Hn=Math.fround||(pn=new Float32Array(1),te=>(pn[0]=+te,pn[0]));var pn;class un{constructor(R){this.options=ui(Object.create(Lr),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:j,minZoom:K,maxZoom:Q,nodeSize:he}=this.options;j&&console.time("total time");const fe=`prepare ${R.length} points`;j&&console.time(fe),this.points=R;let ue=[];for(let ce=0;ce<R.length;ce++)R[ce].geometry&&ue.push(Un(R[ce],ce));this.trees[Q+1]=new Tn(ue,Ki,Rr,he,Float32Array),j&&console.timeEnd(fe);for(let ce=Q;ce>=K;ce--){const ye=+Date.now();ue=this._cluster(ue,ce),this.trees[ce]=new Tn(ue,Ki,Rr,he,Float32Array),j&&console.log("z%d: %d clusters in %dms",ce,ue.length,+Date.now()-ye)}return j&&console.timeEnd("total time"),this}getClusters(R,j){let K=((R[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,R[1]));let he=R[2]===180?180:((R[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)K=-180,he=180;else if(K>he){const Ae=this.getClusters([K,Q,180,fe],j),je=this.getClusters([-180,Q,he,fe],j);return Ae.concat(je)}const ue=this.trees[this._limitZoom(j)],ce=ue.range(Vt(K),cn(fe),Vt(he),cn(Q)),ye=[];for(const Ae of ce){const je=ue.points[Ae];ye.push(je.numPoints?Jn(je):this.points[je.index])}return ye}getChildren(R){const j=this._getOriginId(R),K=this._getOriginZoom(R),Q="No cluster with the specified id.",he=this.trees[K];if(!he)throw new Error(Q);const fe=he.points[j];if(!fe)throw new Error(Q);const ue=this.options.radius/(this.options.extent*Math.pow(2,K-1)),ce=he.within(fe.x,fe.y,ue),ye=[];for(const Ae of ce){const je=he.points[Ae];je.parentId===R&&ye.push(je.numPoints?Jn(je):this.points[je.index])}if(ye.length===0)throw new Error(Q);return ye}getLeaves(R,j,K){const Q=[];return this._appendLeaves(Q,R,j=j||10,K=K||0,0),Q}getTile(R,j,K){const Q=this.trees[this._limitZoom(R)],he=Math.pow(2,R),{extent:fe,radius:ue}=this.options,ce=ue/fe,ye=(K-ce)/he,Ae=(K+1+ce)/he,je={features:[]};return this._addTileFeatures(Q.range((j-ce)/he,ye,(j+1+ce)/he,Ae),Q.points,j,K,he,je),j===0&&this._addTileFeatures(Q.range(1-ce/he,ye,1,Ae),Q.points,he,K,he,je),j===he-1&&this._addTileFeatures(Q.range(0,ye,ce/he,Ae),Q.points,-1,K,he,je),je.features.length?je:null}getClusterExpansionZoom(R){let j=this._getOriginZoom(R)-1;for(;j<=this.options.maxZoom;){const K=this.getChildren(R);if(j++,K.length!==1)break;R=K[0].properties.cluster_id}return j}_appendLeaves(R,j,K,Q,he){const fe=this.getChildren(j);for(const ue of fe){const ce=ue.properties;if(ce&&ce.cluster?he+ce.point_count<=Q?he+=ce.point_count:he=this._appendLeaves(R,ce.cluster_id,K,Q,he):he<Q?he++:R.push(ue),R.length===K)break}return he}_addTileFeatures(R,j,K,Q,he,fe){for(const ue of R){const ce=j[ue],ye=ce.numPoints;let Ae,je,Le;if(ye)Ae=Ur(ce),je=ce.x,Le=ce.y;else{const ot=this.points[ce.index];Ae=ot.properties,je=Vt(ot.geometry.coordinates[0]),Le=cn(ot.geometry.coordinates[1])}const ft={type:1,geometry:[[Math.round(this.options.extent*(je*he-K)),Math.round(this.options.extent*(Le*he-Q))]],tags:Ae};let gt;ye?gt=ce.id:this.options.generateId?gt=ce.index:this.points[ce.index].id&&(gt=this.points[ce.index].id),gt!==void 0&&(ft.id=gt),fe.features.push(ft)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,j){const K=[],{radius:Q,extent:he,reduce:fe,minPoints:ue}=this.options,ce=Q/(he*Math.pow(2,j));for(let ye=0;ye<R.length;ye++){const Ae=R[ye];if(Ae.zoom<=j)continue;Ae.zoom=j;const je=this.trees[j+1],Le=je.within(Ae.x,Ae.y,ce),ft=Ae.numPoints||1;let gt=ft;for(const ot of Le){const Pt=je.points[ot];Pt.zoom>j&&(gt+=Pt.numPoints||1)}if(gt>ft&&gt>=ue){let ot=Ae.x*ft,Pt=Ae.y*ft,bt=fe&&ft>1?this._map(Ae,!0):null;const jt=(ye<<5)+(j+1)+this.points.length;for(const It of Le){const Dt=je.points[It];if(Dt.zoom<=j)continue;Dt.zoom=j;const Ht=Dt.numPoints||1;ot+=Dt.x*Ht,Pt+=Dt.y*Ht,Dt.parentId=jt,fe&&(bt||(bt=this._map(Ae,!0)),fe(bt,this._map(Dt)))}Ae.parentId=jt,K.push(Jt(ot/gt,Pt/gt,jt,gt,bt))}else if(K.push(Ae),gt>1)for(const ot of Le){const Pt=je.points[ot];Pt.zoom<=j||(Pt.zoom=j,K.push(Pt))}}return K}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,j){if(R.numPoints)return j?ui({},R.properties):R.properties;const K=this.points[R.index].properties,Q=this.options.map(K);return j&&Q===K?ui({},Q):Q}}function Jt(te,R,j,K,Q){return{x:Hn(te),y:Hn(R),zoom:1/0,id:j,parentId:-1,numPoints:K,properties:Q}}function Un(te,R){const[j,K]=te.geometry.coordinates;return{x:Hn(Vt(j)),y:Hn(cn(K)),zoom:1/0,index:R,parentId:-1}}function Jn(te){return{type:"Feature",id:te.id,properties:Ur(te),geometry:{type:"Point",coordinates:[(R=te.x,360*(R-.5)),yn(te.y)]}};var R}function Ur(te){const R=te.numPoints,j=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return ui(ui({},te.properties),{cluster:!0,cluster_id:te.id,point_count:R,point_count_abbreviated:j})}function Vt(te){return te/360+.5}function cn(te){const R=Math.sin(te*Math.PI/180),j=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return j<0?0:j>1?1:j}function yn(te){const R=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function ui(te,R){for(const j in R)te[j]=R[j];return te}function Ki(te){return te.x}function Rr(te){return te.y}function Ye(te,R,j,K){for(var Q,he=K,fe=j-R>>1,ue=j-R,ce=te[R],ye=te[R+1],Ae=te[j],je=te[j+1],Le=R+3;Le<j;Le+=3){var ft=St(te[Le],te[Le+1],ce,ye,Ae,je);if(ft>he)Q=Le,he=ft;else if(ft===he){var gt=Math.abs(Le-fe);gt<ue&&(Q=Le,ue=gt)}}he>K&&(Q-R>3&&Ye(te,R,Q,K),te[Q+2]=he,j-Q>3&&Ye(te,Q,j,K))}function St(te,R,j,K,Q,he){var fe=Q-j,ue=he-K;if(fe!==0||ue!==0){var ce=((te-j)*fe+(R-K)*ue)/(fe*fe+ue*ue);ce>1?(j=Q,K=he):ce>0&&(j+=fe*ce,K+=ue*ce)}return(fe=te-j)*fe+(ue=R-K)*ue}function Rt(te,R,j,K){var Q={id:te===void 0?null:te,type:R,geometry:j,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var fe=he.geometry,ue=he.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Ee(he,fe);else if(ue==="Polygon"||ue==="MultiLineString")for(var ce=0;ce<fe.length;ce++)Ee(he,fe[ce]);else if(ue==="MultiPolygon")for(ce=0;ce<fe.length;ce++)for(var ye=0;ye<fe[ce].length;ye++)Ee(he,fe[ce][ye])}(Q),Q}function Ee(te,R){for(var j=0;j<R.length;j+=3)te.minX=Math.min(te.minX,R[j]),te.minY=Math.min(te.minY,R[j+1]),te.maxX=Math.max(te.maxX,R[j]),te.maxY=Math.max(te.maxY,R[j+1])}function Re(te,R,j,K){if(R.geometry){var Q=R.geometry.coordinates,he=R.geometry.type,fe=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),ue=[],ce=R.id;if(j.promoteId?ce=R.properties[j.promoteId]:j.generateId&&(ce=K||0),he==="Point")On(Q,ue);else if(he==="MultiPoint")for(var ye=0;ye<Q.length;ye++)On(Q[ye],ue);else if(he==="LineString")Ut(Q,ue,fe,!1);else if(he==="MultiLineString"){if(j.lineMetrics){for(ye=0;ye<Q.length;ye++)Ut(Q[ye],ue=[],fe,!1),te.push(Rt(ce,"LineString",ue,R.properties));return}xt(Q,ue,fe,!1)}else if(he==="Polygon")xt(Q,ue,fe,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(ye=0;ye<R.geometry.geometries.length;ye++)Re(te,{id:ce,geometry:R.geometry.geometries[ye],properties:R.properties},j,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<Q.length;ye++){var Ae=[];xt(Q[ye],Ae,fe,!0),ue.push(Ae)}}te.push(Rt(ce,he,ue,R.properties))}}function On(te,R){R.push(rn(te[0])),R.push(Vn(te[1])),R.push(0)}function Ut(te,R,j,K){for(var Q,he,fe=0,ue=0;ue<te.length;ue++){var ce=rn(te[ue][0]),ye=Vn(te[ue][1]);R.push(ce),R.push(ye),R.push(0),ue>0&&(fe+=K?(Q*ye-ce*he)/2:Math.sqrt(Math.pow(ce-Q,2)+Math.pow(ye-he,2))),Q=ce,he=ye}var Ae=R.length-3;R[2]=1,Ye(R,0,Ae,j),R[Ae+2]=1,R.size=Math.abs(fe),R.start=0,R.end=R.size}function xt(te,R,j,K){for(var Q=0;Q<te.length;Q++){var he=[];Ut(te[Q],he,j,K),R.push(he)}}function rn(te){return te/360+.5}function Vn(te){var R=Math.sin(te*Math.PI/180),j=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return j<0?0:j>1?1:j}function yr(te,R,j,K,Q,he,fe,ue){if(K/=R,he>=(j/=R)&&fe<K)return te;if(fe<j||he>=K)return null;for(var ce=[],ye=0;ye<te.length;ye++){var Ae=te[ye],je=Ae.geometry,Le=Ae.type,ft=Q===0?Ae.minX:Ae.minY,gt=Q===0?Ae.maxX:Ae.maxY;if(ft>=j&&gt<K)ce.push(Ae);else if(!(gt<j||ft>=K)){var ot=[];if(Le==="Point"||Le==="MultiPoint")Qn(je,ot,j,K,Q);else if(Le==="LineString")Ze(je,ot,j,K,Q,!1,ue.lineMetrics);else if(Le==="MultiLineString")Ot(je,ot,j,K,Q,!1);else if(Le==="Polygon")Ot(je,ot,j,K,Q,!0);else if(Le==="MultiPolygon")for(var Pt=0;Pt<je.length;Pt++){var bt=[];Ot(je[Pt],bt,j,K,Q,!0),bt.length&&ot.push(bt)}if(ot.length){if(ue.lineMetrics&&Le==="LineString"){for(Pt=0;Pt<ot.length;Pt++)ce.push(Rt(Ae.id,Le,ot[Pt],Ae.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(ot.length===1?(Le="LineString",ot=ot[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=ot.length===3?"Point":"MultiPoint"),ce.push(Rt(Ae.id,Le,ot,Ae.tags))}}}return ce.length?ce:null}function Qn(te,R,j,K,Q){for(var he=0;he<te.length;he+=3){var fe=te[he+Q];fe>=j&&fe<=K&&(R.push(te[he]),R.push(te[he+1]),R.push(te[he+2]))}}function Ze(te,R,j,K,Q,he,fe){for(var ue,ce,ye=Ft(te),Ae=Q===0?vi:kt,je=te.start,Le=0;Le<te.length-3;Le+=3){var ft=te[Le],gt=te[Le+1],ot=te[Le+2],Pt=te[Le+3],bt=te[Le+4],jt=Q===0?ft:gt,It=Q===0?Pt:bt,Dt=!1;fe&&(ue=Math.sqrt(Math.pow(ft-Pt,2)+Math.pow(gt-bt,2))),jt<j?It>j&&(ce=Ae(ye,ft,gt,Pt,bt,j),fe&&(ye.start=je+ue*ce)):jt>K?It<K&&(ce=Ae(ye,ft,gt,Pt,bt,K),fe&&(ye.start=je+ue*ce)):hr(ye,ft,gt,ot),It<j&&jt>=j&&(ce=Ae(ye,ft,gt,Pt,bt,j),Dt=!0),It>K&&jt<=K&&(ce=Ae(ye,ft,gt,Pt,bt,K),Dt=!0),!he&&Dt&&(fe&&(ye.end=je+ue*ce),R.push(ye),ye=Ft(te)),fe&&(je+=ue)}var Ht=te.length-3;ft=te[Ht],gt=te[Ht+1],ot=te[Ht+2],(jt=Q===0?ft:gt)>=j&&jt<=K&&hr(ye,ft,gt,ot),Ht=ye.length-3,he&&Ht>=3&&(ye[Ht]!==ye[0]||ye[Ht+1]!==ye[1])&&hr(ye,ye[0],ye[1],ye[2]),ye.length&&R.push(ye)}function Ft(te){var R=[];return R.size=te.size,R.start=te.start,R.end=te.end,R}function Ot(te,R,j,K,Q,he){for(var fe=0;fe<te.length;fe++)Ze(te[fe],R,j,K,Q,he,!1)}function hr(te,R,j,K){te.push(R),te.push(j),te.push(K)}function vi(te,R,j,K,Q,he){var fe=(he-R)/(K-R);return te.push(he),te.push(j+(Q-j)*fe),te.push(1),fe}function kt(te,R,j,K,Q,he){var fe=(he-j)/(Q-j);return te.push(R+(K-R)*fe),te.push(he),te.push(1),fe}function Zr(te,R){for(var j=[],K=0;K<te.length;K++){var Q,he=te[K],fe=he.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Q=or(he.geometry,R);else if(fe==="MultiLineString"||fe==="Polygon"){Q=[];for(var ue=0;ue<he.geometry.length;ue++)Q.push(or(he.geometry[ue],R))}else if(fe==="MultiPolygon")for(Q=[],ue=0;ue<he.geometry.length;ue++){for(var ce=[],ye=0;ye<he.geometry[ue].length;ye++)ce.push(or(he.geometry[ue][ye],R));Q.push(ce)}j.push(Rt(he.id,fe,Q,he.tags))}return j}function or(te,R){var j=[];j.size=te.size,te.start!==void 0&&(j.start=te.start,j.end=te.end);for(var K=0;K<te.length;K+=3)j.push(te[K]+R,te[K+1],te[K+2]);return j}function Ji(te,R){if(te.transformed)return te;var j,K,Q,he=1<<te.z,fe=te.x,ue=te.y;for(j=0;j<te.features.length;j++){var ce=te.features[j],ye=ce.geometry,Ae=ce.type;if(ce.geometry=[],Ae===1)for(K=0;K<ye.length;K+=2)ce.geometry.push(er(ye[K],ye[K+1],R,he,fe,ue));else for(K=0;K<ye.length;K++){var je=[];for(Q=0;Q<ye[K].length;Q+=2)je.push(er(ye[K][Q],ye[K][Q+1],R,he,fe,ue));ce.geometry.push(je)}}return te.transformed=!0,te}function er(te,R,j,K,Q,he){return[Math.round(j*(te*K-Q)),Math.round(j*(R*K-he))]}function dr(te,R,j,K,Q){for(var he=R===Q.maxZoom?0:Q.tolerance/((1<<R)*Q.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:K,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<te.length;ue++){fe.numFeatures++,sn(fe,te[ue],he,Q);var ce=te[ue].minX,ye=te[ue].minY,Ae=te[ue].maxX,je=te[ue].maxY;ce<fe.minX&&(fe.minX=ce),ye<fe.minY&&(fe.minY=ye),Ae>fe.maxX&&(fe.maxX=Ae),je>fe.maxY&&(fe.maxY=je)}return fe}function sn(te,R,j,K){var Q=R.geometry,he=R.type,fe=[];if(he==="Point"||he==="MultiPoint")for(var ue=0;ue<Q.length;ue+=3)fe.push(Q[ue]),fe.push(Q[ue+1]),te.numPoints++,te.numSimplified++;else if(he==="LineString")Qi(fe,Q,te,j,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(ue=0;ue<Q.length;ue++)Qi(fe,Q[ue],te,j,he==="Polygon",ue===0);else if(he==="MultiPolygon")for(var ce=0;ce<Q.length;ce++){var ye=Q[ce];for(ue=0;ue<ye.length;ue++)Qi(fe,ye[ue],te,j,!0,ue===0)}if(fe.length){var Ae=R.tags||null;if(he==="LineString"&&K.lineMetrics){for(var je in Ae={},R.tags)Ae[je]=R.tags[je];Ae.mapbox_clip_start=Q.start/Q.size,Ae.mapbox_clip_end=Q.end/Q.size}var Le={geometry:fe,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:Ae};R.id!==null&&(Le.id=R.id),te.features.push(Le)}}function Qi(te,R,j,K,Q,he){var fe=K*K;if(K>0&&R.size<(Q?fe:K))j.numPoints+=R.length/3;else{for(var ue=[],ce=0;ce<R.length;ce+=3)(K===0||R[ce+2]>fe)&&(j.numSimplified++,ue.push(R[ce]),ue.push(R[ce+1])),j.numPoints++;Q&&function(ye,Ae){for(var je=0,Le=0,ft=ye.length,gt=ft-2;Le<ft;gt=Le,Le+=2)je+=(ye[Le]-ye[gt])*(ye[Le+1]+ye[gt+1]);if(je>0===Ae)for(Le=0,ft=ye.length;Le<ft/2;Le+=2){var ot=ye[Le],Pt=ye[Le+1];ye[Le]=ye[ft-2-Le],ye[Le+1]=ye[ft-1-Le],ye[ft-2-Le]=ot,ye[ft-1-Le]=Pt}}(ue,he),te.push(ue)}}function xi(te,R){var j=(R=this.options=function(Q,he){for(var fe in he)Q[fe]=he[fe];return Q}(Object.create(this.options),R)).debug;if(j&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(Q,he){var fe=[];if(Q.type==="FeatureCollection")for(var ue=0;ue<Q.features.length;ue++)Re(fe,Q.features[ue],he,ue);else Re(fe,Q.type==="Feature"?Q:{geometry:Q},he);return fe}(te,R);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(Q,he){var fe=he.buffer/he.extent,ue=Q,ce=yr(Q,1,-1-fe,fe,0,-1,2,he),ye=yr(Q,1,1-fe,2+fe,0,-1,2,he);return(ce||ye)&&(ue=yr(Q,1,-fe,1+fe,0,-1,2,he)||[],ce&&(ue=Zr(ce,1).concat(ue)),ye&&(ue=ue.concat(Zr(ye,-1)))),ue}(K,R),K.length&&this.splitTile(K,0,0,0),j&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bi(te,R,j){return 32*((1<<te)*j+R)+te}function fs(te,R){const j=te.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const K=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!K)return R(null,null);const Q=new me(K.features);let he=ve.exports(Q);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),R(null,{vectorTile:Q,rawData:he.buffer})}xi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xi.prototype.splitTile=function(te,R,j,K,Q,he,fe){for(var ue=[te,R,j,K],ce=this.options,ye=ce.debug;ue.length;){K=ue.pop(),j=ue.pop(),R=ue.pop(),te=ue.pop();var Ae=1<<R,je=bi(R,j,K),Le=this.tiles[je];if(!Le&&(ye>1&&console.time("creation"),Le=this.tiles[je]=dr(te,R,j,K,ce),this.tileCoords.push({z:R,x:j,y:K}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,j,K,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var ft="z"+R;this.stats[ft]=(this.stats[ft]||0)+1,this.total++}if(Le.source=te,Q){if(R===ce.maxZoom||R===Q)continue;var gt=1<<Q-R;if(j!==Math.floor(he/gt)||K!==Math.floor(fe/gt))continue}else if(R===ce.indexMaxZoom||Le.numPoints<=ce.indexMaxPoints)continue;if(Le.source=null,te.length!==0){ye>1&&console.time("clipping");var ot,Pt,bt,jt,It,Dt,Ht=.5*ce.buffer/ce.extent,Yt=.5-Ht,kn=.5+Ht,Ln=1+Ht;ot=Pt=bt=jt=null,It=yr(te,Ae,j-Ht,j+kn,0,Le.minX,Le.maxX,ce),Dt=yr(te,Ae,j+Yt,j+Ln,0,Le.minX,Le.maxX,ce),te=null,It&&(ot=yr(It,Ae,K-Ht,K+kn,1,Le.minY,Le.maxY,ce),Pt=yr(It,Ae,K+Yt,K+Ln,1,Le.minY,Le.maxY,ce),It=null),Dt&&(bt=yr(Dt,Ae,K-Ht,K+kn,1,Le.minY,Le.maxY,ce),jt=yr(Dt,Ae,K+Yt,K+Ln,1,Le.minY,Le.maxY,ce),Dt=null),ye>1&&console.timeEnd("clipping"),ue.push(ot||[],R+1,2*j,2*K),ue.push(Pt||[],R+1,2*j,2*K+1),ue.push(bt||[],R+1,2*j+1,2*K),ue.push(jt||[],R+1,2*j+1,2*K+1)}}},xi.prototype.getTile=function(te,R,j){var K=this.options,Q=K.extent,he=K.debug;if(te<0||te>24)return null;var fe=1<<te,ue=bi(te,R=(R%fe+fe)%fe,j);if(this.tiles[ue])return Ji(this.tiles[ue],Q);he>1&&console.log("drilling down to z%d-%d-%d",te,R,j);for(var ce,ye=te,Ae=R,je=j;!ce&&ye>0;)ye--,Ae=Math.floor(Ae/2),je=Math.floor(je/2),ce=this.tiles[bi(ye,Ae,je)];return ce&&ce.source?(he>1&&console.log("found parent tile z%d-%d-%d",ye,Ae,je),he>1&&console.time("drilling down"),this.splitTile(ce.source,ye,Ae,je,te,R,j),he>1&&console.timeEnd("drilling down"),this.tiles[ue]?Ji(this.tiles[ue],Q):null):null};class Ns extends F{constructor(R,j,K,Q){super(R,j,K,fs),Q&&(this.loadGeoJSON=Q)}loadData(R,j){var K;(K=this._pendingRequest)===null||K===void 0||K.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Q=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=j,this._pendingRequest=this.loadGeoJSON(R,(he,fe)=>{if(delete this._pendingCallback,delete this._pendingRequest,he||!fe)return j(he);if(typeof fe!="object")return j(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{U(fe,!0);try{if(R.filter){const ce=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Ae=>`${Ae.key}: ${Ae.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(Ae=>ce.value.evaluate({zoom:0},Ae))}}this._geoJSONIndex=R.cluster?new un(function({superclusterOptions:ce,clusterProperties:ye}){if(!ye||!ce)return ce;const Ae={},je={},Le={accumulated:null,zoom:0},ft={properties:null},gt=Object.keys(ye);for(const ot of gt){const[Pt,bt]=ye[ot],jt=l.createExpression(bt),It=l.createExpression(typeof Pt=="string"?[Pt,["accumulated"],["get",ot]]:Pt);Ae[ot]=jt.value,je[ot]=It.value}return ce.map=ot=>{ft.properties=ot;const Pt={};for(const bt of gt)Pt[bt]=Ae[bt].evaluate(Le,ft);return Pt},ce.reduce=(ot,Pt)=>{ft.properties=Pt;for(const bt of gt)Le.accumulated=ot[bt],ot[bt]=je[bt].evaluate(Le,ft)},ce}(R)).load(fe.features):function(ce,ye){return new xi(ce,ye)}(fe,R.geojsonVtOptions)}catch(ce){return j(ce)}this.loaded={};const ue={};if(Q){const ce=Q.finish();ce&&(ue.resourceTiming={},ue.resourceTiming[R.source]=JSON.parse(JSON.stringify(ce)))}j(null,ue)}})}reloadTile(R,j){const K=this.loaded;return K&&K[R.uid]?super.reloadTile(R,j):this.loadTile(R,j)}loadGeoJSON(R,j){if(R.request)return l.getJSON(R.request,j);if(typeof R.data=="string")try{j(null,JSON.parse(R.data))}catch{j(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else j(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),j()}getClusterExpansionZoom(R,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(K){j(K)}}getClusterChildren(R,j){try{j(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(K){j(K)}}getClusterLeaves(R,j){try{j(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(K){j(K)}}}class es{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:F,geojson:Ns},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,K)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=K},this.self.registerRTLTextPlugin=j=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=j.applyArabicShaping,l.plugin.processBidirectionalText=j.processBidirectionalText,l.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}setReferrer(R,j){this.referrer=j}setImages(R,j,K){this.availableImages[R]=j;for(const Q in this.workerSources[R]){const he=this.workerSources[R][Q];for(const fe in he)he[fe].availableImages=j}K()}setLayers(R,j,K){this.getLayerIndex(R).replace(j),K()}updateLayers(R,j,K){this.getLayerIndex(R).update(j.layers,j.removedIds),K()}loadTile(R,j,K){this.getWorkerSource(R,j.type,j.source).loadTile(j,K)}loadDEMTile(R,j,K){this.getDEMWorkerSource(R,j.source).loadTile(j,K)}reloadTile(R,j,K){this.getWorkerSource(R,j.type,j.source).reloadTile(j,K)}abortTile(R,j,K){this.getWorkerSource(R,j.type,j.source).abortTile(j,K)}removeTile(R,j,K){this.getWorkerSource(R,j.type,j.source).removeTile(j,K)}removeDEMTile(R,j){this.getDEMWorkerSource(R,j.source).removeTile(j)}removeSource(R,j,K){if(!this.workerSources[R]||!this.workerSources[R][j.type]||!this.workerSources[R][j.type][j.source])return;const Q=this.workerSources[R][j.type][j.source];delete this.workerSources[R][j.type][j.source],Q.removeSource!==void 0?Q.removeSource(j,K):K()}loadWorkerSource(R,j,K){try{this.self.importScripts(j.url),K()}catch(Q){K(Q.toString())}}syncRTLPluginState(R,j,K){try{l.plugin.setState(j);const Q=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&Q!=null){this.self.importScripts(Q);const he=l.plugin.isParsed();K(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),he)}}catch(Q){K(Q.toString())}}getAvailableImages(R){let j=this.availableImages[R];return j||(j=[]),j}getLayerIndex(R){let j=this.layerIndexes[R];return j||(j=this.layerIndexes[R]=new E),j}getWorkerSource(R,j,K){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][j]||(this.workerSources[R][j]={}),!this.workerSources[R][j][K]){const Q={send:(he,fe,ue)=>{this.actor.send(he,fe,ue,R)}};this.workerSources[R][j][K]=new this.workerSourceTypes[j](Q,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][j][K]}getDEMWorkerSource(R,j){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][j]||(this.demWorkerSources[R][j]=new J),this.demWorkerSources[R][j]}enforceCacheSizeLimit(R,j){l.enforceCacheSizeLimit(j)}}return l.isWorker()&&(self.worker=new es(self)),es}),a(["./shared"],function(l){var m=v;function v(g){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,b=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(b);try{_=new Worker(P),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(P),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var b=_.getImageData(0,0,1,1);return b&&b.width===p.width}()?(E[d=o&&o.failIfMajorPerformanceCaveat]===void 0&&(E[d]=function(p){var _,b=function(P){var I=document.createElement("canvas"),M=Object.create(v.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=P,I.getContext("webgl",M)||I.getContext("experimental-webgl",M)}(p);if(!b)return!1;try{_=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!_||b.isContextLost())&&(b.shaderSource(_,"void main() {}"),b.compileShader(_),b.getShaderParameter(_,b.COMPILE_STATUS)===!0)}(d)),E[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(g)}var E={};function T(g,o){if(Array.isArray(g)){if(!Array.isArray(o)||g.length!==o.length)return!1;for(let d=0;d<g.length;d++)if(!T(g[d],o[d]))return!1;return!0}if(typeof g=="object"&&g!==null&&o!==null){if(typeof o!="object"||Object.keys(g).length!==Object.keys(o).length)return!1;for(const d in g)if(!T(g[d],o[d]))return!1;return!0}return g===o}v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class S{static testProp(o){if(!S.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in S.docStyle)return o[d];return o[0]}static create(o,d,p){const _=window.document.createElement(o);return d!==void 0&&(_.className=d),p&&p.appendChild(_),_}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){S.docStyle&&S.selectProp&&(S.userSelect=S.docStyle[S.selectProp],S.docStyle[S.selectProp]="none")}static enableDrag(){S.docStyle&&S.selectProp&&(S.docStyle[S.selectProp]=S.userSelect)}static setTransform(o,d){o.style[S.transformProp]=d}static addEventListener(o,d,p,_={}){o.addEventListener(d,p,"passive"in _?_:_.capture)}static removeEventListener(o,d,p,_={}){o.removeEventListener(d,p,"passive"in _?_:_.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",S.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",S.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",S.suppressClickInternal,!0)},0)}static mousePos(o,d){const p=o.getBoundingClientRect();return new l.pointGeometry(d.clientX-p.left-o.clientLeft,d.clientY-p.top-o.clientTop)}static touchPos(o,d){const p=o.getBoundingClientRect(),_=[];for(let b=0;b<d.length;b++)_.push(new l.pointGeometry(d[b].clientX-p.left-o.clientLeft,d[b].clientY-p.top-o.clientTop));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}S.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,S.selectProp=S.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),S.transformProp=S.testProp(["transform","WebkitTransform"]);class z{constructor(o){this._transformRequestFn=o}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeSpriteURL(o,d,p){const _=function(b){const P=b.match(D);if(!P)throw new Error(`Unable to parse URL "${b}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(o);return _.path+=`${d}${p}`,function(b){const P=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${P}`}(_)}setTransformRequest(o){this._transformRequestFn=o}}const D=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class F{constructor(o,d,p,_){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(d,_)}update(o,d,p){const{width:_,height:b}=o,P=!(this.size&&this.size[0]===_&&this.size[1]===b||p),{context:I}=this,{gl:M}=I;if(this.useMipmap=!!(d&&d.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!d||d.premultiply!==!1)),P)this.size=[_,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,_,b,0,this.format,M.UNSIGNED_BYTE,o.data);else{const{x:L,y:B}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?M.texSubImage2D(M.TEXTURE_2D,0,L,B,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,L,B,_,b,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(o,d,p){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||o),this.filter=o),d!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function J(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class U extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:p}of this.requestors)this._notify(d,p);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let p=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,d){if(!o)return!0;let p=0;for(const _ of o){if(_[0]<p||_[1]<_[0]||d<_[1])return!1;p=_[1]}return!0}_validateContent(o,d){return!(o&&(o.length!==4||o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,d){const p=this.images[o];if(p.data.width!==d.data.width||p.data.height!==d.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=p.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let p=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const p={};for(const _ of o){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const b=this.images[_];b?p[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,p)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],p=this.getImage(o);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new l.ImagePosition(_,p);this.patterns[o]={bin:_,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new F(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:d,h:p}=l.potpack(o),_=this.atlasImage;_.resize({width:d||1,height:p||1});for(const b in this.patterns){const{bin:P}=this.patterns[b],I=P.x+1,M=P.y+1,L=this.images[b].data,B=L.width,W=L.height;l.RGBAImage.copy(L,_,{x:0,y:0},{x:I,y:M},{width:B,height:W}),l.RGBAImage.copy(L,_,{x:0,y:W-1},{x:I,y:M-1},{width:B,height:1}),l.RGBAImage.copy(L,_,{x:0,y:0},{x:I,y:M+W},{width:B,height:1}),l.RGBAImage.copy(L,_,{x:B-1,y:0},{x:I-1,y:M},{width:1,height:W}),l.RGBAImage.copy(L,_,{x:0,y:0},{x:I+B,y:M},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.images[d];p||l.warnOnce(`Image with ID: "${d}" was not found`),J(p)&&this.updateImage(d,p)}}}const V=1e20;function G(g,o,d,p,_,b,P,I,M){for(let L=o;L<o+p;L++)ee(g,d*b+L,b,_,P,I,M);for(let L=d;L<d+_;L++)ee(g,L*b+o,1,p,P,I,M)}function ee(g,o,d,p,_,b,P){b[0]=0,P[0]=-V,P[1]=V,_[0]=g[o];for(let I=1,M=0,L=0;I<p;I++){_[I]=g[o+I*d];const B=I*I;do{const W=b[M];L=(_[I]-_[W]+B-W*W)/(I-W)/2}while(L<=P[M]&&--M>-1);M++,b[M]=I,P[M]=L,P[M+1]=V}for(let I=0,M=0;I<p;I++){for(;P[M+1]<I;)M++;const L=b[M],B=I-L;g[o+I*d]=_[L]+B*B}}class se{constructor(o,d){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={}}setURL(o){this.url=o}getGlyphs(o,d){const p=[];for(const _ in o)for(const b of o[_])p.push({stack:_,id:b});l.asyncAll(p,({stack:_,id:b},P)=>{let I=this.entries[_];I||(I=this.entries[_]={glyphs:{},requests:{},ranges:{}});let M=I.glyphs[b];if(M!==void 0)return void P(null,{stack:_,id:b,glyph:M});if(M=this._tinySDF(I,_,b),M)return I.glyphs[b]=M,void P(null,{stack:_,id:b,glyph:M});const L=Math.floor(b/256);if(256*L>65535)return void P(new Error("glyphs > 65535 not supported"));if(I.ranges[L])return void P(null,{stack:_,id:b,glyph:M});let B=I.requests[L];B||(B=I.requests[L]=[],se.loadGlyphRange(_,L,this.url,this.requestManager,(W,q)=>{if(q){for(const oe in q)this._doesCharSupportLocalGlyph(+oe)||(I.glyphs[+oe]=q[+oe]);I.ranges[L]=!0}for(const oe of B)oe(W,q);delete I.requests[L]})),B.push((W,q)=>{W?P(W):q&&P(null,{stack:_,id:b,glyph:q[b]||null})})},(_,b)=>{if(_)d(_);else if(b){const P={};for(const{stack:I,id:M,glyph:L}of b)(P[I]||(P[I]={}))[M]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};d(null,P)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](o)||l.unicodeBlockLookup["Hangul Syllables"](o)||l.unicodeBlockLookup.Hiragana(o)||l.unicodeBlockLookup.Katakana(o))}_tinySDF(o,d,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let b=o.tinySDF;if(!b){let I="400";/bold/i.test(d)?I="900":/medium/i.test(d)?I="500":/light/i.test(d)&&(I="200"),b=o.tinySDF=new se.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:I})}const P=b.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:P.width||30,height:P.height||30},P.data),metrics:{width:P.glyphWidth||24,height:P.glyphHeight||24,left:P.glyphLeft||0,top:P.glyphTop-27||-8,advance:P.glyphAdvance||24}}}}se.loadGlyphRange=function(g,o,d,p,_){const b=256*o,P=b+255,I=p.transformRequest(d.replace("{fontstack}",g).replace("{range}",`${b}-${P}`),l.ResourceType.Glyphs);l.getArrayBuffer(I,(M,L)=>{if(M)_(M);else if(L){const B={};for(const W of l.parseGlyphPbf(L))B[W.id]=W;_(null,B)}})},se.TinySDF=class{constructor({fontSize:g=24,buffer:o=3,radius:d=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:b="normal",fontStyle:P="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=d;const I=this.size=g+4*o,M=this._createCanvas(I),L=this.ctx=M.getContext("2d",{willReadFrequently:!0});L.font=`${P} ${b} ${g}px ${_}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(g){const o=document.createElement("canvas");return o.width=o.height=g,o}draw(g){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:b}=this.ctx.measureText(g),P=Math.ceil(d),I=Math.min(this.size-this.buffer,Math.ceil(b-_)),M=Math.min(this.size-this.buffer,P+Math.ceil(p)),L=I+2*this.buffer,B=M+2*this.buffer,W=Math.max(L*B,0),q=new Uint8ClampedArray(W),oe={data:q,width:L,height:B,glyphWidth:I,glyphHeight:M,glyphTop:P,glyphLeft:0,glyphAdvance:o};if(I===0||M===0)return oe;const{ctx:re,buffer:ie,gridInner:ge,gridOuter:_e}=this;re.clearRect(ie,ie,I,M),re.fillText(g,ie,ie+P);const we=re.getImageData(ie,ie,I,M);_e.fill(V,0,W),ge.fill(0,0,W);for(let ae=0;ae<M;ae++)for(let Ce=0;Ce<I;Ce++){const Te=we.data[4*(ae*I+Ce)+3]/255;if(Te===0)continue;const Fe=(ae+ie)*L+Ce+ie;if(Te===1)_e[Fe]=0,ge[Fe]=V;else{const Ne=.5-Te;_e[Fe]=Ne>0?Ne*Ne:0,ge[Fe]=Ne<0?Ne*Ne:0}}G(_e,0,0,L,B,L,this.f,this.v,this.z),G(ge,ie,ie,I,M,L,this.f,this.v,this.z);for(let ae=0;ae<W;ae++){const Ce=Math.sqrt(_e[ae])-Math.sqrt(ge[ae]);q[ae]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return oe}};const me=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(g,o){return l.sphericalToCartesian(g.expression.evaluate(o))}interpolate(g,o,d){return{x:l.number(g.x,o.x,d),y:l.number(g.y,o.y,d),z:l.number(g.z,o.z,d)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),ve="-transition";class Me extends l.Evented{constructor(o){super(),this._transitionable=new l.Transitionable(me),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(l.validateLight,o,d))for(const p in o){const _=o[p];p.endsWith(ve)?this._transitionable.setTransition(p.slice(0,-ve.length),_):this._transitionable.setValue(p,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,o.call(l.validateStyle,l.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Be{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const p=o.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,d)),this.dashEntry[p]}getDashRanges(o,d,p){const _=[];let b=o.length%2==1?-o[o.length-1]*p:0,P=o[0]*p,I=!0;_.push({left:b,right:P,isDash:I,zeroLength:o[0]===0});let M=o[0];for(let L=1;L<o.length;L++){I=!I;const B=o[L];b=M*p,M+=B,P=M*p,_.push({left:b,right:P,isDash:I,zeroLength:B===0})}return _}addRoundDash(o,d,p){const _=d/2;for(let b=-p;b<=p;b++){const P=this.width*(this.nextRow+p+b);let I=0,M=o[I];for(let L=0;L<this.width;L++){L/M.right>1&&(M=o[++I]);const B=Math.abs(L-M.left),W=Math.abs(L-M.right),q=Math.min(B,W);let oe;const re=b/p*(_+1);if(M.isDash){const ie=_-Math.abs(re);oe=Math.sqrt(q*q+ie*ie)}else oe=_-Math.sqrt(q*q+re*re);this.data[P+L]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const M=o[I],L=o[I+1];M.zeroLength?o.splice(I,1):L&&L.isDash===M.isDash&&(L.left=M.left,o.splice(I,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const _=this.width*this.nextRow;let b=0,P=o[b];for(let I=0;I<this.width;I++){I/P.right>1&&(P=o[++b]);const M=Math.abs(I-P.left),L=Math.abs(I-P.right),B=Math.min(M,L);this.data[_+I]=Math.max(0,Math.min(255,(P.isDash?B:-B)+128))}}addDash(o,d){const p=d?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let b=0;for(let I=0;I<o.length;I++)b+=o[I];if(b!==0){const I=this.width/b,M=this.getDashRanges(o,this.width,I);d?this.addRoundDash(M,I,p):this.addRegularDash(M)}const P={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=_,this.dirty=!0,P}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class ze{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const b=new ze.Actor(p[_],d,this.id);b.name=`Worker ${_}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d,p){l.asyncAll(this.actors,(_,b)=>{_.send(o,d,b)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Oe(g,o,d){const p=function(_,b){if(_)return d(_);if(b){const P=l.pick(l.extend(b,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(P.vectorLayers=b.vector_layers,P.vectorLayerIds=P.vectorLayers.map(I=>I.id)),d(null,P)}};return g.url?l.getJSON(o.transformRequest(g.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,g))}ze.Actor=l.Actor;class tt{constructor(o,d,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*d),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*d),b=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*d);return o.x>=p&&o.x<b&&o.y>=_&&o.y<P}}class et extends l.Evented{constructor(o,d,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(d,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Oe(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new l.ErrorEvent(o)):d&&(l.extend(this,d),d.bounds&&(this.tileBounds=new tt(d.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(P,I){return delete o.request,o.aborted?d(null):P&&P.status!==404?d(P):(I&&I.resourceTiming&&(o.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&o.setExpiryData(I),o.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",_,b.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",_,b.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class st extends l.Evented{constructor(o,d,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},d),l.extend(this,l.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Oe(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new l.ErrorEvent(o)):d&&(l.extend(this,d),d.bounds&&(this.tileBounds=new tt(d.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,b,P)=>{if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(_)o.state="errored",d(_);else if(b){this.map._refreshExpiredTiles&&o.setExpiryData(P);const I=this.map.painter.context,M=I.gl;o.texture=this.map.painter.getTileTexture(b.width),o.texture?o.texture.update(b,{useMipmap:!0}):(o.texture=new F(I,b,M.RGBA,{useMipmap:!0}),o.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),o.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}let Bt;class Je extends st{constructor(o,d,p,_){super(o,d,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(b,P){b&&(o.state="errored",d(b)),P&&(o.dem=P,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",d(null))}o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(b,P){if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(b)o.state="errored",d(b);else if(P){this.map._refreshExpiredTiles&&o.setExpiryData(P),delete P.cacheControl,delete P.expires;const I=l.isImageBitmap(P)&&(Bt==null&&(Bt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Bt)?P:l.exported.getImageData(P,1),M={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:I,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",M,_.bind(this)))}}).bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const d=o.canonical,p=Math.pow(2,d.z),_=(d.x-1+p)%p,b=d.x===0?o.wrap-1:o.wrap,P=(d.x+1+p)%p,I=d.x+1===p?o.wrap+1:o.wrap,M={};return M[new l.OverscaledTileID(o.overscaledZ,b,d.z,_,d.y).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,I,d.z,P,d.y).key]={backfilled:!1},d.y>0&&(M[new l.OverscaledTileID(o.overscaledZ,b,d.z,_,d.y-1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,I,d.z,P,d.y-1).key]={backfilled:!1}),d.y+1<p&&(M[new l.OverscaledTileID(o.overscaledZ,b,d.z,_,d.y+1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,I,d.z,P,d.y+1).key]={backfilled:!1}),M}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class en extends l.Evented{constructor(o,d,p,_){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=d.data,this._options=l.extend({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const b=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*b,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*b,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.EXTENT,radius:(d.clusterRadius||50)*b,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},d),this}getClusterChildren(o,d){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},d),this}getClusterLeaves(o,d,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:d,offset:p},_),this}_updateWorkerData(o){const d=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(d.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(_,b)=>{if(this._pendingLoads--,this._removed||b&&b.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:o}));let P=null;if(b&&b.resourceTiming&&b.resourceTiming[this.id]&&(P=b.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const I={dataType:"source",sourceDataType:o};this._collectResourceTiming&&P&&P.length>0&&l.extend(I,{resourceTiming:P}),this.fire(new l.Event("data",I))})}loaded(){return this._pendingLoads===0}loadTile(o,d){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,_,(b,P)=>(delete o.request,o.unloadVectorData(),o.aborted?d(null):b?d(b):(o.loadVectorData(P,this.map.painter,p==="reloadTile"),d(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var We=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qe extends l.Evented{constructor(o,d,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=d}load(o,d){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,o&&(this.coordinates=o),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const d=o.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let b=1/0,P=1/0,I=-1/0,M=-1/0;for(const q of _)b=Math.min(b,q.x),P=Math.min(P,q.y),I=Math.max(I,q.x),M=Math.max(M,q.y);const L=Math.max(I-b,M-P),B=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),W=Math.pow(2,B);return new l.CanonicalTileID(B,Math.floor((b+I)/2*W),Math.floor((P+M)/2*W))}(d),this.minzoom=this.maxzoom=this.tileID.z;const p=d.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new F(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Tt extends Qe{constructor(o,d,p,_){super(o,d,p,_),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const d of o.urls)this.urls.push(this.map._requestManager.transformRequest(d,l.ResourceType.Source).url);l.getVideo(this.urls,(d,p)=>{this._loaded=!0,d?this.fire(new l.ErrorEvent(d)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new F(o,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class tn extends Qe{constructor(o,d,p,_){super(o,d,p,_),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(P=>typeof P!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,p=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new F(d,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const b=this.tiles[_];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Xt={vector:et,raster:st,"raster-dem":Je,geojson:en,video:Tt,image:Qe,canvas:tn};function An(g,o){const d=l.create();return l.translate(d,d,[1,1,0]),l.scale(d,d,[.5*g.width,.5*g.height,1]),l.multiply(d,d,g.calculatePosMatrix(o.toUnwrapped()))}function xn(g,o,d,p,_,b){const P=function(W,q,oe){if(W)for(const re of W){const ie=q[re];if(ie&&ie.source===oe&&ie.type==="fill-extrusion")return!0}else for(const re in q){const ie=q[re];if(ie.source===oe&&ie.type==="fill-extrusion")return!0}return!1}(_&&_.layers,o,g.id),I=b.maxPitchScaleFactor(),M=g.tilesIn(p,I,P);M.sort(zn);const L=[];for(const W of M)L.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(o,d,g._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,_,b,I,An(g.transform,W.tileID))});const B=function(W){const q={},oe={};for(const re of W){const ie=re.queryResults,ge=re.wrappedTileID,_e=oe[ge]=oe[ge]||{};for(const we in ie){const ae=ie[we],Ce=_e[we]=_e[we]||{},Te=q[we]=q[we]||[];for(const Fe of ae)Ce[Fe.featureIndex]||(Ce[Fe.featureIndex]=!0,Te.push(Fe))}}return q}(L);for(const W in B)B[W].forEach(q=>{const oe=q.feature,re=g.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=re});return B}function zn(g,o){const d=g.tileID,p=o.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}class Dn{constructor(o,d){this.tileID=o,this.uid=l.uniqueId(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<l.exported.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(d=>o.saveTileTexture(d)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,b){const P={};if(!b)return P;for(const I of _){const M=I.layerIds.map(L=>b.getLayer(L)).filter(Boolean);if(M.length!==0){I.layers=M,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(L=>M.filter(B=>B.id===L)[0]));for(const L of M)P[L.id]=I}}return P}(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof l.SymbolBucket&&b.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const b=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(_).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new F(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new F(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,p,_,b,P,I,M,L,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:b,scale:P,tileSize:this.tileSize,pixelPosMatrix:B,transform:M,params:I,queryPadding:this.queryPadding*L},o,d,p):{}}querySourceFeatures(o,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),b=d?d.sourceLayer:"",P=_._geojsonTileLayer||_[b];if(!P)return;const I=l.createFilter(d&&d.filter),{z:M,x:L,y:B}=this.tileID.canonical,W={z:M,x:L,y:B};for(let q=0;q<P.length;q++){const oe=P.feature(q);if(I.needGeometry){const ge=l.toEvaluationFeature(oe,!0);if(!I.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!I.filter(new l.EvaluationParameters(this.tileID.overscaledZ),oe))continue;const re=p.getId(oe,b),ie=new l.GeoJSONFeature(oe,M,L,B,re);ie.tile=W,o.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const p=l.parseCacheControl(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(d)if(this.expirationTime<d)_=!0;else{const b=this.expirationTime-d;b?this.expirationTime=p+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!d.style.hasLayer(_))continue;const b=this.buckets[_],P=b.layers[0].sourceLayer||"_geojsonTileLayer",I=p[P],M=o[P];if(!I||!M||Object.keys(M).length===0)continue;b.update(M,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const L=d&&d.style&&d.style.getLayer(_);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=l.exported.now()+o}setDependencies(o,d){const p={};for(const _ of d)p[_]=!0;this.dependencies[o]=p}hasDependency(o,d){for(const p of o){const _=this.dependencies[p];if(_){for(const b of d)if(_[b])return!0}}return!1}}class ln{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,p){const _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const b={value:d,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(o,b)},p)),this.data[_].push(b),this.order.push(_),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const p=o.wrapped().key,_=d===void 0?0:this.data[p].indexOf(d),b=this.data[p][_];return this.data[p].splice(_,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const p in this.data)for(const _ of this.data[p])o(_.value)||d.push(_);for(const p of d)this.remove(p.value.tileID,p)}}class Wn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,p){const _=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},l.extend(this.stateChanges[o][_],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const b in this.state[o])b!==_&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(const b in this.state[o][_])p[b]||(this.deletedStates[o][_][b]=null)}else for(const b in p)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][b]===null&&delete this.deletedStates[o][_][b]}removeFeatureState(o,d,p){if(this.deletedStates[o]===null)return;const _=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&d!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][p]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(p in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][p]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,d){const p=String(d),_=l.extend({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const b=this.deletedStates[o][d];if(b===null)return{};for(const P in b)delete _[P]}return _}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const b={};for(const P in this.stateChanges[_])this.state[_][P]||(this.state[_][P]={}),l.extend(this.state[_][P],this.stateChanges[_][P]),b[P]=this.state[_][P];p[_]=b}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const b={};if(this.deletedStates[_]===null)for(const P in this.state[_])b[P]={},this.state[_][P]={};else for(const P in this.deletedStates[_]){if(this.deletedStates[_][P]===null)this.state[_][P]={};else for(const I of Object.keys(this.deletedStates[_][P]))delete this.state[_][P][I];b[P]=this.state[_][P]}p[_]=p[_]||{},l.extend(p[_],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in o)o[_].setFeatureState(p,d)}}class zt extends l.Evented{constructor(o,d,p){super(),this.id=o,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,b,P,I){const M=new Xt[b.type](_,b,P,I);if(M.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${M.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],M),M}(o,d,p,this),this._tiles={},this._cache=new ln(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Wn}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d){return this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new l.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Tn).map(o=>o.key)}getRenderableIds(o){const d=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&d.push(this._tiles[p]);return o?d.sort((p,_)=>{const b=p.tileID,P=_.tileID,I=new l.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),M=new l.pointGeometry(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-P.overscaledZ||M.y-I.y||M.x-I.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(Tn).map(p=>p.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,d){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=d),this._loadTile(p,this._tileLoaded.bind(this,p,o,d)))}_tileLoaded(o,d,p,_){if(_)return o.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=l.exported.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let _=0;_<d.length;_++){const b=d[_];if(o.neighboringTiles&&o.neighboringTiles[b]){const P=this.getTileByID(b);p(o,P),p(P,o)}}function p(_,b){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let P=b.tileID.canonical.x-_.tileID.canonical.x;const I=b.tileID.canonical.y-_.tileID.canonical.y,M=Math.pow(2,_.tileID.canonical.z),L=b.tileID.key;P===0&&I===0||Math.abs(I)>1||(Math.abs(P)>1&&(Math.abs(P+M)===1?P+=M:Math.abs(P-M)===1&&(P-=M)),b.dem&&_.dem&&(_.dem.backfillBorder(b.dem,P,I),_.neighboringTiles&&_.neighboringTiles[L]&&(_.neighboringTiles[L].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,p,_){for(const b in this._tiles){let P=this._tiles[b];if(_[b]||!P.hasData()||P.tileID.overscaledZ<=d||P.tileID.overscaledZ>p)continue;let I=P.tileID;for(;P&&P.tileID.overscaledZ>d+1;){const L=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[L.key],P&&P.hasData()&&(I=L)}let M=I;for(;M.overscaledZ>d;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){_[I.key]=I;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=d?p:null}for(let p=o.overscaledZ-1;p>=d;p--){const _=o.scaledTo(p),b=this._getLoadedTile(_);if(b)return b}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,_=Math.floor(d*p*5),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(b)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const p={};for(const _ in this._tiles){const b=this._tiles[_];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+d),p[b.tileID.key]=b}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(o,d){if(this.transform=o,this.terrain=d,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new l.OverscaledTileID(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(p=p.filter(L=>this._source.hasTile(L)))):p=[];const _=o.coveringZoomLevel(this._source),b=Math.max(_-zt.maxOverzooming,this._source.minzoom),P=Math.max(_+zt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const B of p)if(B.canonical.z>this._source.minzoom){const W=B.scaledTo(B.canonical.z-1);L[W.key]=W;const q=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));L[q.key]=q}p=p.concat(Object.values(L))}const I=this._updateRetainedTiles(p,_);if(Lr(this._source.type)){const L={},B={},W=Object.keys(I);for(const q of W){const oe=I[q],re=this._tiles[q];if(!re||re.fadeEndTime&&re.fadeEndTime<=l.exported.now())continue;const ie=this.findLoadedParent(oe,b);ie&&(this._addTile(ie.tileID),L[ie.tileID.key]=ie.tileID),B[q]=oe}this._retainLoadedChildren(B,_,P,I);for(const q in L)I[q]||(this._coveredTiles[q]=!0,I[q]=L[q]);if(d){const q={},oe={};for(const re of p)this._tiles[re.key].hasData()?q[re.key]=re:oe[re.key]=re;for(const re in oe){const ie=oe[re].children(this._source.maxzoom);this._tiles[ie[0].key]&&this._tiles[ie[1].key]&&this._tiles[ie[2].key]&&this._tiles[ie[3].key]&&(q[ie[0].key]=I[ie[0].key]=ie[0],q[ie[1].key]=I[ie[1].key]=ie[1],q[ie[2].key]=I[ie[2].key]=ie[2],q[ie[3].key]=I[ie[3].key]=ie[3],delete oe[re])}for(const re in oe){const ie=this.findLoadedParent(oe[re],this._source.minzoom);if(ie){q[ie.tileID.key]=I[ie.tileID.key]=ie.tileID;for(const ge in q)q[ge].isChildOf(ie.tileID)&&delete q[ge]}}for(const re in this._tiles)q[re]||(this._coveredTiles[re]=!0)}}for(const L in I)this._tiles[L].clearFadeHold();const M=l.keysDifference(this._tiles,I);for(const L of M){const B=this._tiles[L];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){const p={},_={},b=Math.max(d-zt.maxOverzooming,this._source.minzoom),P=Math.max(d+zt.maxUnderzooming,this._source.minzoom),I={};for(const M of o){const L=this._addTile(M);p[M.key]=M,L.hasData()||d<this._source.maxzoom&&(I[M.key]=M)}this._retainLoadedChildren(I,d,P,p);for(const M of o){let L=this._tiles[M.key];if(L.hasData())continue;if(d+1>this._source.maxzoom){const W=M.children(this._source.maxzoom)[0],q=this.getTile(W);if(q&&q.hasData()){p[W.key]=W;continue}}else{const W=M.children(this._source.maxzoom);if(p[W[0].key]&&p[W[1].key]&&p[W[2].key]&&p[W[3].key])continue}let B=L.wasRequested();for(let W=M.overscaledZ-1;W>=b;--W){const q=M.scaledTo(W);if(_[q.key]||(_[q.key]=!0,L=this.getTile(q),!L&&B&&(L=this._addTile(q)),L&&(p[q.key]=q,B=L.wasRequested(),L.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let p,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}d.push(_.key);const b=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;_=b}for(const b of d)this._loadedParentTiles[b]=p}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const p=d;return d||(d=new Dn(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))),d.uses++,this._tiles[o.key]=d,p||this._source.fire(new l.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=d.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,p){const _=[],b=this.transform;if(!b)return _;const P=p?b.getCameraQueryGeometry(o):o,I=o.map(re=>b.pointCoordinate(re,this.terrain)),M=P.map(re=>b.pointCoordinate(re,this.terrain)),L=this.getIds();let B=1/0,W=1/0,q=-1/0,oe=-1/0;for(const re of M)B=Math.min(B,re.x),W=Math.min(W,re.y),q=Math.max(q,re.x),oe=Math.max(oe,re.y);for(let re=0;re<L.length;re++){const ie=this._tiles[L[re]];if(ie.holdingForFade())continue;const ge=ie.tileID,_e=Math.pow(2,b.zoom-ie.tileID.overscaledZ),we=d*ie.queryPadding*l.EXTENT/ie.tileSize/_e,ae=[ge.getTilePoint(new l.MercatorCoordinate(B,W)),ge.getTilePoint(new l.MercatorCoordinate(q,oe))];if(ae[0].x-we<l.EXTENT&&ae[0].y-we<l.EXTENT&&ae[1].x+we>=0&&ae[1].y+we>=0){const Ce=I.map(Fe=>ge.getTilePoint(Fe)),Te=M.map(Fe=>ge.getTilePoint(Fe));_.push({tile:ie,tileID:ge,queryGeometry:Ce,cameraQueryGeometry:Te,scale:_e})}}return _}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of d)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Lr(this._source.type))for(const o in this._tiles){const d=this._tiles[o];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(o,d,p){this._state.updateState(o=o||"_geojsonTileLayer",d,p)}removeFeatureState(o,d,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,p)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,p){const _=this._tiles[o];_&&_.setDependencies(d,p)}reloadTilesForDependencies(o,d){for(const p in this._tiles)this._tiles[p].hasDependency(o,d)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,d))}}function Tn(g,o){const d=Math.abs(2*g.wrap)-+(g.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||p-d||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function Lr(g){return g==="raster"||g==="image"||g==="video"}zt.maxOverzooming=10,zt.maxUnderzooming=3;const Hn="mapboxgl_preloaded_worker_pool";class pn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<pn.workerCount;)this.workers.push(new Worker(oa.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hn]}numActive(){return Object.keys(this.active).length}}const un=Math.floor(l.exported.hardwareConcurrency/2);let Jt;function Un(){return Jt||(Jt=new pn),Jt}function Jn(g,o){const d={};for(const p in g)p!=="ref"&&(d[p]=g[p]);return l.refProperties.forEach(p=>{p in o&&(d[p]=o[p])}),d}function Ur(g){g=g.slice();const o=Object.create(null);for(let d=0;d<g.length;d++)o[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Jn(g[d],o[g[d].ref]));return g}pn.workerCount=Math.max(Math.min(un,6),1);const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function cn(g,o,d){d.push({command:Vt.addSource,args:[g,o[g]]})}function yn(g,o,d){o.push({command:Vt.removeSource,args:[g]}),d[g]=!0}function ui(g,o,d,p){yn(g,d,p),cn(g,o,d)}function Ki(g,o,d){let p;for(p in g[d])if(Object.prototype.hasOwnProperty.call(g[d],p)&&p!=="data"&&!T(g[d][p],o[d][p]))return!1;for(p in o[d])if(Object.prototype.hasOwnProperty.call(o[d],p)&&p!=="data"&&!T(g[d][p],o[d][p]))return!1;return!0}function Rr(g,o,d,p,_,b){let P;for(P in o=o||{},g=g||{})Object.prototype.hasOwnProperty.call(g,P)&&(T(g[P],o[P])||d.push({command:b,args:[p,P,o[P],_]}));for(P in o)Object.prototype.hasOwnProperty.call(o,P)&&!Object.prototype.hasOwnProperty.call(g,P)&&(T(g[P],o[P])||d.push({command:b,args:[p,P,o[P],_]}))}function Ye(g){return g.id}function St(g,o){return g[o.id]=o,g}class Rt{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.clamp(o,0,1);let d=1,p=this._distances[d];const _=o*this.paddedLength+this.padding;for(;p<_&&d<this._distances.length;)p=this._distances[++d];const b=d-1,P=this._distances[b],I=p-P,M=I>0?(_-P)/I:0;return this.points[b].mult(1-M).add(this.points[d].mult(M))}}function Ee(g,o){let d=!0;return g==="always"||g!=="never"&&o!=="never"||(d=!1),d}class Re{constructor(o,d,p){const _=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(d/p);for(let P=0;P<this.xCellCount*this.yCellCount;P++)_.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,p,_,b){this._forEachCell(d,p,_,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)}insertCircle(o,d,p,_){this._forEachCell(d-_,p-_,d+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,d,p,_,b,P){this.boxCells[b].push(P)}_insertCircleCell(o,d,p,_,b,P){this.circleCells[b].push(P)}_query(o,d,p,_,b,P,I){if(p<0||o>this.width||_<0||d>this.height)return[];const M=[];if(o<=0&&d<=0&&this.width<=p&&this.height<=_){if(b)return[{key:null,x1:o,y1:d,x2:p,y2:_}];for(let L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const B=this.circles[3*L],W=this.circles[3*L+1],q=this.circles[3*L+2];M.push({key:this.circleKeys[L],x1:B-q,y1:W-q,x2:B+q,y2:W+q})}}else this._forEachCell(o,d,p,_,this._queryCell,M,{hitTest:b,overlapMode:P,seenUids:{box:{},circle:{}}},I);return M}query(o,d,p,_){return this._query(o,d,p,_,!1,null)}hitTest(o,d,p,_,b,P){return this._query(o,d,p,_,!0,b,P).length>0}hitTestCircle(o,d,p,_,b){const P=o-p,I=o+p,M=d-p,L=d+p;if(I<0||P>this.width||L<0||M>this.height)return!1;const B=[];return this._forEachCell(P,M,I,L,this._queryCellCircle,B,{hitTest:!0,overlapMode:_,circle:{x:o,y:d,radius:p},seenUids:{box:{},circle:{}}},b),B.length>0}_queryCell(o,d,p,_,b,P,I,M){const{seenUids:L,hitTest:B,overlapMode:W}=I,q=this.boxCells[b];if(q!==null){const re=this.bboxes;for(const ie of q)if(!L.box[ie]){L.box[ie]=!0;const ge=4*ie,_e=this.boxKeys[ie];if(o<=re[ge+2]&&d<=re[ge+3]&&p>=re[ge+0]&&_>=re[ge+1]&&(!M||M(_e))&&(!B||!Ee(W,_e.overlapMode))&&(P.push({key:_e,x1:re[ge],y1:re[ge+1],x2:re[ge+2],y2:re[ge+3]}),B))return!0}}const oe=this.circleCells[b];if(oe!==null){const re=this.circles;for(const ie of oe)if(!L.circle[ie]){L.circle[ie]=!0;const ge=3*ie,_e=this.circleKeys[ie];if(this._circleAndRectCollide(re[ge],re[ge+1],re[ge+2],o,d,p,_)&&(!M||M(_e))&&(!B||!Ee(W,_e.overlapMode))){const we=re[ge],ae=re[ge+1],Ce=re[ge+2];if(P.push({key:_e,x1:we-Ce,y1:ae-Ce,x2:we+Ce,y2:ae+Ce}),B)return!0}}}return!1}_queryCellCircle(o,d,p,_,b,P,I,M){const{circle:L,seenUids:B,overlapMode:W}=I,q=this.boxCells[b];if(q!==null){const re=this.bboxes;for(const ie of q)if(!B.box[ie]){B.box[ie]=!0;const ge=4*ie,_e=this.boxKeys[ie];if(this._circleAndRectCollide(L.x,L.y,L.radius,re[ge+0],re[ge+1],re[ge+2],re[ge+3])&&(!M||M(_e))&&!Ee(W,_e.overlapMode))return P.push(!0),!0}}const oe=this.circleCells[b];if(oe!==null){const re=this.circles;for(const ie of oe)if(!B.circle[ie]){B.circle[ie]=!0;const ge=3*ie,_e=this.circleKeys[ie];if(this._circlesCollide(re[ge],re[ge+1],re[ge+2],L.x,L.y,L.radius)&&(!M||M(_e))&&!Ee(W,_e.overlapMode))return P.push(!0),!0}}}_forEachCell(o,d,p,_,b,P,I,M){const L=this._convertToXCellCoord(o),B=this._convertToYCellCoord(d),W=this._convertToXCellCoord(p),q=this._convertToYCellCoord(_);for(let oe=L;oe<=W;oe++)for(let re=B;re<=q;re++)if(b.call(this,o,d,p,_,this.xCellCount*re+oe,P,I,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,p,_,b,P){const I=_-o,M=b-d,L=p+P;return L*L>I*I+M*M}_circleAndRectCollide(o,d,p,_,b,P,I){const M=(P-_)/2,L=Math.abs(o-(_+M));if(L>M+p)return!1;const B=(I-b)/2,W=Math.abs(d-(b+B));if(W>B+p)return!1;if(L<=M||W<=B)return!0;const q=L-M,oe=W-B;return q*q+oe*oe<=p*p}}function On(g,o,d,p,_){const b=l.create();return o?(l.scale(b,b,[1/_,1/_,1]),d||l.rotateZ(b,b,p.angle)):l.multiply(b,p.labelPlaneMatrix,g),b}function Ut(g,o,d,p,_){if(o){const b=l.clone(g);return l.scale(b,b,[_,_,1]),d||l.rotateZ(b,b,-p.angle),b}return p.glCoordMatrix}function xt(g,o,d){let p;d?(p=[g.x,g.y,d(g.x,g.y),1],l.transformMat4(p,p,o)):(p=[g.x,g.y,0,1],Zr(p,p,o));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function rn(g,o){return .5+g/o*.5}function Vn(g,o){const d=g[0]/g[3],p=g[1]/g[3];return d>=-o[0]&&d<=o[0]&&p>=-o[1]&&p<=o[1]}function yr(g,o,d,p,_,b,P,I,M,L){const B=p?g.textSizeData:g.iconSizeData,W=l.evaluateSizeForZoom(B,d.transform.zoom),q=[256/d.width*2+1,256/d.height*2+1],oe=p?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();const re=g.lineVertexArray,ie=p?g.text.placedSymbolArray:g.icon.placedSymbolArray,ge=d.transform.width/d.transform.height;let _e=!1;for(let we=0;we<ie.length;we++){const ae=ie.get(we);if(ae.hidden||ae.writingMode===l.WritingMode.vertical&&!_e){kt(ae.numGlyphs,oe);continue}let Ce;if(_e=!1,L?(Ce=[ae.anchorX,ae.anchorY,L(ae.anchorX,ae.anchorY),1],l.transformMat4(Ce,Ce,o)):(Ce=[ae.anchorX,ae.anchorY,0,1],Zr(Ce,Ce,o)),!Vn(Ce,q)){kt(ae.numGlyphs,oe);continue}const Te=rn(d.transform.cameraToCenterDistance,Ce[3]),Fe=l.evaluateSizeForFeature(B,W,ae),Ne=P?Fe/Te:Fe*Te,$e=new l.pointGeometry(ae.anchorX,ae.anchorY),De=xt($e,_,L).point,ut={},nt=Ft(ae,Ne,!1,I,o,_,b,g.glyphOffsetArray,re,oe,De,$e,ut,ge,M,L);_e=nt.useVertical,(nt.notEnoughRoom||_e||nt.needsFlipping&&Ft(ae,Ne,!0,I,o,_,b,g.glyphOffsetArray,re,oe,De,$e,ut,ge,M,L).notEnoughRoom)&&kt(ae.numGlyphs,oe)}p?g.text.dynamicLayoutVertexBuffer.updateData(oe):g.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Qn(g,o,d,p,_,b,P,I,M,L,B,W,q){const oe=I.glyphStartIndex+I.numGlyphs,re=I.lineStartIndex,ie=I.lineStartIndex+I.lineLength,ge=o.getoffsetX(I.glyphStartIndex),_e=o.getoffsetX(oe-1),we=hr(g*ge,d,p,_,b,P,I.segment,re,ie,M,L,B,W,q);if(!we)return null;const ae=hr(g*_e,d,p,_,b,P,I.segment,re,ie,M,L,B,W,q);return ae?{first:we,last:ae}:null}function Ze(g,o,d,p){return g===l.WritingMode.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*p?{useVertical:!0}:(g===l.WritingMode.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function Ft(g,o,d,p,_,b,P,I,M,L,B,W,q,oe,re,ie){const ge=o/24,_e=g.lineOffsetX*ge,we=g.lineOffsetY*ge;let ae;if(g.numGlyphs>1){const Ce=g.glyphStartIndex+g.numGlyphs,Te=g.lineStartIndex,Fe=g.lineStartIndex+g.lineLength,Ne=Qn(ge,I,_e,we,d,B,W,g,M,b,q,re,ie);if(!Ne)return{notEnoughRoom:!0};const $e=xt(Ne.first.point,P,ie).point,De=xt(Ne.last.point,P,ie).point;if(p&&!d){const ut=Ze(g.writingMode,$e,De,oe);if(ut)return ut}ae=[Ne.first];for(let ut=g.glyphStartIndex+1;ut<Ce-1;ut++)ae.push(hr(ge*I.getoffsetX(ut),_e,we,d,B,W,g.segment,Te,Fe,M,b,q,re,ie));ae.push(Ne.last)}else{if(p&&!d){const Te=xt(W,_,ie).point,Fe=g.lineStartIndex+g.segment+1,Ne=new l.pointGeometry(M.getx(Fe),M.gety(Fe)),$e=xt(Ne,_,ie),De=$e.signedDistanceFromCamera>0?$e.point:Ot(W,Ne,Te,1,_,ie),ut=Ze(g.writingMode,Te,De,oe);if(ut)return ut}const Ce=hr(ge*I.getoffsetX(g.glyphStartIndex),_e,we,d,B,W,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,M,b,q,re,ie);if(!Ce)return{notEnoughRoom:!0};ae=[Ce]}for(const Ce of ae)l.addDynamicAttributes(L,Ce.point,Ce.angle);return{}}function Ot(g,o,d,p,_,b){const P=xt(g.add(g.sub(o)._unit()),_,b).point,I=d.sub(P);return d.add(I._mult(p/I.mag()))}function hr(g,o,d,p,_,b,P,I,M,L,B,W,q,oe){const re=p?g-o:g+o;let ie=re>0?1:-1,ge=0;p&&(ie*=-1,ge=Math.PI),ie<0&&(ge+=Math.PI);let _e=ie>0?I+P:I+P+1,we=_,ae=_,Ce=0,Te=0;const Fe=Math.abs(re),Ne=[];for(;Ce+Te<=Fe;){if(_e+=ie,_e<I||_e>=M)return null;if(ae=we,Ne.push(we),we=W[_e],we===void 0){const ht=new l.pointGeometry(L.getx(_e),L.gety(_e)),Nt=xt(ht,B,oe);if(Nt.signedDistanceFromCamera>0)we=W[_e]=Nt.point;else{const $t=_e-ie;we=Ot(Ce===0?b:new l.pointGeometry(L.getx($t),L.gety($t)),ht,ae,Fe-Ce+1,B,oe)}}Ce+=Te,Te=ae.dist(we)}const $e=(Fe-Ce)/Te,De=we.sub(ae),ut=De.mult($e)._add(ae);ut._add(De._unit()._perp()._mult(d*ie));const nt=ge+Math.atan2(we.y-ae.y,we.x-ae.x);return Ne.push(ut),{point:ut,angle:q?nt:0,path:Ne}}const vi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function kt(g,o){for(let d=0;d<g;d++){const p=o.length;o.resize(p+4),o.float32.set(vi,3*p)}}function Zr(g,o,d){const p=o[0],_=o[1];return g[0]=d[0]*p+d[4]*_+d[12],g[1]=d[1]*p+d[5]*_+d[13],g[3]=d[3]*p+d[7]*_+d[15],g}const or=100;class Ji{constructor(o,d=new Re(o.width+200,o.height+200,25),p=new Re(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+or,this.screenBottomBoundary=o.height+or,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,p,_,b,P){const I=this.projectAndGetPerspectiveRatio(_,o.anchorPointX,o.anchorPointY,P),M=p*I.perspectiveRatio,L=o.x1*M+I.point.x,B=o.y1*M+I.point.y,W=o.x2*M+I.point.x,q=o.y2*M+I.point.y;return!this.isInsideGrid(L,B,W,q)||d!=="always"&&this.grid.hitTest(L,B,W,q,d,b)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[L,B,W,q],offscreen:this.isOffscreen(L,B,W,q)}}placeCollisionCircles(o,d,p,_,b,P,I,M,L,B,W,q,oe,re){const ie=[],ge=new l.pointGeometry(d.anchorX,d.anchorY),_e=xt(ge,P,re),we=rn(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),ae=(B?b/we:b*we)/l.ONE_EM,Ce=xt(ge,I,re).point,Te=Qn(ae,_,d.lineOffsetX*ae,d.lineOffsetY*ae,!1,Ce,ge,d,p,I,{},!1,re);let Fe=!1,Ne=!1,$e=!0;if(Te){const De=.5*q*we+oe,ut=new l.pointGeometry(-100,-100),nt=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ht=new Rt,Nt=Te.first,$t=Te.last;let At=[];for(let nn=Nt.path.length-1;nn>=1;nn--)At.push(Nt.path[nn]);for(let nn=1;nn<$t.path.length;nn++)At.push($t.path[nn]);const bn=2.5*De;if(M){const nn=At.map(on=>xt(on,M,re));At=nn.some(on=>on.signedDistanceFromCamera<=0)?[]:nn.map(on=>on.point)}let wn=[];if(At.length>0){const nn=At[0].clone(),on=At[0].clone();for(let Sn=1;Sn<At.length;Sn++)nn.x=Math.min(nn.x,At[Sn].x),nn.y=Math.min(nn.y,At[Sn].y),on.x=Math.max(on.x,At[Sn].x),on.y=Math.max(on.y,At[Sn].y);wn=nn.x>=ut.x&&on.x<=nt.x&&nn.y>=ut.y&&on.y<=nt.y?[At]:on.x<ut.x||nn.x>nt.x||on.y<ut.y||nn.y>nt.y?[]:l.clipLine([At],ut.x,ut.y,nt.x,nt.y)}for(const nn of wn){ht.reset(nn,.25*De);let on=0;on=ht.length<=.5*De?1:Math.ceil(ht.paddedLength/bn)+1;for(let Sn=0;Sn<on;Sn++){const Vr=Sn/Math.max(on-1,1),js=ht.lerp(Vr),ys=js.x+or,Gs=js.y+or;ie.push(ys,Gs,De,0);const Ro=ys-De,ns=Gs-De,Ei=ys+De,oo=Gs+De;if($e=$e&&this.isOffscreen(Ro,ns,Ei,oo),Ne=Ne||this.isInsideGrid(Ro,ns,Ei,oo),o!=="always"&&this.grid.hitTestCircle(ys,Gs,De,o,W)&&(Fe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!L&&Fe||!Ne||we<this.perspectiveRatioCutoff?[]:ie,offscreen:$e,collisionDetected:Fe}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let p=1/0,_=1/0,b=-1/0,P=-1/0;for(const B of o){const W=new l.pointGeometry(B.x+or,B.y+or);p=Math.min(p,W.x),_=Math.min(_,W.y),b=Math.max(b,W.x),P=Math.max(P,W.y),d.push(W)}const I=this.grid.query(p,_,b,P).concat(this.ignoredGrid.query(p,_,b,P)),M={},L={};for(const B of I){const W=B.key;if(M[W.bucketInstanceId]===void 0&&(M[W.bucketInstanceId]={}),M[W.bucketInstanceId][W.featureIndex])continue;const q=[new l.pointGeometry(B.x1,B.y1),new l.pointGeometry(B.x2,B.y1),new l.pointGeometry(B.x2,B.y2),new l.pointGeometry(B.x1,B.y2)];l.polygonIntersectsPolygon(d,q)&&(M[W.bucketInstanceId][W.featureIndex]=!0,L[W.bucketInstanceId]===void 0&&(L[W.bucketInstanceId]=[]),L[W.bucketInstanceId].push(W.featureIndex))}return L}insertCollisionBox(o,d,p,_,b,P){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:P,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,p,_,b,P){const I=p?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:b,collisionGroupID:P,overlapMode:d};for(let L=0;L<o.length;L+=4)I.insertCircle(M,o[L],o[L+1],o[L+2])}projectAndGetPerspectiveRatio(o,d,p,_){let b;return _?(b=[d,p,_(d,p),1],l.transformMat4(b,b,o)):(b=[d,p,0,1],Zr(b,b,o)),{point:new l.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+or,(-b[1]/b[3]+1)/2*this.transform.height+or),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(o,d,p,_){return p<or||o>=this.screenRightBoundary||_<or||d>this.screenBottomBoundary}isInsideGrid(o,d,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=l.identity([]);return l.translate(o,o,[-100,-100,0]),o}}function er(g,o,d){return o*(l.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}class dr{constructor(o,d,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class sn{constructor(o,d,p,_,b){this.text=new dr(o?o.text:null,d,p,b),this.icon=new dr(o?o.icon:null,d,_,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qi{constructor(o,d,p){this.text=o,this.icon=d,this.skipFade=p}}class xi{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class bi{constructor(o,d,p,_,b){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=b}}class fs{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[o]}}function Ns(g,o,d,p,_){const{horizontalAlign:b,verticalAlign:P}=l.getAnchorAlignment(g),I=-(b-.5)*o,M=-(P-.5)*d,L=l.evaluateVariableOffset(g,p);return new l.pointGeometry(I+L[0]*_,M+L[1]*_)}function es(g,o,d,p,_,b){const{x1:P,x2:I,y1:M,y2:L,anchorPointX:B,anchorPointY:W}=g,q=new l.pointGeometry(o,d);return p&&q._rotate(_?b:-b),{x1:P+q.x,y1:M+q.y,x2:I+q.x,y2:L+q.y,anchorPointX:B,anchorPointY:W}}class te{constructor(o,d,p,_,b){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new Ji(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new fs(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,p,_){const b=p.getBucket(d),P=p.latestFeatureIndex;if(!b||!P||d.id!==b.layerIds[0])return;const I=p.collisionBoxArray,M=b.layers[0].layout,L=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),B=p.tileSize/l.EXTENT,W=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),q=M.get("text-pitch-alignment")==="map",oe=M.get("text-rotation-alignment")==="map",re=er(p,1,this.transform.zoom),ie=On(W,q,oe,this.transform,re);let ge=null;if(q){const we=Ut(W,q,oe,this.transform,re);ge=l.multiply([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[b.bucketInstanceId]=new bi(b.bucketInstanceId,P,b.sourceLayerIndex,b.index,p.tileID);const _e={bucket:b,layout:M,posMatrix:W,textLabelPlaneMatrix:ie,labelToScreenMatrix:ge,scale:L,textPixelRatio:B,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(_)for(const we of b.sortKeyRanges){const{sortKey:ae,symbolInstanceStart:Ce,symbolInstanceEnd:Te}=we;o.push({sortKey:ae,symbolInstanceStart:Ce,symbolInstanceEnd:Te,parameters:_e})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(o,d,p,_,b,P,I,M,L,B,W,q,oe,re,ie,ge){const _e=[q.textOffset0,q.textOffset1],we=Ns(o,p,_,_e,b),ae=this.collisionIndex.placeCollisionBox(es(d,we.x,we.y,P,I,this.transform.angle),W,M,L,B.predicate,ge);if((!ie||this.collisionIndex.placeCollisionBox(es(ie,we.x,we.y,P,I,this.transform.angle),W,M,L,B.predicate,ge).box.length!==0)&&ae.box.length>0){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:_e,width:p,height:_,anchor:o,textBoxScale:b,prevAnchor:Ce},this.markUsedJustification(oe,o,q,re),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,re,q),this.placedOrientations[q.crossTileID]=re),{shift:we,placedGlyphBoxes:ae}}}placeLayerBucketPart(o,d,p){const{bucket:_,layout:b,posMatrix:P,textLabelPlaneMatrix:I,labelToScreenMatrix:M,textPixelRatio:L,holdingForFade:B,collisionBoxArray:W,partiallyEvaluatedTextSize:q,collisionGroup:oe}=o.parameters,re=b.get("text-optional"),ie=b.get("icon-optional"),ge=l.getOverlapMode(b,"text-overlap","text-allow-overlap"),_e=ge==="always",we=l.getOverlapMode(b,"icon-overlap","icon-allow-overlap"),ae=we==="always",Ce=b.get("text-rotation-alignment")==="map",Te=b.get("text-pitch-alignment")==="map",Fe=b.get("icon-text-fit")!=="none",Ne=b.get("symbol-z-order")==="viewport-y",$e=_e&&(ae||!_.hasIconData()||ie),De=ae&&(_e||!_.hasTextData()||re);!_.collisionArrays&&W&&_.deserializeCollisionBoxes(W);const ut=(nt,ht)=>{if(d[nt.crossTileID])return;if(B)return void(this.placements[nt.crossTileID]=new Qi(!1,!1,!1));let Nt=!1,$t=!1,At=!0,bn=null,wn={box:null,offscreen:null},nn={box:null,offscreen:null},on=null,Sn=null,Vr=null,js=0,ys=0,Gs=0;ht.textFeatureIndex?js=ht.textFeatureIndex:nt.useRuntimeCollisionCircles&&(js=nt.featureIndex),ht.verticalTextFeatureIndex&&(ys=ht.verticalTextFeatureIndex);const Ro=this.retainedQueryData[_.bucketInstanceId].tileID,ns=this.terrain?(Dr,Zt)=>this.terrain.getElevation(Ro,Dr,Zt):null;for(const Dr of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Zt=ht[Dr];Zt&&(Zt.elevation=ns?ns(Zt.anchorPointX,Zt.anchorPointY):0)}const Ei=ht.textBox;if(Ei){const Dr=_n=>{let jr=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!_n&&this.prevPlacement){const Gr=this.prevPlacement.placedOrientations[nt.crossTileID];Gr&&(this.placedOrientations[nt.crossTileID]=Gr,jr=Gr,this.markUsedOrientation(_,jr,nt))}return jr},Zt=(_n,jr)=>{if(_.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const Gr of _.writingModes)if(Gr===l.WritingMode.vertical?(wn=jr(),nn=wn):wn=_n(),wn&&wn.box&&wn.box.length)break}else wn=_n()};if(b.get("text-variable-anchor")){let _n=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt.crossTileID]){const Xn=this.prevPlacement.variableOffsets[nt.crossTileID];_n.indexOf(Xn.anchor)>0&&(_n=_n.filter(rs=>rs!==Xn.anchor),_n.unshift(Xn.anchor))}const jr=(Xn,rs,aa)=>{const ld=Xn.x2-Xn.x1,Ka=Xn.y2-Xn.y1,nm=nt.textBoxScale,cd=Fe&&we==="never"?rs:null;let zo={box:[],offscreen:!1};const la=ge!=="never"?2*_n.length:_n.length;for(let ca=0;ca<la;++ca){const uu=this.attemptAnchorPlacement(_n[ca%_n.length],Xn,ld,Ka,nm,Ce,Te,L,P,oe,ca>=_n.length?ge:"never",nt,_,aa,cd,ns);if(uu&&(zo=uu.placedGlyphBoxes,zo&&zo.box&&zo.box.length)){Nt=!0,bn=uu.shift;break}}return zo};Zt(()=>jr(Ei,ht.iconBox,l.WritingMode.horizontal),()=>{const Xn=ht.verticalTextBox;return _.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&nt.numVerticalGlyphVertices>0&&Xn?jr(Xn,ht.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),wn&&(Nt=wn.box,At=wn.offscreen);const Gr=Dr(wn&&wn.box);if(!Nt&&this.prevPlacement){const Xn=this.prevPlacement.variableOffsets[nt.crossTileID];Xn&&(this.variableOffsets[nt.crossTileID]=Xn,this.markUsedJustification(_,Xn.anchor,nt,Gr))}}else{const _n=(jr,Gr)=>{const Xn=this.collisionIndex.placeCollisionBox(jr,ge,L,P,oe.predicate,ns);return Xn&&Xn.box&&Xn.box.length&&(this.markUsedOrientation(_,Gr,nt),this.placedOrientations[nt.crossTileID]=Gr),Xn};Zt(()=>_n(Ei,l.WritingMode.horizontal),()=>{const jr=ht.verticalTextBox;return _.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&jr?_n(jr,l.WritingMode.vertical):{box:null,offscreen:null}}),Dr(wn&&wn.box&&wn.box.length)}}if(on=wn,Nt=on&&on.box&&on.box.length>0,At=on&&on.offscreen,nt.useRuntimeCollisionCircles){const Dr=_.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),Zt=l.evaluateSizeForFeature(_.textSizeData,q,Dr),_n=b.get("text-padding");Sn=this.collisionIndex.placeCollisionCircles(ge,Dr,_.lineVertexArray,_.glyphOffsetArray,Zt,P,I,M,p,Te,oe.predicate,nt.collisionCircleDiameter,_n,ns),Sn.circles.length&&Sn.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Nt=_e||Sn.circles.length>0&&!Sn.collisionDetected,At=At&&Sn.offscreen}if(ht.iconFeatureIndex&&(Gs=ht.iconFeatureIndex),ht.iconBox){const Dr=Zt=>{const _n=Fe&&bn?es(Zt,bn.x,bn.y,Ce,Te,this.transform.angle):Zt;return this.collisionIndex.placeCollisionBox(_n,we,L,P,oe.predicate,ns)};nn&&nn.box&&nn.box.length&&ht.verticalIconBox?(Vr=Dr(ht.verticalIconBox),$t=Vr.box.length>0):(Vr=Dr(ht.iconBox),$t=Vr.box.length>0),At=At&&Vr.offscreen}const oo=re||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,cu=ie||nt.numIconVertices===0;if(oo||cu?cu?oo||($t=$t&&Nt):Nt=$t&&Nt:$t=Nt=$t&&Nt,Nt&&on&&on.box&&this.collisionIndex.insertCollisionBox(on.box,ge,b.get("text-ignore-placement"),_.bucketInstanceId,nn&&nn.box&&ys?ys:js,oe.ID),$t&&Vr&&this.collisionIndex.insertCollisionBox(Vr.box,we,b.get("icon-ignore-placement"),_.bucketInstanceId,Gs,oe.ID),Sn&&(Nt&&this.collisionIndex.insertCollisionCircles(Sn.circles,ge,b.get("text-ignore-placement"),_.bucketInstanceId,js,oe.ID),p)){const Dr=_.bucketInstanceId;let Zt=this.collisionCircleArrays[Dr];Zt===void 0&&(Zt=this.collisionCircleArrays[Dr]=new xi);for(let _n=0;_n<Sn.circles.length;_n+=4)Zt.circles.push(Sn.circles[_n+0]),Zt.circles.push(Sn.circles[_n+1]),Zt.circles.push(Sn.circles[_n+2]),Zt.circles.push(Sn.collisionDetected?1:0)}if(nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new Qi(Nt||$e,$t||De,At||_.justReloaded),d[nt.crossTileID]=!0};if(Ne){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=_.getSortedSymbolIndexes(this.transform.angle);for(let ht=nt.length-1;ht>=0;--ht){const Nt=nt[ht];ut(_.symbolInstances.get(Nt),_.collisionArrays[Nt])}}else for(let nt=o.symbolInstanceStart;nt<o.symbolInstanceEnd;nt++)ut(_.symbolInstances.get(nt),_.collisionArrays[nt]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[_.bucketInstanceId];l.invert(nt.invProjMatrix,P),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(o,d,p,_){let b;b=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(d)];const P=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const I of P)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=b>=0&&I!==b?0:p.crossTileID)}markUsedOrientation(o,d,p){const _=d===l.WritingMode.horizontal||d===l.WritingMode.horizontalOnly?d:0,b=d===l.WritingMode.vertical?d:0,P=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const I of P)o.text.placedSymbolArray.get(I).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const _=d?d.symbolFadeChange(o):1,b=d?d.opacities:{},P=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const M in this.placements){const L=this.placements[M],B=b[M];B?(this.opacities[M]=new sn(B,_,L.text,L.icon),p=p||L.text!==B.text.placed||L.icon!==B.icon.placed):(this.opacities[M]=new sn(null,_,L.text,L.icon,L.skipFade),p=p||L.text||L.icon)}for(const M in b){const L=b[M];if(!this.opacities[M]){const B=new sn(L,_,!1,!1);B.isHidden()||(this.opacities[M]=B,p=p||L.text.placed||L.icon.placed)}}for(const M in P)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=P[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const p={};for(const _ of d){const b=_.getBucket(o);b&&_.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,_.collisionBoxArray)}}updateBucketOpacities(o,d,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,b=new sn(null,0,!1,!1,!0),P=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),M=_.get("text-variable-anchor"),L=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",W=_.get("icon-text-fit")!=="none",q=new sn(null,0,P&&(I||!o.hasIconData()||_.get("icon-optional")),I&&(P||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const oe=(re,ie,ge)=>{for(let _e=0;_e<ie/4;_e++)re.opacityVertexArray.emplaceBack(ge)};for(let re=0;re<o.symbolInstances.length;re++){const ie=o.symbolInstances.get(re),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:_e,crossTileID:we}=ie;let ae=this.opacities[we];d[we]?ae=b:ae||(ae=q,this.opacities[we]=ae),d[we]=!0;const Ce=ie.numIconVertices>0,Te=this.placedOrientations[ie.crossTileID],Fe=Te===l.WritingMode.vertical,Ne=Te===l.WritingMode.horizontal||Te===l.WritingMode.horizontalOnly;if(ge>0||_e>0){const $e=ye(ae.text);oe(o.text,ge,Fe?Ae:$e),oe(o.text,_e,Ne?Ae:$e);const De=ae.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(ht=>{ht>=0&&(o.text.placedSymbolArray.get(ht).hidden=De||Fe?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=De||Ne?1:0);const ut=this.variableOffsets[ie.crossTileID];ut&&this.markUsedJustification(o,ut.anchor,ie,Te);const nt=this.placedOrientations[ie.crossTileID];nt&&(this.markUsedJustification(o,"left",ie,nt),this.markUsedOrientation(o,nt,ie))}if(Ce){const $e=ye(ae.icon),De=!(W&&ie.verticalPlacedIconSymbolIndex&&Fe);ie.placedIconSymbolIndex>=0&&(oe(o.icon,ie.numIconVertices,De?$e:Ae),o.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=ae.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(oe(o.icon,ie.numVerticalIconVertices,De?Ae:$e),o.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const $e=o.collisionArrays[re];if($e){let De=new l.pointGeometry(0,0);if($e.textBox||$e.verticalTextBox){let nt=!0;if(M){const ht=this.variableOffsets[we];ht?(De=Ns(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale),L&&De._rotate(B?this.transform.angle:-this.transform.angle)):nt=!1}$e.textBox&&R(o.textCollisionBox.collisionVertexArray,ae.text.placed,!nt||Fe,De.x,De.y),$e.verticalTextBox&&R(o.textCollisionBox.collisionVertexArray,ae.text.placed,!nt||Ne,De.x,De.y)}const ut=!!(!Ne&&$e.verticalIconBox);$e.iconBox&&R(o.iconCollisionBox.collisionVertexArray,ae.icon.placed,ut,W?De.x:0,W?De.y:0),$e.verticalIconBox&&R(o.iconCollisionBox.collisionVertexArray,ae.icon.placed,!ut,W?De.x:0,W?De.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=re.invProjMatrix,o.placementViewportMatrix=re.viewportMatrix,o.collisionCircleArray=re.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function R(g,o,d,p,_){g.emplaceBack(o?1:0,d?1:0,p||0,_||0),g.emplaceBack(o?1:0,d?1:0,p||0,_||0),g.emplaceBack(o?1:0,d?1:0,p||0,_||0),g.emplaceBack(o?1:0,d?1:0,p||0,_||0)}const j=Math.pow(2,25),K=Math.pow(2,24),Q=Math.pow(2,17),he=Math.pow(2,16),fe=Math.pow(2,9),ue=Math.pow(2,8),ce=Math.pow(2,1);function ye(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,d=Math.floor(127*g.opacity);return d*j+o*K+d*Q+o*he+d*fe+o*ue+d*ce+o}const Ae=0;class je{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,p,_,b){const P=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(P,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((I,M)=>I.sortKey-M.sortKey));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Le{constructor(o,d,p,_,b,P,I,M){this.placement=new te(o,d,P,I,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,p){const _=l.exported.now(),b=()=>{const P=l.exported.now()-_;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=d[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=I)&&(!P.maxzoom||P.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new je(P)),this._inProgressLayer.continuePlacement(p[P.source],this.placement,this._showCollisionBoxes,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ft=512/l.EXTENT/2;class gt{constructor(o,d,p){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<d.length;_++){const b=d.get(_),P=b.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,d){const p=ft/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*l.EXTENT+o.anchorX)*p),y:Math.floor((d.canonical.y*l.EXTENT+o.anchorY)*p)}}findMatches(o,d,p){const _=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let b=0;b<o.length;b++){const P=o.get(b);if(P.crossTileID)continue;const I=this.indexedSymbolInstances[P.key];if(!I)continue;const M=this.getScaledCoordinates(P,d);for(const L of I)if(Math.abs(L.coord.x-M.x)<=_&&Math.abs(L.coord.y-M.y)<=_&&!p[L.crossTileID]){p[L.crossTileID]=!0,P.crossTileID=L.crossTileID;break}}}}class ot{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const p in this.indexes){const _=this.indexes[p],b={};for(const P in _){const I=_[P];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),b[I.tileID.key]=I}this.indexes[p]=b}this.lng=o}addBucket(o,d,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<d.symbolInstances.length;b++)d.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const _=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const P=this.indexes[b];if(Number(b)>o.overscaledZ)for(const I in P){const M=P[I];M.tileID.isChildOf(o)&&M.findMatches(d.symbolInstances,o,_)}else{const I=P[o.scaledTo(Number(b)).key];I&&I.findMatches(d.symbolInstances,o,_)}}for(let b=0;b<d.symbolInstances.length;b++){const P=d.symbolInstances.get(b);P.crossTileID||(P.crossTileID=p.generate(),_[P.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new gt(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const p in d.indexedSymbolInstances)for(const _ of d.indexedSymbolInstances[p])delete this.usedCrossTileIDs[o][_.crossTileID]}removeStaleBuckets(o){let d=!1;for(const p in this.indexes){const _=this.indexes[p];for(const b in _)o[_[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[b]),delete _[b],d=!0)}return d}}class bt{constructor(){this.layerIndexes={},this.crossTileIDs=new ot,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,p){let _=this.layerIndexes[o.id];_===void 0&&(_=this.layerIndexes[o.id]=new Pt);let b=!1;const P={};_.handleWrapJump(p);for(const I of d){const M=I.getBucket(o);M&&o.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(I.tileID,M,this.crossTileIDs)&&(b=!0),P[M.bucketInstanceId]=!0)}return _.removeStaleBuckets(P)&&(b=!0),b}pruneUnusedLayers(o){const d={};o.forEach(p=>{d[p]=!0});for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}var jt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class It extends l.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const d=this._tiles[o];d.textures.forEach(p=>p.destroy()),d.textures=[]}}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];for(const p of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new Dn(p,this.tileSize))}removeOutdated(o){const d={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)d[p]=!0;for(const p of this.renderHistory)d[p]=!0;for(const p in this._tiles)d[p]||(this._tiles[p].clearTextures(o),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const d={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16),l.ortho(b.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),d[p]=b}else if(_.canonical.isChildOf(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const P=_.canonical.z-o.canonical.z,I=_.canonical.x-(_.canonical.x>>P<<P),M=_.canonical.y-(_.canonical.y>>P<<P),L=l.EXTENT>>P;l.ortho(b.posMatrix,0,L,0,L,0,1),l.translate(b.posMatrix,b.posMatrix,[-I*L,-M*L,0]),d[p]=b}else if(o.canonical.isChildOf(_.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const P=o.canonical.z-_.canonical.z,I=o.canonical.x-(o.canonical.x>>P<<P),M=o.canonical.y-(o.canonical.y>>P<<P),L=l.EXTENT>>P;l.ortho(b.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(b.posMatrix,b.posMatrix,[I*L,M*L,0]),l.scale(b.posMatrix,b.posMatrix,[1/2**P,1/2**P,0]),d[p]=b}}return d}getSourceTile(o,d){const p=this.sourceCache._source;let _=o.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(_).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!b||!b.dem)&&d)for(;_>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(o.scaledTo(_--).key);return b}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(d=>d.timeLoaded>=o)}}class Dt{constructor(o,d,p){this.style=o,this.sourceCache=new It(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,d,p,_=l.EXTENT){if(!(d>=0&&d<_&&p>=0&&p<_))return this.elevationOffset;let b=0;const P=this.getTerrainData(o);if(P.tile&&P.tile.dem){const I=l.transformMat4$1([],[d/_*l.EXTENT,p/_*l.EXTENT],P.u_terrain_matrix),M=[I[0]*P.tile.dem.dim,I[1]*P.tile.dem.dim],L=[Math.floor(M[0]),Math.floor(M[1])],B=P.tile.dem.get(L[0],L[1]),W=P.tile.dem.get(L[0],L[1]+1),q=P.tile.dem.get(L[0]+1,L[1]),oe=P.tile.dem.get(L[0]+1,L[1]+1);b=l.number(l.number(B,W,M[0]-L[0]),l.number(q,oe,M[0]-L[0]),M[1]-L[1])}return b}rememberForRerender(o,d){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(d)||_.tileID.isChildOf(d))&&(o===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][_.tileID.key]=!0)}}needsRerender(o,d){return this._rerender[o]&&this._rerender[o][d.key]}clearRerenderCache(){this._rerender={}}getElevation(o,d,p,_=l.EXTENT){return(this.getDEMElevation(o,d,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const _=this.style.map.painter.context,b=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new F(_,b,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new F(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const _=this.style.map.painter.context;d.demTexture=this.style.map.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new F(_,d.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),d.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let b=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=_?b=o.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=o.canonical.x-(o.canonical.x>>b<<b),I=o.canonical.y-(o.canonical.y>>b<<b),M=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<b),1/(l.EXTENT<<b),0]);l.translate(M,M,[P*l.EXTENT,I*l.EXTENT,0]),this._demMatrixCache[o.key]={matrix:M,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const d=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(d,d,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,d,d))}return this._rttFramebuffer}getFramebuffer(o){const d=this.style.map.painter,p=d.width/devicePixelRatio,_=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new F(d.context,{width:p,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new F(d.context,{width:p,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,P=0;b<this._coordsTextureSize;b++)for(let I=0;I<this._coordsTextureSize;I++,P+=4)d[P+0]=255&I,d[P+1]=255&b,d[P+2]=I>>8<<4|b>>8,d[P+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),_=new F(o,p,o.gl.RGBA,{premultiply:!1});return _.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(o){const d=new Uint8Array(4),p=this.style.map.painter,_=p.context,b=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(o.x,p.height/devicePixelRatio-o.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const P=d[0]+(d[2]>>4<<8),I=d[1]+((15&d[2])<<8),M=this.coordsIndex[255-d[3]],L=M&&this.sourceCache.getTileByID(M);if(!L)return null;const B=this._coordsTextureSize,W=(1<<L.tileID.canonical.z)*B;return new l.MercatorCoordinate((L.tileID.canonical.x*B+P)/W,(L.tileID.canonical.y*B+I)/W,this.getElevation(L.tileID,P,I,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,d=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,b=l.EXTENT/_,P=_*_;for(let I=0;I<=_;I++)for(let M=0;M<=_;M++)d.emplaceBack(M*b,I*b);for(let I=0;I<P;I+=_+1)for(let M=0;M<_;M++)p.emplaceBack(M+I,_+M+I+1,_+M+I+2),p.emplaceBack(M+I,_+M+I+2,M+I+1);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(d,jt.members),segments:l.SegmentVector.simpleSegment(0,0,d.length,p.length)},this._mesh}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=(d.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(d.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ht=(g,o)=>l.emitValidationErrors(g,o&&o.filter(d=>d.identifier!=="source.canvas")),Yt=l.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),kn=l.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),Ln=function(){const g={},o=l.spec.$version;for(const d in l.spec.$root){const p=l.spec.$root[d];if(p.required){let _=null;_=d==="version"?o:p.type==="array"?[]:{},_!=null&&(g[d]=_)}}return g}();class zr extends l.Evented{constructor(o,d={}){super(),this.map=o,this.dispatcher=new ze(Un(),this),this.imageManager=new U,this.imageManager.setEventedParent(this),this.glyphManager=new se(o._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Be(256,512),this.crossTileSymbolIndex=new bt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=zr.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(b,P)=>{if(l.triggerPluginCompletionEvent(b),P&&P.every(I=>I))for(const I in p.sourceCaches)p.sourceCaches[I].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const P=b.getSource();if(P&&P.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===P.id&&this._validateLayer(M)}})}loadURL(o,d={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof d.validate!="boolean"||d.validate,_=this.map._requestManager.transformRequest(o,l.ResourceType.Style);this._request=l.getJSON(_,(b,P)=>{this._request=null,b?this.fire(new l.ErrorEvent(b)):P&&this._load(P,p)})}loadJSON(o,d={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(o,d.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Ln,!1)}_load(o,d){if(d&&Ht(this,l.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const p=Ur(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Me(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(d,p,_,b){let P,I,M;const L=_>1?"@2x":"";let B=l.getJSON(p.transformRequest(p.normalizeSpriteURL(d,L,".json"),l.ResourceType.SpriteJSON),(oe,re)=>{B=null,M||(M=oe,P=re,q())}),W=l.getImage(p.transformRequest(p.normalizeSpriteURL(d,L,".png"),l.ResourceType.SpriteImage),(oe,re)=>{W=null,M||(M=oe,I=re,q())});function q(){if(M)b(M);else if(P&&I){const oe=l.exported.getImageData(I),re={};for(const ie in P){const{width:ge,height:_e,x:we,y:ae,sdf:Ce,pixelRatio:Te,stretchX:Fe,stretchY:Ne,content:$e}=P[ie],De=new l.RGBAImage({width:ge,height:_e});l.RGBAImage.copy(oe,De,{x:we,y:ae},{x:0,y:0},{width:ge,height:_e}),re[ie]={data:De,pixelRatio:Te,sdf:Ce,stretchX:Fe,stretchY:Ne,content:$e}}b(null,re)}}return{cancel(){B&&(B.cancel(),B=null),W&&(W.cancel(),W=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(d,p)=>{if(this._spriteRequest=null,d)this.fire(new l.ErrorEvent(d));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const p=o.sourceLayer;if(!p)return;const _=d.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const d=[];for(const p of o){const _=this._layers[p];_.type!=="custom"&&d.push(_.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(_.length||b.length)&&this._updateWorkerLayers(_,b);for(const P in this._updatedSources){const I=this._updatedSources[P];if(I==="reload")this._reloadSource(P);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(P)}}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const b=this.sourceCaches[_];p[_]=b.used,b.used=!1}for(const _ of this._order){const b=this._layers[_];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const _ in p){const b=this.sourceCaches[_];p[_]!==b.used&&b.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(o),this.z=o.zoom,d&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const d=this.sourceCaches[o.source];if(!d)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new Dt(this,d,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),Ht(this,l.validateStyle(o)))return!1;(o=l.clone$1(o)).layers=Ur(o.layers);const d=function(_,b){if(!_)return[{command:Vt.setStyle,args:[b]}];let P=[];try{if(!T(_.version,b.version))return[{command:Vt.setStyle,args:[b]}];T(_.center,b.center)||P.push({command:Vt.setCenter,args:[b.center]}),T(_.zoom,b.zoom)||P.push({command:Vt.setZoom,args:[b.zoom]}),T(_.bearing,b.bearing)||P.push({command:Vt.setBearing,args:[b.bearing]}),T(_.pitch,b.pitch)||P.push({command:Vt.setPitch,args:[b.pitch]}),T(_.sprite,b.sprite)||P.push({command:Vt.setSprite,args:[b.sprite]}),T(_.glyphs,b.glyphs)||P.push({command:Vt.setGlyphs,args:[b.glyphs]}),T(_.transition,b.transition)||P.push({command:Vt.setTransition,args:[b.transition]}),T(_.light,b.light)||P.push({command:Vt.setLight,args:[b.light]});const I={},M=[];(function(B,W,q,oe){let re;for(re in W=W||{},B=B||{})Object.prototype.hasOwnProperty.call(B,re)&&(Object.prototype.hasOwnProperty.call(W,re)||yn(re,q,oe));for(re in W)Object.prototype.hasOwnProperty.call(W,re)&&(Object.prototype.hasOwnProperty.call(B,re)?T(B[re],W[re])||(B[re].type==="geojson"&&W[re].type==="geojson"&&Ki(B,W,re)?q.push({command:Vt.setGeoJSONSourceData,args:[re,W[re].data]}):ui(re,W,q,oe)):cn(re,W,q))})(_.sources,b.sources,M,I);const L=[];_.layers&&_.layers.forEach(B=>{I[B.source]?P.push({command:Vt.removeLayer,args:[B.id]}):L.push(B)}),P=P.concat(M),function(B,W,q){W=W||[];const oe=(B=B||[]).map(Ye),re=W.map(Ye),ie=B.reduce(St,{}),ge=W.reduce(St,{}),_e=oe.slice(),we=Object.create(null);let ae,Ce,Te,Fe,Ne,$e,De;for(ae=0,Ce=0;ae<oe.length;ae++)Te=oe[ae],Object.prototype.hasOwnProperty.call(ge,Te)?Ce++:(q.push({command:Vt.removeLayer,args:[Te]}),_e.splice(_e.indexOf(Te,Ce),1));for(ae=0,Ce=0;ae<re.length;ae++)Te=re[re.length-1-ae],_e[_e.length-1-ae]!==Te&&(Object.prototype.hasOwnProperty.call(ie,Te)?(q.push({command:Vt.removeLayer,args:[Te]}),_e.splice(_e.lastIndexOf(Te,_e.length-Ce),1)):Ce++,$e=_e[_e.length-ae],q.push({command:Vt.addLayer,args:[ge[Te],$e]}),_e.splice(_e.length-ae,0,Te),we[Te]=!0);for(ae=0;ae<re.length;ae++)if(Te=re[ae],Fe=ie[Te],Ne=ge[Te],!we[Te]&&!T(Fe,Ne))if(T(Fe.source,Ne.source)&&T(Fe["source-layer"],Ne["source-layer"])&&T(Fe.type,Ne.type)){for(De in Rr(Fe.layout,Ne.layout,q,Te,null,Vt.setLayoutProperty),Rr(Fe.paint,Ne.paint,q,Te,null,Vt.setPaintProperty),T(Fe.filter,Ne.filter)||q.push({command:Vt.setFilter,args:[Te,Ne.filter]}),T(Fe.minzoom,Ne.minzoom)&&T(Fe.maxzoom,Ne.maxzoom)||q.push({command:Vt.setLayerZoomRange,args:[Te,Ne.minzoom,Ne.maxzoom]}),Fe)Object.prototype.hasOwnProperty.call(Fe,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Rr(Fe[De],Ne[De],q,Te,De.slice(6),Vt.setPaintProperty):T(Fe[De],Ne[De])||q.push({command:Vt.setLayerProperty,args:[Te,De,Ne[De]]}));for(De in Ne)Object.prototype.hasOwnProperty.call(Ne,De)&&!Object.prototype.hasOwnProperty.call(Fe,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Rr(Fe[De],Ne[De],q,Te,De.slice(6),Vt.setPaintProperty):T(Fe[De],Ne[De])||q.push({command:Vt.setLayerProperty,args:[Te,De,Ne[De]]}))}else q.push({command:Vt.removeLayer,args:[Te]}),$e=_e[_e.lastIndexOf(Te)+1],q.push({command:Vt.addLayer,args:[Ne,$e]})}(L,b.layers,P)}catch(I){console.warn("Unable to compute style diff:",I),P=[{command:Vt.setStyle,args:[b]}]}return P}(this.serialize(),o).filter(_=>!(_.command in kn));if(d.length===0)return!1;const p=d.filter(_=>!(_.command in Yt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return d.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,!0}addImage(o,d){if(this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.validateStyle.source,`sources.${o}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const _=this.sourceCaches[o]=new zt(o,d,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:o})),_.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new l.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,p={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let b;if(o.type==="custom"){if(Ht(this,l.validateCustomStyleLayer(o)))return;b=l.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=l.clone$1(o),o=l.extend(o,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,o,{arrayIndex:-1},p))return;b=l.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[b.id]=b.serialize()}const P=d?this._order.indexOf(d):this._order.length;if(d&&P===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${d}".`)));else{if(this._order.splice(P,0,_),this._layerOrderChanged=!0,this._layers[_]=b,this._removedLayers[_]&&b.source&&b.type!=="custom"){const I=this._removedLayers[_];delete this._removedLayers[_],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const p=this._order.indexOf(o);this._order.splice(p,1);const _=d?this._order.indexOf(d):this._order.length;d&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,p){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===d&&_.maxzoom===p||(d!=null&&(_.minzoom=d),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,p={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!T(_.filter,d))return d==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,d,null,p)||(_.filter=l.clone$1(d),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,d,p,_={}){this._checkLoaded();const b=this.getLayer(o);b?T(b.getLayoutProperty(d),p)||(b.setLayoutProperty(d,p,_),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const p=this.getLayer(o);if(p)return p.getLayoutProperty(d);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,p,_={}){this._checkLoaded();const b=this.getLayer(o);b?T(b.getPaintProperty(d),p)||(b.setPaintProperty(d,p,_)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const p=o.source,_=o.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const P=b.getSource().type;P==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||_?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),b.setFeatureState(_,o.id,d)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const p=o.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=_.getSource().type,P=b==="vector"?o.sourceLayer:void 0;b!=="vector"||P?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(P,o.id,d):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,p=o.sourceLayer,_=this.sourceCaches[d];if(_!==void 0)return _.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,o.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=P=>this._layers[P].type==="fill-extrusion",p={},_=[];for(let P=this._order.length-1;P>=0;P--){const I=this._order[P];if(d(I)){p[I]=P;for(const M of o){const L=M[I];if(L)for(const B of L)_.push(B)}}}_.sort((P,I)=>I.intersectionZ-P.intersectionZ);const b=[];for(let P=this._order.length-1;P>=0;P--){const I=this._order[P];if(d(I))for(let M=_.length-1;M>=0;M--){const L=_[M].feature;if(p[L.layer.id]<P)break;b.push(L),_.pop()}else for(const M of o){const L=M[I];if(L)for(const B of L)b.push(B.feature)}}return b}queryRenderedFeatures(o,d,p){d&&d.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const _={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const I=this._layers[P];if(!I)return this.fire(new l.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];_[I.source]=!0}}const b=[];d.availableImages=this._availableImages;for(const P in this.sourceCaches)d.layers&&!_[P]||b.push(xn(this.sourceCaches[P],this._layers,this._serializedLayers,o,d,p));return this.placement&&b.push(function(P,I,M,L,B,W,q){const oe={},re=W.queryRenderedSymbols(L),ie=[];for(const ge of Object.keys(re).map(Number))ie.push(q[ge]);ie.sort(zn);for(const ge of ie){const _e=ge.featureIndex.lookupSymbolFeatures(re[ge.bucketInstanceId],I,ge.bucketIndex,ge.sourceLayerIndex,B.filter,B.layers,B.availableImages,P);for(const we in _e){const ae=oe[we]=oe[we]||[],Ce=_e[we];Ce.sort((Te,Fe)=>{const Ne=ge.featureSortOrder;if(Ne){const $e=Ne.indexOf(Te.featureIndex);return Ne.indexOf(Fe.featureIndex)-$e}return Fe.featureIndex-Te.featureIndex});for(const Te of Ce)ae.push(Te)}}for(const ge in oe)oe[ge].forEach(_e=>{const we=_e.feature,ae=M[P[ge].source].getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=ae});return oe}(this._layers,this._serializedLayers,this.sourceCaches,o,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,d){d&&d.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[o];return p?function(_,b){const P=_.getRenderableIds().map(L=>_.getTileByID(L)),I=[],M={};for(let L=0;L<P.length;L++){const B=P[L],W=B.tileID.canonical.key;M[W]||(M[W]=!0,B.querySourceFeatures(I,b))}return I}(p,d):[]}addSourceType(o,d,p){return zr.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(zr.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const P in o)if(!T(o[P],p[P])){_=!0;break}if(!_)return;const b={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(b)}_validate(o,d,p,_,b={}){return(!b||b.validate!==!1)&&Ht(this,o.call(l.validateStyle,l.extend({key:d,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const d=this.sourceCaches[o];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,p,_,b=!1){let P=!1,I=!1;const M={};for(const L of this._order){const B=this._layers[L];if(B.type!=="symbol")continue;if(!M[B.source]){const q=this.sourceCaches[B.source];M[B.source]=q.getRenderableIds(!0).map(oe=>q.getTileByID(oe)).sort((oe,re)=>re.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(re.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(B,M[B.source],o.center.lng);P=P||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),o.zoom))&&(this.pauseablePlacement=new Le(o,this.terrain,this._order,b,d,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),I=!0),P&&this.pauseablePlacement.placement.setStale()),I||P)for(const L of this._order){const B=this._layers[L];B.type==="symbol"&&this.placement.updateLayerOpacities(B,M[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,p){this.imageManager.getImages(d.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[d.source];_&&_.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(o,d,p){this.glyphManager.getGlyphs(d.stacks,p)}getResource(o,d,p){return l.makeRequest(d,p)}}zr.getSourceType=function(g){return Xt[g]},zr.setSourceType=function(g,o){Xt[g]=o},zr.registerForPluginStateChange=l.registerForPluginStateChange;var ps="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Xr={prelude:hn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:hn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:hn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:hn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:hn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:hn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:hn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:hn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:hn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:hn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ps),terrainDepth:hn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ps),terrainCoords:hn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ps)};function hn(g,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),_=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=b?b.concat(_):_,I={};return{fragmentSource:g=g.replace(d,(M,L,B,W,q)=>(I[q]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${B} ${W} ${q};
#else
uniform ${B} ${W} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${B} ${W} ${q} = u_${q};
#endif
`)),vertexSource:o=o.replace(d,(M,L,B,W,q)=>{const oe=W==="float"?"vec2":"vec4",re=q.match(/color/)?"color":oe;return I[q]?L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${B} ${oe} a_${q};
varying ${B} ${W} ${q};
#else
uniform ${B} ${W} u_${q};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${B} ${W} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${re}(a_${q}, u_${q}_t);
#else
    ${B} ${W} ${q} = u_${q};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${B} ${oe} a_${q};
#else
uniform ${B} ${W} u_${q};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${B} ${W} ${q} = a_${q};
#else
    ${B} ${W} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${B} ${W} ${q} = unpack_mix_${re}(a_${q}, u_${q}_t);
#else
    ${B} ${W} ${q} = u_${q};
#endif
`}),staticAttributes:p,staticUniforms:P}}class ta{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,p,_,b,P,I,M,L){this.context=o;let B=this.boundPaintVertexBuffers.length!==_.length;for(let W=0;!B&&W<_.length;W++)this.boundPaintVertexBuffers[W]!==_[W]&&(B=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===p&&!B&&this.boundIndexBuffer===b&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===M&&this.boundDynamicVertexBuffer3===L?(o.bindVertexArrayOES.set(this.vao),I&&I.bind(),b&&b.dynamicDraw&&b.bind(),M&&M.bind(),L&&L.bind()):this.freshBind(d,p,_,b,P,I,M,L)}freshBind(o,d,p,_,b,P,I,M){let L;const B=o.numAttributes,W=this.context,q=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=M;else{L=W.currentNumAttributes||0;for(let oe=B;oe<L;oe++)q.disableVertexAttribArray(oe)}d.enableAttributes(q,o);for(const oe of p)oe.enableAttributes(q,o);P&&P.enableAttributes(q,o),I&&I.enableAttributes(q,o),M&&M.enableAttributes(q,o),d.bind(),d.setVertexAttribPointers(q,o,b);for(const oe of p)oe.bind(),oe.setVertexAttribPointers(q,o,b);P&&(P.bind(),P.setVertexAttribPointers(q,o,b)),_&&_.bind(),I&&(I.bind(),I.setVertexAttribPointers(q,o,b)),M&&(M.bind(),M.setVertexAttribPointers(q,o,b)),W.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function na(g){const o=[];for(let d=0;d<g.length;d++){if(g[d]===null)continue;const p=g[d].split(" ");o.push(p.pop())}return o}class Fa{constructor(o,d,p,_,b,P,I){const M=o.gl;this.program=M.createProgram();const L=na(p.staticAttributes),B=_?_.getBinderAttributes():[],W=L.concat(B),q=Xr.prelude.staticUniforms?na(Xr.prelude.staticUniforms):[],oe=p.staticUniforms?na(p.staticUniforms):[],re=_?_.getBinderUniforms():[],ie=q.concat(oe).concat(re),ge=[];for(const Ne of ie)ge.indexOf(Ne)<0&&ge.push(Ne);const _e=_?_.defines():[];P&&_e.push("#define OVERDRAW_INSPECTOR;"),I&&_e.push("#define TERRAIN3D;");const we=_e.concat(Xr.prelude.fragmentSource,p.fragmentSource).join(`
`),ae=_e.concat(Xr.prelude.vertexSource,p.vertexSource).join(`
`),Ce=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Ce,we),M.compileShader(Ce),M.attachShader(this.program,Ce);const Te=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Te,ae),M.compileShader(Te),M.attachShader(this.program,Te),this.attributes={};const Fe={};this.numAttributes=W.length;for(let Ne=0;Ne<this.numAttributes;Ne++)W[Ne]&&(M.bindAttribLocation(this.program,Ne,W[Ne]),this.attributes[W[Ne]]=Ne);M.linkProgram(this.program),M.deleteShader(Te),M.deleteShader(Ce);for(let Ne=0;Ne<ge.length;Ne++){const $e=ge[Ne];if($e&&!Fe[$e]){const De=M.getUniformLocation(this.program,$e);De&&(Fe[$e]=De)}}this.fixedUniforms=b(o,Fe),this.terrainUniforms=((Ne,$e)=>({u_depth:new l.Uniform1i(Ne,$e.u_depth),u_terrain:new l.Uniform1i(Ne,$e.u_terrain),u_terrain_dim:new l.Uniform1f(Ne,$e.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Ne,$e.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Ne,$e.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(Ne,$e.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(Ne,$e.u_terrain_exaggeration)}))(o,Fe),this.binderUniforms=_?_.getUniforms(o,Fe):[]}draw(o,d,p,_,b,P,I,M,L,B,W,q,oe,re,ie,ge,_e,we){const ae=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(_),o.setColorMode(b),o.setCullFace(P),M){o.activeTexture.set(ae.TEXTURE2),ae.bindTexture(ae.TEXTURE_2D,M.depthTexture),o.activeTexture.set(ae.TEXTURE3),ae.bindTexture(ae.TEXTURE_2D,M.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(M[Te])}for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(I[Te]);ie&&ie.setUniforms(o,this.binderUniforms,oe,{zoom:re});let Ce=0;switch(d){case ae.LINES:Ce=2;break;case ae.TRIANGLES:Ce=3;break;case ae.LINE_STRIP:Ce=1}for(const Te of q.get()){const Fe=Te.vaos||(Te.vaos={});(Fe[L]||(Fe[L]=new ta)).bind(o,this,B,ie?ie.getPaintVertexBuffers():[],W,Te.vertexOffset,ge,_e,we),ae.drawElements(d,Te.primitiveLength*Ce,ae.UNSIGNED_SHORT,Te.primitiveOffset*Ce*2)}}}function Ba(g,o,d){const p=1/er(d,1,o.transform.tileZoom),_=Math.pow(2,d.tileID.overscaledZ),b=d.tileSize*Math.pow(2,o.transform.tileZoom)/_,P=b*(d.tileID.canonical.x+d.tileID.wrap*_),I=b*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[P>>16,I>>16],u_pixel_coord_lower:[65535&P,65535&I]}}const Po=(g,o,d,p)=>{const _=o.style.light,b=_.properties.get("position"),P=[b.x,b.y,b.z],I=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(I,-o.transform.angle),l.transformMat3(P,P,I);const M=_.properties.get("color");return{u_matrix:g,u_lightpos:P,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+d,u_opacity:p}},ms=(g,o,d,p,_,b,P)=>l.extend(Po(g,o,d,p),Ba(b,o,P),{u_height_factor:-Math.pow(2,_.overscaledZ)/P.tileSize/8}),Na=g=>({u_matrix:g}),Ua=(g,o,d,p)=>l.extend(Na(g),Ba(d,o,p)),Va=(g,o)=>({u_matrix:g,u_world:o}),Fl=(g,o,d,p,_)=>l.extend(Ua(g,o,d,p),{u_world:_}),qc=(g,o,d,p)=>{const _=g.transform;let b,P;if(p.paint.get("circle-pitch-alignment")==="map"){const I=er(d,1,_.zoom);b=!0,P=[I,I]}else b=!1,P=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(o.posMatrix,d,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:P}},ro=(g,o,d)=>{const p=er(d,1,o.zoom),_=Math.pow(2,o.zoom-d.tileID.overscaledZ),b=d.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*_),o.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:b}},Z=(g,o,d=1)=>({u_matrix:g,u_color:o,u_overlay:0,u_overlay_scale:d}),ne=g=>({u_matrix:g}),pe=(g,o,d,p)=>({u_matrix:g,u_extrude_scale:er(o,1,d),u_intensity:p});function ke(g,o){const d=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new l.MercatorCoordinate(0,p/d).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/d).toLngLat().lat]}const He=(g,o,d,p)=>{const _=g.transform;return{u_matrix:_r(g,o,d,p),u_ratio:1/er(o,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},mt=(g,o,d,p,_)=>l.extend(He(g,o,d,_),{u_image:0,u_image_height:p}),qt=(g,o,d,p,_)=>{const b=g.transform,P=Gt(o,b);return{u_matrix:_r(g,o,d,_),u_texsize:o.imageAtlasTexture.size,u_ratio:1/er(o,1,b.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[P,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},tr=(g,o,d,p,_,b)=>{const P=g.lineAtlas,I=Gt(o,g.transform),M=d.layout.get("line-cap")==="round",L=P.getDash(p.from,M),B=P.getDash(p.to,M),W=L.width*_.fromScale,q=B.width*_.toScale;return l.extend(He(g,o,d,b),{u_patternscale_a:[I/W,-L.height/2],u_patternscale_b:[I/q,-B.height/2],u_sdfgamma:P.width/(256*Math.min(W,q)*g.pixelRatio)/2,u_image:0,u_tex_y_a:L.y,u_tex_y_b:B.y,u_mix:_.t})};function Gt(g,o){return 1/er(g,1,o.tileZoom)}function _r(g,o,d,p){return g.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Di=(g,o,d,p,_)=>{return{u_matrix:g,u_tl_parent:o,u_scale_parent:d,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(P=_.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(b=_.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Tp(_.paint.get("raster-hue-rotate"))};var b,P};function Tp(g){g*=Math.PI/180;const o=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Dh=(g,o,d,p,_,b,P,I,M,L)=>{const B=_.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:B.width/B.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:P,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+p,u_texsize:L,u_texture:0}},Zc=(g,o,d,p,_,b,P,I,M,L,B)=>{const W=_.transform;return l.extend(Dh(g,o,d,p,_,b,P,I,M,L),{u_gamma_scale:p?Math.cos(W._pitch)*W.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+B})},Sp=(g,o,d,p,_,b,P,I,M,L)=>l.extend(Zc(g,o,d,p,_,b,P,I,!0,M,!0),{u_texsize_icon:L,u_texture_icon:1}),q0=(g,o,d)=>({u_matrix:g,u_opacity:o,u_color:d}),Z0=(g,o,d,p,_,b)=>l.extend(function(P,I,M,L){const B=M.imageManager.getPattern(P.from.toString()),W=M.imageManager.getPattern(P.to.toString()),{width:q,height:oe}=M.imageManager.getPixelSize(),re=Math.pow(2,L.tileID.overscaledZ),ie=L.tileSize*Math.pow(2,M.transform.tileZoom)/re,ge=ie*(L.tileID.canonical.x+L.tileID.wrap*re),_e=ie*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[q,oe],u_mix:I.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/er(L,1,M.transform.tileZoom),u_pixel_coord_upper:[ge>>16,_e>>16],u_pixel_coord_lower:[65535&ge,65535&_e]}}(p,b,d,_),{u_matrix:g,u_opacity:o}),Oh={fillExtrusion:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_lightpos:new l.Uniform3f(g,o.u_lightpos),u_lightintensity:new l.Uniform1f(g,o.u_lightintensity),u_lightcolor:new l.Uniform3f(g,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(g,o.u_vertical_gradient),u_opacity:new l.Uniform1f(g,o.u_opacity)}),fillExtrusionPattern:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_lightpos:new l.Uniform3f(g,o.u_lightpos),u_lightintensity:new l.Uniform1f(g,o.u_lightintensity),u_lightcolor:new l.Uniform3f(g,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(g,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(g,o.u_height_factor),u_image:new l.Uniform1i(g,o.u_image),u_texsize:new l.Uniform2f(g,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(g,o.u_scale),u_fade:new l.Uniform1f(g,o.u_fade),u_opacity:new l.Uniform1f(g,o.u_opacity)}),fill:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix)}),fillPattern:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_image:new l.Uniform1i(g,o.u_image),u_texsize:new l.Uniform2f(g,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(g,o.u_scale),u_fade:new l.Uniform1f(g,o.u_fade)}),fillOutline:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_world:new l.Uniform2f(g,o.u_world)}),fillOutlinePattern:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_world:new l.Uniform2f(g,o.u_world),u_image:new l.Uniform1i(g,o.u_image),u_texsize:new l.Uniform2f(g,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(g,o.u_scale),u_fade:new l.Uniform1f(g,o.u_fade)}),circle:(g,o)=>({u_camera_to_center_distance:new l.Uniform1f(g,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(g,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(g,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(g,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(g,o.u_matrix)}),collisionBox:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(g,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(g,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(g,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(g,o.u_overscale_factor)}),collisionCircle:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(g,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(g,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(g,o.u_viewport_size)}),debug:(g,o)=>({u_color:new l.UniformColor(g,o.u_color),u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_overlay:new l.Uniform1i(g,o.u_overlay),u_overlay_scale:new l.Uniform1f(g,o.u_overlay_scale)}),clippingMask:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix)}),heatmap:(g,o)=>({u_extrude_scale:new l.Uniform1f(g,o.u_extrude_scale),u_intensity:new l.Uniform1f(g,o.u_intensity),u_matrix:new l.UniformMatrix4f(g,o.u_matrix)}),heatmapTexture:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_world:new l.Uniform2f(g,o.u_world),u_image:new l.Uniform1i(g,o.u_image),u_color_ramp:new l.Uniform1i(g,o.u_color_ramp),u_opacity:new l.Uniform1f(g,o.u_opacity)}),hillshade:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_image:new l.Uniform1i(g,o.u_image),u_latrange:new l.Uniform2f(g,o.u_latrange),u_light:new l.Uniform2f(g,o.u_light),u_shadow:new l.UniformColor(g,o.u_shadow),u_highlight:new l.UniformColor(g,o.u_highlight),u_accent:new l.UniformColor(g,o.u_accent)}),hillshadePrepare:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_image:new l.Uniform1i(g,o.u_image),u_dimension:new l.Uniform2f(g,o.u_dimension),u_zoom:new l.Uniform1f(g,o.u_zoom),u_unpack:new l.Uniform4f(g,o.u_unpack)}),line:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_ratio:new l.Uniform1f(g,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(g,o.u_units_to_pixels)}),lineGradient:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_ratio:new l.Uniform1f(g,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(g,o.u_units_to_pixels),u_image:new l.Uniform1i(g,o.u_image),u_image_height:new l.Uniform1f(g,o.u_image_height)}),linePattern:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_texsize:new l.Uniform2f(g,o.u_texsize),u_ratio:new l.Uniform1f(g,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_image:new l.Uniform1i(g,o.u_image),u_units_to_pixels:new l.Uniform2f(g,o.u_units_to_pixels),u_scale:new l.Uniform3f(g,o.u_scale),u_fade:new l.Uniform1f(g,o.u_fade)}),lineSDF:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_ratio:new l.Uniform1f(g,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(g,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(g,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(g,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(g,o.u_sdfgamma),u_image:new l.Uniform1i(g,o.u_image),u_tex_y_a:new l.Uniform1f(g,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(g,o.u_tex_y_b),u_mix:new l.Uniform1f(g,o.u_mix)}),raster:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_tl_parent:new l.Uniform2f(g,o.u_tl_parent),u_scale_parent:new l.Uniform1f(g,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(g,o.u_buffer_scale),u_fade_t:new l.Uniform1f(g,o.u_fade_t),u_opacity:new l.Uniform1f(g,o.u_opacity),u_image0:new l.Uniform1i(g,o.u_image0),u_image1:new l.Uniform1i(g,o.u_image1),u_brightness_low:new l.Uniform1f(g,o.u_brightness_low),u_brightness_high:new l.Uniform1f(g,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(g,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(g,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(g,o.u_spin_weights)}),symbolIcon:(g,o)=>({u_is_size_zoom_constant:new l.Uniform1i(g,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(g,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(g,o.u_size_t),u_size:new l.Uniform1f(g,o.u_size),u_camera_to_center_distance:new l.Uniform1f(g,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(g,o.u_pitch),u_rotate_symbol:new l.Uniform1i(g,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(g,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(g,o.u_fade_change),u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(g,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(g,o.u_coord_matrix),u_is_text:new l.Uniform1i(g,o.u_is_text),u_pitch_with_map:new l.Uniform1i(g,o.u_pitch_with_map),u_texsize:new l.Uniform2f(g,o.u_texsize),u_texture:new l.Uniform1i(g,o.u_texture)}),symbolSDF:(g,o)=>({u_is_size_zoom_constant:new l.Uniform1i(g,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(g,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(g,o.u_size_t),u_size:new l.Uniform1f(g,o.u_size),u_camera_to_center_distance:new l.Uniform1f(g,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(g,o.u_pitch),u_rotate_symbol:new l.Uniform1i(g,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(g,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(g,o.u_fade_change),u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(g,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(g,o.u_coord_matrix),u_is_text:new l.Uniform1i(g,o.u_is_text),u_pitch_with_map:new l.Uniform1i(g,o.u_pitch_with_map),u_texsize:new l.Uniform2f(g,o.u_texsize),u_texture:new l.Uniform1i(g,o.u_texture),u_gamma_scale:new l.Uniform1f(g,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(g,o.u_is_halo)}),symbolTextAndIcon:(g,o)=>({u_is_size_zoom_constant:new l.Uniform1i(g,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(g,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(g,o.u_size_t),u_size:new l.Uniform1f(g,o.u_size),u_camera_to_center_distance:new l.Uniform1f(g,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(g,o.u_pitch),u_rotate_symbol:new l.Uniform1i(g,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(g,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(g,o.u_fade_change),u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(g,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(g,o.u_coord_matrix),u_is_text:new l.Uniform1i(g,o.u_is_text),u_pitch_with_map:new l.Uniform1i(g,o.u_pitch_with_map),u_texsize:new l.Uniform2f(g,o.u_texsize),u_texsize_icon:new l.Uniform2f(g,o.u_texsize_icon),u_texture:new l.Uniform1i(g,o.u_texture),u_texture_icon:new l.Uniform1i(g,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(g,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(g,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(g,o.u_is_halo)}),background:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_opacity:new l.Uniform1f(g,o.u_opacity),u_color:new l.UniformColor(g,o.u_color)}),backgroundPattern:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_opacity:new l.Uniform1f(g,o.u_opacity),u_image:new l.Uniform1i(g,o.u_image),u_pattern_tl_a:new l.Uniform2f(g,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(g,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(g,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(g,o.u_pattern_br_b),u_texsize:new l.Uniform2f(g,o.u_texsize),u_mix:new l.Uniform1f(g,o.u_mix),u_pattern_size_a:new l.Uniform2f(g,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(g,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(g,o.u_scale_a),u_scale_b:new l.Uniform1f(g,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(g,o.u_tile_units_to_pixels)}),terrain:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_texture:new l.Uniform1i(g,o.u_texture)}),terrainDepth:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix)}),terrainCoords:(g,o)=>({u_matrix:new l.UniformMatrix4f(g,o.u_matrix),u_texture:new l.Uniform1i(g,o.u_texture),u_terrain_coords_id:new l.Uniform1f(g,o.u_terrain_coords_id)})};class Fh{constructor(o,d,p){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nh{constructor(o,d,p,_){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=_,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let p=0;p<this.attributes.length;p++){const _=d.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,d,p){for(let _=0;_<this.attributes.length;_++){const b=this.attributes[_],P=d.attributes[b.name];P!==void 0&&o.vertexAttribPointer(P,b.components,o[Bh[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class mn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pp extends mn{getDefault(){return l.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class X0 extends mn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Bl extends mn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Nl extends mn{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ap extends mn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Oi extends mn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Uh extends mn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Xc extends mn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Yc extends mn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Vh extends mn{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class jh extends mn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Kc extends mn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Gh extends mn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class $h extends mn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Jc extends mn{getDefault(){return l.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Cp extends mn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Ip extends mn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class ja extends mn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Y0 extends mn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class K0 extends mn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class J0 extends mn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Q0 extends mn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class e_ extends mn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class t_ extends mn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Wh extends mn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Qc extends mn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Hh extends mn{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class qh extends mn{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ga extends mn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Mp extends mn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class kp extends mn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class eu extends mn{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class ra extends eu{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Lp extends eu{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class $a{constructor(o,d,p,_){this.context=o,this.width=d,this.height=p;const b=o.gl,P=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new ra(o,P),_&&(this.depthAttachment=new Lp(o,P)),b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class jn{constructor(o,d,p){this.blendFunction=o,this.blendColor=d,this.mask=p}}jn.Replace=[1,0],jn.disabled=new jn(jn.Replace,l.Color.transparent,[!1,!1,!1,!1]),jn.unblended=new jn(jn.Replace,l.Color.transparent,[!0,!0,!0,!0]),jn.alphaBlended=new jn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Rp{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Pp(this),this.clearDepth=new X0(this),this.clearStencil=new Bl(this),this.colorMask=new Nl(this),this.depthMask=new Ap(this),this.stencilMask=new Oi(this),this.stencilFunc=new Uh(this),this.stencilOp=new Xc(this),this.stencilTest=new Yc(this),this.depthRange=new Vh(this),this.depthTest=new jh(this),this.depthFunc=new Kc(this),this.blend=new Gh(this),this.blendFunc=new $h(this),this.blendColor=new Jc(this),this.blendEquation=new Cp(this),this.cullFace=new Ip(this),this.cullFaceSide=new ja(this),this.frontFace=new Y0(this),this.program=new K0(this),this.activeTexture=new J0(this),this.viewport=new Q0(this),this.bindFramebuffer=new e_(this),this.bindRenderbuffer=new t_(this),this.bindTexture=new Wh(this),this.bindVertexBuffer=new Qc(this),this.bindElementBuffer=new Hh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qh(this),this.pixelStoreUnpack=new Ga(this),this.pixelStoreUnpackPremultiplyAlpha=new Mp(this),this.pixelStoreUnpackFlipY=new kp(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Fh(this,o,d)}createVertexBuffer(o,d,p){return new Nh(this,o,d,p)}createRenderbuffer(o,d,p){const _=this.gl,b=_.createRenderbuffer();return this.bindRenderbuffer.set(b),_.renderbufferStorage(_.RENDERBUFFER,o,d,p),this.bindRenderbuffer.set(null),b}createFramebuffer(o,d,p){return new $a(this,o,d,p)}clear({color:o,depth:d}){const p=this.gl;let _=0;o&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){T(o.blendFunction,jn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Qt{constructor(o,d,p){this.func=o,this.mask=d,this.range=p}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const gn=7680;class Fn{constructor(o,d,p,_,b,P){this.test=o,this.ref=d,this.mask=p,this.fail=_,this.depthFail=b,this.pass=P}}Fn.disabled=new Fn({func:519,mask:0},0,0,gn,gn,gn);class qn{constructor(o,d,p){this.enable=o,this.mode=d,this.frontFace=p}}let Ul;function Wa(g,o,d,p,_,b,P){const I=g.context,M=I.gl,L=g.useProgram("collisionBox"),B=[];let W=0,q=0;for(let ae=0;ae<p.length;ae++){const Ce=p[ae],Te=o.getTile(Ce),Fe=Te.getBucket(d);if(!Fe)continue;let Ne=Ce.posMatrix;_[0]===0&&_[1]===0||(Ne=g.translatePosMatrix(Ce.posMatrix,Te,_,b));const $e=P?Fe.textCollisionBox:Fe.iconCollisionBox,De=Fe.collisionCircleArray;if(De.length>0){const ut=l.create(),nt=Ne;l.mul(ut,Fe.placementInvProjMatrix,g.transform.glCoordMatrix),l.mul(ut,ut,Fe.placementViewportMatrix),B.push({circleArray:De,circleOffset:q,transform:nt,invTransform:ut,coord:Ce}),W+=De.length/4,q=W}$e&&L.draw(I,M.LINES,Qt.disabled,Fn.disabled,g.colorModeForRenderPass(),qn.disabled,ro(Ne,g.transform,Te),g.style.terrain&&g.style.terrain.getTerrainData(Ce),d.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,g.transform.zoom,null,null,$e.collisionVertexBuffer)}if(!P||!B.length)return;const oe=g.useProgram("collisionCircle"),re=new l.CollisionCircleLayoutArray;re.resize(4*W),re._trim();let ie=0;for(const ae of B)for(let Ce=0;Ce<ae.circleArray.length/4;Ce++){const Te=4*Ce,Fe=ae.circleArray[Te+0],Ne=ae.circleArray[Te+1],$e=ae.circleArray[Te+2],De=ae.circleArray[Te+3];re.emplace(ie++,Fe,Ne,$e,De,0),re.emplace(ie++,Fe,Ne,$e,De,1),re.emplace(ie++,Fe,Ne,$e,De,2),re.emplace(ie++,Fe,Ne,$e,De,3)}(!Ul||Ul.length<2*W)&&(Ul=function(ae){const Ce=2*ae,Te=new l.QuadTriangleArray;Te.resize(Ce),Te._trim();for(let Fe=0;Fe<Ce;Fe++){const Ne=6*Fe;Te.uint16[Ne+0]=4*Fe+0,Te.uint16[Ne+1]=4*Fe+1,Te.uint16[Ne+2]=4*Fe+2,Te.uint16[Ne+3]=4*Fe+2,Te.uint16[Ne+4]=4*Fe+3,Te.uint16[Ne+5]=4*Fe+0}return Te}(W));const ge=I.createIndexBuffer(Ul,!0),_e=I.createVertexBuffer(re,l.collisionCircleLayout.members,!0);for(const ae of B){const Ce={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(we=g.transform).cameraToCenterDistance,u_viewport_size:[we.width,we.height]};oe.draw(I,M.TRIANGLES,Qt.disabled,Fn.disabled,g.colorModeForRenderPass(),qn.disabled,Ce,g.style.terrain&&g.style.terrain.getTerrainData(ae.coord),d.id,_e,ge,l.SegmentVector.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,g.transform.zoom,null,null,null)}var we;_e.destroy(),ge.destroy()}qn.disabled=new qn(!1,1029,2305),qn.backCCW=new qn(!0,1029,2305);const n_=l.identity(new Float32Array(16));function r_(g,o,d,p,_,b){const{horizontalAlign:P,verticalAlign:I}=l.getAnchorAlignment(g),M=-(P-.5)*o,L=-(I-.5)*d,B=l.evaluateVariableOffset(g,p);return new l.pointGeometry((M/_+B[0])*b,(L/_+B[1])*b)}function zp(g,o,d,p,_,b,P,I,M,L,B){const W=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,oe=g.icon.dynamicLayoutVertexArray,re={};q.clear();for(let ie=0;ie<W.length;ie++){const ge=W.get(ie),_e=g.allowVerticalPlacement&&!ge.placedOrientation,we=ge.hidden||!ge.crossTileID||_e?null:p[ge.crossTileID];if(we){const ae=new l.pointGeometry(ge.anchorX,ge.anchorY),Ce=xt(ae,d?P:b,B),Te=rn(_.cameraToCenterDistance,Ce.signedDistanceFromCamera);let Fe=l.evaluateSizeForFeature(g.textSizeData,M,ge)*Te/l.ONE_EM;d&&(Fe*=g.tilePixelRatio/I);const{width:Ne,height:$e,anchor:De,textOffset:ut,textBoxScale:nt}=we,ht=r_(De,Ne,$e,ut,nt,Fe),Nt=d?xt(ae.add(ht),b,B).point:Ce.point.add(o?ht.rotate(-_.angle):ht),$t=g.allowVerticalPlacement&&ge.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let At=0;At<ge.numGlyphs;At++)l.addDynamicAttributes(q,Nt,$t);L&&ge.associatedIconIndex>=0&&(re[ge.associatedIconIndex]={shiftedAnchor:Nt,angle:$t})}else kt(ge.numGlyphs,q)}if(L){oe.clear();const ie=g.icon.placedSymbolArray;for(let ge=0;ge<ie.length;ge++){const _e=ie.get(ge);if(_e.hidden)kt(_e.numGlyphs,oe);else{const we=re[ge];if(we)for(let ae=0;ae<_e.numGlyphs;ae++)l.addDynamicAttributes(oe,we.shiftedAnchor,we.angle);else kt(_e.numGlyphs,oe)}}g.icon.dynamicLayoutVertexBuffer.updateData(oe)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function i_(g,o,d){return d.iconsInText&&o?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function tu(g,o,d,p,_,b,P,I,M,L,B,W){const q=g.context,oe=q.gl,re=g.transform,ie=I==="map",ge=M==="map",_e=I!=="viewport"&&d.layout.get("symbol-placement")!=="point",we=ie&&!ge&&!_e,ae=!d.layout.get("symbol-sort-key").isConstant();let Ce=!1;const Te=g.depthModeForSublayer(0,Qt.ReadOnly),Fe=d.layout.get("text-variable-anchor"),Ne=[];for(const $e of p){const De=o.getTile($e),ut=De.getBucket(d);if(!ut)continue;const nt=_?ut.text:ut.icon;if(!nt||!nt.segments.get().length)continue;const ht=nt.programConfigurations.get(d.id),Nt=_||ut.sdfIcons,$t=_?ut.textSizeData:ut.iconSizeData,At=ge||re.pitch!==0,bn=g.useProgram(i_(Nt,_,ut),ht),wn=l.evaluateSizeForZoom($t,re.zoom),nn=g.style.terrain&&g.style.terrain.getTerrainData($e);let on,Sn,Vr,js,ys=[0,0],Gs=null;if(_){if(Sn=De.glyphAtlasTexture,Vr=oe.LINEAR,on=De.glyphAtlasTexture.size,ut.iconsInText){ys=De.imageAtlasTexture.size,Gs=De.imageAtlasTexture;const rs=$t.kind==="composite"||$t.kind==="camera";js=At||g.options.rotating||g.options.zooming||rs?oe.LINEAR:oe.NEAREST}}else{const rs=d.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear;Sn=De.imageAtlasTexture,Vr=Nt||g.options.rotating||g.options.zooming||rs||At?oe.LINEAR:oe.NEAREST,on=De.imageAtlasTexture.size}const Ro=er(De,1,g.transform.zoom),ns=On($e.posMatrix,ge,ie,g.transform,Ro),Ei=Ut($e.posMatrix,ge,ie,g.transform,Ro),oo=Fe&&ut.hasTextData(),cu=d.layout.get("icon-text-fit")!=="none"&&oo&&ut.hasIconData();if(_e){const rs=g.style.terrain?(ld,Ka)=>g.style.terrain.getElevation($e,ld,Ka):null,aa=d.layout.get("text-rotation-alignment")==="map";yr(ut,$e.posMatrix,g,_,ns,Ei,ge,L,aa,rs)}const Dr=g.translatePosMatrix($e.posMatrix,De,b,P),Zt=_e||_&&Fe||cu?n_:ns,_n=g.translatePosMatrix(Ei,De,b,P,!0),jr=Nt&&d.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gr;Gr=Nt?ut.iconsInText?Sp($t.kind,wn,we,ge,g,Dr,Zt,_n,on,ys):Zc($t.kind,wn,we,ge,g,Dr,Zt,_n,_,on,!0):Dh($t.kind,wn,we,ge,g,Dr,Zt,_n,_,on);const Xn={program:bn,buffers:nt,uniformValues:Gr,atlasTexture:Sn,atlasTextureIcon:Gs,atlasInterpolation:Vr,atlasInterpolationIcon:js,isSDF:Nt,hasHalo:jr};if(ae&&ut.canOverlap){Ce=!0;const rs=nt.segments.get();for(const aa of rs)Ne.push({segments:new l.SegmentVector([aa]),sortKey:aa.sortKey,state:Xn,terrainData:nn})}else Ne.push({segments:nt.segments,sortKey:0,state:Xn,terrainData:nn})}Ce&&Ne.sort(($e,De)=>$e.sortKey-De.sortKey);for(const $e of Ne){const De=$e.state;if(q.activeTexture.set(oe.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,oe.CLAMP_TO_EDGE),De.atlasTextureIcon&&(q.activeTexture.set(oe.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),De.isSDF){const ut=De.uniformValues;De.hasHalo&&(ut.u_is_halo=1,Vl(De.buffers,$e.segments,d,g,De.program,Te,B,W,ut,$e.terrainData)),ut.u_is_halo=0}Vl(De.buffers,$e.segments,d,g,De.program,Te,B,W,De.uniformValues,$e.terrainData)}}function Vl(g,o,d,p,_,b,P,I,M,L){const B=p.context;_.draw(B,B.gl.TRIANGLES,b,P,I,qn.disabled,M,L,d.id,g.layoutVertexBuffer,g.indexBuffer,o,d.paint,p.transform.zoom,g.programConfigurations.get(d.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function jl(g,o,d,p,_,b,P){const I=g.context.gl,M=d.paint.get("fill-pattern"),L=M&&M.constantOr(1),B=d.getCrossfadeParameters();let W,q,oe,re,ie;P?(q=L&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=I.LINES):(q=L?"fillPattern":"fill",W=I.TRIANGLES);for(const ge of p){const _e=o.getTile(ge);if(L&&!_e.patternsLoaded())continue;const we=_e.getBucket(d);if(!we)continue;const ae=we.programConfigurations.get(d.id),Ce=g.useProgram(q,ae),Te=g.style.terrain&&g.style.terrain.getTerrainData(ge);L&&(g.context.activeTexture.set(I.TEXTURE0),_e.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ae.updatePaintBuffers(B));const Fe=M.constantOr(null);if(Fe&&_e.imageAtlas){const De=_e.imageAtlas,ut=De.patternPositions[Fe.to.toString()],nt=De.patternPositions[Fe.from.toString()];ut&&nt&&ae.setConstantPatternPositions(ut,nt)}const Ne=Te?ge:null,$e=g.translatePosMatrix(Ne?Ne.posMatrix:ge.posMatrix,_e,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(P){re=we.indexBuffer2,ie=we.segments2;const De=[I.drawingBufferWidth,I.drawingBufferHeight];oe=q==="fillOutlinePattern"&&L?Fl($e,g,B,_e,De):Va($e,De)}else re=we.indexBuffer,ie=we.segments,oe=L?Ua($e,g,B,_e):Na($e);Ce.draw(g.context,W,_,g.stencilModeForClipping(ge),b,qn.disabled,oe,Te,d.id,we.layoutVertexBuffer,re,ie,d.paint,g.transform.zoom,ae)}}function Gl(g,o,d,p,_,b,P){const I=g.context,M=I.gl,L=d.paint.get("fill-extrusion-pattern"),B=L.constantOr(1),W=d.getCrossfadeParameters(),q=d.paint.get("fill-extrusion-opacity");for(const oe of p){const re=o.getTile(oe),ie=re.getBucket(d);if(!ie)continue;const ge=g.style.terrain&&g.style.terrain.getTerrainData(oe),_e=ie.programConfigurations.get(d.id),we=g.useProgram(B?"fillExtrusionPattern":"fillExtrusion",_e);B&&(g.context.activeTexture.set(M.TEXTURE0),re.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),_e.updatePaintBuffers(W));const ae=L.constantOr(null);if(ae&&re.imageAtlas){const Ne=re.imageAtlas,$e=Ne.patternPositions[ae.to.toString()],De=Ne.patternPositions[ae.from.toString()];$e&&De&&_e.setConstantPatternPositions($e,De)}const Ce=g.translatePosMatrix(oe.posMatrix,re,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Te=d.paint.get("fill-extrusion-vertical-gradient"),Fe=B?ms(Ce,g,Te,q,oe,W,re):Po(Ce,g,Te,q);we.draw(I,I.gl.TRIANGLES,_,b,P,qn.backCCW,Fe,ge,d.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,d.paint,g.transform.zoom,_e,g.style.terrain&&ie.centroidVertexBuffer)}}function Zh(g,o,d,p,_,b,P){const I=g.context,M=I.gl,L=d.fbo;if(!L)return;const B=g.useProgram("hillshade"),W=g.style.terrain&&g.style.terrain.getTerrainData(o);I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,L.colorAttachment.get()),B.draw(I,M.TRIANGLES,_,b,P,qn.disabled,((q,oe,re,ie)=>{const ge=re.paint.get("hillshade-shadow-color"),_e=re.paint.get("hillshade-highlight-color"),we=re.paint.get("hillshade-accent-color");let ae=re.paint.get("hillshade-illumination-direction")*(Math.PI/180);re.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=q.transform.angle);const Ce=!q.options.moving;return{u_matrix:ie?ie.posMatrix:q.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:ke(0,oe.tileID),u_light:[re.paint.get("hillshade-exaggeration"),ae],u_shadow:ge,u_highlight:_e,u_accent:we}})(g,d,p,W?o:null),W,p.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Dp(g,o,d,p,_,b){const P=g.context,I=P.gl,M=o.dem;if(M&&M.data){const L=M.dim,B=M.stride,W=M.getPixels();if(P.activeTexture.set(I.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(B),o.demTexture){const oe=o.demTexture;oe.update(W,{premultiply:!1}),oe.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new F(P,W,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);P.activeTexture.set(I.TEXTURE0);let q=o.fbo;if(!q){const oe=new F(P,{width:L,height:L,data:null},I.RGBA);oe.bind(I.LINEAR,I.CLAMP_TO_EDGE),q=o.fbo=P.createFramebuffer(L,L,!0),q.colorAttachment.set(oe.texture)}P.bindFramebuffer.set(q.framebuffer),P.viewport.set([0,0,L,L]),g.useProgram("hillshadePrepare").draw(P,I.TRIANGLES,p,_,b,qn.disabled,((oe,re)=>{const ie=re.stride,ge=l.create();return l.ortho(ge,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(ge,ge,[0,-l.EXTENT,0]),{u_matrix:ge,u_image:1,u_dimension:[ie,ie],u_zoom:oe.overscaledZ,u_unpack:re.getUnpackVector()}})(o.tileID,M),null,d.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function nu(g,o,d,p,_,b){const P=p.paint.get("raster-fade-duration");if(!b&&P>0){const I=l.exported.now(),M=(I-g.timeAdded)/P,L=o?(I-o.timeAdded)/P:-1,B=d.getSource(),W=_.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),q=!o||Math.abs(o.tileID.overscaledZ-W)>Math.abs(g.tileID.overscaledZ-W),oe=q&&g.refreshedUponExpiration?1:l.clamp(q?M:1-L,0,1);return g.refreshedUponExpiration&&M>=1&&(g.refreshedUponExpiration=!1),o?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const ru=new l.Color(1,0,0,1),gs=new l.Color(0,1,0,1),Op=new l.Color(0,0,1,1),Xh=new l.Color(1,0,1,1),Fp=new l.Color(0,1,1,1);function ia(g,o,d,p){Ha(g,0,o+d/2,g.transform.width,d,p)}function $l(g,o,d,p){Ha(g,o-d/2,0,d,g.transform.height,p)}function Ha(g,o,d,p,_,b){const P=g.context,I=P.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*g.pixelRatio,d*g.pixelRatio,p*g.pixelRatio,_*g.pixelRatio),P.clear({color:b}),I.disable(I.SCISSOR_TEST)}function s_(g,o,d){const p=g.context,_=p.gl,b=d.posMatrix,P=g.useProgram("debug"),I=Qt.disabled,M=Fn.disabled,L=g.colorModeForRenderPass(),B="$debug",W=g.style.terrain&&g.style.terrain.getTerrainData(d);p.activeTexture.set(_.TEXTURE0),g.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const q=o.getTileByID(d.key).latestRawTileData,oe=Math.floor((q&&q.byteLength||0)/1024),re=o.getTile(d).tileSize,ie=512/Math.min(re,512)*(d.overscaledZ/g.transform.zoom)*.5;let ge=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ge+=` => ${d.overscaledZ}`),function(_e,we){_e.initDebugOverlayCanvas();const ae=_e.debugOverlayCanvas,Ce=_e.context.gl,Te=_e.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,ae.width,ae.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(we,5,5),Te.strokeText(we,5,5),_e.debugOverlayTexture.update(ae),_e.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(g,`${ge} ${oe}kB`),P.draw(p,_.TRIANGLES,I,M,jn.alphaBlended,qn.disabled,Z(b,l.Color.transparent,ie),null,B,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),P.draw(p,_.LINE_STRIP,I,M,L,qn.disabled,Z(b,l.Color.red),W,B,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function iu(g,o,d){const p=g.context,_=p.gl,b=g.colorModeForRenderPass(),P=new Qt(_.LEQUAL,Qt.ReadWrite,g.depthRangeFor3D),I=g.useProgram("terrain"),M=o.getTerrainMesh(),L=o.getTerrainData(d.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,g.width,g.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const B=g.transform.calculatePosMatrix(d.tileID.toUnwrapped());I.draw(p,_.TRIANGLES,P,Fn.disabled,b,qn.backCCW,{u_matrix:B,u_texture:0},L,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}function Bp(g,o,d,p){const _=g.context,b=d.tileSize*o.qualityFactor;d.textures[p]||(d.textures[p]=g.getTileTexture(b)||new F(_,{width:b,height:b,data:null},_.gl.RGBA),d.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&o.sourceCache.renderHistory.unshift(d.tileID.key));const P=o.getRTTFramebuffer();P.colorAttachment.set(d.textures[p].texture),_.bindFramebuffer.set(P.framebuffer),_.viewport.set([0,0,b,b])}class Np{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,d=o.terrain;for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const _=o.sourceCaches[p].getVisibleCoordinates();for(const b of _){const P=d.sourceCache.getTerrainCoords(b);for(const I in P)this._coordsDescendingInv[p][I]||(this._coordsDescendingInv[p][I]=[]),this._coordsDescendingInv[p][I].push(P[I])}}for(const p of o._order){const _=o._layers[p],b=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const P in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][P]=this._coordsDescendingInv[b][P].map(I=>I.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[_][p.tileID.key];b&&b!==p.textureCoords[_]&&p.clearTextures(this.painter),d.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),d.clearRerenderCache(),d.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const d=o.type,p=this.painter,_=p.style._order,b=p.currentLayer,P=b+1===_.length;if(this._renderToTexture[d]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(_[b]),!P))return!0;if(this._renderToTexture[this._prevType]||d==="hillshade"||this._renderToTexture[d]&&P){this._prevType=d;const I=this._stacks.length-1,M=this._stacks[I]||[];for(const L of this._renderableTiles){if(Bp(p,p.style.terrain,L,I),this._rerender[L.tileID.key]){p.context.clear({color:l.Color.transparent});for(let B=0;B<M.length;B++){const W=p.style._layers[M[B]],q=W.source?this._coordsDescendingInv[W.source][L.tileID.key]:[L.tileID];p._renderTileClippingMasks(W,q),p.renderLayer(p,p.style.sourceCaches[W.source],W,q),W.source&&(L.textureCoords[W.source]=this._coordsDescendingInvStr[W.source][L.tileID.key])}}iu(p,p.style.terrain,L)}if(d==="hillshade"){this._stacks.push([_[b]]);for(const L of this._renderableTiles){const B=this._coordsDescendingInv[o.source][L.tileID.key];Bp(p,p.style.terrain,L,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(o,B),p.renderLayer(p,p.style.sourceCaches[o.source],o,B),iu(p,p.style.terrain,L)}return!0}return this._renderToTexture[d]}return!1}}const Wl={symbol:function(g,o,d,p,_){if(g.renderPass!=="translucent")return;const b=Fn.disabled,P=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(I,M,L,B,W,q,oe){const re=M.transform,ie=W==="map",ge=q==="map";for(const _e of I){const we=B.getTile(_e),ae=we.getBucket(L);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const Ce=l.evaluateSizeForZoom(ae.textSizeData,re.zoom),Te=er(we,1,M.transform.zoom),Fe=On(_e.posMatrix,ge,ie,M.transform,Te),Ne=L.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(Ce){const $e=Math.pow(2,re.zoom-we.tileID.overscaledZ);zp(ae,ie,ge,oe,re,Fe,_e.posMatrix,$e,Ce,Ne,M.style.terrain?(De,ut)=>M.style.terrain.getElevation(_e,De,ut):null)}}}(p,g,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),_),d.paint.get("icon-opacity").constantOr(1)!==0&&tu(g,o,d,p,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),b,P),d.paint.get("text-opacity").constantOr(1)!==0&&tu(g,o,d,p,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),b,P),o.map.showCollisionBoxes&&(Wa(g,o,d,p,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Wa(g,o,d,p,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,o,d,p){if(g.renderPass!=="translucent")return;const _=d.paint.get("circle-opacity"),b=d.paint.get("circle-stroke-width"),P=d.paint.get("circle-stroke-opacity"),I=!d.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(b.constantOr(1)===0||P.constantOr(1)===0))return;const M=g.context,L=M.gl,B=g.depthModeForSublayer(0,Qt.ReadOnly),W=Fn.disabled,q=g.colorModeForRenderPass(),oe=[];for(let re=0;re<p.length;re++){const ie=p[re],ge=o.getTile(ie),_e=ge.getBucket(d);if(!_e)continue;const we=_e.programConfigurations.get(d.id),ae=g.useProgram("circle",we),Ce=_e.layoutVertexBuffer,Te=_e.indexBuffer,Fe=g.style.terrain&&g.style.terrain.getTerrainData(ie),Ne={programConfiguration:we,program:ae,layoutVertexBuffer:Ce,indexBuffer:Te,uniformValues:qc(g,ie,ge,d),terrainData:Fe};if(I){const $e=_e.segments.get();for(const De of $e)oe.push({segments:new l.SegmentVector([De]),sortKey:De.sortKey,state:Ne})}else oe.push({segments:_e.segments,sortKey:0,state:Ne})}I&&oe.sort((re,ie)=>re.sortKey-ie.sortKey);for(const re of oe){const{programConfiguration:ie,program:ge,layoutVertexBuffer:_e,indexBuffer:we,uniformValues:ae,terrainData:Ce}=re.state;ge.draw(M,L.TRIANGLES,B,W,q,qn.disabled,ae,Ce,d.id,_e,we,re.segments,d.paint,g.transform.zoom,ie)}},heatmap:function(g,o,d,p){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const _=g.context,b=_.gl,P=Fn.disabled,I=new jn([b.ONE,b.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(M,L,B){const W=M.gl;M.activeTexture.set(W.TEXTURE1),M.viewport.set([0,0,L.width/4,L.height/4]);let q=B.heatmapFbo;if(q)W.bindTexture(W.TEXTURE_2D,q.colorAttachment.get()),M.bindFramebuffer.set(q.framebuffer);else{const oe=W.createTexture();W.bindTexture(W.TEXTURE_2D,oe),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),q=B.heatmapFbo=M.createFramebuffer(L.width/4,L.height/4,!1),function(re,ie,ge,_e){const we=re.gl;we.texImage2D(we.TEXTURE_2D,0,we.RGBA,ie.width/4,ie.height/4,0,we.RGBA,re.extRenderToTextureHalfFloat?re.extTextureHalfFloat.HALF_FLOAT_OES:we.UNSIGNED_BYTE,null),_e.colorAttachment.set(ge)}(M,L,oe,q)}})(_,g,d),_.clear({color:l.Color.transparent});for(let M=0;M<p.length;M++){const L=p[M];if(o.hasRenderableParent(L))continue;const B=o.getTile(L),W=B.getBucket(d);if(!W)continue;const q=W.programConfigurations.get(d.id),oe=g.useProgram("heatmap",q),{zoom:re}=g.transform;oe.draw(_,b.TRIANGLES,Qt.disabled,P,I,qn.disabled,pe(L.posMatrix,B,re,d.paint.get("heatmap-intensity")),null,d.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,d.paint,g.transform.zoom,q)}_.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(_,b){const P=_.context,I=P.gl,M=b.heatmapFbo;if(!M)return;P.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),P.activeTexture.set(I.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new F(P,b.colorRamp,I.RGBA)),L.bind(I.LINEAR,I.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(P,I.TRIANGLES,Qt.disabled,Fn.disabled,_.colorModeForRenderPass(),qn.disabled,((B,W,q,oe)=>{const re=l.create();l.ortho(re,0,B.width,B.height,0,0,1);const ie=B.context.gl;return{u_matrix:re,u_world:[ie.drawingBufferWidth,ie.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}})(_,b),null,b.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,b.paint,_.transform.zoom)}(g,d))},line:function(g,o,d,p){if(g.renderPass!=="translucent")return;const _=d.paint.get("line-opacity"),b=d.paint.get("line-width");if(_.constantOr(1)===0||b.constantOr(1)===0)return;const P=g.depthModeForSublayer(0,Qt.ReadOnly),I=g.colorModeForRenderPass(),M=d.paint.get("line-dasharray"),L=d.paint.get("line-pattern"),B=L.constantOr(1),W=d.paint.get("line-gradient"),q=d.getCrossfadeParameters(),oe=B?"linePattern":M?"lineSDF":W?"lineGradient":"line",re=g.context,ie=re.gl;let ge=!0;for(const _e of p){const we=o.getTile(_e);if(B&&!we.patternsLoaded())continue;const ae=we.getBucket(d);if(!ae)continue;const Ce=ae.programConfigurations.get(d.id),Te=g.context.program.get(),Fe=g.useProgram(oe,Ce),Ne=ge||Fe.program!==Te,$e=g.style.terrain&&g.style.terrain.getTerrainData(_e),De=L.constantOr(null);if(De&&we.imageAtlas){const ht=we.imageAtlas,Nt=ht.patternPositions[De.to.toString()],$t=ht.patternPositions[De.from.toString()];Nt&&$t&&Ce.setConstantPatternPositions(Nt,$t)}const ut=$e?_e:null,nt=B?qt(g,we,d,q,ut):M?tr(g,we,d,M,q,ut):W?mt(g,we,d,ae.lineClipsArray.length,ut):He(g,we,d,ut);if(B)re.activeTexture.set(ie.TEXTURE0),we.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Ce.updatePaintBuffers(q);else if(M&&(Ne||g.lineAtlas.dirty))re.activeTexture.set(ie.TEXTURE0),g.lineAtlas.bind(re);else if(W){const ht=ae.gradients[d.id];let Nt=ht.texture;if(d.gradientVersion!==ht.version){let $t=256;if(d.stepInterpolant){const At=o.getSource().maxzoom,bn=_e.canonical.z===At?Math.ceil(1<<g.transform.maxZoom-_e.canonical.z):1;$t=l.clamp(l.nextPowerOfTwo(ae.maxLineLength/l.EXTENT*1024*bn),256,re.maxTextureSize)}ht.gradient=l.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:$t,image:ht.gradient||void 0,clips:ae.lineClipsArray}),ht.texture?ht.texture.update(ht.gradient):ht.texture=new F(re,ht.gradient,ie.RGBA),ht.version=d.gradientVersion,Nt=ht.texture}re.activeTexture.set(ie.TEXTURE0),Nt.bind(d.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}Fe.draw(re,ie.TRIANGLES,P,g.stencilModeForClipping(_e),I,qn.disabled,nt,$e,d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,g.transform.zoom,Ce,ae.layoutVertexBuffer2),ge=!1}},fill:function(g,o,d,p){const _=d.paint.get("fill-color"),b=d.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const P=g.colorModeForRenderPass(),I=d.paint.get("fill-pattern"),M=g.opaquePassEnabledForLayer()&&!I.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===M){const L=g.depthModeForSublayer(1,g.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly);jl(g,o,d,p,L,P,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const L=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly);jl(g,o,d,p,L,P,!0)}},"fill-extrusion":function(g,o,d,p){const _=d.paint.get("fill-extrusion-opacity");if(_!==0&&g.renderPass==="translucent"){const b=new Qt(g.context.gl.LEQUAL,Qt.ReadWrite,g.depthRangeFor3D);if(_!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Gl(g,o,d,p,b,Fn.disabled,jn.disabled),Gl(g,o,d,p,b,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const P=g.colorModeForRenderPass();Gl(g,o,d,p,b,Fn.disabled,P)}}},hillshade:function(g,o,d,p){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const _=g.context,b=g.depthModeForSublayer(0,Qt.ReadOnly),P=g.colorModeForRenderPass(),[I,M]=g.renderPass==="translucent"?g.stencilConfigForOverlap(p):[{},p];for(const L of M){const B=o.getTile(L);B.needsHillshadePrepare!==void 0&&B.needsHillshadePrepare&&g.renderPass==="offscreen"?Dp(g,B,d,b,Fn.disabled,P):g.renderPass==="translucent"&&Zh(g,L,B,d,b,I[L.overscaledZ],P)}_.viewport.set([0,0,g.width,g.height])},raster:function(g,o,d,p){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!p.length)return;const _=g.context,b=_.gl,P=o.getSource(),I=g.useProgram("raster"),M=g.colorModeForRenderPass(),[L,B]=P instanceof Qe?[{},p]:g.stencilConfigForOverlap(p),W=B[B.length-1].overscaledZ,q=!g.options.moving;for(const oe of B){const re=g.depthModeForSublayer(oe.overscaledZ-W,d.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,b.LESS),ie=o.getTile(oe);ie.registerFadeDuration(d.paint.get("raster-fade-duration"));const ge=o.findLoadedParent(oe,0),_e=nu(ie,ge,o,d,g.transform,g.style.terrain);let we,ae;const Ce=d.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;_.activeTexture.set(b.TEXTURE0),ie.texture.bind(Ce,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(b.TEXTURE1),ge?(ge.texture.bind(Ce,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),we=Math.pow(2,ge.tileID.overscaledZ-ie.tileID.overscaledZ),ae=[ie.tileID.canonical.x*we%1,ie.tileID.canonical.y*we%1]):ie.texture.bind(Ce,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);const Te=g.style.terrain&&g.style.terrain.getTerrainData(oe),Fe=Te?oe:null,Ne=Fe?Fe.posMatrix:g.transform.calculatePosMatrix(oe.toUnwrapped(),q),$e=Di(Ne,ae||[0,0],we||1,_e,d);P instanceof Qe?I.draw(_,b.TRIANGLES,re,Fn.disabled,M,qn.disabled,$e,Te,d.id,P.boundsBuffer,g.quadTriangleIndexBuffer,P.boundsSegments):I.draw(_,b.TRIANGLES,re,L[oe.overscaledZ],M,qn.disabled,$e,Te,d.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}},background:function(g,o,d,p){const _=d.paint.get("background-color"),b=d.paint.get("background-opacity");if(b===0)return;const P=g.context,I=P.gl,M=g.transform,L=M.tileSize,B=d.paint.get("background-pattern");if(g.isPatternMissing(B))return;const W=!B&&_.a===1&&b===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==W)return;const q=Fn.disabled,oe=g.depthModeForSublayer(0,W==="opaque"?Qt.ReadWrite:Qt.ReadOnly),re=g.colorModeForRenderPass(),ie=g.useProgram(B?"backgroundPattern":"background"),ge=p||M.coveringTiles({tileSize:L,terrain:g.style.terrain});B&&(P.activeTexture.set(I.TEXTURE0),g.imageManager.bind(g.context));const _e=d.getCrossfadeParameters();for(const we of ge){const ae=p?we.posMatrix:g.transform.calculatePosMatrix(we.toUnwrapped()),Ce=B?Z0(ae,b,g,B,{tileID:we,tileSize:L},_e):q0(ae,b,_),Te=g.style.terrain&&g.style.terrain.getTerrainData(we);ie.draw(P,I.TRIANGLES,oe,q,re,qn.disabled,Ce,Te,d.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}},debug:function(g,o,d){for(let p=0;p<d.length;p++)s_(g,o,d[p])},custom:function(g,o,d){const p=g.context,_=d.implementation;if(g.renderPass==="offscreen"){const b=_.prerender;b&&(g.setCustomLayerDefaults(),p.setColorMode(g.colorModeForRenderPass()),b.call(_,p.gl,g.transform.customLayerMatrix()),p.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),p.setColorMode(g.colorModeForRenderPass()),p.setStencilMode(Fn.disabled);const b=_.renderingMode==="3d"?new Qt(g.context.gl.LEQUAL,Qt.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,Qt.ReadOnly);p.setDepthMode(b),_.render(p.gl,g.transform.customLayerMatrix()),p.setDirty(),g.setBaseState(),p.bindFramebuffer.set(null)}}};class Yh{constructor(o,d){this.context=new Rp(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=zt.maxUnderzooming+zt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bt,this.gpuTimers={}}resize(o,d,p){if(this.width=o*p,this.height=d*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const o=this.context,d=new l.PosArray;d.emplaceBack(0,0),d.emplaceBack(l.EXTENT,0),d.emplaceBack(0,l.EXTENT),d.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(d,jt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=o.createVertexBuffer(p,jt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(_,We.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const b=new l.PosArray;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,jt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const P=new l.LineStripIndexArray;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(P);const I=new l.TriangleIndexArray;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new F(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const M=this.context.gl;this.stencilClearMode=new Fn({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,d.TRIANGLES,Qt.disabled,this.stencilClearMode,jn.disabled,qn.disabled,ne(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source;const p=this.context,_=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(jn.disabled),p.setDepthMode(Qt.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const I=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,M=this.style.terrain&&this.style.terrain.getTerrainData(P);b.draw(p,_.TRIANGLES,Qt.disabled,new Fn({func:_.ALWAYS,mask:0},I,255,_.KEEP,_.KEEP,_.REPLACE),jn.disabled,qn.disabled,ne(P.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new Fn({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new Fn({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,p=o.sort((P,I)=>I.overscaledZ-P.overscaledZ),_=p[p.length-1].overscaledZ,b=p[0].overscaledZ-_+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const P={};for(let I=0;I<b;I++)P[I+_]=new Fn({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=b,[P,p]}return[{[_]:Fn.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new jn([o.CONSTANT_COLOR,o.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jn.unblended:jn.alphaBlended}depthModeForSublayer(o,d,p){if(!this.opaquePassEnabledForLayer())return Qt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Qt(p||this.context.gl.LEQUAL,d,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,b=this.style.terrain&&new Np(this);for(const L in _){const B=_[L];B.used&&B.prepare(this.context)}const P={},I={},M={};for(const L in _){const B=_[L];P[L]=B.getVisibleCoordinates(),I[L]=P[L].slice().reverse(),M[L]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<p.length;L++)if(this.style._layers[p[L]].is3D()){this.opaquePassCutoff=L;break}if(b){this.opaquePassCutoff=0;const L=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||L.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,W){const q=B.context,oe=q.gl,re=jn.unblended,ie=new Qt(oe.LEQUAL,Qt.ReadWrite,[0,1]),ge=W.getTerrainMesh(),_e=W.sourceCache.getRenderableTiles(),we=B.useProgram("terrainDepth");q.bindFramebuffer.set(W.getFramebuffer("depth").framebuffer),q.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),q.clear({color:l.Color.transparent,depth:1});for(const ae of _e){const Ce=W.getTerrainData(ae.tileID),Te=B.transform.calculatePosMatrix(ae.tileID.toUnwrapped());we.draw(q,oe.TRIANGLES,ie,Fn.disabled,re,qn.backCCW,{u_matrix:Te},Ce,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments)}q.bindFramebuffer.set(null),q.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain),function(B,W){const q=B.context,oe=q.gl,re=jn.unblended,ie=new Qt(oe.LEQUAL,Qt.ReadWrite,[0,1]),ge=W.getTerrainMesh(),_e=W.getCoordsTexture(),we=W.sourceCache.getRenderableTiles(),ae=B.useProgram("terrainCoords");q.bindFramebuffer.set(W.getFramebuffer("coords").framebuffer),q.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),q.clear({color:l.Color.transparent,depth:1}),W.coordsIndex=[];for(const Ce of we){const Te=W.getTerrainData(Ce.tileID);q.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,_e.texture);const Fe=B.transform.calculatePosMatrix(Ce.tileID.toUnwrapped());ae.draw(q,oe.TRIANGLES,ie,Fn.disabled,re,qn.backCCW,{u_matrix:Fe,u_terrain_coords_id:(255-W.coordsIndex.length)/255,u_texture:0},Te,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments),W.coordsIndex.push(Ce.tileID.key)}q.bindFramebuffer.set(null),q.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const L of p){const B=this.style._layers[L];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const W=I[B.source];(B.type==="custom"||W.length)&&this.renderLayer(this,_[B.source],B,W)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!b)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[p[this.currentLayer]],B=_[L.source],W=P[L.source];this._renderTileClippingMasks(L,W),this.renderLayer(this,B,L,W)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const L=this.style._layers[p[this.currentLayer]],B=_[L.source];if(b&&b.renderLayer(L))continue;const W=(L.type==="symbol"?M:I)[L.source];this._renderTileClippingMasks(L,P[L.source]),this.renderLayer(this,B,L,W)}if(this.options.showTileBoundaries){let L,B;Object.values(this.style._layers).forEach(W=>{W.source&&!W.isHidden(this.transform.zoom)&&(W.source!==(B&&B.id)&&(B=this.style.sourceCaches[W.source]),(!L||L.getSource().maxzoom<B.getSource().maxzoom)&&(L=B))}),L&&Wl.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const B=L.transform.padding;ia(L,L.transform.height-(B.top||0),3,ru),ia(L,B.bottom||0,3,gs),$l(L,B.left||0,3,Op),$l(L,L.transform.width-(B.right||0),3,Xh);const W=L.transform.centerPoint;(function(q,oe,re,ie){Ha(q,oe-1,re-10,2,20,ie),Ha(q,oe-10,re-1,20,2,ie)})(L,W.x,L.transform.height-W.y,Fp)}(this),this.context.setDefault()}renderLayer(o,d,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),Wl[p.type](o,d,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let p=this.gpuTimers[o.id];p||(p=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),p.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const d={};for(const p in o){const _=o[p],b=this.context.extTimerQuery,P=b.getQueryObjectEXT(_.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(_.query),d[p]=P}return d}translatePosMatrix(o,d,p,_,b){if(!p[0]&&!p[1])return o;const P=b?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(P){const L=Math.sin(P),B=Math.cos(P);p=[p[0]*B-p[1]*L,p[0]*L+p[1]*B]}const I=[b?p[0]:er(d,p[0],this.transform.zoom),b?p[1]:er(d,p[1],this.transform.zoom),0],M=new Float32Array(16);return l.translate(M,o,I),M}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!d||!p}useProgram(o,d){this.cache=this.cache||{};const p=o+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Fa(this.context,o,Xr[o],d,Oh[o],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new F(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class su{constructor(o,d){this.points=o,this.planes=d}static fromInvProjectionMatrix(o,d,p){const _=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const M=1/(I=l.transformMat4([],I,o))[3]/d*_;return l.mul$1(I,I,[M,M,1/I[3],M])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const M=l.sub([],b[I[0]],b[I[1]]),L=l.sub([],b[I[2]],b[I[1]]),B=l.normalize([],l.cross([],M,L)),W=-l.dot(B,b[I[1]]);return B.concat(W)});return new su(b,P)}}class Hl{constructor(o,d){this.min=o,this.max=d,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(o){const d=[o%2==0,o<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let b=0;b<d.length;b++)p[b]=d[b]?this.min[b]:this.center[b],_[b]=d[b]?this.center[b]:this.max[b];return _[2]=this.max[2],new Hl(p,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<o.planes.length;_++){const b=o.planes[_];let P=0;for(let I=0;I<d.length;I++)l.dot$1(b,d[I])>=0&&P++;if(P===0)return 0;P!==d.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let b=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const M=o.points[I][_]-this.min[_];b=Math.min(b,M),P=Math.max(P,M)}if(P<0||b>this.max[_]-this.min[_])return 0}return 1}}class qa{constructor(o=0,d=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=p,this.right=_}interpolate(o,d,p){return d.top!=null&&o.top!=null&&(this.top=l.number(o.top,d.top,p)),d.bottom!=null&&o.bottom!=null&&(this.bottom=l.number(o.bottom,d.bottom,p)),d.left!=null&&o.left!=null&&(this.left=l.number(o.left,d.left,p)),d.right!=null&&o.right!=null&&(this.right=l.number(o.right,d.right,p)),this}getCenter(o,d){const p=l.clamp((this.left+o-this.right)/2,0,o),_=l.clamp((this.top+d-this.bottom)/2,0,d);return new l.pointGeometry(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new qa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ql{constructor(o,d,p,_,b){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=b===void 0||!!b,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new ql(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const d=-l.wrap(o,-180,180)*Math.PI/180;var p;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,b,P){var I=b[0],M=b[1],L=b[2],B=b[3],W=Math.sin(P),q=Math.cos(P);_[0]=I*q+L*W,_[1]=M*q+B*W,_[2]=I*-W+L*q,_[3]=M*-W+B*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=l.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,p){this._unmodified=!1,this._edgeInsets.interpolate(o,d,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new l.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),b=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),P=this.pointCoordinate(new l.pointGeometry(0,this.height)),I=Math.floor(Math.min(p.x,_.x,b.x,P.x)),M=Math.floor(Math.max(p.x,_.x,b.x,P.x)),L=1;for(let B=I-L;B<=M+L;B++)B!==0&&d.push(new l.UnwrappedTileID(B,o))}return d}coveringTiles(o){var d,p;let _=this.coveringZoomLevel(o);const b=_;if(o.minzoom!==void 0&&_<o.minzoom)return[];o.maxzoom!==void 0&&_>o.maxzoom&&(_=o.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),I=l.MercatorCoordinate.fromLngLat(this.center),M=Math.pow(2,_),L=[M*P.x,M*P.y,0],B=[M*I.x,M*I.y,0],W=su.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let q=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=_);const oe=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,re=ae=>({aabb:new Hl([ae*M,0,0],[(ae+1)*M,M,0]),zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),ie=[],ge=[],_e=_,we=o.reparseOverscaled?b:_;if(this._renderWorldCopies)for(let ae=1;ae<=3;ae++)ie.push(re(-ae)),ie.push(re(ae));for(ie.push(re(0));ie.length>0;){const ae=ie.pop(),Ce=ae.x,Te=ae.y;let Fe=ae.fullyVisible;if(!Fe){const ht=ae.aabb.intersects(W);if(ht===0)continue;Fe=ht===2}const Ne=o.terrain?L:B,$e=ae.aabb.distanceX(Ne),De=ae.aabb.distanceY(Ne),ut=Math.max(Math.abs($e),Math.abs(De)),nt=oe+(1<<_e-ae.zoom)-2;if(ae.zoom===_e||ut>nt&&ae.zoom>=q){const ht=_e-ae.zoom,Nt=L[0]-.5-(Ce<<ht),$t=L[1]-.5-(Te<<ht);ge.push({tileID:new l.OverscaledTileID(ae.zoom===_e?we:ae.zoom,ae.wrap,ae.zoom,Ce,Te),distanceSq:l.sqrLen([B[0]-.5-Ce,B[1]-.5-Te]),tileDistanceToCamera:Math.sqrt(Nt*Nt+$t*$t)})}else for(let ht=0;ht<4;ht++){const Nt=(Ce<<1)+ht%2,$t=(Te<<1)+(ht>>1),At=ae.zoom+1;let bn=ae.aabb.quadrant(ht);if(o.terrain){const wn=new l.OverscaledTileID(At,ae.wrap,At,Nt,$t),nn=o.terrain.getMinMaxElevation(wn),on=(d=nn.minElevation)!==null&&d!==void 0?d:this.elevation,Sn=(p=nn.maxElevation)!==null&&p!==void 0?p:this.elevation;bn=new Hl([bn.min[0],bn.min[1],on],[bn.max[0],bn.max[1],Sn])}ie.push({aabb:bn,zoom:At,x:Nt,y:$t,wrap:ae.wrap,fullyVisible:Fe})}}return ge.sort((ae,Ce)=>ae.distanceSq-Ce.distanceSq).map(ae=>ae.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=l.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(o.lng)*this.worldSize,l.mercatorYfromLat(d)*this.worldSize)}unproject(o){return new l.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,d){const p=l.MercatorCoordinate.fromLngLat(o),_=(1<<this.tileZoom)*l.EXTENT,b=p.x*_,P=p.y*_,I=Math.floor(b/l.EXTENT),M=Math.floor(P/l.EXTENT),L=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,I,M);return d.getElevation(L,b%l.EXTENT,P%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const d=this.pointLocation(this.centerPoint,o),p=this.getElevation(d,o);if(!(this.elevation-p))return;const _=this.getCameraPosition(),b=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),P=l.MercatorCoordinate.fromLngLat(d,p),I=b.x-P.x,M=b.y-P.y,L=b.z-P.z,B=Math.sqrt(I*I+M*M+L*L),W=this.scaleZoom(this.cameraToCenterDistance/B/this.tileSize);this._elevation=p,this._center=d,this.zoom=W}setLocationAtPoint(o,d){const p=this.pointCoordinate(d),_=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),P=new l.MercatorCoordinate(b.x-(p.x-_.x),b.y-(p.y-_.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,d){return d?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,d),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,d){return this.coordinateLocation(this.pointCoordinate(o,d))}locationCoordinate(o){return l.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,d){if(d){const q=d.pointCoordinate(o);if(q!=null)return q}const p=[o.x,o.y,0,1],_=[o.x,o.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const b=p[3],P=_[3],I=p[1]/b,M=_[1]/P,L=p[2]/b,B=_[2]/P,W=L===B?0:(0-L)/(B-L);return new l.MercatorCoordinate(l.number(p[0]/b,_[0]/P,W)/this.worldSize,l.number(I,M,W)/this.worldSize)}coordinatePoint(o,d=0,p=this.pixelMatrix){const _=[o.x*this.worldSize,o.y*this.worldSize,d,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,o))).extend(this.pointLocation(new l.pointGeometry(this.width,o))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,d=!1){const p=o.key,_=d?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const b=o.canonical,P=this.worldSize/this.zoomScale(b.z),I=b.x+Math.pow(2,b.z)*o.wrap,M=l.identity(new Float64Array(16));return l.translate(M,M,[I*P,b.y*P,0]),l.scale(M,M,[P/l.EXTENT,P/l.EXTENT,1]),l.multiply(M,d?this.alignedProjMatrix:this.projMatrix,M),_[p]=new Float32Array(M),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,d,p,_,b=-90,P=90,I=-180,M=180;const L=this.size,B=this._unmodified;if(this.latRange){const oe=this.latRange;b=l.mercatorYfromLat(oe[1])*this.worldSize,P=l.mercatorYfromLat(oe[0])*this.worldSize,o=P-b<L.y?L.y/(P-b):0}if(this.lngRange){const oe=this.lngRange;I=l.wrap(l.mercatorXfromLng(oe[0])*this.worldSize,0,this.worldSize),M=l.wrap(l.mercatorXfromLng(oe[1])*this.worldSize,0,this.worldSize),M<I&&(M+=this.worldSize),d=M-I<L.x?L.x/(M-I):0}const W=this.point,q=Math.max(d||0,o||0);if(q)return this.center=this.unproject(new l.pointGeometry(d?(M+I)/2:W.x,o?(P+b)/2:W.y)),this.zoom+=this.scaleZoom(q),this._unmodified=B,void(this._constraining=!1);if(this.latRange){const oe=W.y,re=L.y/2;oe-re<b&&(_=b+re),oe+re>P&&(_=P-re)}if(this.lngRange){const oe=(I+M)/2,re=l.wrap(W.x,oe-this.worldSize/2,oe+this.worldSize/2),ie=L.x/2;re-ie<I&&(p=I+ie),re+ie>M&&(p=M-ie)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:W.x,_!==void 0?_:W.y)).wrap()),this._unmodified=B,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const b=Math.PI/2+this._pitch,P=this._fov*(.5+o.y/this.height),I=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-b-P,.01,Math.PI-.01)),M=this.getHorizon(),L=2*Math.atan(M/this.cameraToCenterDistance)*(.5+o.y/(2*M)),B=Math.sin(L)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-b-L,.01,Math.PI-.01)),W=Math.cos(Math.PI/2-this._pitch)*I+this.cameraToSeaLevelDistance,q=Math.cos(Math.PI/2-this._pitch)*B+this.cameraToSeaLevelDistance,oe=1.01*Math.min(W,q),re=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,re,oe),_[8]=2*-o.x/this.width,_[9]=2*o.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-d,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ie=this.width%2/2,ge=this.height%2/2,_e=Math.cos(this.angle),we=Math.sin(this.angle),ae=d-Math.round(d)+_e*ie+we*ge,Ce=p-Math.round(p)+_e*ge+we*ie,Te=new Float64Array(_);if(l.translate(Te,Te,[ae>.5?ae-1:ae,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Te,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.pointGeometry(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,o))}getCameraQueryGeometry(o){const d=this.getCameraPoint();if(o.length===1)return[o[0],d];{let p=d.x,_=d.y,b=d.x,P=d.y;for(const I of o)p=Math.min(p,I.x),_=Math.min(_,I.y),b=Math.max(b,I.x),P=Math.max(P,I.y);return[new l.pointGeometry(p,_),new l.pointGeometry(b,_),new l.pointGeometry(b,P),new l.pointGeometry(p,P),new l.pointGeometry(p,_)]}}}class Up{constructor(o){this._hashName=o&&encodeURIComponent(o),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(d,p){let _=!1,b=null;const P=()=>{b=null,_&&(d(),b=setTimeout(P,300),_=!1)};return()=>(_=!0,b||P(),b)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),P=Math.round(d.lng*b)/b,I=Math.round(d.lat*b)/b,M=this._map.getBearing(),L=this._map.getPitch();let B="";if(B+=o?`/${P}/${I}/${p}`:`${p}/${I}/${P}`,(M||L)&&(B+="/"+Math.round(10*M)/10),L&&(B+=`/${Math.round(L)}`),this._hashName){const W=this._hashName;let q=!1;const oe=window.location.hash.slice(1).split("&").map(re=>{const ie=re.split("=")[0];return ie===W?(q=!0,`${ie}=${B}`):re}).filter(re=>re);return q||oe.push(`${W}=${B}`),`#${oe.join("&")}`}return`#${B}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(d=p)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const Zl={linearity:.3,easing:l.bezier(0,0,.3,1)},Vp=l.extend({deceleration:2500,maxSpeed:1400},Zl),jp=l.extend({deceleration:20,maxSpeed:1400},Zl),Gp=l.extend({deceleration:1e3,maxSpeed:360},Zl),Za=l.extend({deceleration:1e3,maxSpeed:90},Zl);class $p{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=l.exported.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)d.zoom+=b.zoomDelta||0,d.bearing+=b.bearingDelta||0,d.pitch+=b.pitchDelta||0,b.panDelta&&d.pan._add(b.panDelta),b.around&&(d.around=b.around),b.pinchAround&&(d.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(d.pan.mag()){const b=Yl(d.pan.mag(),p,l.extend({},Vp,o||{}));_.offset=d.pan.mult(b.amount/d.pan.mag()),_.center=this._map.transform.center,Xl(_,b)}if(d.zoom){const b=Yl(d.zoom,p,jp);_.zoom=this._map.transform.zoom+b.amount,Xl(_,b)}if(d.bearing){const b=Yl(d.bearing,p,Gp);_.bearing=this._map.transform.bearing+l.clamp(b.amount,-179,179),Xl(_,b)}if(d.pitch){const b=Yl(d.pitch,p,Za);_.pitch=this._map.transform.pitch+b.amount,Xl(_,b)}if(_.zoom||_.bearing){const b=d.pinchAround===void 0?d.around:d.pinchAround;_.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function Xl(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function Yl(g,o,d){const{maxSpeed:p,linearity:_,deceleration:b}=d,P=l.clamp(g*_/(o/1e3),-p,p),I=Math.abs(P)/(b*_);return{easing:d.easing,duration:1e3*I,amount:P*(I/2)}}class Fi extends l.Event{constructor(o,d,p,_={}){const b=S.mousePos(d.getCanvasContainer(),p),P=d.unproject(b);super(o,l.extend({point:b,lngLat:P,originalEvent:p},_)),this._defaultPrevented=!1,this.target=d}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Kl extends l.Event{constructor(o,d,p){const _=o==="touchend"?p.changedTouches:p.touches,b=S.touchPos(d.getCanvasContainer(),_),P=b.map(M=>d.unproject(M)),I=b.reduce((M,L,B,W)=>M.add(L.div(W.length)),new l.pointGeometry(0,0));super(o,{points:b,point:I,lngLats:P,lngLat:d.unproject(I),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Bi extends l.Event{constructor(o,d,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class o_{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Bi(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Fi(o.type,this._map,o))}mouseup(o){this._map.fire(new Fi(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Fi(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Fi(o.type,this._map,o))}mouseover(o){this._map.fire(new Fi(o.type,this._map,o))}mouseout(o){this._map.fire(new Fi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Kl(o.type,this._map,o))}touchmove(o){this._map.fire(new Kl(o.type,this._map,o))}touchend(o){this._map.fire(new Kl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Kl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ao{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Fi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Fi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wp{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(S.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=S.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(_.x,p.x),P=Math.max(_.x,p.x),I=Math.min(_.y,p.y),M=Math.max(_.y,p.y);S.setTransform(this._box,`translate(${b}px,${I}px)`),this._box.style.width=P-b+"px",this._box.style.height=M-I+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const p=this._startPos,_=d;if(this.reset(),S.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new l.Event(o,{originalEvent:d}))}}function io(g,o){if(g.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${o.length}`);const d={};for(let p=0;p<g.length;p++)d[g[p].identifier]=o[p];return d}class Jl{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const b=new l.pointGeometry(0,0);for(const P of _)b._add(P);return b.div(_.length)}(d),this.touches=io(p,d)))}touchmove(o,d,p){if(this.aborted||!this.centroid)return;const _=io(p,d);for(const b in this.touches){const P=this.touches[b],I=_[b];(!I||I.dist(P)>30)&&(this.aborted=!0)}}touchend(o,d,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Kh{constructor(o){this.singleTap=new Jl(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,p){this.singleTap.touchstart(o,d,p)}touchmove(o,d,p){this.singleTap.touchmove(o,d,p)}touchend(o,d,p){const _=this.singleTap.touchend(o,d,p);if(_){const b=o.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(_)<30;if(b&&P||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class a_{constructor(){this._zoomIn=new Kh({numTouches:1,numTaps:2}),this._zoomOut=new Kh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,p){this._zoomIn.touchstart(o,d,p),this._zoomOut.touchstart(o,d,p)}touchmove(o,d,p){this._zoomIn.touchmove(o,d,p),this._zoomOut.touchmove(o,d,p)}touchend(o,d,p){const _=this._zoomIn.touchend(o,d,p),b=this._zoomOut.touchend(o,d,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(_)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const l_={0:1,2:2};class ou{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const p=S.mouseButton(o);this._correctButton(o,p)&&(this._lastPoint=d,this._eventButton=p)}mousemoveWindow(o,d){const p=this._lastPoint;if(p){if(o.preventDefault(),function(_,b){const P=l_[b];return _.buttons===void 0||(_.buttons&P)!==P}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(p,d)}}mouseupWindow(o){this._lastPoint&&S.mouseButton(o)===this._eventButton&&(this._moved&&S.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql extends ou{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class so extends ou{_correctButton(o,d){return d===0&&o.ctrlKey||d===2}_move(o,d){const p=.8*(d.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class pt extends ou{_correctButton(o,d){return d===0&&o.ctrlKey||d===2}_move(o,d){const p=-.5*(d.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class Hp{constructor(o,d){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,d,p){return this._calculateTransform(o,d,p)}touchmove(o,d,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,d,p)}touchend(o,d,p){this._calculateTransform(o,d,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,p){p.length>0&&(this._active=!0);const _=io(p,d),b=new l.pointGeometry(0,0),P=new l.pointGeometry(0,0);let I=0;for(const L in _){const B=_[L],W=this._touches[L];W&&(b._add(B),P._add(B.sub(W)),I++,_[L]=B)}if(this._touches=_,I<this._minTouches||!P.mag())return;const M=P.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,d,p){return{}}touchstart(o,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,p){if(!this._firstTwoTouches)return;o.preventDefault();const[_,b]=this._firstTwoTouches,P=Co(p,d,_),I=Co(p,d,b);if(!P||!I)return;const M=this._aroundCenter?null:P.add(I).div(2);return this._move([P,I],M,o)}touchend(o,d,p){if(!this._firstTwoTouches)return;const[_,b]=this._firstTwoTouches,P=Co(p,d,_),I=Co(p,d,b);P&&I||(this._active&&S.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Co(g,o,d){for(let p=0;p<g.length;p++)if(g[p].identifier===d)return o[p]}function Jh(g,o){return Math.log(g/o)/Math.LN2}class at extends sa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Jh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jh(this._distance,p),pinchAround:d}}}function au(g,o){return 180*g.angleWith(o)/Math.PI}class c_ extends sa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:au(this._vector,p),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,p=au(o,this._startVector);return Math.abs(p)<d}}function Qh(g){return Math.abs(g.y)>Math.abs(g.x)}class ed extends sa{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,p){super.touchstart(o,d,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Qh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,b,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,p){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,b=d.mag()>=2;if(!_&&!b)return;if(!_||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const P=o.y>0==d.y>0;return Qh(o)&&Qh(d)&&P}}const qp={panStep:100,bearingStep:15,pitchStep:10};class Zp{constructor(){const o=qp;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,p=0,_=0,b=0,P=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),P=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:u_,zoom:d?Math.round(M)+d*(o.shiftKey?2:1):M,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+_*this._pitchStep,offset:[-b*this._panStep,-P*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function u_(g){return g*(2-g)}const Xp=4.000244140625;class td{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%Xp==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=S.mousePos(this._el,o);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Xp?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&M!==0&&(M=1/M);const L=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(L*M))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,_=this._easing;let b,P=!1;if(this._type==="wheel"&&p&&_){const I=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),M=_(I);b=l.number(p,d,M),I<1?this._frameId||(this._frameId=!0):P=!0}else b=d,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,b=p.easing(_+.01)-p.easing(_),P=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-P*P);d=l.bezier(P,I,.25,1)}return this._prevEase={start:l.exported.now(),duration:o,easing:d},d}reset(){this._active=!1}}class nd{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rd{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class id{constructor(){this._tap=new Kh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,d,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=d[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,d,p))}touchmove(o,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=d[0],b=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,d,p)}touchend(o,d,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,d,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wi{constructor(o,d,p){this._el=o,this._mousePan=d,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Io{constructor(o,d,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yp{constructor(o,d,p,_){this._el=o,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xa=g=>g.zoom||g.drag||g.pitch||g.rotate;class sd extends l.Event{}function ec(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Kp{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $p(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,b,P]of this._listeners)S.addEventListener(_,b,_===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[o,d,p]of this._listeners)S.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new o_(d,o));const _=d.boxZoom=new Wp(d,o);this._add("boxZoom",_);const b=new a_,P=new rd;d.doubleClickZoom=new nd(P,b),this._add("tapZoom",b),this._add("clickZoom",P);const I=new id;this._add("tapDragZoom",I);const M=d.touchPitch=new ed(d);this._add("touchPitch",M);const L=new so(o),B=new pt(o);d.dragRotate=new Io(o,L,B),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const W=new Ql(o),q=new Hp(o,d);d.dragPan=new wi(p,W,q),this._add("mousePan",W),this._add("touchPan",q,["touchZoom","touchRotate"]);const oe=new c_,re=new at;d.touchZoomRotate=new Yp(p,re,oe,I),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]);const ie=d.scrollZoom=new td(d,this);this._add("scrollZoom",ie,["mousePan"]);const ge=d.keyboard=new Zp;this._add("keyboard",ge),this._add("blockableMapEvent",new Ao(d));for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[_e]&&d[_e].enable(o[_e])}_add(o,d,p){this._handlers.push({handlerName:o,handler:d,allowed:p}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xa(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,p){for(const _ in o)if(_!==p&&(!d||d.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const p of o)this._el.contains(p.target)&&d.push(p);return d}handleEvent(o,d){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=o.type==="renderFrame"?void 0:o,_={needsRenderFrame:!1},b={},P={},I=o.touches,M=I?this._getMapTouches(I):void 0,L=M?S.touchPos(this._el,M):S.mousePos(this._el,o);for(const{handlerName:q,handler:oe,allowed:re}of this._handlers){if(!oe.isEnabled())continue;let ie;this._blockedByActive(P,re,q)?oe.reset():oe[d||o.type]&&(ie=oe[d||o.type](o,L,M),this.mergeHandlerResult(_,b,ie,q,p),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||oe.isActive())&&(P[q]=oe)}const B={};for(const q in this._previousActiveHandlers)P[q]||(B[q]=p);this._previousActiveHandlers=P,(Object.keys(B).length||ec(_))&&(this._changes.push([_,b,B]),this._triggerRenderFrame()),(Object.keys(P).length||ec(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=_;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))}mergeHandlerResult(o,d,p,_,b){if(!p)return;l.extend(o,p);const P={handlerName:_,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(d.zoom=P),p.panDelta!==void 0&&(d.drag=P),p.pitchDelta!==void 0&&(d.pitch=P),p.bearingDelta!==void 0&&(d.rotate=P)}_applyChanges(){const o={},d={},p={};for(const[_,b,P]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),l.extend(d,b),l.extend(p,P);this._updateMapTransform(o,d,p),this._changes=[]}_updateMapTransform(o,d,p){const _=this._map,b=_.transform,P=_.style&&_.style.terrain;if(!(ec(o)||P&&this._drag))return this._fireEvents(d,p,!0);let{panDelta:I,zoomDelta:M,bearingDelta:L,pitchDelta:B,around:W,pinchAround:q}=o;q!==void 0&&(W=q),_._stop(!0),W=W||_.transform.centerPoint;const oe=b.pointLocation(I?W.sub(I):W);L&&(b.bearing+=L),B&&(b.pitch+=B),M&&(b.zoom+=M),P?d.drag&&!this._drag?(this._drag={center:b.centerPoint,lngLat:b.pointLocation(W),point:W,handlerName:d.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):d.drag&&this._drag&&(b.center=b.pointLocation(b.centerPoint.sub(I))):b.setLocationAtPoint(oe,W),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,p,!0)}_fireEvents(o,d,p){const _=Xa(this._eventsInProgress),b=Xa(o),P={};for(const B in o){const{originalEvent:W}=o[B];this._eventsInProgress[B]||(P[`${B}start`]=W),this._eventsInProgress[B]=o[B]}!_&&b&&this._fireEvent("movestart",b.originalEvent);for(const B in P)this._fireEvent(B,P[B]);b&&this._fireEvent("move",b.originalEvent);for(const B in o){const{originalEvent:W}=o[B];this._fireEvent(B,W)}const I={};let M;for(const B in this._eventsInProgress){const{handlerName:W,originalEvent:q}=this._eventsInProgress[B];this._handlersById[W].isActive()||(delete this._eventsInProgress[B],M=d[W]||q,I[`${B}end`]=M)}for(const B in I)this._fireEvent(B,I[B]);const L=Xa(this._eventsInProgress);if(p&&(_||b)&&!L){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;B?(W(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:M})):(this._map.fire(new l.Event("moveend",{originalEvent:M})),W(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new l.Event(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new sd("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ts={extend:(g,...o)=>l.extend(g,...o),run(g){g()},logToElement(g,o=!1,d="log"){const p=window.document.getElementById(d);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${g}`)}};class Zn extends l.Evented{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,p){return o=l.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,l.extend({offset:o},d),p)}panTo(o,d,p){return this.easeTo(l.extend({center:o},d),p)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,p){return this.easeTo(l.extend({zoom:o},d),p)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,p){return this.easeTo(l.extend({bearing:o},d),p)}resetNorth(o,d){return this.rotateTo(0,l.extend({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=l.LngLatBounds.convert(o);const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,d)}_cameraForBoxAndBearing(o,d,p,_){const b={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const Te=_.padding;_.padding={top:Te,bottom:Te,right:Te,left:Te}}_.padding=l.extend(b,_.padding);const P=this.transform,I=P.padding,M=P.project(l.LngLat.convert(o)),L=P.project(l.LngLat.convert(d)),B=M.rotate(-p*Math.PI/180),W=L.rotate(-p*Math.PI/180),q=new l.pointGeometry(Math.max(B.x,W.x),Math.max(B.y,W.y)),oe=new l.pointGeometry(Math.min(B.x,W.x),Math.min(B.y,W.y)),re=q.sub(oe),ie=(P.width-(I.left+I.right+_.padding.left+_.padding.right))/re.x,ge=(P.height-(I.top+I.bottom+_.padding.top+_.padding.bottom))/re.y;if(ge<0||ie<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _e=Math.min(P.scaleZoom(P.scale*Math.min(ie,ge)),_.maxZoom),we=l.pointGeometry.convert(_.offset),ae=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Ce=we.add(ae).mult(P.scale/P.zoomScale(_e));return{center:P.unproject(M.add(L).div(2).sub(Ce)),zoom:_e,bearing:p}}fitBounds(o,d,p){return this._fitInternal(this.cameraForBounds(o,d),d,p)}fitScreenCoordinates(o,d,p,_,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(o)),this.transform.pointLocation(l.pointGeometry.convert(d)),p,_),_,b)}_fitInternal(o,d,p){return o?(delete(d=l.extend(o,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(o,d){this.stop();const p=this.transform;let _=!1,b=!1,P=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=l.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(b=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(P=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this.fire(new l.Event("movestart",d)).fire(new l.Event("move",d)),_&&this.fire(new l.Event("zoomstart",d)).fire(new l.Event("zoom",d)).fire(new l.Event("zoomend",d)),b&&this.fire(new l.Event("rotatestart",d)).fire(new l.Event("rotate",d)).fire(new l.Event("rotateend",d)),P&&this.fire(new l.Event("pitchstart",d)).fire(new l.Event("pitch",d)).fire(new l.Event("pitchend",d)),this.fire(new l.Event("moveend",d))}calculateCameraOptionsFromTo(o,d,p,_=0){const b=l.MercatorCoordinate.fromLngLat(o,d),P=l.MercatorCoordinate.fromLngLat(p,_),I=P.x-b.x,M=P.y-b.y,L=P.z-b.z,B=Math.hypot(I,M,L);if(B===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(I,M),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/B/this.transform.tileSize),oe=180*Math.atan2(I,-M)/Math.PI;let re=180*Math.acos(W/B)/Math.PI;return re=L<0?90-re:90+re,{center:P.toLngLat(),zoom:q,pitch:re,bearing:oe}}easeTo(o,d){this._stop(!1,o.easeId),((o=l.extend({offset:[0,0],duration:500,easing:l.ease},o)).animate===!1||!o.essential&&l.exported.prefersReducedMotion)&&(o.duration=0);const p=this.transform,_=this.getZoom(),b=this.getBearing(),P=this.getPitch(),I=this.getPadding(),M="zoom"in o?+o.zoom:_,L="bearing"in o?this._normalizeBearing(o.bearing,b):b,B="pitch"in o?+o.pitch:P,W="padding"in o?o.padding:p.padding,q=l.pointGeometry.convert(o.offset);let oe=p.centerPoint.add(q);const re=p.pointLocation(oe),ie=l.LngLat.convert(o.center||re);this._normalizeCenter(ie);const ge=p.project(re),_e=p.project(ie).sub(ge),we=p.zoomScale(M-_);let ae,Ce;o.around&&(ae=l.LngLat.convert(o.around),Ce=p.locationPoint(ae));const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==_,this._rotating=this._rotating||b!==L,this._pitching=this._pitching||B!==P,this._padding=!p.isPaddingEqual(W),this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Te),this._ease(Fe=>{if(this._zooming&&(p.zoom=l.number(_,M,Fe)),this._rotating&&(p.bearing=l.number(b,L,Fe)),this._pitching&&(p.pitch=l.number(P,B,Fe)),this._padding&&(p.interpolatePadding(I,W,Fe),oe=p.centerPoint.add(q)),ae)p.setLocationAtPoint(ae,Ce);else{const Ne=p.zoomScale(p.zoom-_),$e=M>_?Math.min(2,we):Math.max(.5,we),De=Math.pow($e,1-Fe),ut=p.unproject(ge.add(_e.mult(Fe*De)).mult(Ne));p.setLocationAtPoint(p.renderWorldCopies?ut.wrap():ut,oe)}this._fireMoveEvents(d)},Fe=>{this._afterEase(d,Fe)},o),this}_prepareEase(o,d,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),d||p.moving||this.fire(new l.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new l.Event("move",o)),this._zooming&&this.fire(new l.Event("zoom",o)),this._rotating&&this.fire(new l.Event("rotate",o)),this._pitching&&this.fire(new l.Event("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",o)),_&&this.fire(new l.Event("rotateend",o)),b&&this.fire(new l.Event("pitchend",o)),this.fire(new l.Event("moveend",o))}flyTo(o,d){if(!o.essential&&l.exported.prefersReducedMotion){const At=l.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(At,d)}this.stop(),o=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},o);const p=this.transform,_=this.getZoom(),b=this.getBearing(),P=this.getPitch(),I=this.getPadding(),M="zoom"in o?l.clamp(+o.zoom,p.minZoom,p.maxZoom):_,L="bearing"in o?this._normalizeBearing(o.bearing,b):b,B="pitch"in o?+o.pitch:P,W="padding"in o?o.padding:p.padding,q=p.zoomScale(M-_),oe=l.pointGeometry.convert(o.offset);let re=p.centerPoint.add(oe);const ie=p.pointLocation(re),ge=l.LngLat.convert(o.center||ie);this._normalizeCenter(ge);const _e=p.project(ie),we=p.project(ge).sub(_e);let ae=o.curve;const Ce=Math.max(p.width,p.height),Te=Ce/q,Fe=we.mag();if("minZoom"in o){const At=l.clamp(Math.min(o.minZoom,_,M),p.minZoom,p.maxZoom),bn=Ce/p.zoomScale(At-_);ae=Math.sqrt(bn/Fe*2)}const Ne=ae*ae;function $e(At){const bn=(Te*Te-Ce*Ce+(At?-1:1)*Ne*Ne*Fe*Fe)/(2*(At?Te:Ce)*Ne*Fe);return Math.log(Math.sqrt(bn*bn+1)-bn)}function De(At){return(Math.exp(At)-Math.exp(-At))/2}function ut(At){return(Math.exp(At)+Math.exp(-At))/2}const nt=$e(0);let ht=function(At){return ut(nt)/ut(nt+ae*At)},Nt=function(At){return Ce*((ut(nt)*(De(bn=nt+ae*At)/ut(bn))-De(nt))/Ne)/Fe;var bn},$t=($e(1)-nt)/ae;if(Math.abs(Fe)<1e-6||!isFinite($t)){if(Math.abs(Ce-Te)<1e-6)return this.easeTo(o,d);const At=Te<Ce?-1:1;$t=Math.abs(Math.log(Te/Ce))/ae,Nt=function(){return 0},ht=function(bn){return Math.exp(At*ae*bn)}}return o.duration="duration"in o?+o.duration:1e3*$t/("screenSpeed"in o?+o.screenSpeed/ae:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=b!==L,this._pitching=B!==P,this._padding=!p.isPaddingEqual(W),this._prepareEase(d,!1),this._ease(At=>{const bn=At*$t,wn=1/ht(bn);p.zoom=At===1?M:_+p.scaleZoom(wn),this._rotating&&(p.bearing=l.number(b,L,At)),this._pitching&&(p.pitch=l.number(P,B,At)),this._padding&&(p.interpolatePadding(I,W,At),re=p.centerPoint.add(oe));const nn=At===1?ge:p.unproject(_e.add(we.mult(Nt(bn))).mult(wn));p.setLocationAtPoint(p.renderWorldCopies?nn.wrap():nn,re),this._fireMoveEvents(d)},()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,d)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,d,p){p.animate===!1||p.duration===0?(o(1),d()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=l.wrap(o,-180,180);const p=Math.abs(o-d);return Math.abs(o-360-d)<p&&(o-=360),Math.abs(o+360-d)<p&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const p=o.lng-d.center.lng;o.lng+=p>180?-360:p<-180?360:0}}class tc{constructor(o={}){this.options=o,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=S.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=S.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const p=this._map._getUIString(`AttributionControl.${d}`);o.title=p,o.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const d=this._map.style.sourceCaches;for(const _ in d){const b=d[_];if(b.used||b.usedForTerrain){const P=b.getSource();P.attribution&&o.indexOf(P.attribution)<0&&o.push(P.attribution)}}o=o.filter(_=>String(_).trim()),o.sort((_,b)=>_.length-b.length),o=o.filter((_,b)=>{for(let P=b+1;P<o.length;P++)if(o[P].indexOf(_)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class lu{constructor(o={}){this.options=o,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=S.create("div","maplibregl-ctrl mapboxgl-ctrl");const d=S.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){S.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact","mapboxgl-compact"):d.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Jp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Qp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},em={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},h_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Us{constructor(o,d,p=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new so({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new pt({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),S.addEventListener(d,"mousedown",this.mousedown),S.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(d,"touchmove",this.touchmove),S.addEventListener(d,"touchend",this.touchend),S.addEventListener(d,"touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),S.disableDrag()}move(o,d){const p=this.map,_=this.mouseRotate.mousemoveWindow(o,d);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(o,d);b&&b.pitchDelta&&p.setPitch(p.getPitch()+b.pitchDelta)}}off(){const o=this.element;S.removeEventListener(o,"mousedown",this.mousedown),S.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(o,"touchmove",this.touchmove),S.removeEventListener(o,"touchend",this.touchend),S.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){S.enableDrag(),S.removeEventListener(window,"mousemove",this.mousemove),S.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(l.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),S.mousePos(this.element,o)),S.addEventListener(window,"mousemove",this.mousemove),S.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,S.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function nc(g,o,d){if(g=new l.LngLat(g.lng,g.lat),o){const p=new l.LngLat(g.lng-360,g.lat),_=new l.LngLat(g.lng+360,g.lat),b=d.locationPoint(g).distSqr(o);d.locationPoint(p).distSqr(o)<b?g=p:d.locationPoint(_).distSqr(o)<b&&(g=_)}for(;Math.abs(g.lng-d.center.lng)>180;){const p=d.locationPoint(g);if(p.x>=0&&p.y>=0&&p.x<=d.width&&p.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const vt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mt(g,o,d){const p=g.classList;for(const _ in vt)p.remove(`maplibregl-${d}-anchor-${_}`,`mapboxgl-${d}-anchor-${_}`);p.add(`maplibregl-${d}-anchor-${o}`,`mapboxgl-${d}-anchor-${o}`)}class Ya extends l.Evented{constructor(o,d){if(super(),(o instanceof HTMLElement||d)&&(o=l.extend({element:o},d)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=l.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div"),this._element.setAttribute("aria-label","Map marker");const p=S.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${b}px`),p.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const P=S.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");const I=S.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const M=S.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const we of L){const ae=S.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",we.rx),ae.setAttributeNS(null,"ry",we.ry),M.appendChild(ae)}const B=S.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const W=S.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(W);const q=S.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const oe=S.createNS("http://www.w3.org/2000/svg","path");oe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(oe);const re=S.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),re.setAttributeNS(null,"fill","#FFFFFF");const ie=S.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=S.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const _e=S.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),ie.appendChild(ge),ie.appendChild(_e),I.appendChild(M),I.appendChild(B),I.appendChild(q),I.appendChild(re),I.appendChild(ie),p.appendChild(I),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),Mt(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const d=o.code,p=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,p=this._element;this._popup&&(d===p||p.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=nc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,`${vt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${d}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),b=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*b?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=l.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const od={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mo,Yr=0,ko=!1;const Vs={maxWidth:100,unit:"metric"};function tm(g,o,d){const p=d&&d.maxWidth||100,_=g._container.clientHeight/2,b=g.unproject([0,_]),P=g.unproject([p,_]),I=b.distanceTo(P);if(d&&d.unit==="imperial"){const M=3.2808*I;M>5280?Lo(o,p,M/5280,g._getUIString("ScaleControl.Miles")):Lo(o,p,M,g._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Lo(o,p,I/1852,g._getUIString("ScaleControl.NauticalMiles")):I>=1e3?Lo(o,p,I/1e3,g._getUIString("ScaleControl.Kilometers")):Lo(o,p,I,g._getUIString("ScaleControl.Meters"))}function Lo(g,o,d,p){const _=function(b){const P=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/P;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const L=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*L)/L}(I),P*I}(d);g.style.width=o*(_/d)+"px",g.innerHTML=`${_}&nbsp;${p}`}const fr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Tr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ad(g){if(g){if(typeof g=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(g,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,g),"top-left":new l.pointGeometry(o,o),"top-right":new l.pointGeometry(-o,o),bottom:new l.pointGeometry(0,-g),"bottom-left":new l.pointGeometry(o,-o),"bottom-right":new l.pointGeometry(-o,-o),left:new l.pointGeometry(g,0),right:new l.pointGeometry(-g,0)}}if(g instanceof l.pointGeometry||Array.isArray(g)){const o=l.pointGeometry.convert(g);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.pointGeometry.convert(g.center||[0,0]),top:l.pointGeometry.convert(g.top||[0,0]),"top-left":l.pointGeometry.convert(g["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(g["top-right"]||[0,0]),bottom:l.pointGeometry.convert(g.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(g["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(g["bottom-right"]||[0,0]),left:l.pointGeometry.convert(g.left||[0,0]),right:l.pointGeometry.convert(g.right||[0,0])}}return ad(new l.pointGeometry(0,0))}const oa={supported:m,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Zn{constructor(g){var o;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(g=l.extend({},em,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ql(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Jp,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Qp,g.locale),this._clickTolerance=g.clickTolerance,this._pixelRatio=(o=g.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new z(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Kp(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Up(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,l.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new tc({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new lu,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new l.Event(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new l.Event(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new l.Event("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,o,d,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(d,this.style.terrain)),super.calculateCameraOptionsFromTo(g,o,d,p)}resize(g){const o=this._containerDimensions(),d=o[0],p=o[1];this._resizeCanvas(d,p,this.getPixelRatio()),this.transform.resize(d,p),this.painter.resize(d,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",g)).fire(new l.Event("move",g))),this.fire(new l.Event("resize",g)),_&&this.fire(new l.Event("moveend",g)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(g){const[o,d]=this._containerDimensions();this._pixelRatio=g,this._resizeCanvas(o,d,g),this.painter.resize(o,d,g)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(l.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(l.LngLat.convert(g),this.style&&this.style.terrain)}unproject(g){return this.transform.pointLocation(l.pointGeometry.convert(g),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(g,o,d){if(g==="mouseenter"||g==="mouseover"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:b=>{const P=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];P.length?p||(p=!0,d.call(this,new Fi(g,this,b.originalEvent,{features:P}))):p=!1},mouseout:()=>{p=!1}}}}if(g==="mouseleave"||g==="mouseout"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:P=>{(this.getLayer(o)?this.queryRenderedFeatures(P.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,d.call(this,new Fi(g,this,P.originalEvent)))},mouseout:P=>{p&&(p=!1,d.call(this,new Fi(g,this,P.originalEvent)))}}}}{const p=_=>{const b=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];b.length&&(_.features=b,d.call(this,_),delete _.features)};return{layer:o,listener:d,delegates:{[g]:p}}}}on(g,o,d){if(d===void 0)return super.on(g,o);const p=this._createDelegatedListener(g,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(g,o,d){if(d===void 0)return super.once(g,o);const p=this._createDelegatedListener(g,o,d);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(g,o,d){return d===void 0?super.off(g,o):(this._delegatedListeners&&this._delegatedListeners[g]&&(p=>{const _=this._delegatedListeners[g];for(let b=0;b<_.length;b++){const P=_[b];if(P.layer===o&&P.listener===d){for(const I in P.delegates)this.off(I,P.delegates[I]);return _.splice(b,1),this}}})(),this)}queryRenderedFeatures(g,o){if(!this.style)return[];let d;if(o!==void 0||g===void 0||g instanceof l.pointGeometry||Array.isArray(g)||(o=g,g=void 0),o=o||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof g[0]=="number")d=[l.pointGeometry.convert(g)];else{const p=l.pointGeometry.convert(g[0]),_=l.pointGeometry.convert(g[1]);d=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(g,o){return this.style.querySourceFeatures(g,o)}setStyle(g,o){return(o=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(g,o))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new zr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,o){if(typeof g=="string"){const d=this._requestManager.transformRequest(g,l.ResourceType.Style);l.getJSON(d,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,o)})}else typeof g=="object"&&this._updateDiff(g,o)}_updateDiff(g,o){try{this.style.setState(g)&&this._update(!0)}catch(d){l.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(g,o){return this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)}isSourceLoaded(g){const o=this.style&&this.style.sourceCaches[g];if(o!==void 0)return o.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){return this.style.setTerrain(g),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const o in g){const d=g[o]._tiles;for(const p in d){const _=d[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(g,o,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,o,d)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,o,{pixelRatio:d=1,sdf:p=!1,stretchX:_,stretchY:b,content:P}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||l.isImageBitmap(o)){const{width:I,height:M,data:L}=l.exported.getImageData(o);this.style.addImage(g,{data:new l.RGBAImage({width:I,height:M},L),pixelRatio:d,stretchX:_,stretchY:b,content:P,sdf:p,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:M,data:L}=o,B=o;this.style.addImage(g,{data:new l.RGBAImage({width:I,height:M},new Uint8Array(L)),pixelRatio:d,stretchX:_,stretchY:b,content:P,sdf:p,version:0,userImage:B}),B.onAdd&&B.onAdd(this,g)}}}updateImage(g,o){const d=this.style.getImage(g);if(!d)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||l.isImageBitmap(o)?l.exported.getImageData(o):o,{width:_,height:b,data:P}=p;if(_===void 0||b===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==d.data.width||b!==d.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||l.isImageBitmap(o));d.data.replace(P,I),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,o){l.getImage(this._requestManager.transformRequest(g,l.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(g,o){return this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)}moveLayer(g,o){return this.style.moveLayer(g,o),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,o,d){return this.style.setLayerZoomRange(g,o,d),this._update(!0)}setFilter(g,o,d={}){return this.style.setFilter(g,o,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,o,d,p={}){return this.style.setPaintProperty(g,o,d,p),this._update(!0)}getPaintProperty(g,o){return this.style.getPaintProperty(g,o)}setLayoutProperty(g,o,d,p={}){return this.style.setLayoutProperty(g,o,d,p),this._update(!0)}getLayoutProperty(g,o){return this.style.getLayoutProperty(g,o)}setLight(g,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,o){return this.style.setFeatureState(g,o),this._update()}removeFeatureState(g,o){return this.style.removeFeatureState(g,o),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,o=0;return this._container&&(g=this._container.clientWidth||400,o=this._container.clientHeight||300),[g,o]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=S.create("div","maplibregl-canvas-container mapboxgl-canvas-container",g);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=S.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions();this._resizeCanvas(d[0],d[1],this.getPixelRatio());const p=this._controlContainer=S.create("div","maplibregl-control-container mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=S.create("div",`maplibregl-ctrl-${b} mapboxgl-ctrl-${b}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const g=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=S.create("div","maplibregl-cooperative-gesture-screen",g);let o="Control",d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(g,o,d){this._canvas.width=d*g,this._canvas.height=d*o,this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const g=l.extend({},m.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);o?(this.painter=new Yh(o,this.transform),l.exported$1.testSupport(o)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(g,o,d){return!o&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){let o,d=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,o),d=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,I=l.exported.now();this.style.zoomHistory.update(P,I);const M=new l.EvaluationParameters(P,{now:I,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=M.crossFadingFactor();L===1&&L===this._crossFadingFactor||(_=!0,this._crossFadingFactor=L),this.style.update(M)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=l.exported.now()-d;p.endQueryEXT(p.TIME_ELAPSED_EXT,o),setTimeout(()=>{const I=p.getQueryObjectEXT(o,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(o),this.fire(new l.Event("gpu-timing-frame",{cpuTime:P,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(P);this.fire(new l.Event("gpu-timing-layer",{layerTimes:I}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty;return b||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),S.remove(this._canvasContainer),S.remove(this._controlContainer),this._cooperativeGestures&&S.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(g=>{l.PerformanceUtils.frame(g),this._frame=null,this._render(g)}))}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}_setCacheLimits(g,o){l.setCacheLimits(g,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(g){this.options=l.extend({},h_,g),this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map.getZoom(),o=g===this._map.getMaxZoom(),d=g===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const g=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=g}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Us(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,o){const d=S.create("button",g,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(g,o){const d=this._map._getUIString(`NavigationControl.${o}`);g.title=d,g.setAttribute("aria-label",d)}},GeolocateControl:class extends l.Evented{constructor(g){super(),this.options=l.extend({},od,g),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(g){var o;return this._map=g,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,Mo!==void 0?o(Mo):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Mo=d.state!=="denied",o(Mo)}):(Mo=!!window.navigator.geolocation,o(Mo)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yr=0,ko=!1}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),d=g.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",g)),this._finish()}}_updateCamera(g){const o=new l.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),_,{geolocateSource:!0})}_updateMarker(g){if(g){const o=new l.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._container.clientHeight/2,o=this._map.unproject([0,g]),d=this._map.unproject([1,g]),p=o.distanceTo(d),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&ko)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=S.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ya(this._dotElement),this._circleElement=S.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ya({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yr--,ko=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yr++,Yr>1?(g={maximumAge:6e5,timeout:0},ko=!0):(g=this.options.positionOptions,ko=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:tc,LogoControl:lu,ScaleControl:class{constructor(g){this.options=l.extend({},Vs,g),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){tm(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,tm(this._map,this._container,this.options)}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){S.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=S.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(g){this.options=g,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(g){return this._map=g,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=S.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){S.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(g){super(),this.options=l.extend(Object.create(fr),g),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=g;p=d.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=S.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(g){this._update(g.point)}_onMouseMove(g){this._update(g.point)}_onDrag(g){this._update(g.point)}_update(g){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=S.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=S.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(b=>this._container.classList.add(b)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!g))return;const o=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat);let d=this.options.anchor;const p=ad(this.options.offset);if(!d){const b=this._container.offsetWidth,P=this._container.offsetHeight;let I;I=o.y+p.bottom.y<P?["top"]:o.y>this._map.transform.height-P?["bottom"]:[],o.x<b/2?I.push("left"):o.x>this._map.transform.width-b/2&&I.push("right"),d=I.length===0?"bottom":I.join("-")}const _=o.add(p[d]).round();S.setTransform(this._container,`${vt[d]} translate(${_.x}px,${_.y}px)`),Mt(this._container,d,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Tr);g&&g.focus()}_onClose(){this.remove()}},Marker:Ya,Style:zr,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:tn,GeoJSONSource:en,ImageSource:Qe,RasterDEMTileSource:Je,RasterTileSource:st,VectorTileSource:et,VideoSource:Tt,prewarm:function(){Un().acquire(Hn)},clearPrewarmedResources:function(){const g=Jt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Hn),Jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return pn.workerCount},set workerCount(g){pn.workerCount=g},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){l.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){l.clearTileCache(g)},workerUrl:"",addProtocol(g,o){l.config.REGISTERED_PROTOCOLS[g]=o},removeProtocol(g){delete l.config.REGISTERED_PROTOCOLS[g]}};return ts.extend(oa,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),oa});var h=i;return h})})(_M);var lD=_M.exports;const cD=$y(lD);function dy(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const qb=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),$T=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);$T&&parseFloat($T[1]);const uD="3.4.8";function Ca(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Pg=typeof process!="object"||String(process)!=="[object process]"||process.browser,hD=typeof window<"u"&&typeof window.orientation<"u",WT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);WT&&parseFloat(WT[1]);function Ff(t){"@babel/helpers - typeof";return Ff=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ff(t)}function dD(t,e){if(Ff(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Ff(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function fD(t){var e=dD(t,"string");return Ff(e)==="symbol"?e:String(e)}function $(t,e,n){return e=fD(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class pD{constructor(e,n){$(this,"name",void 0),$(this,"workerThread",void 0),$(this,"isRunning",!0),$(this,"result",void 0),$(this,"_resolve",()=>{}),$(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Ca(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ca(this.isRunning),this.isRunning=!1,this._reject(e)}}let Ev=class{terminate(){}};const Tv=new Map;function mD(t){Ca(t.source&&!t.url||!t.source&&t.url);let e=Tv.get(t.source||t.url);return e||(t.url&&(e=gD(t.url),Tv.set(t.url,e)),t.source&&(e=xM(t.source),Tv.set(t.source,e))),Ca(e),e}function gD(t){if(!t.startsWith("http"))return t;const e=yD(t);return xM(e)}function xM(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function yD(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function bM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(HT(t))r.add(t);else if(HT(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)bM(t[i],e,r)}}return n===void 0?Array.from(r):[]}function HT(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Sv=()=>{};class a1{static isSupported(){return typeof Worker<"u"&&Pg||typeof Ev<"u"&&!Pg}constructor(e){$(this,"name",void 0),$(this,"source",void 0),$(this,"url",void 0),$(this,"terminated",!1),$(this,"worker",void 0),$(this,"onMessage",void 0),$(this,"onError",void 0),$(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Ca(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Sv,this.onError=a=>console.log(a),this.worker=Pg?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Sv,this.onError=Sv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||bM(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=mD({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Ev(r,{eval:!1})}else if(this.source)e=new Ev(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class _D{static isSupported(){return a1.isSupported()}constructor(e){$(this,"name","unnamed"),$(this,"source",void 0),$(this,"url",void 0),$(this,"maxConcurrency",1),$(this,"maxMobileConcurrency",1),$(this,"onDebug",()=>{}),$(this,"reuseWorkers",!0),$(this,"props",{}),$(this,"jobQueue",[]),$(this,"idleQueue",[]),$(this,"count",0),$(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(a,h,l)=>a.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(a,h)=>a.error(h);const i=new Promise(a=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:a}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new pD(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new a1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return hD?this.maxMobileConcurrency:this.maxConcurrency}}const vD={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class xa{static isSupported(){return a1.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return xa._workerFarm=xa._workerFarm||new xa({}),xa._workerFarm.setProps(e),xa._workerFarm}constructor(e){$(this,"props",void 0),$(this,"workerPools",new Map),this.props={...vD},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let a=this.workerPools.get(n);return a||(a=new _D({name:n,source:r,url:i}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}$(xa,"_workerFarm",void 0);const xD="latest";function bD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(r)),!i){let a=t.version;a==="latest"&&(a=xD);const h=a?"@".concat(a):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(h,"/dist/").concat(r)}return Ca(i),i}function wD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:uD;Ca(t,"no worker provided");const n=t.version;return!(!e||!n)}function ED(t,e){return!xa.isSupported()||!Pg&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function TD(t,e,n,r,i){const a=t.id,h=bD(t,n),m=xa.getWorkerFarm(n).getWorkerPool({name:a,url:h});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const v=await m.startJob("process-on-worker",SD.bind(null,i));return v.postMessage("process",{input:e,options:n,context:r}),await(await v.result).result}async function SD(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:a,options:h}=r;try{const l=await t(a,h);e.postMessage("done",{id:i,result:l})}catch(l){const m=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:m})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function PD(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let a=0;a<r.length;++a)if(r[a]!==i[a])return!1;return!0}function AD(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),i=r.reduce((l,m)=>l+m.byteLength,0),a=new Uint8Array(i);let h=0;for(const l of r)a.set(l,h),h+=l.byteLength;return a.buffer}async function CD(t){const e=[];for await(const n of t)e.push(n);return AD(...e)}let ID="";const qT={};function MD(t){for(const e in qT)if(t.startsWith(e)){const n=qT[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(ID).concat(t)),t}function kD(t){return t&&typeof t=="object"&&t.isBuffer}function wM(t){if(kD(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function EM(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function LD(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const RD=t=>typeof t=="boolean",ff=t=>typeof t=="function",op=t=>t!==null&&typeof t=="object",ZT=t=>op(t)&&t.constructor==={}.constructor,zD=t=>t&&typeof t[Symbol.iterator]=="function",DD=t=>t&&typeof t[Symbol.asyncIterator]=="function",$c=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Wc=t=>typeof Blob<"u"&&t instanceof Blob,OD=t=>t&&typeof t=="object"&&t.isBuffer,FD=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||op(t)&&ff(t.tee)&&ff(t.cancel)&&ff(t.getReader),BD=t=>op(t)&&ff(t.read)&&ff(t.pipe)&&RD(t.readable),TM=t=>FD(t)||BD(t),ND=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,UD=/^([-\w.]+\/[-\w.+]+)/;function VD(t){const e=UD.exec(t);return e?e[1]:t}function XT(t){const e=ND.exec(t);return e?e[1]:""}const SM=/\?.*/;function jD(t){const e=t.match(SM);return e&&e[0]}function Zb(t){return t.replace(SM,"")}function a0(t){return $c(t)?t.url:Wc(t)?t.name||"":typeof t=="string"?t:""}function Xb(t){if($c(t)){const e=t,n=e.headers.get("content-type")||"",r=Zb(e.url);return VD(n)||XT(r)}return Wc(t)?t.type||"":typeof t=="string"?XT(t):""}function GD(t){return $c(t)?t.headers["content-length"]||-1:Wc(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function PM(t){if($c(t))return t;const e={},n=GD(t);n>=0&&(e["content-length"]=String(n));const r=a0(t),i=Xb(t);i&&(e["content-type"]=i);const a=await HD(t);a&&(e["x-first-bytes"]=a),typeof t=="string"&&(t=new TextEncoder().encode(t));const h=new Response(t,{headers:e});return Object.defineProperty(h,"url",{value:r}),h}async function $D(t){if(!t.ok){const e=await WD(t);throw new Error(e)}}async function WD(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function HD(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=a=>{var h;return r(a==null||(h=a.target)===null||h===void 0?void 0:h.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=qD(n);return"data:base64,".concat(r)}return null}function qD(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function YT(t,e){if(typeof t=="string"){t=MD(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await PM(t)}function ZD(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function ap(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||ZD()}const jm=globalThis.window||globalThis.self||globalThis.global,Dd=globalThis.process||{},AM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";ap();function XD(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let YD=class{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=XD(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function KD(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function JD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Pv(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const a=t.width*n,h=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(h/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(h,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(h,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let fy;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(fy||(fy={}));const QD=10;function KT(t){return typeof t!="string"?t:(t=t.toUpperCase(),fy[t]||fy.WHITE)}function eO(t,e,n){if(!ap&&typeof t=="string"){if(e){const r=KT(e);t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")}if(n){const r=KT(n);t="\x1B[".concat(r+QD,"m").concat(t,"\x1B[49m")}}return t}function tO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const a of r){const h=i[a];typeof h=="function"&&(e.find(l=>a===l)||(i[a]=h.bind(t)))}}function py(t,e){if(!t)throw new Error(e||"Assertion failed")}function bu(){let t;if(ap()&&jm.performance){var e,n;t=jm==null||(e=jm.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Dd){var r;const i=Dd==null||(r=Dd.hrtime)===null||r===void 0?void 0:r.call(Dd);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const wu={debug:ap()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},nO={enabled:!0,level:0};function qs(){}const JT={},QT={once:!0};let Yb=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=AM,this._startTs=bu(),this._deltaTs=bu(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new YD("__probe-".concat(this.id,"__"),nO),this.timeStamp("".concat(this.id," started")),tO(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((bu()-this._startTs).toPrecision(10))}getDelta(){return Number((bu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){py(e,n)}warn(e){return this._getLogFunction(0,e,wu.warn,arguments,QT)}error(e){return this._getLogFunction(0,e,wu.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,wu.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,wu.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,wu.debug||wu.info,arguments,QT)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||qs,r&&[r],{tag:oO(n)}):qs}image(e){let{logLevel:n,priority:r,image:i,message:a="",scale:h=1}=e;return this._shouldLog(n||r)?ap()?sO({image:i,message:a,scale:h}):iO():qs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||qs)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=eS({logLevel:e,message:n,opts:r}),{collapsed:a}=r;return i.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||qs)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=CM(e)}_getLogFunction(e,n,r,i,a){if(this._shouldLog(e)){a=eS({logLevel:e,message:n,args:i,opts:a}),r=r||a.method,py(r),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=bu();const h=a.tag||a.message;if(a.once&&h)if(!JT[h])JT[h]=bu();else return qs;return n=rO(this.id,a.message,a),r.bind(console,n,...a.args)}return qs}};Yb.VERSION=AM;function CM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return py(Number.isFinite(e)&&e>=0),e}function eS(t){const{logLevel:e,message:n}=t;t.logLevel=CM(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return py(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function rO(t,e,n){if(typeof e=="string"){const r=n.time?JD(KD(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=eO(e,n.color,n.background)}return e}function iO(t){return console.warn("removed"),qs}function sO(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const a=new Image;return a.onload=()=>{const h=Pv(a,n,r);console.log(...h)},a.src=e,qs}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Pv(e,n,r)),qs;if(i.toLowerCase()==="canvas"){const a=new Image;return a.onload=()=>console.log(...Pv(a,n,r)),a.src=e.toDataURL(),qs}return qs}function oO(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const tS=new Yb({id:"loaders.gl"});class aO{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class lO{constructor(){$(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const IM={fetch:null,mimeType:void 0,nothrow:!1,log:new lO,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:qb,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},cO={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function MM(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const kM=()=>{const t=MM();return t.globalOptions=t.globalOptions||{...IM},t.globalOptions};function uO(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],hO(t,n),fO(e,t,r)}function hO(t,e){nS(t,null,IM,cO,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},a=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};nS(r,n.id,i,a,e)}}function nS(t,e,n,r,i){const a=e||"Top level",h=e?"".concat(e,"."):"";for(const l in t){const m=!e&&op(t[l]),v=l==="baseUri"&&!e,E=l==="workerUrl"&&e;if(!(l in n)&&!v&&!E){if(l in r)tS.warn("".concat(a," loader option '").concat(h).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!m){const T=dO(l,i);tS.warn("".concat(a," loader option '").concat(h).concat(l,"' not recognized. ").concat(T))()}}}}function dO(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const a in i.options){if(t===a)return"Did you mean '".concat(i.id,".").concat(a,"'?");const h=a.toLowerCase();(n.startsWith(h)||h.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(a,"'?"))}return r}function fO(t,e,n){const i={...t.options||{}};return pO(i,n),i.log===null&&(i.log=new aO),rS(i,kM()),rS(i,e),i}function rS(t,e){for(const n in e)if(n in e){const r=e[n];ZT(r)&&ZT(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function pO(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Kb(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Jb(t){var e,n;dy(t,"null loader"),dy(Kb(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const LM=()=>{const t=MM();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function mO(t){const e=LM();t=Array.isArray(t)?t:[t];for(const n of t){const r=Jb(n);e.find(i=>r===i)||e.unshift(r)}}function gO(){return LM()}const yO=new Yb({id:"loaders.gl"}),_O=/\.([^.]+)$/;async function vO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!RM(t))return null;let i=iS(t,e,{...n,nothrow:!0},r);if(i)return i;if(Wc(t)&&(t=await t.slice(0,10).arrayBuffer(),i=iS(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(zM(t));return i}function iS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!RM(t))return null;if(e&&!Array.isArray(e))return Jb(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...gO()),bO(i);const a=xO(t,i,n,r);if(!a&&!(n!=null&&n.nothrow))throw new Error(zM(t));return a}function xO(t,e,n,r){const i=a0(t),a=Xb(t),h=Zb(i)||(r==null?void 0:r.url);let l=null,m="";if(n!=null&&n.mimeType&&(l=Av(e,n==null?void 0:n.mimeType),m="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||wO(e,h),m=m||(l?"matched url ".concat(h):""),l=l||Av(e,a),m=m||(l?"matched MIME type ".concat(a):""),l=l||TO(e,t),m=m||(l?"matched initial data ".concat(DM(t)):""),l=l||Av(e,n==null?void 0:n.fallbackMimeType),m=m||(l?"matched fallback MIME type ".concat(a):""),m){var v;yO.log(1,"selectLoader selected ".concat((v=l)===null||v===void 0?void 0:v.name,": ").concat(m,"."))}return l}function RM(t){return!(t instanceof Response&&t.status===204)}function zM(t){const e=a0(t),n=Xb(t);let r="No valid loader found (";r+=e?"".concat(EM(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const i=t?DM(t):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function bO(t){for(const e of t)Jb(e)}function wO(t,e){const n=e&&_O.exec(e),r=n&&n[1];return r?EO(t,r):null}function EO(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Av(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function TO(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(SO(e,n))return n}else if(ArrayBuffer.isView(e)){if(sS(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&sS(e,0,n))return n;return null}function SO(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function sS(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>PO(t,e,n,i))}function PO(t,e,n,r){if(r instanceof ArrayBuffer)return PD(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=l1(t,e,r.length);return r===i;default:return!1}}function DM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?l1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?l1(t,0,e):""}function l1(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let a=0;a<n;a++)i+=String.fromCharCode(r.getUint8(e+a));return i}const AO=256*1024;function*CO(t,e){const n=(e==null?void 0:e.chunkSize)||AO;let r=0;const i=new TextEncoder;for(;r<t.length;){const a=Math.min(t.length-r,n),h=t.slice(r,r+a);r+=a,yield i.encode(h)}}const IO=256*1024;function MO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=IO}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),a=new ArrayBuffer(i),h=new Uint8Array(t,r,i);new Uint8Array(a).set(h),r+=i,yield a}}()}const kO=1024*1024;async function*LO(t,e){const n=(e==null?void 0:e.chunkSize)||kO;let r=0;for(;r<t.size;){const i=r+n,a=await t.slice(r,i).arrayBuffer();r=i,yield a}}function oS(t,e){return qb?RO(t,e):zO(t)}async function*RO(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:a,value:h}=await i;if(a)return;yield wM(h)}}catch{n.releaseLock()}}async function*zO(t,e){for await(const n of t)yield wM(n)}function DO(t,e){if(typeof t=="string")return CO(t,e);if(t instanceof ArrayBuffer)return MO(t,e);if(Wc(t))return LO(t,e);if(TM(t))return oS(t,e);if($c(t))return oS(t.body,e);throw new Error("makeIterator")}const OM="Cannot convert supplied data type";function OO(t,e,n){if(e.text&&typeof t=="string")return t;if(OD(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(OM)}async function FO(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return OO(t,e);if(Wc(t)&&(t=await PM(t)),$c(t)){const i=t;return await $D(i),e.binary?await i.arrayBuffer():await i.text()}if(TM(t)&&(t=DO(t,n)),zD(t)||DD(t))return CD(t);throw new Error(OM)}function FM(t,e){const n=kM(),r=t||n;return typeof r.fetch=="function"?r.fetch:op(r.fetch)?i=>YT(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:YT}function BO(t,e,n){if(n)return n;const r={fetch:FM(e,t),...t};if(r.url){const i=Zb(r.url);r.baseUrl=i,r.queryString=jD(r.url),r.filename=EM(i),r.baseUrl=LD(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function NO(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function Qb(t,e,n,r){Ca(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Kb(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=a0(t),h=NO(e,r),l=await vO(t,h,n);return l?(n=uO(n,l,h,i),r=BO({url:i,parse:Qb,loaders:h},n,r||null),await UO(l,t,n,r)):null}async function UO(t,e,n,r){if(wD(t),$c(e)){const i=e,{ok:a,redirected:h,status:l,statusText:m,type:v,url:E}=i,T=Object.fromEntries(i.headers.entries());r.response={headers:T,ok:a,redirected:h,status:l,statusText:m,type:v,url:E}}if(e=await FO(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(ED(t,n))return await TD(t,e,n,r,Qb);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw Ca(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function my(t,e,n,r){!Array.isArray(e)&&!Kb(e)&&(n=e,e=void 0);const i=FM(n);let a=t;return typeof t=="string"&&(a=await i(t)),Wc(t)&&(a=await i(t)),await Qb(a,e,n)}const VO="3.4.8",{_parseImageNode:jO}=globalThis,c1=typeof Image<"u",u1=typeof ImageBitmap<"u",GO=!!jO,h1=qb?!0:GO;function $O(t){switch(t){case"auto":return u1||c1||h1;case"imagebitmap":return u1;case"image":return c1;case"data":return h1;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function WO(){if(u1)return"imagebitmap";if(c1)return"image";if(h1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function HO(t){const e=ZO(t);if(!e)throw new Error("Not an image");return e}function qO(t){switch(HO(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function ZO(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const XO=/^data:image\/svg\+xml/,YO=/\.svg((\?|#).*)?$/;function ew(t){return t&&(XO.test(t)||YO.test(t))}function KO(t,e){if(ew(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(a){throw new Error(a.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return BM(t,e)}function BM(t,e){if(ew(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function NM(t,e,n){const r=KO(t,n),i=self.URL||self.webkitURL,a=typeof r!="string"&&i.createObjectURL(r);try{return await JO(a||r,e)}finally{a&&i.revokeObjectURL(a)}}async function JO(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=a=>i(new Error("Could not load image ".concat(t,": ").concat(a)))}catch(a){i(a)}})}const QO={};let aS=!0;async function e6(t,e,n){let r;ew(n)?r=await NM(t,e,n):r=BM(t,n);const i=e&&e.imagebitmap;return await t6(r,i)}async function t6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((n6(e)||!aS)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),aS=!1}return await createImageBitmap(t)}function n6(t){for(const e in t||QO)return!1;return!0}function r6(t){return!a6(t,"ftyp",4)||!(t[8]&96)?null:i6(t)}function i6(t){switch(s6(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function s6(t,e,n){return String.fromCharCode(...t.slice(e,n))}function o6(t){return[...t].map(e=>e.charCodeAt(0))}function a6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=o6(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const $o=!1,pf=!0;function UM(t){const e=lp(t);return c6(e)||d6(e)||u6(e)||h6(e)||l6(e)}function l6(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=r6(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function c6(t){const e=lp(t);return e.byteLength>=24&&e.getUint32(0,$o)===2303741511?{mimeType:"image/png",width:e.getUint32(16,$o),height:e.getUint32(20,$o)}:null}function u6(t){const e=lp(t);return e.byteLength>=10&&e.getUint32(0,$o)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,pf),height:e.getUint16(8,pf)}:null}function h6(t){const e=lp(t);return e.byteLength>=14&&e.getUint16(0,$o)===16973&&e.getUint32(2,pf)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,pf),height:e.getUint32(22,pf)}:null}function d6(t){const e=lp(t);if(!(e.byteLength>=3&&e.getUint16(0,$o)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=f6();let a=2;for(;a+9<e.byteLength;){const h=e.getUint16(a,$o);if(i.has(h))return{mimeType:"image/jpeg",height:e.getUint16(a+5,$o),width:e.getUint16(a+7,$o)};if(!r.has(h))return null;a+=2,a+=e.getUint16(a,$o)}return null}function f6(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function lp(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function p6(t,e){const{mimeType:n}=UM(t)||{},r=globalThis._parseImageNode;return dy(r),await r(t,n)}async function m6(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:a}=n||{},h=g6(i);let l;switch(h){case"imagebitmap":l=await e6(t,e,a);break;case"image":l=await NM(t,e,a);break;case"data":l=await p6(t);break;default:dy(!1)}return i==="data"&&(l=qO(l)),l}function g6(t){switch(t){case"auto":case"data":return WO();default:return $O(t),t}}const y6=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],_6=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],v6={image:{type:"auto",decode:!0}},x6={id:"image",module:"images",name:"Images",version:VO,mimeTypes:_6,extensions:y6,parse:m6,tests:[t=>!!UM(new DataView(t))],options:v6};function VM(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function La(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||VM()}const Ag={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Gm=Ag.window||Ag.self||Ag.global,Od=Ag.process||{},jM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";La();const Cv=globalThis;function GM(t){if(!t&&!La())return"Node";if(VM(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i?"IE":Cv.chrome?"Chrome":Cv.safari?"Safari":Cv.mozInnerScreenX?"Firefox":"Unknown"}function b6(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class w6{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";$(this,"storage",void 0),$(this,"id",void 0),$(this,"config",void 0),this.storage=b6(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function E6(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function T6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Iv(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const a=t.width*n,h=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(h/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(h,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(h,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let gy;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(gy||(gy={}));function lS(t){return typeof t=="string"?gy[t.toUpperCase()]||gy.WHITE:t}function S6(t,e,n){return!La&&typeof t=="string"&&(e&&(e=lS(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=lS(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function P6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const i of r)typeof t[i]=="function"&&(e.find(a=>i===a)||(t[i]=t[i].bind(t)))}function yy(t,e){if(!t)throw new Error(e||"Assertion failed")}function Eu(){let t;if(La&&"performance"in Gm){var e,n;t=Gm==null||(e=Gm.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Od){var r;const i=Od==null||(r=Od.hrtime)===null||r===void 0?void 0:r.call(Od);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Tu={debug:La&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},A6={enabled:!0,level:0};function Zs(){}const cS={},uS={once:!0};class tw{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};$(this,"id",void 0),$(this,"VERSION",jM),$(this,"_startTs",Eu()),$(this,"_deltaTs",Eu()),$(this,"_storage",void 0),$(this,"userData",{}),$(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new w6("__probe-".concat(this.id,"__"),A6),this.timeStamp("".concat(this.id," started")),P6(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Eu()-this._startTs).toPrecision(10))}getDelta(){return Number((Eu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){yy(e,n)}warn(e){return this._getLogFunction(0,e,Tu.warn,arguments,uS)}error(e){return this._getLogFunction(0,e,Tu.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Tu.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Tu.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];return this._getLogFunction(e,n,Tu.debug||Tu.info,arguments,uS)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Zs,r&&[r],{tag:k6(n)}):Zs}image(e){let{logLevel:n,priority:r,image:i,message:a="",scale:h=1}=e;return this._shouldLog(n||r)?La?M6({image:i,message:a,scale:h}):I6():Zs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Zs)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=hS({logLevel:e,message:n,opts:r}),{collapsed:a}=r;return i.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Zs)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=$M(e)}_getLogFunction(e,n,r,i,a){if(this._shouldLog(e)){a=hS({logLevel:e,message:n,args:i,opts:a}),r=r||a.method,yy(r),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Eu();const h=a.tag||a.message;if(a.once)if(!cS[h])cS[h]=Eu();else return Zs;return n=C6(this.id,a.message,a),r.bind(console,n,...a.args)}return Zs}}$(tw,"VERSION",jM);function $M(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return yy(Number.isFinite(e)&&e>=0),e}function hS(t){const{logLevel:e,message:n}=t;t.logLevel=$M(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return yy(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function C6(t,e,n){if(typeof e=="string"){const r=n.time?T6(E6(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=S6(e,n.color,n.background)}return e}function I6(t){return console.warn("removed"),Zs}function M6(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const a=new Image;return a.onload=()=>{const h=Iv(a,n,r);console.log(...h)},a.src=e,Zs}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Iv(e,n,r)),Zs;if(i.toLowerCase()==="canvas"){const a=new Image;return a.onload=()=>console.log(...Iv(a,n,r)),a.src=e.toDataURL(),Zs}return Zs}function k6(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const an=new tw({id:"deck"});let d1={};function L6(t){d1=t}function ki(t,e,n,r){an.level>0&&d1[t]&&d1[t].call(null,e,n,r)}function R6(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const z6={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:R6,parseTextSync:JSON.parse};function D6(){const t="8.9.22",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(an.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:an,_registerLoggers:L6},mO([z6,[x6,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const O6=D6(),Pn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Pn,"IDENTITY",{get:()=>(an.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ho={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Rc={common:0,meters:1,pixels:2},dS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Lt=new tw({id:"luma.gl"});function qi(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const F6="Invalid WebGLRenderingContext",B6="Requires WebGL2";function l0(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function dn(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function N6(t){return dn(t)?t:null}function c0(t){return qi(l0(t),F6),t}function Ri(t){return qi(dn(t),B6),t}const Jd={};function U6(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function V6(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function j6(t,e){Jd[t]=!0,e!==void 0&&U6(e)}function G6(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(Jd[r]=!0);while(r!==0);for(r in Jd)if(Jd[r])return delete Jd[r],parseInt(r,10);return 0}}const cp=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new t.VertexAttrib(n);this.attribs[r]=i}this.maxAttrib=0};cp.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};cp.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Hc=function(e){const n=this;this.gl=e,G6(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(a){return a===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(a){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);const l=h.attribs[a];return l.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(a){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);const l=h.attribs[a];return l.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(a,h){switch(a){case 34962:n.currentArrayBuffer=h;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=h;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(a,h){const m=n.currentVertexArrayObject.attribs[a];switch(h){case 34975:return m.buffer;case 34338:return m.enabled;case 34339:return m.size;case 34340:return m.stride;case 34341:return m.type;case 34922:return m.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(a,h,l,m,v,E){const T=n.currentVertexArrayObject;T.maxAttrib=Math.max(T.maxAttrib,a);const S=T.attribs[a];return S.buffer=n.currentArrayBuffer,S.size=h,S.type=l,S.normalized=m,S.stride=v,S.offset=E,S.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{V6("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Hc.prototype.VERTEX_ARRAY_BINDING_OES=34229;Hc.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new cp(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Hc.prototype.createVertexArrayOES=function(){const e=new cp(this);return this.vertexArrayObjects.push(e),e};Hc.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Hc.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof cp&&e.hasBeenBound&&e.ext===this)};Hc.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){j6(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const a=this.currentVertexArrayObject;if(i===a)return;(!i||a.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(n,34963,a.elementArrayBuffer);let h=this.currentArrayBuffer;const l=Math.max(i?i.maxAttrib:0,a.maxAttrib);for(let m=0;m<=l;m++){const v=a.attribs[m],E=i?i.attribs[m]:null;if((!i||v.enabled!==E.enabled)&&(v.enabled?r.enableVertexAttribArray.call(n,m):r.disableVertexAttribArray.call(n,m)),v.enabled){let T=!1;(!i||v.buffer!==E.buffer)&&(h!==v.buffer&&(r.bindBuffer.call(n,34962,v.buffer),h=v.buffer),T=!0),(T||v.cached!==E.cached)&&r.vertexAttribPointer.call(n,m,v.size,v.type,v.normalized,v.stride,v.offset)}}this.currentArrayBuffer!==h&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function $6(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const n=t.getExtension;t.getExtension=function(i){const a=n.call(this,i);return a||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Hc(this)),this.__OESVertexArrayObject))}}const fS="OES_element_index",pS="WEBGL_draw_buffers",W6="EXT_disjoint_timer_query",H6="EXT_disjoint_timer_query_webgl2",q6="EXT_texture_filter_anisotropic",mS="WEBGL_debug_renderer_info",Z6=35723,X6=4352,Y6=36795,K6=34047,J6=37445,Q6=37446,rr=t=>dn(t)?void 0:0,eF={3074:t=>dn(t)?void 0:36064,[Z6]:t=>dn(t)?void 0:X6,35977:rr,32937:rr,[Y6]:(t,e)=>{const n=dn(t)?t.getExtension(H6):t.getExtension(W6);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[J6]:(t,e)=>{const n=t.getExtension(mS);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[Q6]:(t,e)=>{const n=t.getExtension(mS);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[K6]:(t,e)=>{const n=t.luma.extensions[q6];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:rr,35071:rr,37447:rr,36063:(t,e)=>{if(!dn(t)){const n=t.getExtension(pS);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:rr,35374:rr,35377:rr,34852:t=>{if(!dn(t)){const e=t.getExtension(pS);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(fS)?2147483647:65535,33001:t=>t.getExtension(fS)?16777216:65535,33e3:t=>16777216,37157:rr,35373:rr,35657:rr,36183:rr,37137:rr,34045:rr,35978:rr,35979:rr,35968:rr,35376:rr,35375:rr,35659:rr,37154:rr,35371:rr,35658:rr,35076:rr,35077:rr,35380:rr};function tF(t,e,n){const r=eF[n],i=typeof r=="function"?r(t,e,n):r;return i!==void 0?i:e(n)}const nF="OES_vertex_array_object",WM="ANGLE_instanced_arrays",rF="WEBGL_draw_buffers",iF="EXT_disjoint_timer_query",sF="EXT_texture_filter_anisotropic",oF="VertexArray requires WebGL2 or OES_vertex_array_object extension";function aF(t,e){return{webgl2:dn(t),ext:t.getExtension(e)}}const HM={[nF]:{meta:{suffix:"OES"},createVertexArray:()=>{qi(!1,oF)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[WM]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){qi(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[rF]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{qi(!1)}},[iF]:{meta:{suffix:"EXT"},createQuery:()=>{qi(!1)},deleteQuery:()=>{qi(!1)},beginQuery:()=>{qi(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Mv={readBuffer:(t,e,n)=>{dn(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:i,ext:a}=aF(t,WM);let h;switch(r){case 35069:h=i?void 0:!1;break;case 35070:h=!i&&!a?0:void 0;break}return h!==void 0?h:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!dn(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,i)=>{if(!dn(t))switch(i){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,i)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:i}=t.luma,a=i[sF];r=a&&a.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:tF,hint(t,e,n,r){return e(n,r)}};function lF(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||($6(t),cF(t),hF(t,HM),uF(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=lF;function cF(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function uF(t,e){let{target:n,target2:r}=e;Object.keys(Mv).forEach(i=>{if(typeof Mv[i]=="function"){const a=t[i]?t[i].bind(t):()=>{},h=Mv[i].bind(null,t,a);n[i]=h,r[i]=h}})}function hF(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&dF(t,{extension:n,target:t.luma,target2:t})}function dF(t,e){let{extension:n,target:r,target2:i}=e;const a=HM[n];qi(a);const{meta:h={}}=a,{suffix:l=""}=h,m=t.getExtension(n);for(const v of Object.keys(a)){const E="".concat(v).concat(l);let T=null;v==="meta"||typeof t[v]=="function"||(m&&typeof m[E]=="function"?T=function(){return m[E](...arguments)}:typeof a[v]=="function"&&(T=a[v].bind(r))),T&&(r[v]=T,i[v]=T)}}const nw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},il=(t,e,n)=>e?t.enable(n):t.disable(n),gS=(t,e,n)=>t.hint(n,e),ws=(t,e,n)=>t.pixelStorei(n,e),fF=(t,e)=>{const n=dn(t)?36009:36160;return t.bindFramebuffer(n,e)},pF=(t,e)=>t.bindFramebuffer(36008,e);function Fd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const mF={3042:il,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:il,2885:(t,e)=>t.cullFace(e),2929:il,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:il,35723:gS,36006:fF,2886:(t,e)=>t.frontFace(e),33170:gS,2849:(t,e)=>t.lineWidth(e),32823:il,32824:"polygonOffset",10752:"polygonOffset",35977:il,32938:"sampleCoverage",32939:"sampleCoverage",3089:il,3088:(t,e)=>t.scissor(...e),2960:il,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:ws,3317:ws,37440:ws,37441:ws,37443:ws,3330:ws,3332:ws,3331:ws,36010:pF,3314:ws,32878:ws,3316:ws,3315:ws,32877:ws,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Fd(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Fd(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Fd(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Fd(e)&&e.length===3?[...e,...e]:e;const[n,r,i,a,h,l]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,a,h,l)},stencilOp:(t,e)=>{e=Fd(e)&&e.length===3?[...e,...e]:e;const[n,r,i,a,h,l]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,a,h,l)},viewport:(t,e)=>t.viewport(...e)};function Ar(t,e,n){return e[t]!==void 0?e[t]:n[t]}const gF={blendEquation:(t,e,n)=>t.blendEquationSeparate(Ar(32777,e,n),Ar(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Ar(32969,e,n),Ar(32968,e,n),Ar(32971,e,n),Ar(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Ar(32824,e,n),Ar(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Ar(32938,e,n),Ar(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Ar(2962,e,n),Ar(2967,e,n),Ar(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Ar(34816,e,n),Ar(36003,e,n),Ar(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Ar(2964,e,n),Ar(2965,e,n),Ar(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Ar(34817,e,n),Ar(34818,e,n),Ar(34819,e,n))},yS={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Fo=(t,e)=>t.isEnabled(e),_S={3042:Fo,2884:Fo,2929:Fo,3024:Fo,32823:Fo,32926:Fo,32928:Fo,3089:Fo,2960:Fo,35977:Fo};function qM(t){for(const e in t)return!1;return!0}function yF(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function vS(t,e){const n=t[e].bind(t);t[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache?t.state.enable?t.state.cache[i]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function _F(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var a=arguments.length,h=new Array(a),l=0;l<a;l++)h[l]=arguments[l];const{valueChanged:m,oldValue:v}=n(t.state._updateCache,...h);return m&&r(...h),v},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function vF(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class xF{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?wF(e):Object.assign({},nw),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){qi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Ia(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const a in e){qi(a!==void 0);const h=e[a],l=this.cache[a];yF(h,l)||(n=!0,r=l,i&&!(a in i)&&(i[a]=l),this.cache[a]=h)}return{valueChanged:n,oldValue:r}}}function ZM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(qi(r!==void 0),!t.state){const{polyfillContext:i}=globalThis;i&&i(t),t.state=new xF(t,{copyState:r}),vF(t);for(const a in yS){const h=yS[a];_F(t,a,h)}vS(t,"getParameter"),vS(t,"isEnabled")}return t.state.enable=n,t}function bF(t){t.state||ZM(t,{copyState:!1}),t.state.push()}function xS(t){qi(t.state),t.state.pop()}function Ia(t,e){if(qi(l0(t),"setParameters requires a WebGL context"),qM(e))return;const n={};for(const i in e){const a=Number(i),h=mF[i];h&&(typeof h=="string"?n[h]=!0:h(t,e[i],a))}const r=t.state&&t.state.cache;if(r)for(const i in n){const a=gF[i];a(t,e,r)}}function wF(t,e){if(e=e||nw,typeof e=="number"){const i=e,a=_S[i];return a?a(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const a=_S[i];r[i]=a?a(t,Number(i)):t.getParameter(Number(i))}return r}function EF(t){Ia(t,nw)}function wo(t,e,n){if(qM(e))return n(t);const{nocatch:r=!0}=e;bF(t),Ia(t,e);let i;if(r)i=n(t),xS(t);else try{i=n(t)}finally{xS(t)}return i}function gh(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,r="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function kv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=gh(t),i=t.drawingBufferWidth,a=t.drawingBufferHeight;return SF(e,r,i,a,n)}function TF(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function SF(t,e,n,r,i){const a=bS(t[0],e,n);let h=wS(t[1],e,r,i),l=bS(t[0]+1,e,n);const m=l===n-1?l:l-1;l=wS(t[1]+1,e,r,i);let v;return i?(l=l===0?l:l+1,v=h,h=l):v=l===r-1?l:l-1,{x:a,y:h,width:Math.max(m-a+1,1),height:Math.max(v-h+1,1)}}function bS(t,e,n){return Math.min(Math.round(t*e),n-1)}function wS(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const rw=La(),PF=rw&&typeof document<"u",XM={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function YM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};qi(rw,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},XM,t);const{width:e,height:n}=t;function r(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=r;let i;const{canvas:a}=t,h=MF({canvas:a,width:e,height:n,onError:r});return i=IF(h,t),i?(i=iw(i,t),kF(i),i):null}function iw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||LF(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},XM,e);const{manageState:n,debug:r}=e;return n&&ZM(t,{copyState:!1,log:function(){for(var i=arguments.length,a=new Array(i),h=0;h<i;h++)a[h]=arguments[h];return Lt.log(1,...a)()}}),rw&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Lt.level=Math.max(Lt.level,1)):Lt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function AF(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),i=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),a=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:a||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function CF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=TF(e.useDevicePixels);RF(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function IF(t,e){const{onError:n}=e;let r=null;const i=m=>r=m.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:a=!0,webgl2:h=!0}=e;let l=null;return h&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),a&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(h&&!a?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function MF(t){let{canvas:e,width:n=800,height:r=600,onError:i}=t,a;return typeof e=="string"?(PF&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),a=document.getElementById(e)):e?a=e:(a=document.createElement("canvas"),a.id="lumagl-canvas",a.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",a.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(a,document.body.firstChild)),a}function kF(t){const e=dn(t)?"WebGL2":"WebGL1",n=AF(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",i=t.debug?" debug":"";Lt.info(1,"".concat(e).concat(i," context ").concat(r))()}function LF(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function RF(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,i="height"in n?n.height:t.canvas.clientHeight;(!r||!i)&&(Lt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const a=t.luma.canvasSizeInfo;if(a.clientWidth!==r||a.clientHeight!==i||a.devicePixelRatio!==e){let h=e;const l=Math.floor(r*h),m=Math.floor(i*h);t.canvas.width=l,t.canvas.height=m,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==m)&&(Lt.warn("Device pixel ratio clamped")(),h=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/i),t.canvas.width=Math.floor(r*h),t.canvas.height=Math.floor(i*h)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}function ES(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class TS{constructor(e,n){$(this,"name",void 0),$(this,"type",void 0),$(this,"sampleSize",1),$(this,"time",void 0),$(this,"count",void 0),$(this,"samples",void 0),$(this,"lastTiming",void 0),$(this,"lastSampleTime",void 0),$(this,"lastSampleCount",void 0),$(this,"_count",0),$(this,"_time",0),$(this,"_samples",0),$(this,"_startTime",0),$(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ES(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ES()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class sw{constructor(e){$(this,"id",void 0),$(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof TS?this.stats[n]=e:this.stats[n]=new TS(n,r)),this.stats[n]}}const mf="8.5.20",zF="set luma.log.level=1 (or higher) to trace rendering";class DF{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new sw({id:e})),this.stats.get(e)}}const xc=new DF;if(globalThis.luma&&globalThis.luma.VERSION!==mf)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(mf));globalThis.luma||(La()&&Lt.log(1,"luma.gl ".concat(mf," - ").concat(zF))(),globalThis.luma=globalThis.luma||{VERSION:mf,version:mf,log:Lt,stats:xc,globals:{modules:{},nodeIO:{}}});function OF(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function FF(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function _t(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Lv(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return _t(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Cl(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Rv={};function Ll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Rv[t]=Rv[t]||1;const e=Rv[t]++;return"".concat(t,"-").concat(e)}function SS(t){return _t(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function yh(t){let e=!0;for(const n in t){e=!1;break}return e}function KM(t,e,n,r){const i="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);r.forEach(h=>{a.methodName||(a[h]=()=>{throw Lt.removed("Calling removed method ".concat(e,".").concat(h,": "),i)(),new Error(h)})})}const Su="Resource subclass must define virtual methods";let Ra=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};c0(e);const{id:r,userData:i={}}=n;this.gl=e,this.gl2=e,this.id=r||Ll(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Lv(this.gl,e),_t(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const a=dn(this.gl);if(!((!("webgl2"in i)||a)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const l=i.webgl1,m="webgl2"in i?i.webgl2:i.webgl1;return a?m:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,i=this.constructor.PARAMETERS||{},a=dn(this.gl),h={},l=n||Object.keys(i);for(const m of l){const v=i[m];if(v&&(!("webgl2"in v)||a)&&(!("extension"in v)||this.gl.getExtension(v.extension))){const T=r?Cl(this.gl,m):m;h[T]=this.getParameter(m,e),r&&v.type==="GLenum"&&(h[T]=Cl(this.gl,h[T]))}}return h}setParameter(e,n){e=Lv(this.gl,e),_t(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const a=dn(this.gl);if(!((!("webgl2"in i)||a)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(n=Lv(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return KM(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(Su)}_deleteHandle(){throw new Error(Su)}_bindHandle(e){throw new Error(Su)}_getOptsFromHandle(){throw new Error(Su)}_getParameter(e,n){throw new Error(Su)}_setParameter(e,n){throw new Error(Su)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=xc.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];xc.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=xc.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=xc.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const BF="Failed to deduce GL constant from typed array";function f1(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(BF)}}function Bf(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function NF(t){let{data:e,width:n,height:r,bytesPerPixel:i=4,temp:a}=t;const h=n*i;a=a||new Uint8Array(h);for(let l=0;l<r/2;++l){const m=l*h,v=(r-l-1)*h;a.set(e.subarray(m,m+h)),e.copyWithin(m,v,v+h),e.set(a,v)}}function UF(t){let{data:e,width:n,height:r}=t;const i=Math.round(n/2),a=Math.round(r/2),h=new Uint8Array(i*a*4);for(let l=0;l<a;l++)for(let m=0;m<i;m++)for(let v=0;v<4;v++)h[(l*i+m)*4+v]=e[(l*2*n+m*2)*4+v];return{data:h,width:i,height:a}}function p1(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:a={}}=n;for(const l in r)if(l in e){const v=r[l]?"".concat(t,".").concat(r[l]):"N/A";Lt.removed("".concat(t,".").concat(l),v)()}for(const l in i)if(l in e){const m=i[l];Lt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(m))()}let h=null;for(const l in a)if(l in e){const m=a[l];Lt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(m))(),h=h||Object.assign({},e),h[m]=e[l],delete h[l]}return h||e}const VF={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},jF={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class As{static getBytesPerElement(e){return Bf(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return _t(e.size),Bf(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new As(VF,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return As.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return As.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=p1("Accessor",e,jF),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const PS=10,JM={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},GF={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:JM},$F={removedProps:JM};class $n extends Ra{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/As.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/As.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=p1("Buffer",e,GF),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=p1("Buffer",e,$F),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new As(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:i=0}=e,a=e.byteLength||e.length;_t(n);const h=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(h,this.handle),i!==0||a!==void 0?(Ri(this.gl),this.gl.bufferSubData(this.target,r,n,i,a)):this.gl.bufferSubData(h,r,n),this.gl.bindBuffer(h,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:i=0,size:a}=e;const{gl:h}=this;return Ri(h),h.bindBuffer(36662,n.handle),h.bindBuffer(36663,this.handle),h.copyBufferSubData(36662,36663,r,i,a),h.bindBuffer(36662,null),h.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ri(this.gl);const a=Bf(this.accessor.type||5126,{clamped:!1}),h=this._getAvailableElementCount(n),l=r;let m,v;e?(v=e.length,m=v-l):(m=Math.min(h,i||h),v=l+m);const E=Math.min(h,m);return i=i||E,_t(i<=E),e=e||new a(v),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,i):(_t(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(PS,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;_t(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,n,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,PS),this.bytesUsed=r,this._trackAllocatedMemory(r);const a=f1(e);return _t(a),this.setAccessor(new As(this.accessor,{type:a})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;_t(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,n),this.gl.bindBuffer(i,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Bf(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new As(this.accessor,{type:f1(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Lt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Lt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Lt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Lt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new As(this.accessor,e),this}}const ow={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},QM={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},ek={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function WF(t,e){const n=ow[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=dn(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function HF(t,e){const n=ow[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const qF=[9729,9728],AS=globalThis.WebGLBuffer||function(){};class zc extends Ra{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=n;let a=!0;return r&&(a=a&&WF(e,r),a=a&&(!i||HF(e,r))),a}constructor(e,n){const{id:r=Ll("texture"),handle:i,target:a}=n;super(e,{id:r,handle:i}),this.target=a,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(V=>this.initialize(Object.assign({},e,{pixels:V,data:V}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:a=6408,border:h=0,recreate:l=!1,parameters:m={},pixelStore:v={},textureUnit:E=void 0}=e;n||(n=i);let{width:T,height:S,dataFormat:z,type:D,compressed:F=!1,mipmaps:J=!0}=e;const{depth:U=0}=e;return{width:T,height:S,compressed:F,dataFormat:z,type:D}=this._deduceParameters({format:a,type:D,dataFormat:z,compressed:F,data:n,width:T,height:S}),this.width=T,this.height=S,this.depth=U,this.format=a,this.type=D,this.dataFormat=z,this.border=h,this.textureUnit=E,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),J&&this._isNPOT()&&(Lt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),J=!1,this._updateForNPOT(m)),this.mipmaps=J,this.setImageData({data:n,width:T,height:S,depth:U,format:a,type:D,dataFormat:z,border:h,mipmaps:J,parameters:v,compressed:F}),J&&this.generateMipmap(),this.setParameters(m),l&&(this.data=n),r&&(this._video={video:n,parameters:m,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:i=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Lt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),wo(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:i=0,format:a=this.format,border:h=this.border,offset:l=0,parameters:m={}}=e;let{data:v=null,type:E=this.type,width:T=this.width,height:S=this.height,dataFormat:z=this.dataFormat,compressed:D=!1}=e;v||(v=r),{type:E,dataFormat:z,compressed:D,width:T,height:S}=this._deduceParameters({format:a,type:E,dataFormat:z,compressed:D,data:v,width:T,height:S});const{gl:F}=this;F.bindTexture(this.target,this.handle);let J=null;({data:v,dataType:J}=this._getDataType({data:v,compressed:D}));let U,V=0;if(wo(this.gl,m,()=>{switch(J){case"null":F.texImage2D(n,i,a,T,S,h,z,E,v);break;case"typed-array":F.texImage2D(n,i,a,T,S,h,z,E,v,l);break;case"buffer":U=Ri(F),U.bindBuffer(35052,v.handle||v),U.texImage2D(n,i,a,T,S,h,z,E,l),U.bindBuffer(35052,null);break;case"browser-object":dn(F)?F.texImage2D(n,i,a,T,S,h,z,E,v):F.texImage2D(n,i,a,z,E,v);break;case"compressed":for(const[G,ee]of v.entries())F.compressedTexImage2D(n,G,ee.format,ee.width,ee.height,h,ee.data),V+=ee.levelSize;break;default:_t(!1,"Unknown image data type")}}),J==="compressed")this._trackAllocatedMemory(V,"Texture");else if(v&&v.byteLength)this._trackAllocatedMemory(v.byteLength,"Texture");else{const G=QM[this.dataFormat]||4,ee=ek[this.type]||1;this._trackAllocatedMemory(this.width*this.height*G*ee,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:i=null,x:a=0,y:h=0,width:l=this.width,height:m=this.height,level:v=0,format:E=this.format,type:T=this.type,dataFormat:S=this.dataFormat,compressed:z=!1,offset:D=0,border:F=this.border,parameters:J={}}=e;if({type:T,dataFormat:S,compressed:z,width:l,height:m}=this._deduceParameters({format:E,type:T,dataFormat:S,compressed:z,data:i,width:l,height:m}),_t(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const U=i;i=U.data,l=U.shape[0],m=U.shape[1]}i instanceof $n&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),wo(this.gl,J,()=>{if(z)this.gl.compressedTexSubImage2D(n,v,a,h,l,m,E,i);else if(i===null)this.gl.texSubImage2D(n,v,a,h,l,m,S,T,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(n,v,a,h,l,m,S,T,i,D);else if(i instanceof AS){const U=Ri(this.gl);U.bindBuffer(35052,i),U.texSubImage2D(n,v,a,h,l,m,S,T,D),U.bindBuffer(35052,null)}else dn(this.gl)?Ri(this.gl).texSubImage2D(n,v,a,h,l,m,S,T,i):this.gl.texSubImage2D(n,v,a,h,S,T,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Lt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof $n?{data:n.handle,dataType:"buffer"}:n instanceof AS?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:i,height:a,dataFormat:h,type:l,compressed:m}=e;const v=ow[n];return h=h||v&&v.dataFormat,l=l||v&&v.types[0],m=m||v&&v.compressed,{width:i,height:a}=this._deduceImageSize(r,i,a),{dataFormat:h,type:l,compressed:m,width:i,height:a,format:n,data:r}}_deduceImageSize(e,n,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:n,height:r}:i={width:n>=0?n:1,height:r>=0?r:1},_t(i,"Could not deduced texture size"),_t(n===void 0||i.width===n,"Deduced texture width does not match supplied width"),_t(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:_t(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return dn(this.gl)||!this.width||!this.height?!1:!SS(this.width)||!SS(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:qF.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let ZF="";function XF(t,e){return _t(typeof t=="string"),t=ZF+t,new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(i){r(i)}})}class Ds extends zc{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return zc.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};c0(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:XF(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const m1=[34069,34070,34071,34072,34073,34074];class tk extends zc{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};c0(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:i=0,y:a=0,mipmapLevel:h=0}=e;return this._subImage({target:n,data:r,x:i,y:a,mipmapLevel:h})}async setCubeMapImageData(e){let{width:n,height:r,pixels:i,data:a,border:h=0,format:l=6408,type:m=5121}=e;const{gl:v}=this,E=i||a,T=await Promise.all(m1.map(S=>{const z=E[S];return Promise.all(Array.isArray(z)?z:[z])}));this.bind(),m1.forEach((S,z)=>{T[z].length>1&&this.opts.mipmaps!==!1&&Lt.warn("".concat(this.id," has mipmap and multiple LODs."))(),T[z].forEach((D,F)=>{n&&r?v.texImage2D(S,F,l,n,r,h,l,m,D):v.texImage2D(S,F,l,l,m,D)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:i,pixels:a,data:h,border:l=0,format:m=6408,type:v=5121}=e,{gl:E}=this,T=a||h;return this.bind(),T instanceof Promise?T.then(S=>this.setImageDataForFace(Object.assign({},e,{face:n,data:S,pixels:S}))):this.width||this.height?E.texImage2D(n,0,m,r,i,l,m,v,T):E.texImage2D(n,0,m,m,v,T),this}}tk.FACES=m1;class YF extends zc{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return dn(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ri(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:i,height:a,depth:h=1,border:l=0,format:m,type:v=5121,offset:E=0,data:T,parameters:S={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),wo(this.gl,S,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,n,r,i,a,h,l,m,v,T),T instanceof $n&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,n,r,i,a,h,l,m,v,E))}),T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const z=QM[this.dataFormat]||4,D=ek[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*z*D,"Texture")}return this.loaded=!0,this}}const cc="EXT_color_buffer_float",CS={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:cc,bpp:2},33327:{gl2:cc,bpp:4},34842:{gl2:cc,bpp:8},33326:{gl2:cc,bpp:4},33328:{gl2:cc,bpp:8},34836:{gl2:cc,bpp:16},35898:{gl2:cc,bpp:4}};function KF(t,e,n){const r=n[e];if(!r)return!1;const i=dn(t)&&r.gl2||r.gl1;return typeof i=="string"?t.getExtension(i):i}class qu extends Ra{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||KF(e,n,CS)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:i=1,samples:a=0}=e;return _t(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),a!==0&&dn(this.gl)?this.gl.renderbufferStorageMultisample(36161,a,n,r,i):this.gl.renderbufferStorage(36161,n,r,i),this.format=n,this.width=r,this.height=i,this.samples=a,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*CS[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const JF=256,QF=1024,eB=16384,IS=6144,MS=6145,kS=6146,LS=34041,nk="clear: bad arguments";function aw(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a={};e&&(a.framebuffer=e);let h=0;n&&(h|=eB,n!==!0&&(a.clearColor=n)),r&&(h|=JF,r!==!0&&(a.clearDepth=r)),i&&(h|=QF,r!==!0&&(a.clearStencil=r)),_t(h!==0,nk),wo(t,a,()=>{t.clear(h)})}function tB(t){let{framebuffer:e=null,buffer:n=IS,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ri(t),wo(t,{framebuffer:e},()=>{switch(n){case IS:switch(i.constructor){case Int32Array:t.clearBufferiv(n,r,i);break;case Uint32Array:t.clearBufferuiv(n,r,i);break;case Float32Array:default:t.clearBufferfv(n,r,i)}break;case MS:t.clearBufferfv(MS,0,[i]);break;case kS:t.clearBufferiv(kS,0,[i]);break;case LS:const[a,h]=i;t.clearBufferfi(LS,0,a,h);break;default:_t(!1,nk)}})}function nB(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return _t(!1),0}}function u0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:a=36064,target:h=null,sourceWidth:l,sourceHeight:m,sourceType:v}=e;const{framebuffer:E,deleteFramebuffer:T}=rk(t);_t(E);const{gl:S,handle:z,attachments:D}=E;l=l||E.width,m=m||E.height,a===36064&&z===null&&(a=1028),_t(D[a]),v=v||D[a].type,h=iB(h,v,i,l,m),v=v||f1(h);const F=S.bindFramebuffer(36160,z);return S.readPixels(n,r,l,m,i,v,h),S.bindFramebuffer(36160,F||null),T&&E.delete(),h}function RS(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=u0(t,{sourceAttachment:e}),{width:i,height:a}=t;for(;a>n;)({data:r,width:i,height:a}=UF({data:r,width:i,height:a}));NF({data:r,width:i,height:a});const h=document.createElement("canvas");h.width=i,h.height=a;const l=h.getContext("2d"),m=l.createImageData(i,a);return m.data.set(r),l.putImageData(m,0,0),h.toDataURL()}function rB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:i=0,targetMipmaplevel:a=0,targetInternalFormat:h=6408}=n;let{targetX:l,targetY:m,targetZ:v,width:E,height:T}=n;const{framebuffer:S,deleteFramebuffer:z}=rk(t);_t(S);const{gl:D,handle:F}=S,J=typeof l<"u"||typeof m<"u"||typeof v<"u";l=l||0,m=m||0,v=v||0;const U=D.bindFramebuffer(36160,F);_t(e);let V=null;if(e instanceof zc&&(V=e,E=Number.isFinite(E)?E:V.width,T=Number.isFinite(T)?T:V.height,V.bind(0),e=V.target),!J)D.copyTexImage2D(e,a,h,r,i,E,T,0);else switch(e){case 3553:case 34067:D.copyTexSubImage2D(e,a,l,m,r,i,E,T);break;case 35866:case 32879:Ri(D).copyTexSubImage3D(e,a,l,m,v,r,i,E,T);break}return V&&V.unbind(),D.bindFramebuffer(36160,U||null),z&&S.delete(),V}function rk(t){return t instanceof ti?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:pB(t),deleteFramebuffer:!0}}function iB(t,e,n,r,i){if(t)return t;e=e||5121;const a=Bf(e,{clamped:!1}),h=nB(n);return new a(r*i*h)}const cr={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function sB(t){const e=new Ds(t,{format:6408,type:5126,dataFormat:6408}),n=new ti(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const ik={[cr.WEBGL2]:[!1,!0],[cr.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[cr.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[cr.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[cr.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[cr.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[cr.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[cr.FLOAT_BLEND]:["EXT_float_blend"],[cr.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[cr.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[cr.TEXTURE_FLOAT]:["OES_texture_float",!0],[cr.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[cr.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[cr.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[cr.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[cr.COLOR_ATTACHMENT_RGBA32F]:[sB,"EXT_color_buffer_float"],[cr.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[cr.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[cr.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[cr.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[cr.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[cr.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},oB=2;function aB(t,e){return lw(t,e)}function lw(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>sk(t,n))}function lB(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in ik)t.luma.caps[e]===void 0&&(t.luma.caps[e]=sk(t,e));return t.luma.caps}function sk(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=cB(t,e)),t.luma.caps[e]||Lt.log(oB,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function cB(t,e){const n=ik[e];_t(n,e);let r;const i=dn(t)&&n[1]||n[0];if(typeof i=="function")r=i(t);else if(Array.isArray(i)){r=!0;for(const a of i)r=r&&!!t.getExtension(a)}else typeof i=="string"?r=!!t.getExtension(i):typeof i=="boolean"?r=i:_t(!1);return r}const zS="Multiple render targets not supported";class ti extends Ra{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=n;let a=!0;return r&&(a=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(a=a&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),a}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new ti(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Ri(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Ri(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:i=null,color:a=!0,depth:h=!0,stencil:l=!1,check:m=!0,readBuffer:v=void 0,drawBuffers:E=void 0}=e;if(_t(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,i)for(const T in i){const S=i[T];(Array.isArray(S)?S[0]:S).resize({width:n,height:r})}else i=this._createDefaultAttachments(a,h,l,n,r);this.update({clearAttachments:!0,attachments:i,readBuffer:v,drawBuffers:E}),i&&m&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:i,clearAttachments:a=!1,resizeAttachments:h=!0}=e;this.attach(n,{clearAttachments:a,resizeAttachments:h});const{gl:l}=this,m=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),l.bindFramebuffer(36160,m||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return _t(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&Lt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};n&&Object.keys(this.attachments).forEach(h=>{i[h]=null}),Object.assign(i,e);const a=this.gl.bindFramebuffer(36160,this.handle);for(const h in i){_t(h!==void 0,"Misspelled framebuffer binding point?");const l=Number(h),m=i[l];let v=m;if(!v)this._unattach(l);else if(v instanceof qu)this._attachRenderbuffer({attachment:l,renderbuffer:v});else if(Array.isArray(m)){const[E,T=0,S=0]=m;v=E,this._attachTexture({attachment:l,texture:E,layer:T,level:S})}else this._attachTexture({attachment:l,texture:v,layer:0,level:0});r&&v&&v.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,a||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(h=>!this.attachments[h]).forEach(h=>{delete this.attachments[h]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(hB(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:i,drawBuffers:a=[]}=e,h=this.gl.bindFramebuffer(36160,this.handle);return(n||r||i)&&aw(this.gl,{color:n,depth:r,stencil:i}),a.forEach((l,m)=>{tB(this.gl,{drawBuffer:m,value:l})}),this.gl.bindFramebuffer(36160,h||null),this}readPixels(){return Lt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Lt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Lt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Lt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Lt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Lt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:i=0,width:a,height:h}=e;const l=Ri(this.gl),m=l.bindFramebuffer(36008,this.handle);return r===0&&i===0&&a===void 0&&h===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,r,i,a,h),l.bindFramebuffer(36008,m),this}getAttachmentParameter(e,n,r){let i=this._getAttachmentParameterFallback(n);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=Cl(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const a of r){const h=n?Cl(this.gl,a):a;i[h]=this.getAttachmentParameter(e,a,n)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const i of n){const a=Number(i),h=e?Cl(this.gl,a):a;r[h]=this.getAttachmentParameters(a,e)}return r}show(){return typeof window<"u"&&window.open(RS(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Lt.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=RS(this,{targetMaxHeight:100});return Lt.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,i,a){let h=null;return e&&(h=h||{},h[36064]=new Ds(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:a,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(h[36064])),n&&r?(h=h||{},h[33306]=new qu(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(h[33306])):n?(h=h||{},h[36096]=new qu(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:a}),this.ownResources.push(h[36096])):r&&_t(!1),h}_unattach(e){const n=this.attachments[e];n&&(n instanceof qu?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:i,level:a}=e;const{gl:h}=this;switch(h.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Ri(h).framebufferTextureLayer(36160,n,r.target,a,i);break;case 34067:const m=uB(i);h.framebufferTexture2D(36160,n,m,r.handle,a);break;case 3553:h.framebufferTexture2D(36160,n,3553,r.handle,a);break;default:_t(!1,"Illegal texture type")}h.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=N6(this.gl);n?n.readBuffer(e):_t(e===36064||e===1029,zS),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=Ri(n);if(r)r.drawBuffers(e);else{const i=n.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):_t(e.length===1&&(e[0]===36064||e[0]===1029),zS)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=lB(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function uB(t){return t<34069?t+34069:t}function hB(t){return(ti.STATUS||{})[t]||"Framebuffer error ".concat(t)}const dB=[36049,36048,33296,33298,33299,33300,33301,33302,33303];ti.ATTACHMENT_PARAMETERS=dB;function fB(t,e){_t(t instanceof Ds||t instanceof tk||t instanceof YF);const n=t.constructor,{gl:r,width:i,height:a,format:h,type:l,dataFormat:m,border:v,mipmaps:E}=t,T=Object.assign({width:i,height:a,format:h,type:l,dataFormat:m,border:v,mipmaps:E},e);return new n(r,T)}function pB(t,e){const{gl:n,width:r,height:i,id:a}=t;return new ti(n,Object.assign({},e,{id:"framebuffer-for-".concat(a),width:r,height:i,attachments:{36064:t}}))}function Cg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const mB=35632,gB=35633;function yB(t){switch(t){case mB:return"fragment";case gB:return"vertex";default:return"unknown type"}}function _B(t,e,n,r){const i=t.split(/\r?\n/),a={},h={},l=r||Cg(e)||"(unnamed)",m="".concat(yB(n)," shader ").concat(l);for(let E=0;E<i.length;E++){const T=i[E];if(T.length<=1)continue;const S=T.split(":"),z=S[0],D=parseInt(S[2],10);if(isNaN(D))throw new Error("GLSL compilation error in ".concat(m,": ").concat(t));z!=="WARNING"?a[D]=T:h[D]=T}const v=vB(e);return{shaderName:m,errors:DS(a,v),warnings:DS(h,v)}}function DS(t,e){let n="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(i,`
`),t[r+1])){const a=t[r+1],h=a.split(":",3),l=h[0],m=parseInt(h[1],10)||0,v=a.substring(h.join(":").length+1).trim();n+=ok("^^^ ".concat(l,": ").concat(v,`

`),m)}}return n}function vB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((a,h)=>{const l=String(h+e),m=l.length;return ok(l,i-m)+n+a})}function ok(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function ak(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const xB="Shader: GLSL source code must be a JavaScript string";class Nf extends Ra{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return _t(!1),"unknown"}}constructor(e,n){c0(e),_t(typeof n.source=="string",xB);const r=Cg(n.source,null)||n.id||Ll("unnamed ".concat(Nf.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=Cg(n,null);r&&(this.id=Ll(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Nf.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Cg(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:a,warnings:h}=_B(r,this.source,this.shaderType,this.id);throw Lt.error("GLSL compilation errors in ".concat(i,`
`).concat(a))(),Lt.warn("GLSL compilation warnings in ".concat(i,`
`).concat(h))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class zv extends Nf{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Dv extends Nf{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const bB={5126:ar.bind(null,"uniform1fv",Es,1,Ii),35664:ar.bind(null,"uniform2fv",Es,2,Ii),35665:ar.bind(null,"uniform3fv",Es,3,Ii),35666:ar.bind(null,"uniform4fv",Es,4,Ii),5124:ar.bind(null,"uniform1iv",sl,1,Ii),35667:ar.bind(null,"uniform2iv",sl,2,Ii),35668:ar.bind(null,"uniform3iv",sl,3,Ii),35669:ar.bind(null,"uniform4iv",sl,4,Ii),35670:ar.bind(null,"uniform1iv",sl,1,Ii),35671:ar.bind(null,"uniform2iv",sl,2,Ii),35672:ar.bind(null,"uniform3iv",sl,3,Ii),35673:ar.bind(null,"uniform4iv",sl,4,Ii),35674:ar.bind(null,"uniformMatrix2fv",Es,4,ga),35675:ar.bind(null,"uniformMatrix3fv",Es,9,ga),35676:ar.bind(null,"uniformMatrix4fv",Es,16,ga),35678:pi,35680:pi,5125:ar.bind(null,"uniform1uiv",$m,1,Ii),36294:ar.bind(null,"uniform2uiv",$m,2,Ii),36295:ar.bind(null,"uniform3uiv",$m,3,Ii),36296:ar.bind(null,"uniform4uiv",$m,4,Ii),35685:ar.bind(null,"uniformMatrix2x3fv",Es,6,ga),35686:ar.bind(null,"uniformMatrix2x4fv",Es,8,ga),35687:ar.bind(null,"uniformMatrix3x2fv",Es,6,ga),35688:ar.bind(null,"uniformMatrix3x4fv",Es,12,ga),35689:ar.bind(null,"uniformMatrix4x2fv",Es,8,ga),35690:ar.bind(null,"uniformMatrix4x3fv",Es,12,ga),35678:pi,35680:pi,35679:pi,35682:pi,36289:pi,36292:pi,36293:pi,36298:pi,36299:pi,36300:pi,36303:pi,36306:pi,36307:pi,36308:pi,36311:pi},wB={},EB={},TB={},OS=[0];function cw(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(OS[0]=t,t=OS);const i=t.length;if(i%e&&Lt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let a=r[i];a||(a=new n(i),r[i]=a);for(let h=0;h<i;h++)a[h]=t[h];return a}function Es(t,e){return cw(t,e,Float32Array,wB)}function sl(t,e){return cw(t,e,Int32Array,EB)}function $m(t,e){return cw(t,e,Uint32Array,TB)}function FS(t,e,n){const r=bB[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function SB(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function PB(t,e,n){for(const r in t){const i=t[r];if((!n||!!n[r])&&!AB(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function AB(t){return Array.isArray(t)||ArrayBuffer.isView(t)?IB(t):isFinite(t)||t===!0||t===!1||t instanceof zc||t instanceof qu?!0:t instanceof ti?!!t.texture:!1}function CB(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let i=0,a=n.length;i<a;++i)r[i]=n[i]}else t[e]=n.slice();else t[e]=n}function IB(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function pi(){let t=null;return(e,n,r)=>{const i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function ar(t,e,n,r){let i=null,a=null;return(h,l,m)=>{const v=e(m,n),E=v.length;let T=!1;if(i===null)i=new Float32Array(E),a=E,T=!0;else{_t(a===E,"Uniform length cannot change.");for(let S=0;S<E;++S)if(v[S]!==i[S]){T=!0;break}}return T&&(r(h,t,l,v),i.set(v)),T}}function Ii(t,e,n,r){t[e](n,r)}function ga(t,e,n,r){t[e](n,!1,r)}const MB=5120,kB=5121,LB=5122,RB=5123,BS=0,Wm=1,zB=2,DB=3,Hm=4,OB=5,FB=6,Jr=5126,BB=35664,NB=35665,UB=35666,Bd=5124,VB=35667,jB=35668,GB=35669,Nd=5125,$B=36294,WB=36295,HB=36296,qB=35670,ZB=35671,XB=35672,YB=35673,KB=35674,JB=35675,QB=35676,eN=35685,tN=35686,nN=35687,rN=35688,iN=35689,sN=35690,g1={[Jr]:[Jr,1,"float"],[BB]:[Jr,2,"vec2"],[NB]:[Jr,3,"vec3"],[UB]:[Jr,4,"vec4"],[Bd]:[Bd,1,"int"],[VB]:[Bd,2,"ivec2"],[jB]:[Bd,3,"ivec3"],[GB]:[Bd,4,"ivec4"],[Nd]:[Nd,1,"uint"],[$B]:[Nd,2,"uvec2"],[WB]:[Nd,3,"uvec3"],[HB]:[Nd,4,"uvec4"],[qB]:[Jr,1,"bool"],[ZB]:[Jr,2,"bvec2"],[XB]:[Jr,3,"bvec3"],[YB]:[Jr,4,"bvec4"],[KB]:[Jr,8,"mat2"],[eN]:[Jr,8,"mat2x3"],[tN]:[Jr,8,"mat2x4"],[JB]:[Jr,12,"mat3"],[nN]:[Jr,12,"mat3x2"],[rN]:[Jr,12,"mat3x4"],[QB]:[Jr,16,"mat4"],[iN]:[Jr,16,"mat4x2"],[sN]:[Jr,16,"mat4x3"]};function oN(t){switch(t){case BS:return BS;case Wm:return Wm;case DB:return Wm;case zB:return Wm;case Hm:return Hm;case OB:return Hm;case FB:return Hm;default:return _t(!1),0}}function NS(t){const e=g1[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function lk(t,e){switch(t){case MB:case kB:case LB:case RB:t=Jr;break}for(const n in g1){const[r,i,a]=g1[n];if(r===t&&i===e)return{glType:n,name:a}}return null}class aN{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:a,type:h,size:l}=n.getActiveAttrib(e.handle,i),m=n.getAttribLocation(e.handle,a);m>=0&&this._addAttribute(m,a,h,l)}this.attributeInfos.sort((i,a)=>i.location-a.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!dn(n))return;const r=n.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:a,type:h,size:l}=n.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,a,h,l)}this.varyingInfos.sort((i,a)=>i.location-a.location)}_addAttribute(e,n,r,i){const{type:a,components:h}=NS(r),l={type:a,size:i*h};this._inferProperties(e,n,l);const m={location:e,name:n,accessor:new As(l)};this.attributeInfos.push(m),this.attributeInfosByLocation[e]=m,this.attributeInfosByName[m.name]=m}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,i){const{type:a,components:h}=NS(r),l=new As({type:a,size:i*h}),m={location:e,name:n,accessor:l};this.varyingInfos.push(m),this.varyingInfosByName[m.name]=m}}const US=4,lN=35981,cN=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class ck extends Ra{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",cN),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:i,varyings:a,bufferMode:h=lN}=e;return this.hash=n||"",this.vs=typeof r=="string"?new zv(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new Dv(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,_t(this.vs instanceof zv),_t(this.fs instanceof Dv),this.uniforms={},this._textureUniforms={},a&&a.length>0&&(Ri(this.gl),this.varyings=a,this.gl2.transformFeedbackVaryings(this.handle,a,h)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new aN(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:i,offset:a=0,start:h,end:l,isIndexed:m=!1,indexType:v=5123,instanceCount:E=0,isInstanced:T=E>0,vertexArray:S=null,transformFeedback:z,framebuffer:D,parameters:F={},uniforms:J,samplers:U}=e;if((J||U)&&(Lt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(J||{})),Lt.priority>=n){const V=D?D.id:"default",G="mode=".concat(Cl(this.gl,r)," verts=").concat(i," ")+"instances=".concat(E," indexType=").concat(Cl(this.gl,v)," ")+"isInstanced=".concat(T," isIndexed=").concat(m," ")+"Framebuffer=".concat(V);Lt.log(n,G)()}return _t(S),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||T&&E===0?!1:(S.bindForDraw(i,E,()=>{if(D!==void 0&&(F=Object.assign({},F,{framebuffer:D})),z){const V=oN(r);z.begin(V)}this._bindTextures(),wo(this.gl,F,()=>{m&&T?this.gl2.drawElementsInstanced(r,i,v,a,E):m&&dn(this.gl)&&!isNaN(h)&&!isNaN(l)?this.gl2.drawRangeElements(r,h,l,i,v,a):m?this.gl.drawElements(r,i,v,a):T?this.gl2.drawArraysInstanced(r,a,i,E):this.gl.drawArrays(r,a,i)}),z&&z.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lt.priority>=2&&PB(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],i=this._uniformSetters[n];if(i){let a=r,h=!1;if(a instanceof ti&&(a=a.texture),a instanceof zc)if(h=this.uniforms[n]!==r,h){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const l=a,{textureIndex:m}=i;l.bind(m),a=m,this._textureUniforms[n]=l}else a=i.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(i(a)||h)&&CB(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const i of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new zv({handle:i});break;case 35632:r.fs=new Dv({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Ll(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Lt.time(US,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Lt.timeEnd(US,"linkProgram for ".concat(this._getName()))(),e.debug||Lt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:i}=SB(r.name);let a=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=FS(e,a,r),r.size>1)for(let h=0;h<r.size;h++)a=e.getUniformLocation(this.handle,"".concat(i,"[").concat(h,"]")),this._uniformSetters["".concat(i,"[").concat(h,"]")]=FS(e,a,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const uN=34918,hN=34919,dN=35007,fN=36795,pN=35976,mN=35887,gN=36202;class _y extends Ra{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=dn(e),i=lw(e,cr.TIMER_QUERY);let a=r||i;for(const h of n)switch(h){case"queries":a=a&&r;break;case"timers":a=a&&i;break;default:_t(!1)}return a}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(dN)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?gN:mN)}beginTransformFeedbackQuery(){return this.begin(pN)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,hN);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(fN)}getResult(){return this.gl2.getQueryParameter(this.handle,uN)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,i)=>{const a=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}_createHandle(){return _y.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class uk extends Ra{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return dn(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ri(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,yh(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:i,byteSize:a,byteOffset:h}=this._getBufferParams(n);return r<0?(this.unused[e]=i,Lt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,i,h,a),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,i;return e instanceof $n?i=e:(i=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||i.byteLength-n),{buffer:i,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const a=n&&n.handle;return!a||i===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let qm=null;function yN(t){return(!qm||qm.byteLength<t)&&(qm=new ArrayBuffer(t)),qm}function _N(t,e){const n=yN(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function vN(t){let{target:e,source:n,start:r=0,count:i=1}=t;const a=n.length,h=i*a;let l=0;for(let m=r;l<a;l++)e[m++]=n[l];for(;l<h;)l<h-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+h-l),l=h);return e}const xN="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ts extends Ra{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?dn(e)||GM()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Ts(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Ts.MAX_ATTRIBUTES=Ts.MAX_ATTRIBUTES||e.getParameter(34921),Ts.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:Ts._setConstantFloatArray(e,n,r);break;case Int32Array:Ts._setConstantIntArray(e,n,r);break;case Uint32Array:Ts._setConstantUintArray(e,n,r);break;default:_t(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ts.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return _t(!e||e.target===34963,xN),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:i,type:a,stride:h,offset:l,normalized:m,integer:v,divisor:E}=r,{gl:T,gl2:S}=this;return e=Number(e),this.bind(()=>{T.bindBuffer(34962,n.handle),v?(_t(dn(T)),S.vertexAttribIPointer(e,i,a,h,l)):T.vertexAttribPointer(e,i,a,m,h,l),T.enableVertexAttribArray(e),S.vertexAttribDivisor(e,E||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Ts.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),i=r.byteLength*e,a=r.length*e;let h=!this.buffer;if(this.buffer=this.buffer||new $n(this.gl,i),h=h||this.buffer.reallocate(i),h=h||!this._compareConstantArrayValues(r,this.bufferValue),h){const l=_N(n.constructor,a);vN({target:l,source:r,start:0,count:a}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:_t(!1)}}static _setConstantIntArray(e,n,r){switch(_t(dn(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:_t(!1)}}static _setConstantUintArray(e,n,r){switch(_t(dn(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:_t(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return _t(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const bN="VertexArray: attributes must be Buffers or constants (i.e. typed array)",wN=/^(.+)__LOCATION_([0-9]+)$/,EN=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class TN{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ts(e),KM(this,"VertexArray","v6.0",EN),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:i,accessor:a}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return i>=0&&(this.values[i]=n,this.accessors[i]=a,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,n,a)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:a}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return i>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[i]=n,this.accessors[i]=a,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new $n(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof $n&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof $n&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),i=r()}),i}_resolveLocationAndAccessor(e,n,r,i){const a={location:-1,accessor:null},{location:h,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(h)||h<0)return this.unused[e]=n,Lt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),a;const m=this._getAttributeInfo(l||h);if(!m)return a;const v=this.accessors[h]||{},E=As.resolve(m.accessor,v,r,i),{size:T,type:S}=E;return _t(Number.isFinite(T)&&Number.isFinite(S)),{location:h,accessor:E}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=wN.exec(e),i=r?r[1]:e,a=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+a,name:i}:{location:-1}}_setAttribute(e,n){if(n instanceof $n)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof $n){const r=n[0],i=n[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof $n){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(bN)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let a=1;a<this.vertexArrayObject.MAX_ATTRIBUTES;a++)i=this.values[a],ArrayBuffer.isView(i)&&this._setConstantAttribute(a,i)}_setConstantAttributeZero(e,n){if(Ts.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){Ts.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],i=this.accessors[n];if(!r)return;const{divisor:a}=i,h=a>0;if(e.isInstanced=e.isInstanced||h,r instanceof $n){const l=r;if(h){const m=l.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,m)}else{const m=l.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,m)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Lt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function SN(t,e){const{maxElts:n=16,size:r=1}=e;let i="[";for(let h=0;h<t.length&&h<n;++h)h>0&&(i+=",".concat(h%r===0?" ":"")),i+=Uf(t[h],e);const a=t.length>n?"...":"]";return"".concat(i).concat(a)}function Uf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return SN(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function VS(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:i=!1}=t;_t(n);const a=".*_.*",h=".*Matrix",l=n._uniformSetters,m={},v=Object.keys(l).sort();let E=0;for(const z of v)!z.match(a)&&!z.match(h)&&Ov({table:m,header:e,uniforms:r,uniformName:z,undefinedOnly:i})&&E++;for(const z of v)z.match(h)&&Ov({table:m,header:e,uniforms:r,uniformName:z,undefinedOnly:i})&&E++;for(const z of v)m[z]||Ov({table:m,header:e,uniforms:r,uniformName:z,undefinedOnly:i})&&E++;let T=0;const S={};if(!i)for(const z in r){const D=r[z];m[z]||(T++,S[z]={Type:"NOT USED: ".concat(D),[e]:Uf(D)})}return{table:m,count:E,unusedTable:S,unusedCount:T}}function Ov(t){let{table:e,header:n,uniforms:r,uniformName:i,undefinedOnly:a}=t;const h=r[i],l=PN(h);return!a||!l?(e[i]={[n]:l?Uf(h):"N/A","Uniform Type":l?h:"NOT PROVIDED"},!0):!1}function PN(t){return t!=null}function AN(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=jS(e,e.elements,null,n));const i=e.values;for(const a in i){const h=e._getAttributeInfo(a);if(h){let l="".concat(a,": ").concat(h.name);const m=e.accessors[h.location];m&&(l="".concat(a,": ").concat(CN(h.name,m))),r[l]=jS(e,i[a],m,n)}}return r}function jS(t,e,n,r){const{gl:i}=t;if(!e)return{[r]:"null","Format ":"N/A"};let a="NOT PROVIDED",h=1,l=0,m=0,v,E,T;if(n&&(a=n.type,h=n.size,a=String(a).replace("Array",""),v=a.indexOf("nt")!==-1),e instanceof $n){const S=e,{data:z,changed:D}=S.getDebugData();E=D?"*":"",T=z,m=S.byteLength,l=m/z.BYTES_PER_ELEMENT/h;let F;if(n){const J=n.divisor>0;F="".concat(J?"I ":"P "," ").concat(l," (x").concat(h,"=").concat(m," bytes ").concat(Cl(i,a),")")}else v=!0,F="".concat(m," bytes");return{[r]:"".concat(E).concat(Uf(T,{size:h,isInteger:v})),"Format ":F}}return T=e,h=e.length,a=String(e.constructor.name).replace("Array",""),v=a.indexOf("nt")!==-1,{[r]:"".concat(Uf(T,{size:h,isInteger:v})," (constant)"),"Format ":"".concat(h,"x").concat(a," (constant)")}}function CN(t,e){const{type:n,size:r}=e,i=lk(n,r);return i?"".concat(t," (").concat(i.name,")"):t}function IN(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const i=GS(r);e["in ".concat(i)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const i=GS(r);e["out ".concat(i)]={[n]:JSON.stringify(r.accessor)}}return e}function GS(t){const{type:e,size:n}=t.accessor,r=lk(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const $S=La()&&typeof document<"u";let MN=0;class kN{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=J=>YM(J),onAddHTML:r=null,onInitialize:i=()=>{},onRender:a=()=>{},onFinalize:h=()=>{},onError:l,gl:m=null,glOptions:v={},debug:E=!1,createFramebuffer:T=!1,autoResizeViewport:S=!0,autoResizeDrawingBuffer:z=!0,stats:D=xc.get("animation-loop-".concat(MN++))}=e;let{useDevicePixels:F=!0}=e;"useDevicePixelRatio"in e&&(Lt.deprecated("useDevicePixelRatio","useDevicePixels")(),F=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:i,onRender:a,onFinalize:h,onError:l,gl:m,glOptions:v,debug:E,createFramebuffer:T},this.gl=m,this.needsRedraw=null,this.timeline=null,this.stats=D,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:S,autoResizeDrawingBuffer:z,useDevicePixels:F}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return _t(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=_y.isSupported(this.gl,["timers"])?new _y(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return Lt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=$S?new Promise((e,n)=>{if($S&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):FF(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):OF(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?iw(this.props.gl,e):this.onCreateContext(e),!l0(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");EF(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&CF(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new ti(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const up="vs",uw="fs";function Ls(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Fv={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function LN(t){const e={};for(const n in t){const r=t[n],i=RN(r);e[n]=i}return e}function RN(t){let e=WS(t);return e==="object"?t?"type"in t?Object.assign({},t,Fv[t.type]):"value"in t?(e=WS(t.value),Object.assign({type:e},t,Fv[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Fv[e])}function WS(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const zN="vs",DN="fs";class HS{constructor(e){let{name:n,vs:r,fs:i,dependencies:a=[],uniforms:h,getUniforms:l,deprecations:m=[],defines:v={},inject:E={},vertexShader:T,fragmentShader:S}=e;Ls(typeof n=="string"),this.name=n,this.vs=r||T,this.fs=i||S,this.getModuleUniforms=l,this.dependencies=a,this.deprecations=this._parseDeprecationDefinitions(m),this.defines=v,this.injections=ON(E),h&&(this.uniforms=LN(h))}getModuleSource(e){let n;switch(e){case zN:n=this.vs||"";break;case DN:n=this.fs||"";break;default:Ls(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const i in r){const a=r[i];i in e&&!a.private?(a.validate&&Ls(a.validate(e[i],a),"".concat(this.name,": invalid ").concat(i)),n[i]=e[i]):n[i]=a.value}return n}}function ON(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const i=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function FN(t){return BN(dk(t))}function BN(t){const e={},n={};return hk({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function hk(t){let{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)r[a.name]=a,(i[a.name]===void 0||i[a.name]<n)&&(i[a.name]=n);for(const a of e)a.dependencies&&hk({modules:a.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function dk(t,e){return t.map(n=>(n instanceof HS||(Ls(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Ls(n.name,"shader module has no name"),n=new HS(n),n.dependencies=dk(n.dependencies)),n))}function NN(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i}const UN=7936,VN=7937,jN=7938,GN=35724,hw={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},mc={};Object.keys(hw).forEach(t=>{mc[t]=t});function $N(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function WN(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||UN),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||VN);return{gpuVendor:HN(n,r),vendor:n,renderer:r,version:t.getParameter(jN),shadingLanguageVersion:t.getParameter(GN)}}function HN(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Bv={};function qS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=hw[e];if(Ls(r,e),!NN(n))return!0;if(e in Bv)return Bv[e];const i=r[0],a=n.behavior||"enable",h="#extension GL_".concat(i," : ").concat(a,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,h),t.compileShader(l);const m=t.getShaderParameter(l,35713);return t.deleteShader(l),Bv[e]=m,m}function qN(t,e){const n=hw[e];Ls(n,e);const r=$N(t)&&n[1]||n[0],i=typeof r=="string"?!!t.getExtension(r):r;return Ls(i===!1||i===!0),i}function Zm(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>qN(t,n))}function ZN(t){switch(WN(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function XN(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Zm(t,mc.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Zm(t,mc.GLSL_DERIVATIVES)&&qS(t,mc.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Zm(t,mc.GLSL_FRAG_DATA)&&qS(t,mc.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Zm(t,mc.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const YN=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,KN=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,JN={[up]:YN,[uw]:KN},Ig="__LUMA_INJECT_DECLARATIONS__",ZS=/void\s+main\s*\([^)]*\)\s*\{\n?/,XS=/}\n?[^{}]*$/,Nv=[];function YS(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===up;for(const a in n){const h=n[a];h.sort((m,v)=>m.order-v.order),Nv.length=h.length;for(let m=0,v=h.length;m<v;++m)Nv[m]=h[m].injection;const l="".concat(Nv.join(`
`),`
`);switch(a){case"vs:#decl":i&&(t=t.replace(Ig,l));break;case"vs:#main-start":i&&(t=t.replace(ZS,m=>m+l));break;case"vs:#main-end":i&&(t=t.replace(XS,m=>l+m));break;case"fs:#decl":i||(t=t.replace(Ig,l));break;case"fs:#main-start":i||(t=t.replace(ZS,m=>m+l));break;case"fs:#main-end":i||(t=t.replace(XS,m=>l+m));break;default:t=t.replace(a,m=>m+l)}}return t=t.replace(Ig,""),r&&(t=t.replace(/\}\s*$/,a=>a+JN[e])),t}function y1(t){const e={};return Ls(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function _h(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const fk=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],QN=[...fk,[_h("attribute"),"in $1"],[_h("varying"),"out $1"]],e8=[...fk,[_h("varying"),"in $1"]],pk=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],t8=[...pk,[_h("in"),"attribute $1"],[_h("out"),"varying $1"]],n8=[...pk,[_h("in"),"varying $1"]],_1="gl_FragColor",v1=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,r8=/void\s+main\s*\([^)]*\)\s*\{\n?/;function i8(t,e,n){switch(e){case 300:return n?vy(t,QN):s8(t);case 100:return n?vy(t,t8):o8(t);default:throw new Error("unknown GLSL version ".concat(e))}}function vy(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function s8(t){t=vy(t,e8);const e=t.match(v1);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(_1,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(r8,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(_1,"\\b"),"g"),n)}return t}function o8(t){t=vy(t,n8);const e=t.match(v1);if(e){const n=e[1];t=t.replace(v1,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),_1)}return t}const a8=`

`.concat(Ig,`

`),mk={[up]:"vertex",[uw]:"fragment"},l8=`precision highp float;

`;function c8(t,e){const{vs:n,fs:r}=e,i=FN(e.modules||[]);return{gl:t,vs:KS(t,Object.assign({},e,{source:n,type:up,modules:i})),fs:KS(t,Object.assign({},e,{source:r,type:uw,modules:i})),getUniforms:u8(i)}}function KS(t,e){let{id:n,source:r,type:i,modules:a,defines:h={},hookFunctions:l=[],inject:m={},transpileToGLSL100:v=!1,prologue:E=!0,log:T}=e;Ls(typeof r=="string","shader source must be a string");const S=i===up,z=r.split(`
`);let D=100,F="",J=r;z[0].indexOf("#version ")===0?(D=300,F=z[0],J=z.slice(1).join(`
`)):F="#version ".concat(D);const U={};a.forEach(ve=>{Object.assign(U,ve.getDefines())}),Object.assign(U,h);let V=E?"".concat(F,`
`).concat(d8({id:n,source:r,type:i}),`
`).concat(h8({type:i}),`
`).concat(ZN(t),`
`).concat(XN(t),`
`).concat(f8(U),`
`).concat(S?"":l8,`
`):"".concat(F,`
`);const G=m8(l),ee={},se={},me={};for(const ve in m){const Me=typeof m[ve]=="string"?{injection:m[ve],order:0}:m[ve],Be=ve.match(/^(v|f)s:(#)?([\w-]+)$/);if(Be){const ze=Be[2],Oe=Be[3];ze?Oe==="decl"?se[ve]=[Me]:me[ve]=[Me]:ee[ve]=[Me]}else me[ve]=[Me]}for(const ve of a){T&&ve.checkDeprecations(J,T);const Me=ve.getModuleSource(i,D);V+=Me;const Be=ve.injections[i];for(const ze in Be){const Oe=ze.match(/^(v|f)s:#([\w-]+)$/);if(Oe){const et=Oe[2]==="decl"?se:me;et[ze]=et[ze]||[],et[ze].push(Be[ze])}else ee[ze]=ee[ze]||[],ee[ze].push(Be[ze])}}return V+=a8,V=YS(V,i,se),V+=p8(G[i],ee),V+=J,V=YS(V,i,me),V=i8(V,v?100:D,S),V}function u8(t){return function(n){const r={};for(const i of t){const a=i.getUniforms(n,r);Object.assign(r,a)}return r}}function h8(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(mk[e].toUpperCase(),`
`)}function d8(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(mk[r],`

`):""}function f8(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const i=t[r];(i||Number.isFinite(i))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function p8(t,e){let n="";for(const r in t){const i=t[r];if(n+="void ".concat(i.signature,` {
`),i.header&&(n+="  ".concat(i.header)),e[r]){const a=e[r];a.sort((h,l)=>h.order-l.order);for(const h of a)n+="  ".concat(h.injection,`
`)}i.footer&&(n+="  ".concat(i.footer)),n+=`}
`}return n}function m8(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[i,a]=n.split(":"),h=n.replace(/\(.+/,"");e[i][h]=Object.assign(r,{signature:a})}),e}const g8="void main() {gl_FragColor = vec4(0);}",gk=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,y8=`#version 300 es
`.concat(gk);function yk(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,i,a]=n;if(!e.includes(r)||!i||!a)return null;const h=a.split(";")[0];return{qualifier:r,type:i,name:h}}function _k(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:i}=t;if(!n)return e===300?y8:e>300?"#version ".concat(e,`
`).concat(gk):g8;const a=x8(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(a,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(a,`;
}`)}function _8(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Ls(!1),null}}function v8(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Ls(!1),null}}function x8(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Ls(!1),null}}const b8=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,w8={name:"fp32",vs:b8,fs:null};function JS(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Ms={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function E8(t,{precision:e=Ms.precision}={}){return t=T8(t),"".concat(parseFloat(t.toPrecision(e)))}function vh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function gl(t,e,n){return P8(t,r=>Math.max(e,Math.min(n,r)))}function xy(t,e,n){return vh(t)?t.map((r,i)=>xy(r,e[i],n)):n*e+(1-n)*t}function Vf(t,e,n){const r=Ms.EPSILON;n&&(Ms.EPSILON=n);try{if(t===e)return!0;if(vh(t)&&vh(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Vf(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ms.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ms.EPSILON=r}}function T8(t){return Math.round(t/Ms.EPSILON)*Ms.EPSILON}function S8(t){return t.clone?t.clone():new Array(t.length)}function P8(t,e,n){if(vh(t)){const r=t;n=n||S8(r);for(let i=0;i<n.length&&i<r.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function A8(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class vk extends A8(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:vh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ms)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+E8(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Vf(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const a=e[i];this[i]=a+r*(n[i]-a)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ms.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function C8(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ps(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Uv(t,e,n=""){if(Ms.debug&&!C8(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class I8 extends vk{get x(){return this[0]}set x(e){this[0]=Ps(e)}get y(){return this[1]}set y(e){this[1]=Ps(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Ps(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Ps(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return JS(e>=0&&e<this.ELEMENTS,"index is out of range"),Ps(this[e])}setComponent(e,n){return JS(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Mg=1e-6,xh=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function M8(){var t=new xh(2);return xh!=Float32Array&&(t[0]=0,t[1]=0),t}function QS(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function k8(t,e){return t[0]=-e[0],t[1]=-e[1],t}function xk(t,e,n,r){var i=e[0],a=e[1];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t}function L8(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){var t=M8();return function(e,n,r,i,a,h){var l,m;for(n||(n=2),r||(r=0),i?m=Math.min(i*n+r,e.length):m=e.length,l=r;l<m;l+=n)t[0]=e[l],t[1]=e[l+1],a(t,t,h),e[l]=t[0],e[l+1]=t[1];return e}})();function R8(t,e,n){const r=e[0],i=e[1],a=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/a,t[1]=(n[1]*r+n[5]*i)/a,t}function bk(t,e,n){const r=e[0],i=e[1],a=e[2],h=n[3]*r+n[7]*i+n[11]*a||1;return t[0]=(n[0]*r+n[4]*i+n[8]*a)/h,t[1]=(n[1]*r+n[5]*i+n[9]*a)/h,t[2]=(n[2]*r+n[6]*i+n[10]*a)/h,t}function z8(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function D8(){var t=new xh(3);return xh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function O8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function F8(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function B8(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function N8(t,e,n){var r=e[0],i=e[1],a=e[2],h=n[0],l=n[1],m=n[2];return t[0]=i*m-a*l,t[1]=a*h-r*m,t[2]=r*l-i*h,t}function wk(t,e,n){var r=e[0],i=e[1],a=e[2],h=n[3]*r+n[7]*i+n[11]*a+n[15];return h=h||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/h,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/h,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/h,t}function U8(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function V8(t,e,n){var r=n[0],i=n[1],a=n[2],h=n[3],l=e[0],m=e[1],v=e[2],E=i*v-a*m,T=a*l-r*v,S=r*m-i*l,z=i*S-a*T,D=a*E-r*S,F=r*T-i*E,J=h*2;return E*=J,T*=J,S*=J,z*=2,D*=2,F*=2,t[0]=l+E+z,t[1]=m+T+D,t[2]=v+S+F,t}function j8(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function G8(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function $8(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function W8(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],h=e[1],l=e[2],m=Math.sqrt(n*n+r*r+i*i),v=Math.sqrt(a*a+h*h+l*l),E=m*v,T=E&&B8(t,e)/E;return Math.acos(Math.min(Math.max(T,-1),1))}var H8=O8;(function(){var t=D8();return function(e,n,r,i,a,h){var l,m;for(n||(n=3),r||(r=0),i?m=Math.min(i*n+r,e.length):m=e.length,l=r;l<m;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],a(t,t,h),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const Vv=[0,0,0];let Xm;class Jo extends I8{static get ZERO(){return Xm||(Xm=new Jo(0,0,0),Object.freeze(Xm)),Xm}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&vh(e)?this.copy(e):(Ms.debug&&(Ps(e),Ps(n),Ps(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ms.debug&&(Ps(e.x),Ps(e.y),Ps(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ps(e)}angle(e){return W8(this,e)}cross(e){return N8(this,this,e),this.check()}rotateX({radians:e,origin:n=Vv}){return j8(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Vv}){return G8(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Vv}){return $8(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return wk(this,this,e),this.check()}transformAsVector(e){return bk(this,this,e),this.check()}transformByMatrix3(e){return U8(this,this,e),this.check()}transformByMatrix2(e){return z8(this,this,e),this.check()}transformByQuaternion(e){return V8(this,this,e),this.check()}}class q8 extends vk{toString(){let e="[";if(Ms.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Ps(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function Z8(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function X8(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],h=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=h,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function x1(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],h=e[4],l=e[5],m=e[6],v=e[7],E=e[8],T=e[9],S=e[10],z=e[11],D=e[12],F=e[13],J=e[14],U=e[15],V=n*l-r*h,G=n*m-i*h,ee=n*v-a*h,se=r*m-i*l,me=r*v-a*l,ve=i*v-a*m,Me=E*F-T*D,Be=E*J-S*D,ze=E*U-z*D,Oe=T*J-S*F,tt=T*U-z*F,et=S*U-z*J,st=V*et-G*tt+ee*Oe+se*ze-me*Be+ve*Me;return st?(st=1/st,t[0]=(l*et-m*tt+v*Oe)*st,t[1]=(i*tt-r*et-a*Oe)*st,t[2]=(F*ve-J*me+U*se)*st,t[3]=(S*me-T*ve-z*se)*st,t[4]=(m*ze-h*et-v*Be)*st,t[5]=(n*et-i*ze+a*Be)*st,t[6]=(J*ee-D*ve-U*G)*st,t[7]=(E*ve-S*ee+z*G)*st,t[8]=(h*tt-l*ze+v*Me)*st,t[9]=(r*ze-n*tt-a*Me)*st,t[10]=(D*me-F*ee+U*V)*st,t[11]=(T*ee-E*me-z*V)*st,t[12]=(l*Be-h*Oe-m*Me)*st,t[13]=(n*Oe-r*Be+i*Me)*st,t[14]=(F*G-D*se-J*V)*st,t[15]=(E*se-T*G+S*V)*st,t):null}function Y8(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],h=t[5],l=t[6],m=t[7],v=t[8],E=t[9],T=t[10],S=t[11],z=t[12],D=t[13],F=t[14],J=t[15],U=e*h-n*a,V=e*l-r*a,G=e*m-i*a,ee=n*l-r*h,se=n*m-i*h,me=r*m-i*l,ve=v*D-E*z,Me=v*F-T*z,Be=v*J-S*z,ze=E*F-T*D,Oe=E*J-S*D,tt=T*J-S*F;return U*tt-V*Oe+G*ze+ee*Be-se*Me+me*ve}function Pc(t,e,n){var r=e[0],i=e[1],a=e[2],h=e[3],l=e[4],m=e[5],v=e[6],E=e[7],T=e[8],S=e[9],z=e[10],D=e[11],F=e[12],J=e[13],U=e[14],V=e[15],G=n[0],ee=n[1],se=n[2],me=n[3];return t[0]=G*r+ee*l+se*T+me*F,t[1]=G*i+ee*m+se*S+me*J,t[2]=G*a+ee*v+se*z+me*U,t[3]=G*h+ee*E+se*D+me*V,G=n[4],ee=n[5],se=n[6],me=n[7],t[4]=G*r+ee*l+se*T+me*F,t[5]=G*i+ee*m+se*S+me*J,t[6]=G*a+ee*v+se*z+me*U,t[7]=G*h+ee*E+se*D+me*V,G=n[8],ee=n[9],se=n[10],me=n[11],t[8]=G*r+ee*l+se*T+me*F,t[9]=G*i+ee*m+se*S+me*J,t[10]=G*a+ee*v+se*z+me*U,t[11]=G*h+ee*E+se*D+me*V,G=n[12],ee=n[13],se=n[14],me=n[15],t[12]=G*r+ee*l+se*T+me*F,t[13]=G*i+ee*m+se*S+me*J,t[14]=G*a+ee*v+se*z+me*U,t[15]=G*h+ee*E+se*D+me*V,t}function by(t,e,n){var r=n[0],i=n[1],a=n[2],h,l,m,v,E,T,S,z,D,F,J,U;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(h=e[0],l=e[1],m=e[2],v=e[3],E=e[4],T=e[5],S=e[6],z=e[7],D=e[8],F=e[9],J=e[10],U=e[11],t[0]=h,t[1]=l,t[2]=m,t[3]=v,t[4]=E,t[5]=T,t[6]=S,t[7]=z,t[8]=D,t[9]=F,t[10]=J,t[11]=U,t[12]=h*r+E*i+D*a+e[12],t[13]=l*r+T*i+F*a+e[13],t[14]=m*r+S*i+J*a+e[14],t[15]=v*r+z*i+U*a+e[15]),t}function dw(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function K8(t,e,n,r){var i=r[0],a=r[1],h=r[2],l=Math.hypot(i,a,h),m,v,E,T,S,z,D,F,J,U,V,G,ee,se,me,ve,Me,Be,ze,Oe,tt,et,st,Bt;return l<Mg?null:(l=1/l,i*=l,a*=l,h*=l,m=Math.sin(n),v=Math.cos(n),E=1-v,T=e[0],S=e[1],z=e[2],D=e[3],F=e[4],J=e[5],U=e[6],V=e[7],G=e[8],ee=e[9],se=e[10],me=e[11],ve=i*i*E+v,Me=a*i*E+h*m,Be=h*i*E-a*m,ze=i*a*E-h*m,Oe=a*a*E+v,tt=h*a*E+i*m,et=i*h*E+a*m,st=a*h*E-i*m,Bt=h*h*E+v,t[0]=T*ve+F*Me+G*Be,t[1]=S*ve+J*Me+ee*Be,t[2]=z*ve+U*Me+se*Be,t[3]=D*ve+V*Me+me*Be,t[4]=T*ze+F*Oe+G*tt,t[5]=S*ze+J*Oe+ee*tt,t[6]=z*ze+U*Oe+se*tt,t[7]=D*ze+V*Oe+me*tt,t[8]=T*et+F*st+G*Bt,t[9]=S*et+J*st+ee*Bt,t[10]=z*et+U*st+se*Bt,t[11]=D*et+V*st+me*Bt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Ek(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],h=e[5],l=e[6],m=e[7],v=e[8],E=e[9],T=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+v*r,t[5]=h*i+E*r,t[6]=l*i+T*r,t[7]=m*i+S*r,t[8]=v*i-a*r,t[9]=E*i-h*r,t[10]=T*i-l*r,t[11]=S*i-m*r,t}function J8(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],h=e[1],l=e[2],m=e[3],v=e[8],E=e[9],T=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-v*r,t[1]=h*i-E*r,t[2]=l*i-T*r,t[3]=m*i-S*r,t[8]=a*r+v*i,t[9]=h*r+E*i,t[10]=l*r+T*i,t[11]=m*r+S*i,t}function Tk(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],h=e[1],l=e[2],m=e[3],v=e[4],E=e[5],T=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+v*r,t[1]=h*i+E*r,t[2]=l*i+T*r,t[3]=m*i+S*r,t[4]=v*i-a*r,t[5]=E*i-h*r,t[6]=T*i-l*r,t[7]=S*i-m*r,t}function Q8(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],h=n+n,l=r+r,m=i+i,v=n*h,E=r*h,T=r*l,S=i*h,z=i*l,D=i*m,F=a*h,J=a*l,U=a*m;return t[0]=1-T-D,t[1]=E+U,t[2]=S-J,t[3]=0,t[4]=E-U,t[5]=1-v-D,t[6]=z+F,t[7]=0,t[8]=S+J,t[9]=z-F,t[10]=1-v-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eU(t,e,n,r,i,a,h){var l=1/(n-e),m=1/(i-r),v=1/(a-h);return t[0]=a*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*m,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(i+r)*m,t[10]=(h+a)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*a*2*v,t[15]=0,t}function tU(t,e,n,r,i){var a=1/Math.tan(e/2),h;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(h=1/(r-i),t[10]=(i+r)*h,t[14]=2*i*r*h):(t[10]=-1,t[14]=-2*r),t}var nU=tU;function rU(t,e,n,r,i,a,h){var l=1/(e-n),m=1/(r-i),v=1/(a-h);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+n)*l,t[13]=(i+r)*m,t[14]=(h+a)*v,t[15]=1,t}var iU=rU;function sU(t,e,n,r){var i,a,h,l,m,v,E,T,S,z,D=e[0],F=e[1],J=e[2],U=r[0],V=r[1],G=r[2],ee=n[0],se=n[1],me=n[2];return Math.abs(D-ee)<Mg&&Math.abs(F-se)<Mg&&Math.abs(J-me)<Mg?Z8(t):(E=D-ee,T=F-se,S=J-me,z=1/Math.hypot(E,T,S),E*=z,T*=z,S*=z,i=V*S-G*T,a=G*E-U*S,h=U*T-V*E,z=Math.hypot(i,a,h),z?(z=1/z,i*=z,a*=z,h*=z):(i=0,a=0,h=0),l=T*h-S*a,m=S*i-E*h,v=E*a-T*i,z=Math.hypot(l,m,v),z?(z=1/z,l*=z,m*=z,v*=z):(l=0,m=0,v=0),t[0]=i,t[1]=l,t[2]=E,t[3]=0,t[4]=a,t[5]=m,t[6]=T,t[7]=0,t[8]=h,t[9]=v,t[10]=S,t[11]=0,t[12]=-(i*D+a*F+h*J),t[13]=-(l*D+m*F+v*J),t[14]=-(E*D+T*F+S*J),t[15]=1,t)}function oU(){var t=new xh(4);return xh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function aU(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function hp(t,e,n){var r=e[0],i=e[1],a=e[2],h=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*h,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*h,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*h,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*h,t}(function(){var t=oU();return function(e,n,r,i,a,h){var l,m;for(n||(n=4),r||(r=0),i?m=Math.min(i*n+r,e.length):m=e.length,l=r;l<m;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],a(t,t,h),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var b1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(b1||(b1={}));const lU=45*Math.PI/180,cU=1,jv=.1,Gv=500,uU=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Qo extends q8{static get IDENTITY(){return dU()}static get ZERO(){return hU()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return b1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,a,h,l,m,v,E,T,S,z,D,F,J){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=a,this[5]=h,this[6]=l,this[7]=m,this[8]=v,this[9]=E,this[10]=T,this[11]=S,this[12]=z,this[13]=D,this[14]=F,this[15]=J,this.check()}setRowMajor(e,n,r,i,a,h,l,m,v,E,T,S,z,D,F,J){return this[0]=e,this[1]=a,this[2]=v,this[3]=z,this[4]=n,this[5]=h,this[6]=E,this[7]=D,this[8]=r,this[9]=l,this[10]=T,this[11]=F,this[12]=i,this[13]=m,this[14]=S,this[15]=J,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(uU)}fromObject(e){return this.check()}fromQuaternion(e){return Q8(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:a,near:h=jv,far:l=Gv}=e;return l===1/0?fU(this,n,r,i,a,h):eU(this,n,r,i,a,h,l),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return sU(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:a,near:h=jv,far:l=Gv}=e;return iU(this,n,r,i,a,h,l),this.check()}orthographic(e){const{fovy:n=lU,aspect:r=cU,focalDistance:i=1,near:a=jv,far:h=Gv}=e;eP(n);const l=n/2,m=i*Math.tan(l),v=m*r;return this.ortho({left:-v,right:v,bottom:-m,top:m,near:a,far:h})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:a=500}=e;return eP(n),nU(this,n,r,i,a),this.check()}determinant(){return Y8(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],a=1/r[1],h=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*h,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*a,e[6]=this[6]*h,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*a,e[10]=this[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],a=1/r[1],h=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*h,e[3]=this[4]*i,e[4]=this[5]*a,e[5]=this[6]*h,e[6]=this[8]*i,e[7]=this[9]*a,e[8]=this[10]*h,e}transpose(){return X8(this,this),this.check()}invert(){return x1(this,this),this.check()}multiplyLeft(e){return Pc(this,e,this),this.check()}multiplyRight(e){return Pc(this,this,e),this.check()}rotateX(e){return Ek(this,this,e),this.check()}rotateY(e){return J8(this,this,e),this.check()}rotateZ(e){return Tk(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return K8(this,this,e,n),this.check()}scale(e){return dw(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return by(this,this,e),this.check()}transform(e,n){return e.length===4?(n=hp(n||[-0,-0,-0,-0],e,this),Uv(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=L8(n||[-0,-0],e,this);break;case 3:i=wk(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uv(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=R8(n||[-0,-0],e,this);break;case 3:r=bk(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uv(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Ym,Km;function hU(){return Ym||(Ym=new Qo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ym)),Ym}function dU(){return Km||(Km=new Qo,Object.freeze(Km)),Km}function eP(t){if(t>Math.PI*2)throw Error("expected radians")}function fU(t,e,n,r,i,a){const h=2*a/(n-e),l=2*a/(i-r),m=(n+e)/(n-e),v=(i+r)/(i-r),E=-1,T=-1,S=-2*a;return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=m,t[9]=v,t[10]=E,t[11]=T,t[12]=0,t[13]=0,t[14]=S,t[15]=0,t}const tP=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,pU={lightSources:{}};function $v(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function mU(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const i={};return e?i["lighting_uAmbientLight.color"]=$v(e):i["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((a,h)=>{i["lighting_uPointLight[".concat(h,"].color")]=$v(a),i["lighting_uPointLight[".concat(h,"].position")]=a.position,i["lighting_uPointLight[".concat(h,"].attenuation")]=a.attenuation||[1,0,0]}),i.lighting_uPointLightCount=n.length,r.forEach((a,h)=>{i["lighting_uDirectionalLight[".concat(h,"].color")]=$v(a),i["lighting_uDirectionalLight[".concat(h,"].direction")]=a.direction}),i.lighting_uDirectionalLightCount=r.length,i}function Sk(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pU;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{};return e||n&&n.length>0||r&&r.length>0?Object.assign({},mU({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return Sk({lightSources:e})}return{}}const gU={name:"lights",vs:tP,fs:tP,getUniforms:Sk,defines:{MAX_LIGHTS:3}},yU=new Uint8Array([0,255,255,255]),_U={pickingSelectedColor:null,pickingHighlightColor:yU,pickingActive:!1,pickingAttribute:!1};function vU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_U;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const xU=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,bU=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,wU={name:"picking",vs:xU,fs:bU,getUniforms:vU},EU=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,TU={};function SU(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(a=>a/255)}}function PU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:TU;if(!("material"in t))return{};const{material:e}=t;return e?SU(e):{lighting_uEnabled:!1}}const AU={name:"gouraud-lighting",dependencies:[gU],vs:EU,defines:{LIGHTING_VERTEX:1},getUniforms:PU},CU=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,IU={name:"transform",vs:CU,fs:null};class dp{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new dp(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:i={},inject:a={},varyings:h=[],bufferMode:l=35981,transpileToGLSL100:m=!1}=e,v=this._getModuleList(e.modules),E=this._getHash(n),T=this._getHash(r),S=v.map(G=>this._getHash(G.name)).sort(),z=h.map(G=>this._getHash(G)),D=Object.keys(i).sort(),F=Object.keys(a).sort(),J=[],U=[];for(const G of D)J.push(this._getHash(G)),J.push(this._getHash(i[G]));for(const G of F)U.push(this._getHash(G)),U.push(this._getHash(a[G]));const V="".concat(E,"/").concat(T,"D").concat(J.join("/"),"M").concat(S.join("/"),"I").concat(U.join("/"),"V").concat(z.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(m?"T":"");if(!this._programCache[V]){const G=c8(this.gl,{vs:n,fs:r,modules:v,inject:a,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:m});this._programCache[V]=new ck(this.gl,{hash:V,vs:G.vs,fs:G.fs,varyings:h,bufferMode:l}),this._getUniforms[V]=G.getUniforms||(ee=>{}),this._useCounts[V]=0}return this._useCounts[V]++,this._programCache[V]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let a=0,h=this._defaultModules.length;a<h;++a){const l=this._defaultModules[a],m=l.name;n[i++]=l,r[m]=!0}for(let a=0,h=e.length;a<h;++a){const l=e[a],m=l.name;r[m]||(n[i++]=l,r[m]=!0)}return n.length=i,n}}const MU={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function kU(t,e,n){const r={};let i=e.indices;for(const a in e.attributes){const h=e.attributes[a],l=LU(a,n);if(a==="indices")i=h;else if(h.constant)r[l]=h.value;else{const m=h.value,v={...h};delete v.value,r[l]=[new $n(t,m),v],RU(a,v)}}if(i){const a=i.value||i;_t(a instanceof Uint16Array||a instanceof Uint32Array,'attribute array for "indices" must be of integer type');const h={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new $n(t,{data:a,target:34963}),h]}return r}function LU(t,e){const{attributeMap:n=MU}=e||{};return n&&n[t]||t}function RU(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}_t(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Pu=2,zU=1e4,DU="Model needs drawMode and vertexCount",nP=()=>{},OU={};class Dc{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Ll("model")}=n;_t(l0(e)),this.id=r,this.gl=e,this.id=n.id||Ll("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||dp.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:i,modules:a,defines:h,inject:l,varyings:m,bufferMode:v,transpileToGLSL100:E}=e;this.programProps={program:n,vs:r,fs:i,modules:a,defines:h,inject:l,varyings:m,bufferMode:v,transpileToGLSL100:E},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},_t(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),DU)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:i,modules:a,defines:h,inject:l,varyings:m,bufferMode:v,transpileToGLSL100:E}=e;this.programProps={program:n,vs:r,fs:i,modules:a,defines:h,inject:l,varyings:m,bufferMode:v,transpileToGLSL100:E},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return _t(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return _t(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=kU(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(yh(e))return this;const n={};for(const r in e){const i=e[r];n[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return aw(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:i={},attributes:a={},transformFeedback:h=this.transformFeedback,parameters:l={},vertexArray:m=this.vertexArray}=e;this.setAttributes(a),this.updateModuleSettings(n),this.setUniforms(i);let v;Lt.priority>=Pu&&(v=this._logDrawCallStart(Pu));const E=this.vertexArray.getDrawParams(),{isIndexed:T=E.isIndexed,indexType:S=E.indexType,indexOffset:z=E.indexOffset,vertexArrayInstanced:D=E.isInstanced}=this.props;D&&!this.isInstanced&&Lt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:F,instanceCount:J}=this,{onBeforeRender:U=nP,onAfterRender:V=nP}=this.props;U(),this.program.setUniforms(this.uniforms);const G=this.program.draw(Object.assign(OU,e,{logPriority:v,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:m,transformFeedback:h,isIndexed:T,indexType:S,isInstanced:F,instanceCount:J,offset:T?z:0}));return V(),Lt.priority>=Pu&&this._logDrawCallEnd(v,m,r),G}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:a}=e;r&&this._setFeedbackBuffers(r),n&&(a=Object.assign({},a,{35977:n})),i.forEach(h=>h.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:a}))}finally{i.forEach(h=>h.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Lt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:i,modules:a,inject:h,defines:l,varyings:m,bufferMode:v,transpileToGLSL100:E}=this.programProps;n=this.programManager.get({vs:r,fs:i,modules:a,inject:h,defines:l,varyings:m,bufferMode:v,transpileToGLSL100:E}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}_t(n instanceof ck,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new TN(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof $n&&n.delete()}}_setAnimationProps(e){this.animated&&_t(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(yh(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new uk(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:zU;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Lt.group(Pu,">>> DRAWING MODEL ".concat(this.id),{collapsed:Lt.level<=2})(),e}_logDrawCallEnd(e,n,r,i){if(e===void 0)return;const a=AN({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:h,unusedTable:l,unusedCount:m}=VS({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:v,count:E}=VS({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});E>0&&Lt.log("MISSING UNIFORMS",Object.keys(v))(),m>0&&Lt.log("UNUSED UNIFORMS",Object.keys(l))();const T=IN(this.vertexArray.configuration);Lt.table(e,a)(),Lt.table(e,h)(),Lt.table(e+1,T)(),i&&i.log({logLevel:Pu,message:"Rendered to ".concat(i.id)}),Lt.groupEnd(Pu)()}}class FU{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof $n?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&_t(dn(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const a=this.feedbackMap[i];i in n&&(r[a]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const a=r[i];if(typeof a=="string"){const h=n[a],{byteLength:l,usage:m,accessor:v}=h;r[i]=this._createNewBuffer(i,{byteLength:l,usage:m,accessor:v})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:i}=r;e.transformFeedback=new uk(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const a=this.feedbackMap[i];n[i]=e.feedbackBuffers[a],r[a]=e.sourceBuffers[i],_t(r[a]instanceof $n)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new $n(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const BU="transform_uSampler_",wy="transform_uSize_",rP="transform_position";function NU(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:i}=t,h=Object.keys(n).length,l=null;const m={};let v=e,E={};if(h>0||r){const T=v.split(`
`),S=T.slice();if(T.forEach((z,D,F)=>{if(h>0){const J=$U(z,n);if(J){const{updatedLine:U,inject:V}=J;S[D]=U,E=y1([E,V]),Object.assign(m,J.samplerTextureMap),h--}}r&&!l&&(l=GU(z,r))}),r){_t(i);const z="".concat(wy).concat(r),D="uniform vec2 ".concat(z,`;
`),F="     vec2 ".concat(rP," = transform_getPos(").concat(z,`);
     gl_Position = vec4(`).concat(rP,`, 0, 1.);
`);E=y1([E,{"vs:#decl":D,"vs:#main-start":F}])}v=S.join(`
`)}return{vs:v,targetTextureType:l,inject:E,samplerTextureMap:m}}function UU(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const i={};let a,h;n&&({width:a,height:h}=r,i["".concat(wy).concat(n)]=[a,h]);for(const l in e)({width:a,height:h}=e[l]),i["".concat(wy).concat(l)]=[a,h];return i}function VU(t){return yk(t,["attribute","in"])}function jU(t){const e="".concat(BU).concat(t),n="".concat(wy).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function GU(t,e){const n=yk(t,["varying","out"]);return n&&n.name===e?n.type:null}function $U(t,e){const n={},r=VU(t);if(!r)return null;const{type:i,name:a}=r;if(a&&e[a]){const h="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:m,uniformDeclerations:v}=jU(a),E=_8(i),T="  ".concat(i," ").concat(a," = transform_getInput(").concat(l,", ").concat(m,").").concat(E,`;
`);return n[l]=a,{updatedLine:h,inject:{"vs:#decl":v,"vs:#main-start":T},samplerTextureMap:n}}return null}const WU={10241:9728,10240:9728,10242:33071,10243:33071},HU="transform_output";class qU{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:i,targetTexture:a}=this.bindings[this.currentIndex],h=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),m=Object.assign({},e.parameters);let v=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){h.transform_elementID=this.elementIDBuffer;for(const T in this.samplerTextureMap){const S=this.samplerTextureMap[T];l[T]=r[S]}this._setSourceTextureParameters();const E=UU({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:a});Object.assign(l,E)}return this.hasTargetTexture&&(v=!1,m.viewport=[0,0,i.width,i.height]),{attributes:h,framebuffer:i,uniforms:l,discard:v,parameters:m}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=u0(n);if(!e)return r;const i=r.constructor,a=v8(this.targetTextureType),h=new i(r.length*a/4);let l=0;for(let m=0;m<r.length;m+=4)for(let v=0;v<a;v++)h[l++]=r[m+v];return h}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof Ds)return r;const i=n[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:i}=e,a=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:a}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,i,a)=>{a[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new $n(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:i,targetTexture:a}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),a){e.targetTexture=a;const{width:h,height:l}=a,{framebuffer:m}=e;m?(m.update({attachments:{36064:a},resizeAttachments:!1}),m.resize({width:h,height:l})):e.framebuffer=new ti(this.gl,{id:"transform-framebuffer",width:h,height:l,attachments:{36064:a}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(WU)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=fB(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:a,targetTextureType:h,inject:l,samplerTextureMap:m}=NU({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),v=y1([e.inject||{},l]);this.targetTextureType=h,this.samplerTextureMap=m;const E=e._fs||_k({version:ak(i),input:this.targetTextureVarying,inputType:h,output:HU}),T=this.hasSourceTextures||this.targetTextureVarying?[IU].concat(e.modules||[]):e.modules;return{vs:i,fs:E,modules:T,uniforms:a,inject:v}}}let fw=class{static isSupported(e){return dn(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();_t(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Dc(n,Object.assign({},e,{fs:e.fs||_k({version:ak(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=i.updateModelProps(n);return n}_buildResourceTransforms(e,n){ZU(n)&&(this.bufferTransform=new FU(e,n)),XU(n)&&(this.textureTransform=new qU(e,n)),_t(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=Object.assign(n,i.getDrawOptions(n));return n}};function ZU(t){return!!(!yh(t.feedbackBuffers)||!yh(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function XU(t){return!!(!yh(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const iP={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class fp{static get DRAW_MODE(){return iP}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ll("geometry"),drawMode:r=iP.TRIANGLES,attributes:i={},indices:a=null,vertexCount:h=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,a),this.vertexCount=h||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,_t(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(_t(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i in e){const a=e[i],{value:h,size:l,constant:m}=a;!m&&h&&l>=1&&(r=Math.min(r,h.length/l))}return _t(Number.isFinite(r)),r}}let YU=1,KU=1;class Pk{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:a=1}=e,h=YU++,l={time:0,delay:n,duration:r,rate:i,repeat:a};return this._setChannelTime(l,this.time),this.channels.set(h,l),h}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:a,channel:h}=i;a.setTime(this.getTime(h))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=KU++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const JU=[255,255,255],QU=1;let eV=0;class Ak{constructor(e={}){$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","ambient");const{color:n=JU}=e,{intensity:r=QU}=e;this.id=e.id||"ambient-".concat(eV++),this.color=n,this.intensity=r}}const tV=[255,255,255],nV=1,rV=[0,0,-1];let iV=0;class w1{constructor(e={}){$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","directional"),$(this,"direction",void 0),$(this,"shadow",void 0);const{color:n=tV}=e,{intensity:r=nV}=e,{direction:i=rV}=e,{_shadow:a=!1}=e;this.id=e.id||"directional-".concat(iV++),this.color=n,this.intensity=r,this.type="directional",this.direction=new Jo(i).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class sV{constructor(e,n={id:"pass"}){$(this,"id",void 0),$(this,"gl",void 0),$(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class pw extends sV{constructor(...e){super(...e),$(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Ia(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:i,views:a,onViewportActive:h,clearStack:l=!0,clearCanvas:m=!0}=e;e.pass=e.pass||"unknown";const v=this.gl;m&&aV(v,n),l&&(this._lastRenderIndex=-1);const E=[];for(const T of i){const S=a&&a[T.id];h==null||h(T);const z=this._getDrawLayerParams(T,e),D=T.subViewports||[T];for(const F of D){const J=this._drawLayersInViewport(v,{target:n,moduleParameters:r,viewport:F,view:S,pass:e.pass,layers:e.layers},z);E.push(J)}}return E}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:a,cullRect:h,effects:l,moduleParameters:m},v=!1){const E=[],T=Ck(this._lastRenderIndex+1),S={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:h},z={};for(let D=0;D<n.length;D++){const F=n[D],J=this._shouldDrawLayer(F,S,a,z),U={shouldDrawLayer:J};J&&!v&&(U.layerRenderIndex=T(F,J),U.moduleParameters=this._getModuleParameters(F,l,r,m),U.layerParameters=this.getLayerParameters(F,D,e)),E[D]=U}return E}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:a,viewport:h,view:l},m){const v=oV(e,{moduleParameters:r,target:a,viewport:h});if(l&&l.props.clear){const T=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;wo(e,{scissorTest:!0,scissor:v},()=>aw(e,T))}const E={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Ia(e,{viewport:v});for(let T=0;T<n.length;T++){const S=n[T],{shouldDrawLayer:z,layerRenderIndex:D,moduleParameters:F,layerParameters:J}=m[T];if(z&&S.props.pickable&&E.pickableCount++,S.isComposite)E.compositeCount++;else if(z){E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,D),F.viewport=h;try{S._drawLayer({moduleParameters:F,uniforms:{layerIndex:D},parameters:J})}catch(U){S.raiseError(U,"drawing ".concat(S," to ").concat(i))}}}return E}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let h=e.parent;for(;h;){if(!h.props.visible||!h.filterSubLayer(n))return!1;n.layer=h,h=h.parent}if(r){const l=n.layer.id;if(l in i||(i[l]=r(n)),!i[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a;const h=Object.assign(Object.create(((a=e.internalState)===null||a===void 0?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:gh(this.gl)});if(n)for(const m of n){var l;Object.assign(h,(l=m.getModuleParameters)===null||l===void 0?void 0:l.call(m,e))}return Object.assign(h,this.getModuleParameters(e,n),i)}}function Ck(t=0,e={}){const n={},r=(i,a)=>{const h=i.props._offset,l=i.id,m=i.parent&&i.parent.id;let v;if(m&&!(m in e)&&r(i.parent,!1),m in n){const E=n[m]=n[m]||Ck(e[m],e);v=E(i,a),n[l]=E}else Number.isFinite(h)?(v=h+(e[m]||0),n[l]=null):v=t;return a&&v>=t&&(t=v+1),e[l]=v,v};return r}function oV(t,{moduleParameters:e,target:n,viewport:r}){const i=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||gh(t),h=i?n.height:t.drawingBufferHeight,l=r;return[l.x*a,h-(l.y+l.height)*a,l.width*a,l.height*a]}function aV(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;Ia(t,{viewport:[0,0,n,r]}),t.clear(16640)}class lV extends pw{constructor(e,n){super(e,n),$(this,"shadowMap",void 0),$(this,"depthBuffer",void 0),$(this,"fbo",void 0),this.shadowMap=new Ds(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new qu(e,{format:33189,width:1,height:1}),this.fbo=new ti(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;wo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=gh(this.gl),a=r.width*i,h=r.height*i;(a!==n.width||h!==n.height)&&n.resize({width:a,height:h}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const Ik="#define SMOOTH_EDGE_RADIUS 0.5",cV=`
`.concat(Ik,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),uV=`
`.concat(Ik,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),hV={name:"geometry",vs:cV,fs:uV},dV=Object.keys(Pn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Pn[t],";")).join(""),fV=Object.keys(Ho).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Ho[t],";")).join(""),pV=Object.keys(Rc).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Rc[t],";")).join(""),mV="".concat(dV,`
`).concat(fV,`
`).concat(pV,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function gV(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function pp(t){let e={},n;return r=>{for(const i in r)if(!gV(r[i],e[i])){n=t(r),e=r;break}return n}}const sP=[0,0,0,0],yV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Mk=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_V=[0,0,0],kk=[0,0,0],vV=pp(wV);function Lk(t,e,n=kk){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,a=!0;switch(e===Pn.LNGLAT_OFFSETS||e===Pn.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Ho.WEB_MERCATOR:(e===Pn.LNGLAT||e===Pn.CARTESIAN)&&(i=[0,0,0],a=!1);break;case Ho.WEB_MERCATOR_AUTO_OFFSET:e===Pn.LNGLAT?r=i:e===Pn.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Ho.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Ho.GLOBE:a=!1,i=null;break;default:a=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:a}}function xV(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:a,viewProjectionMatrix:h}=t,l=sP,m=sP,v=t.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:T,offsetMode:S}=Lk(t,e,n);return S&&(m=t.projectPosition(E||T),v=[v[0]-m[0],v[1]-m[1],v[2]-m[2]],m[3]=1,l=hp([],m,h),a=r||a,h=Pc([],i,a),h=Pc([],h,yV)),{viewMatrix:a,viewProjectionMatrix:h,projectionCenter:l,originCommon:m,cameraPosCommon:v,shaderCoordinateOrigin:T,geospatialOrigin:E}}function bV({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Pn.DEFAULT,coordinateOrigin:i=kk,autoWrapLongitude:a=!1}){r===Pn.DEFAULT&&(r=t.isGeospatial?Pn.LNGLAT:Pn.CARTESIAN);const h=vV({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return h.project_uWrapLongitude=a,h.project_uModelMatrix=n||Mk,h}function wV({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:a,originCommon:h,cameraPosCommon:l,shaderCoordinateOrigin:m,geospatialOrigin:v}=xV(t,n,r),E=t.getDistanceScales(),T=[t.width*e,t.height*e],S=hp([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,z={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:m,project_uCommonOrigin:h.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:T,project_uDevicePixelRatio:e,project_uFocalDistance:S,project_uCommonUnitsPerMeter:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:_V,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:Mk,project_uCameraPosition:l};if(v){const D=t.getDistanceScales(v);switch(n){case Pn.METER_OFFSETS:z.project_uCommonUnitsPerWorldUnit=D.unitsPerMeter,z.project_uCommonUnitsPerWorldUnit2=D.unitsPerMeter2;break;case Pn.LNGLAT:case Pn.LNGLAT_OFFSETS:t._pseudoMeters||(z.project_uCommonUnitsPerMeter=D.unitsPerMeter),z.project_uCommonUnitsPerWorldUnit=D.unitsPerDegree,z.project_uCommonUnitsPerWorldUnit2=D.unitsPerDegree2;break;case Pn.CARTESIAN:z.project_uCommonUnitsPerWorldUnit=[1,1,D.unitsPerMeter[2]],z.project_uCommonUnitsPerWorldUnit2=[0,0,D.unitsPerMeter2[2]];break}}return z}const EV={};function TV(t=EV){return"viewport"in t?bV(t):{}}const mw={name:"project",dependencies:[w8,hV],vs:mV,getUniforms:TV};function SV(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function nh(t,e){const n=hp([],e,t);return aU(n,n,1/n[3]),n}function oP(t,e){const n=t%e;return n<0?e+n:n}function E1(t,e,n){return t<e?e:t>n?n:t}function PV(t){return Math.log(t)*Math.LOG2E}const gw=Math.log2||PV;function Ma(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const yo=Math.PI,Rk=yo/4,eo=yo/180,T1=180/yo,bh=512,Ey=4003e4,Jm=85.051129,AV=1.5;function CV(t){return gw(t)}function Ty(t){const[e,n]=t;Ma(Number.isFinite(e)),Ma(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*eo,i=n*eo,a=bh*(r+yo)/(2*yo),h=bh*(yo+Math.log(Math.tan(Rk+i*.5)))/(2*yo);return[a,h]}function wh(t){const[e,n]=t,r=e/bh*(2*yo)-yo,i=2*(Math.atan(Math.exp(n/bh*(2*yo)-yo))-Rk);return[r*T1,i*T1]}function IV(t){const{latitude:e}=t;Ma(Number.isFinite(e));const n=Math.cos(e*eo);return CV(Ey*n)-9}function Wv(t){const e=Math.cos(t*eo);return bh/Ey/e}function S1(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;Ma(Number.isFinite(e)&&Number.isFinite(n));const i=bh,a=Math.cos(e*eo),h=i/360,l=h/a,m=i/Ey/a,v={unitsPerMeter:[m,m,m],metersPerUnit:[1/m,1/m,1/m],unitsPerDegree:[h,l,m],degreesPerUnit:[1/h,1/l,1/m]};if(r){const E=eo*Math.tan(e*eo)/a,T=h*E/2,S=i/Ey*E,z=S/l*m;v.unitsPerDegree2=[0,T,S],v.unitsPerMeter2=[z,0,z]}return v}function zk(t,e){const[n,r,i]=t,[a,h,l]=e,{unitsPerMeter:m,unitsPerMeter2:v}=S1({longitude:n,latitude:r,highPrecision:!0}),E=Ty(t);E[0]+=a*(m[0]+v[0]*h),E[1]+=h*(m[1]+v[1]*h);const T=wh(E),S=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[T[0],T[1],S]:T}function MV(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:a,center:h}=t,l=SV();by(l,l,[0,0,-i]),Ek(l,l,-n*eo),Tk(l,l,r*eo);const m=a/e;return dw(l,l,[m,m,m]),h&&by(l,l,F8([],h)),l}function kV(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:a,center:h,scale:l,nearZMultiplier:m=1,farZMultiplier:v=1}=t;let{fovy:E=Sy(AV)}=t;r!==void 0&&(E=Sy(r));const T=E*eo,S=i*eo,z=Dk(E);let D=z;h&&(D+=h[2]*l/Math.cos(S)/n);const F=T*(.5+(a?a[1]:0)/n),J=Math.sin(F)*D/Math.sin(E1(Math.PI/2-S-F,.01,Math.PI-.01)),U=Math.sin(S)*J+D,V=D*10,G=Math.min(U*v,V);return{fov:T,aspect:e/n,focalDistance:z,near:m,far:G}}function Sy(t){return 2*Math.atan(.5/t)*T1}function Dk(t){return .5/Math.tan(.5*t*eo)}function Ok(t,e){const[n,r,i=0]=t;return Ma(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),nh(e,[n,r,i,1])}function yw(t,e,n=0){const[r,i,a]=t;if(Ma(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(a))return nh(e,[r,i,a,1]);const h=nh(e,[r,i,0,1]),l=nh(e,[r,i,1,1]),m=h[2],v=l[2],E=m===v?0:((n||0)-m)/(v-m);return xk([],h,l,E)}function LV(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:a=24,offset:h=[0,0]}=t,[[l,m],[v,E]]=r,T=RV(t.padding),S=Ty([l,E1(E,-Jm,Jm)]),z=Ty([v,E1(m,-Jm,Jm)]),D=[Math.max(Math.abs(z[0]-S[0]),i),Math.max(Math.abs(z[1]-S[1]),i)],F=[e-T.left-T.right-Math.abs(h[0])*2,n-T.top-T.bottom-Math.abs(h[1])*2];Ma(F[0]>0&&F[1]>0);const J=F[0]/D[0],U=F[1]/D[1],V=(T.right-T.left)/2/J,G=(T.top-T.bottom)/2/U,ee=[(z[0]+S[0])/2+V,(z[1]+S[1])/2+G],se=wh(ee),me=Math.min(a,gw(Math.abs(Math.min(J,U))));return Ma(Number.isFinite(me)),{longitude:se[0],latitude:se[1],zoom:me}}function RV(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ma(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const aP=Math.PI/180;function zV(t,e=0){const{width:n,height:r,unproject:i}=t,a={targetZ:e},h=i([0,r],a),l=i([n,r],a);let m,v;const E=t.fovy?.5*t.fovy*aP:Math.atan(.5/t.altitude),T=(90-t.pitch)*aP;return E>T-.01?(m=lP(t,0,e),v=lP(t,n,e)):(m=i([0,0],a),v=i([n,0],a)),[h,l,v,m]}function lP(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=nh(r,[e,0,1,1]),a=nh(r,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(a[2]-i[2]),m=xk([],i,a,l),v=wh(m);return v.push(n),v}const cP=512;function DV(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:a,zoom:h,bearing:l=0}=t;(i<-180||i>180)&&(i=oP(i+180,360)-180),(l<-180||l>180)&&(l=oP(l+180,360)-180);const m=gw(n/cP);if(h<=m)h=m,a=0;else{const v=n/2/Math.pow(2,h),E=wh([0,v])[1];if(a<E)a=E;else{const T=wh([0,cP-v])[1];a>T&&(a=T)}}return{width:e,height:n,longitude:i,latitude:a,zoom:h,pitch:r,bearing:l}}const OV=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,FV=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,BV=pp(GV),NV=pp($V),UV=[0,0,0,1],VV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function jV(t,e){const[n,r,i]=t,a=yw([n,r,i],e);return Number.isFinite(i)?a:[a[0],a[1],0]}function GV({viewport:t,center:e}){return new Qo(t.viewProjectionMatrix).invert().transform(e)}function $V({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,a=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(h=>jV(h,r));for(const h of e){const l=h.clone().translate(new Jo(t.center).negate()),m=a.map(E=>l.transform(E)),v=new Qo().ortho({left:Math.min(...m.map(E=>E[0])),right:Math.max(...m.map(E=>E[0])),bottom:Math.min(...m.map(E=>E[1])),top:Math.max(...m.map(E=>E[1])),near:Math.min(...m.map(E=>-E[2])),far:Math.max(...m.map(E=>-E[2]))});n.push(v.multiplyRight(h))}return n}function WV(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||UV,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=BV({viewport:t.viewport,center:e.project_uCenter}),a=[],h=NV({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const m=h[l],v=m.clone().translate(new Jo(t.viewport.center).negate());e.project_uCoordinateSystem===Pn.LNGLAT&&e.project_uProjectionMode===Ho.WEB_MERCATOR?(h[l]=v,a[l]=i):(h[l]=m.clone().multiplyRight(VV),a[l]=v.transform(i))}for(let l=0;l<h.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=h[l],r["shadow_uProjectCenters[".concat(l,"]")]=a[l],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return r}const Hv={name:"shadow",dependencies:[mw],vs:OV,fs:FV,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?WV(t,e):{}},HV={color:[255,255,255],intensity:1},uP=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],qV=[0,0,0,200/255];class _w{constructor(e={}){$(this,"id","lighting-effect"),$(this,"props",void 0),$(this,"shadowColor",qV),$(this,"shadow",void 0),$(this,"ambientLight",void 0),$(this,"directionalLights",void 0),$(this,"pointLights",void 0),$(this,"shadowPasses",[]),$(this,"shadowMaps",[]),$(this,"dummyShadowMap",null),$(this,"programManager",void 0),$(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:i,onViewportActive:a,views:h}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=dp.getDefaultProgramManager(e),Hv&&this.programManager.addDefaultModule(Hv)),this.dummyShadowMap||(this.dummyShadowMap=new Ds(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:r,viewports:i,onViewportActive:a,views:h,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Hv),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Qo().lookAt({eye:new Jo(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new lV(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new Ak(HV),this.directionalLights.push(new w1(uP[0]),new w1(uP[1])))}}class ZV{constructor(e={}){$(this,"_pool",[]),$(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:a=0,copy:h=!1,initialize:l=!1,maxCount:m}){const v=i||e&&e.constructor||Float32Array,E=n*r+a;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new v(e.buffer,0,E)}let T=1/0;m&&(T=m*r+a);const S=this._allocate(v,E,l,T);return e&&h?S.set(e):l||S.fill(0,0,4),this._release(e),S}release(e){this._release(e)}_allocate(e,n,r,i){let a=Math.max(Math.ceil(n*this.opts.overAlloc),1);a>i&&(a=i);const h=this._pool,l=e.BYTES_PER_ELEMENT*a,m=h.findIndex(v=>v.byteLength>=l);if(m>=0){const v=new e(h.splice(m,1)[0],0,a);return r&&v.fill(0),v}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,a=n.findIndex(h=>h.byteLength>=i);a<0?n.push(r):(a>0||n.length<this.opts.poolSize)&&n.splice(a,0,r),n.length>this.opts.poolSize&&n.shift()}}const Eh=new ZV;function Qd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function XV(t){return[t[12],t[13],t[14]]}function YV(t){return{left:Au(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Au(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Au(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Au(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Au(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Au(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const hP=new Jo;function Au(t,e,n,r){hP.set(t,e,n);const i=hP.len();return{distance:r/i,normal:new Jo(-t/i,-e/i,-n/i)}}function KV(t){return t-Math.fround(t)}let Ud;function qv(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,a=(i-r)/n;Ud=Eh.allocate(Ud,a,{type:Float32Array,size:n*2});let h=r,l=0;for(;h<i;){for(let m=0;m<n;m++){const v=t[h++];Ud[l+m]=v,Ud[l+m+n]=KV(v)}l+=n*2}return Ud.subarray(0,a*n*2)}function JV(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const QV=Math.PI/180,ej=Qd(),dP=[0,0,0],tj={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function nj({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:a,near:h,far:l}){const m=t/e,v=n?new Qo().orthographic({fovy:r,aspect:m,focalDistance:i,near:h,far:l}):new Qo().perspective({fovy:r,aspect:m,near:h,far:l});if(a){const{left:E=0,right:T=0,top:S=0,bottom:z=0}=a,D=gl((E+t-T)/2,0,t)-t/2,F=gl((S+e-z)/2,0,e)-e/2;v[8]-=D*2/t,v[9]+=F*2/e}return v}class Rh{constructor(e={}){$(this,"id",void 0),$(this,"x",void 0),$(this,"y",void 0),$(this,"width",void 0),$(this,"height",void 0),$(this,"padding",void 0),$(this,"isGeospatial",void 0),$(this,"zoom",void 0),$(this,"focalDistance",void 0),$(this,"position",void 0),$(this,"modelMatrix",void 0),$(this,"distanceScales",void 0),$(this,"scale",void 0),$(this,"center",void 0),$(this,"cameraPosition",void 0),$(this,"projectionMatrix",void 0),$(this,"viewMatrix",void 0),$(this,"viewMatrixUncentered",void 0),$(this,"viewMatrixInverse",void 0),$(this,"viewProjectionMatrix",void 0),$(this,"pixelProjectionMatrix",void 0),$(this,"pixelUnprojectionMatrix",void 0),$(this,"resolution",void 0),$(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||tj,this.focalDistance=e.focalDistance||1,this.position=e.position||dP,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ho.WEB_MERCATOR:Ho.WEB_MERCATOR_AUTO_OFFSET:Ho.IDENTITY}equals(e){return e instanceof Rh?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Vf(e.projectionMatrix,this.projectionMatrix)&&Vf(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=Ok(r,this.pixelProjectionMatrix),[a,h]=i,l=n?h:this.height-h;return e.length===2?[a,l]:[a,l,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,a,h]=e,l=n?a:this.height-a,m=r&&r*this.distanceScales.unitsPerMeter[2],v=yw([i,l,h],this.pixelUnprojectionMatrix,m),[E,T,S]=this.unprojectPosition(v);return Number.isFinite(h)?[E,T,S]:Number.isFinite(r)?[E,T,r]:[E,T]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Ty(e);return n[1]=gl(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?wh(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),a=this.unproject([0,this.height],n),h=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],a[0],h[0]),Math.min(r[1],i[1],a[1],h[1]),Math.max(r[0],i[0],a[0],h[0]),Math.max(r[1],i[1],a[1],h[1])]}getDistanceScales(e){return e?S1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,YV(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=IV({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||S1({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:a,modelMatrix:h}=e;let l=dP;if(a&&(l=h?new Qo(h).transformAsVector(a,[]):a),this.isGeospatial){const m=this.projectPosition([n,r,0]);this.center=new Jo(l).scale(this.distanceScales.unitsPerMeter).add(m)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=ej,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:a,fovy:h=75,near:l=.1,far:m=1e3,padding:v=null,focalDistance:E=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Qo().multiplyRight(n).translate(new Jo(this.center).negate()),this.projectionMatrix=r||nj({width:this.width,height:this.height,orthographic:i,fovyRadians:a||h*QV,focalDistance:E,padding:v,near:l,far:m});const T=Qd();Pc(T,T,this.projectionMatrix),Pc(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=x1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=XV(this.viewMatrixInverse);const S=Qd(),z=Qd();dw(S,S,[this.width/2,-this.height/2,1]),by(S,S,[1,-1,0]),Pc(z,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=x1(Qd(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||an.warn("Pixel project matrix not invertible")()}}$(Rh,"displayName","Viewport");class Th extends Rh{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:a=0,bearing:h=0,nearZMultiplier:l=.1,farZMultiplier:m=1.01,orthographic:v=!1,projectionMatrix:E,repeat:T=!1,worldOffset:S=0,position:z,padding:D,legacyMeterSizes:F=!1}=e;let{width:J,height:U,altitude:V=1.5}=e;const G=Math.pow(2,i);J=J||1,U=U||1;let ee,se=null;if(E)V=E[5]/2,ee=Sy(V);else{e.fovy?(ee=e.fovy,V=Dk(ee)):ee=Sy(V);let ve;if(D){const{top:Me=0,bottom:Be=0}=D;ve=[0,gl((Me+U-Be)/2,0,U)-U/2]}se=kV({width:J,height:U,scale:G,center:z&&[0,0,z[2]*Wv(n)],offset:ve,pitch:a,fovy:ee,nearZMultiplier:l,farZMultiplier:m})}let me=MV({height:U,pitch:a,bearing:h,scale:G,altitude:V});S&&(me=new Qo().translate([512*S,0,0]).multiplyLeft(me)),super({...e,width:J,height:U,viewMatrix:me,longitude:r,latitude:n,zoom:i,...se,fovy:ee,focalDistance:V}),$(this,"longitude",void 0),$(this,"latitude",void 0),$(this,"pitch",void 0),$(this,"bearing",void 0),$(this,"altitude",void 0),$(this,"fovy",void 0),$(this,"orthographic",void 0),$(this,"_subViewports",void 0),$(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=a,this.bearing=h,this.altitude=V,this.fovy=ee,this.orthographic=v,this._subViewports=T?[]:null,this._pseudoMeters=F,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const a=i?new Th({...this,worldOffset:i}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Wv(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Wv(r);return[n,r,i]}addMetersToLngLat(e,n){return zk(e,n)}panByPosition(e,n){const r=yw(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),a=QS([],i,k8([],r)),h=QS([],this.center,a),[l,m]=this.unprojectFlat(h);return{longitude:l,latitude:m}}getBounds(e={}){const n=zV(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:a,latitude:h,zoom:l}=LV({width:r,height:i,bounds:e,...n});return new Th({width:r,height:i,longitude:a,latitude:h,zoom:l})}}$(Th,"displayName","WebMercatorViewport");const fP=[0,0,0];function Zv(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Th){const[i,a,h=0]=t,l=e.getDistanceScales([i,a]);r[2]=h*l.unitsPerMeter[2]}return r}function rj(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:a,fromCoordinateOrigin:h}=t;return i===Pn.DEFAULT&&(i=e.isGeospatial?Pn.LNGLAT:Pn.CARTESIAN),a===void 0&&(a=i),h===void 0&&(h=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:a,fromCoordinateOrigin:h}}function Fk(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:a}){let[h,l,m=0]=t;switch(n&&([h,l,m]=hp([],[h,l,m,1],n)),r){case Pn.LNGLAT:return Zv([h,l,m],e,a);case Pn.LNGLAT_OFFSETS:return Zv([h+i[0],l+i[1],m+(i[2]||0)],e,a);case Pn.METER_OFFSETS:return Zv(zk(i,[h,l,m]),e,a);case Pn.CARTESIAN:default:return e.isGeospatial?[h+i[0],l+i[1],m+i[2]]:e.projectPosition([h,l,m])}}function ij(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:a,fromCoordinateSystem:h,fromCoordinateOrigin:l}=rj(e),{autoOffset:m=!0}=e,{geospatialOrigin:v=fP,shaderCoordinateOrigin:E=fP,offsetMode:T=!1}=m?Lk(n,r,i):{},S=Fk(t,{viewport:n,modelMatrix:a,coordinateSystem:h,coordinateOrigin:l,offsetMode:T});if(T){const z=n.projectPosition(v||E);H8(S,S,z)}return S}const Oc=Math.PI/180,sj=1e3*60*60*24,oj=2440588,aj=2451545,Py=Oc*23.4397,lj=357.5291,cj=.98560028,uj=280.147,hj=360.9856235;function dj(t,e,n){const r=Oc*-n,i=Oc*e,a=pj(t),h=wj(a),l=vj(a,r)-h.rightAscension;return{azimuth:yj(l,i,h.declination),altitude:_j(l,i,h.declination)}}function pP(t,e,n){const{azimuth:r,altitude:i}=dj(t,e,n);return[Math.sin(r)*Math.cos(i),Math.cos(r)*Math.cos(i),-Math.sin(i)]}function fj(t){return(typeof t=="number"?t:t.getTime())/sj-.5+oj}function pj(t){return fj(t)-aj}function mj(t,e){const n=t;return Math.atan2(Math.sin(n)*Math.cos(Py)-Math.tan(e)*Math.sin(Py),Math.cos(n))}function gj(t,e){const n=t;return Math.asin(Math.sin(e)*Math.cos(Py)+Math.cos(e)*Math.sin(Py)*Math.sin(n))}function yj(t,e,n){const r=t,i=e,a=n;return Math.atan2(Math.sin(r),Math.cos(r)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function _j(t,e,n){const r=t,i=e,a=n;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(r))}function vj(t,e){return Oc*(uj+hj*t)-e}function xj(t){return Oc*(lj+cj*t)}function bj(t){const e=t,n=Oc*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e)),r=Oc*102.9372;return e+n+r+Math.PI}function wj(t){const e=xj(t),n=bj(e);return{declination:gj(n,0),rightAscension:mj(n,0)}}class Ej extends w1{constructor(e){super(e),$(this,"timestamp",void 0),this.timestamp=e.timestamp}getProjectedLight({layer:e}){const{viewport:n}=e.context;if(n.resolution&&n.resolution>0){const[i,a,h]=pP(this.timestamp,0,0);this.direction=[i,-h,a]}else{const{latitude:i,longitude:a}=n;this.direction=pP(this.timestamp,i,a)}return this}}const mP={blendFunc:[1,0,32771,0],blendEquation:32774};class Bk extends pw{constructor(...e){super(...e),$(this,"pickZ",void 0),$(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:a,pickingFBO:h,deviceRect:{x:l,y:m,width:v,height:E},cullRect:T,effects:S,pass:z="picking",pickZ:D,moduleParameters:F}){const J=this.gl;this.pickZ=D;const U=this._resetColorEncoder(D),V=wo(J,{scissorTest:!0,scissor:[l,m,v,E],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...mP,blend:!D},()=>super.render({target:h,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:a,cullRect:T,effects:S==null?void 0:S.filter(ee=>ee.useInPicking),pass:z,isPicking:!0,moduleParameters:F}));return this._colorEncoderState=null,{decodePickingColor:U&&Sj.bind(null,U),stats:V}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:a,operation:h}=e.props;return this._colorEncoderState?a&&h.includes("draw")&&(Object.assign(i,mP),i.blend=!0,i.blendColor=Tj(this._colorEncoderState,e,r)):i.blend=!1,h.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Tj(t,e,n){const{byLayer:r,byAlpha:i}=t;let a,h=r.get(e);return h?(h.viewports.push(n),a=h.a):(a=r.size+1,a<=255?(h={a,layer:e,viewports:[n]},r.set(e,h),i[a]=h):(an.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function Sj(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const zu={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ay=Symbol.for("component"),Il=Symbol.for("propTypes"),Xv=Symbol.for("deprecatedProps"),rh=Symbol.for("asyncPropDefaults"),Fc=Symbol.for("asyncPropOriginal"),yl=Symbol.for("asyncPropResolved");function vw(t,e=()=>!0){return Array.isArray(t)?Nk(t,e,[]):e(t)?[t]:[]}function Nk(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?Nk(i,e,n):e(i)&&n.push(i)}return n}function Pj({target:t,source:e,start:n=0,count:r=1}){const i=e.length,a=r*i;let h=0;for(let l=n;h<i;h++)t[l++]=e[h];for(;h<a;)h<a-h?(t.copyWithin(n+h,n,n+h),h*=2):(t.copyWithin(n+h,n,n+a-h),h=a);return t}class Aj{constructor(e,n,r){$(this,"id",void 0),$(this,"context",void 0),$(this,"isLoaded",void 0),$(this,"persistent",void 0),$(this,"_loadCount",0),$(this,"_subscribers",new Set),$(this,"_data",void 0),$(this,"_loader",void 0),$(this,"_error",void 0),$(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=my(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(a=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===r&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class Cj{constructor({gl:e,protocol:n}){$(this,"protocol",void 0),$(this,"_context",void 0),$(this,"_resources",void 0),$(this,"_consumers",void 0),$(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let a=this._resources[e];a?a.setData(n,r):(a=new Aj(e,n,this._context),this._resources[e]=a),a.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],a=this._resources[i.resourceId];a&&a.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:a,protocol:h}=this;e.startsWith(h)&&(e=e.replace(h,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=a[e];if(this._track(r,i,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const a=this._consumers,h=a[e]=a[e]||{},l=h[n]||{},m=l.resourceId&&this._resources[l.resourceId];m&&(m.unsubscribe(l),this.prune()),r&&(h[n]=l,l.onChange=i,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const Ij=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,mp={name:"project32",dependencies:[mw],vs:Ij},gp={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...wU},Mj=[mw],kj=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Lj(t){const e=dp.getDefaultProgramManager(t);for(const n of Mj)e.addDefaultModule(n);for(const n of kj)e.addShaderHook(n);return e}const Rj="layerManager.setLayers",zj="layerManager.activateViewport";class Dj{constructor(e,{deck:n,stats:r,viewport:i,timeline:a}={}){$(this,"layers",void 0),$(this,"context",void 0),$(this,"resourceManager",void 0),$(this,"_lastRenderedLayers",[]),$(this,"_needsRedraw",!1),$(this,"_needsUpdate",!1),$(this,"_nextLayers",null),$(this,"_debug",!1),$(this,"activateViewport",h=>{ki(zj,this,h),h&&(this.context.viewport=h)}),this.layers=[],this.resourceManager=new Cj({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&Lj(e),stats:r||new sw({id:"deck.gl"}),viewport:i||new Rh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new Pk,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){ki(Rj,this,n,e),this._lastRenderedLayers=e;const r=vw(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const h of e)r[h.id]?an.warn("Multiple old layers with same id ".concat(h.id))():r[h.id]=h;const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let a=!1;for(const h of i)if(h.hasUniformTransition()){a="Uniform transition in ".concat(h);break}this._needsUpdate=a,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const a=n[i.id];a===null&&an.warn("Multiple new layers with same id ".concat(i.id))(),n[i.id]=null;let h=null;try{this._debug&&a!==i&&i.validateProps(),a?(this._transferLayerState(a,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),h=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}h&&this._updateSublayersRecursively(h,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=zu.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=zu.MATCHED,n!==e&&(e.lifecycle=zu.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=zu.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=zu.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function qo(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!qo(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const a of r)if(!e.hasOwnProperty(a)||!qo(t[a],e[a],n-1))return!1;return!0}return!1}class Oj{constructor(e){$(this,"width",void 0),$(this,"height",void 0),$(this,"views",void 0),$(this,"viewState",void 0),$(this,"controllers",void 0),$(this,"timeline",void 0),$(this,"_viewports",void 0),$(this,"_viewportMap",void 0),$(this,"_isUpdating",void 0),$(this,"_needsRedraw",void 0),$(this,"_needsUpdate",void 0),$(this,"_eventManager",void 0),$(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let a=r.length-1;a>=0;--a){const h=r[a];if(h.containsPixel(i)){const l=e.slice();return l[0]-=h.x,l[1]-=h.y,h.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=vw(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!qo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):an.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var h;return(h=this.getView(e.id))===null||h===void 0?void 0:h.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const a=e.controller;if(a&&r){const h={...n,...a,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==a.type)&&(i=this._createController(e,h)),i&&i.setProps(h),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const a=e[i],h=this.getViewState(a),l=a.makeViewport({viewState:h,width:this.width,height:this.height});let m=n[a.id];const v=!!a.controller;v&&!m&&(r=!0),(r||!v)&&m&&(m.finalize(),m=null),this.controllers[a.id]=this._updateController(a,h,l,m),l&&this._viewports.unshift(l)}for(const i in n){const a=n[i];a&&!this.controllers[i]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const Fj=/([0-9]+\.?[0-9]*)(%|px)/;function ol(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=Fj.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function al(t,e){return t.relative?Math.round(t.position*e):t.position}function ai(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Sh{constructor(e){$(this,"id",void 0),$(this,"viewportInstance",void 0),$(this,"_x",void 0),$(this,"_y",void 0),$(this,"_width",void 0),$(this,"_height",void 0),$(this,"_padding",void 0),$(this,"props",void 0);const{id:n,x:r=0,y:i=0,width:a="100%",height:h="100%",padding:l=null,viewportInstance:m}=e||{};ai(!m||m instanceof Rh),this.viewportInstance=m,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ol(r),this._y=ol(i),this._width=ol(a),this._height=ol(h),this._padding=l&&{left:ol(l.left||0),right:ol(l.right||0),top:ol(l.top||0),bottom:ol(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&qo(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:al(this._x,e),y:al(this._y,n),width:al(this._width,e),height:al(this._height,n)};return this._padding&&(r.padding={left:al(this._padding.left,e),top:al(this._padding.top,n),right:al(this._padding.right,e),bottom:al(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class yp{constructor(e){$(this,"_inProgress",void 0),$(this,"_handle",void 0),$(this,"_timeline",void 0),$(this,"time",void 0),$(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const gP=()=>{},P1={BREAK:1,SNAP_TO_END:2,IGNORE:3},Bj=t=>t,Nj=P1.BREAK;class Uj{constructor(e){$(this,"getControllerState",void 0),$(this,"props",void 0),$(this,"propsInTransition",void 0),$(this,"transition",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:i,startProps:a,endProps:h,duration:l,easing:m}}=n,v=m(r/l),E=i.interpolateProps(a,h,v);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new yp(e.timeline),this.onViewStateChange=e.onViewStateChange||gP,this.onStateChange=e.onStateChange||gP}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:a,endProps:h}=this.transition.settings;i={...r,...a===P1.SNAP_TO_END?h:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===P1.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),a=n.transitionInterpolator,h=a.getDuration?a.getDuration(e,n):n.transitionDuration;if(h===0)return;const l=a.initializeProps(e,i);this.propsInTransition={};const m={duration:h,easing:n.transitionEasing||Bj,interpolator:a,interruption:n.transitionInterruption||Nj,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(m),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class Vj{constructor(e){$(this,"_propsToCompare",void 0),$(this,"_propsToExtract",void 0),$(this,"_requiredProps",void 0);const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Vf(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const a of this._propsToExtract)(a in e||a in n)&&(r[a]=e[a],i[a]=n[a]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];ai(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const jj=["longitude","latitude","zoom","bearing","pitch"],Gj=["longitude","latitude","zoom"];class Uk extends Vj{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:jj,required:Gj},super(r.transitionProps),$(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:a}=this.opts;if(i&&a){const h=i(e),l=i(n),m=h.unproject(a);r.start.around=a,Object.assign(r.end,{around:l.project(m),aroundPosition:m,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const a of this._propsToExtract)i[a]=xy(e[a]||0,n[a]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...n,...i});Object.assign(i,a.panByPosition(n.aroundPosition,xy(e.around,n.around,r)))}return i}}const ll={transitionDuration:0},$j=300,Qm=t=>1-(1-t)*(1-t),Cu={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},uc={};class Wj{constructor(e){$(this,"props",void 0),$(this,"state",{}),$(this,"transitionManager",void 0),$(this,"eventManager",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"makeViewport",void 0),$(this,"_controllerState",void 0),$(this,"_events",{}),$(this,"_interactionState",{isDragging:!1}),$(this,"_customEvents",[]),$(this,"_eventStartBlocked",null),$(this,"_panMove",!1),$(this,"invertPan",!1),$(this,"dragMode","rotate"),$(this,"inertia",0),$(this,"scrollZoom",!0),$(this,"dragPan",!0),$(this,"dragRotate",!0),$(this,"doubleClickZoom",!0),$(this,"touchZoom",!0),$(this,"touchRotate",!1),$(this,"keyboard",!0),this.transitionManager=new Uj({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const a=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return a&&n&&n.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?$j:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:a=!0,doubleClickZoom:h=!0,touchZoom:l=!0,touchRotate:m=!1,keyboard:v=!0}=e,E=!!this.onViewStateChange;this.toggleEvents(Cu.WHEEL,E&&r),this.toggleEvents(Cu.PAN,E),this.toggleEvents(Cu.PINCH,E&&(l||m)),this.toggleEvents(Cu.TRIPLE_PAN,E&&m),this.toggleEvents(Cu.DOUBLE_TAP,E&&h),this.toggleEvents(Cu.KEYBOARD,E&&v),this.scrollZoom=r,this.dragPan=i,this.dragRotate=a,this.doubleClickZoom=h,this.touchZoom=l,this.touchRotate=m,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),a){const h=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:h})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,ll,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,ll,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],a=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qm},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,ll,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],a=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qm},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let h=2/(1+Math.exp(-Math.abs(a*r)));a<0&&h!==0&&(h=1/h);const l=this.controllerState.zoom({pos:n,scale:h});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,ll,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,ll,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],a=this.controllerState.rotate({pos:i});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qm},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return uc._startPinchRotation=e.rotation,uc._lastPinchEvent=e,this.updateViewport(r,ll,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:uc._startPinchRotation-r})}return this.updateViewport(n,ll,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),uc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=uc;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let a=this.controllerState.rotateEnd();const h=Math.log2(e.scale),l=(h-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),m=Math.pow(2,h+l*n/2);a=a.zoom({pos:i,scale:m}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:Qm},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return uc._startPinchRotation=null,uc._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:a,rotateSpeedY:h}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let m;const v={};switch(e.srcEvent.code){case"Minus":m=n?l.zoomOut(r).zoomOut(r):l.zoomOut(r),v.isZooming=!0;break;case"Equal":m=n?l.zoomIn(r).zoomIn(r):l.zoomIn(r),v.isZooming=!0;break;case"ArrowLeft":n?(m=l.rotateLeft(a),v.isRotating=!0):(m=l.moveLeft(i),v.isPanning=!0);break;case"ArrowRight":n?(m=l.rotateRight(a),v.isRotating=!0):(m=l.moveRight(i),v.isPanning=!0);break;case"ArrowUp":n?(m=l.rotateUp(h),v.isRotating=!0):(m=l.moveUp(i),v.isPanning=!0);break;case"ArrowDown":n?(m=l.rotateDown(h),v.isRotating=!0):(m=l.moveDown(i),v.isPanning=!0);break;default:return!1}return this.updateViewport(m,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?ll:e?{...n,transitionInterpolator:new Uk({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class Hj{constructor(e,n){$(this,"_viewportProps",void 0),$(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const yP=5,qj=1.2;class Zj extends Hj{constructor(e){const{width:n,height:r,latitude:i,longitude:a,zoom:h,bearing:l=0,pitch:m=0,altitude:v=1.5,position:E=[0,0,0],maxZoom:T=20,minZoom:S=0,maxPitch:z=60,minPitch:D=0,startPanLngLat:F,startZoomLngLat:J,startRotatePos:U,startBearing:V,startPitch:G,startZoom:ee,normalize:se=!0}=e;ai(Number.isFinite(a)),ai(Number.isFinite(i)),ai(Number.isFinite(h)),super({width:n,height:r,latitude:i,longitude:a,zoom:h,bearing:l,pitch:m,altitude:v,maxZoom:T,minZoom:S,maxPitch:z,minPitch:D,normalize:se,position:E},{startPanLngLat:F,startZoomLngLat:J,startRotatePos:U,startBearing:V,startPitch:G,startZoom:ee}),$(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:a,startPitch:h}=this.getState();if(!i||a===void 0||h===void 0)return this;let l;return e?l=this._getNewRotation(e,i,h,a):l={bearing:a+n,pitch:h+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:a}=this.getState();if(a||(i=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:h,minZoom:l}=this.getViewportProps();let m=i+Math.log2(r);m=gl(m,l,h);const v=this.makeViewport({...this.getViewportProps(),zoom:m});return this._getUpdatedState({zoom:m,...v.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:a}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(a-n.longitude)>180&&(r.longitude=a<0?a+360:a-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=gl(i,r,n);const{maxPitch:a,minPitch:h,pitch:l}=e;e.pitch=gl(l,h,a);const{normalize:m=!0}=e;return m&&Object.assign(e,DV(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const a=e[0]-n[0],h=e[1]-n[1],l=e[1],m=n[1],{width:v,height:E}=this.getViewportProps(),T=a/v;let S=0;h>0?Math.abs(E-m)>yP&&(S=h/(m-E)*qj):h<0&&m>yP&&(S=1-l/m),S=gl(S,-1,1);const{minPitch:z,maxPitch:D}=this.getViewportProps(),F=i+180*T;let J=r;return S>0?J=r+S*(D-r):S<0&&(J=r-S*(z-r)),{pitch:J,bearing:F}}}class Xj extends Wj{constructor(...e){super(...e),$(this,"ControllerState",Zj),$(this,"transition",{transitionDuration:300,transitionInterpolator:new Uk({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),$(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Vk extends Sh{get ViewportType(){return Th}get ControllerType(){return Xj}}$(Vk,"displayName","MapView");const Yj=new _w;function Kj(t,e){var n,r;const i=(n=t.order)!==null&&n!==void 0?n:1/0,a=(r=e.order)!==null&&r!==void 0?r:1/0;return i-a}class Jj{constructor(){$(this,"effects",void 0),$(this,"_resolvedEffects",[]),$(this,"_defaultEffects",[]),$(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>Kj(i,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(qo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const a=n[i.id];a&&a!==i?a.setProps?(a.setProps(i.props),r.push(a)):(a.cleanup(),r.push(i)):r.push(i),delete n[i.id]}for(const i in n)n[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof _w)||this._resolvedEffects.push(Yj),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Qj extends pw{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const e9="deckRenderer.renderLayers";class t9{constructor(e){$(this,"gl",void 0),$(this,"layerFilter",void 0),$(this,"drawPickingColors",void 0),$(this,"drawLayersPass",void 0),$(this,"pickLayersPass",void 0),$(this,"renderCount",void 0),$(this,"_needsRedraw",void 0),$(this,"renderBuffers",void 0),$(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Qj(e),this.pickLayersPass=new Bk(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||ti.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,a=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,ki(e9,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(this.gl,n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new ti(this.gl),new ti(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const a of e)if(a.postRender){if(a.id===this.lastPostProcessEffect){i.target=n.target,a.postRender(this.gl,i);break}const h=a.postRender(this.gl,i);i.inputBuffer=h,i.swapBuffer=h===r[0]?r[1]:r[0]}}}const n9={pickedColor:null,pickedObjectIndex:-1};function r9({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:a}){const{x:h,y:l,width:m,height:v}=a;let E=i*i,T=-1,S=0;for(let z=0;z<v;z++){const D=z+l-r,F=D*D;if(F>E)S+=4*m;else for(let J=0;J<m;J++){if(t[S+3]-1>=0){const V=J+h-n,G=V*V+F;G<=E&&(E=G,T=S)}S+=4}}if(T>=0){const z=t.slice(T,T+4),D=e(z);if(D){const F=Math.floor(T/4/m),J=T/4-F*m;return{...D,pickedColor:z,pickedX:h+J,pickedY:l+F}}an.error("Picked non-existent layer. Is picking buffer corrupt?")()}return n9}function i9({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const a=t.slice(r,r+4),h=a.join(",");if(!n.has(h)){const l=e(a);l?n.set(h,{...l,color:a}):an.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function jk({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:a}){let h=e[0];e.length>1&&(h=o9((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let l;if(h){const m=[r-h.x,i-h.y];a!==void 0&&(m[2]=a),l=h.unproject(m)}return{color:null,layer:null,viewport:h,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function s9(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:a,pickedLayer:h,pickedObjectIndex:l}=e,m=h?[h]:[];if(r==="hover"){const T=n.index,S=n.layerId,z=h?h.props.id:null;if(z!==S||l!==T){if(z!==S){const D=i.find(F=>F.props.id===S);D&&m.unshift(D)}n.layerId=z,n.index=l,n.info=null}}const v=jk(t),E=new Map;return E.set(null,v),m.forEach(T=>{let S={...v};T===h&&(S.color=a,S.index=l,S.picked=!0),S=Gk({layer:T,info:S,mode:r});const z=S.layer;T===h&&r==="hover"&&(n.info=S),E.set(z.id,S),r==="hover"&&z.updateAutoHighlight(S)}),E}function Gk({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function o9(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class a9{constructor(e){$(this,"gl",void 0),$(this,"pickingFBO",void 0),$(this,"depthFBO",void 0),$(this,"pickLayersPass",void 0),$(this,"layerFilter",void 0),$(this,"lastPickedInfo",void 0),$(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new Bk(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},a=this.lastPickedInfo.info){const h=a&&a.layer&&a.layer.id,l=a&&a.viewport&&a.viewport.id,m=h?r.find(S=>S.id===h):null,v=l&&i.find(S=>S.id===l)||i[0],E=v&&v.unproject([e-v.x,n-v.y]);return{...a,...{x:e,y:n,viewport:v,coordinate:E,layer:m}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new ti(r),ti.isSupported(r,{colorBufferFloat:!0}))){const i=new ti(r);i.attach({36064:new Ds(r,{format:dn(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:a,radius:h=0,depth:l=1,mode:m="query",unproject3D:v,onViewportActive:E,effects:T}){const S=this._getPickable(e),z=gh(this.gl);if(!S)return{result:[],emptyInfo:jk({viewports:r,x:i,y:a,pixelRatio:z})};this._resizeBuffer();const D=kv(this.gl,[i,a],!0),F=[D.x+Math.floor(D.width/2),D.y+Math.floor(D.height/2)],J=Math.round(h*z),{width:U,height:V}=this.pickingFBO,G=this._getPickingRect({deviceX:F[0],deviceY:F[1],deviceRadius:J,deviceWidth:U,deviceHeight:V}),ee={x:i-h,y:a-h,width:h*2+1,height:h*2+1};let se;const me=[],ve=new Set;for(let Me=0;Me<l;Me++){let Be;if(G){const Oe=this._drawAndSample({layers:S,views:n,viewports:r,onViewportActive:E,deviceRect:G,cullRect:ee,effects:T,pass:"picking:".concat(m)});Be=r9({...Oe,deviceX:F[0],deviceY:F[1],deviceRadius:J,deviceRect:G})}else Be={pickedColor:null,pickedObjectIndex:-1};let ze;if(Be.pickedLayer&&v&&this.depthFBO){const{pickedColors:Oe}=this._drawAndSample({layers:[Be.pickedLayer],views:n,viewports:r,onViewportActive:E,deviceRect:{x:Be.pickedX,y:Be.pickedY,width:1,height:1},cullRect:ee,effects:T,pass:"picking:".concat(m,":z")},!0);Oe[3]&&(ze=Oe[0])}Be.pickedLayer&&Me+1<l&&(ve.add(Be.pickedLayer),Be.pickedLayer.disablePickingIndex(Be.pickedObjectIndex)),se=s9({pickInfo:Be,lastPickedInfo:this.lastPickedInfo,mode:m,layers:S,viewports:r,x:i,y:a,z:ze,pixelRatio:z});for(const Oe of se.values())Oe.layer&&me.push(Oe);if(!Be.pickedColor)break}for(const Me of ve)Me.restorePickingColors();return{result:me,emptyInfo:se.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:a,width:h=1,height:l=1,mode:m="query",maxObjects:v=null,onViewportActive:E,effects:T}){const S=this._getPickable(e);if(!S)return[];this._resizeBuffer();const z=gh(this.gl),D=kv(this.gl,[i,a],!0),F=D.x,J=D.y+D.height,U=kv(this.gl,[i+h,a+l],!0),V=U.x+U.width,G=U.y,ee={x:F,y:G,width:V-F,height:J-G},se=this._drawAndSample({layers:S,views:n,viewports:r,onViewportActive:E,deviceRect:ee,cullRect:{x:i,y:a,width:h,height:l},effects:T,pass:"picking:".concat(m)}),me=i9(se),ve=new Map,Me=Number.isFinite(v);for(let Be=0;Be<me.length&&!(Me&&v&&ve.size>=v);Be++){const ze=me[Be];let Oe={color:ze.pickedColor,layer:null,index:ze.pickedObjectIndex,picked:!0,x:i,y:a,pixelRatio:z};Oe=Gk({layer:ze.pickedLayer,info:Oe,mode:m}),ve.has(Oe.object)||ve.set(Oe.object,Oe)}return Array.from(ve.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:a,cullRect:h,effects:l,pass:m},v=!1){const E=v?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:E,deviceRect:a,cullRect:h,effects:l,pass:m,pickZ:v,preRenderStats:{}};for(const V of l)V.useInPicking&&(T.preRenderStats[V.id]=V.preRender(this.gl,T));const{decodePickingColor:S}=this.pickLayersPass.render(T),{x:z,y:D,width:F,height:J}=a,U=new(v?Float32Array:Uint8Array)(F*J*4);return u0(E,{sourceX:z,sourceY:D,sourceWidth:F,sourceHeight:J,target:U}),{pickedColors:U,decodePickingColor:S}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:a}){const h=Math.max(0,e-r),l=Math.max(0,n-r),m=Math.min(i,e+r+1)-h,v=Math.min(a,n+r+1)-l;return m<=0||v<=0?null:{x:h,y:l,width:m,height:v}}}const l9={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class c9{constructor(e){$(this,"el",null),$(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,l9),n.appendChild(this.el))}setTooltip(e,n,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(n,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var $k={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var a=["","webkit","Moz","MS","ms","o"],h=n.createElement("div"),l="function",m=Math.round,v=Math.abs,E=Date.now;function T(Z,ne,pe){return setTimeout(G(Z,pe),ne)}function S(Z,ne,pe){return Array.isArray(Z)?(z(Z,pe[ne],pe),!0):!1}function z(Z,ne,pe){var ke;if(Z)if(Z.forEach)Z.forEach(ne,pe);else if(Z.length!==i)for(ke=0;ke<Z.length;)ne.call(pe,Z[ke],ke,Z),ke++;else for(ke in Z)Z.hasOwnProperty(ke)&&ne.call(pe,Z[ke],ke,Z)}function D(Z,ne,pe){var ke="DEPRECATED METHOD: "+ne+`
`+pe+` AT 
`;return function(){var He=new Error("get-stack-trace"),mt=He&&He.stack?He.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",qt=e.console&&(e.console.warn||e.console.log);return qt&&qt.call(e.console,ke,mt),Z.apply(this,arguments)}}var F;typeof Object.assign!="function"?F=function(ne){if(ne===i||ne===null)throw new TypeError("Cannot convert undefined or null to object");for(var pe=Object(ne),ke=1;ke<arguments.length;ke++){var He=arguments[ke];if(He!==i&&He!==null)for(var mt in He)He.hasOwnProperty(mt)&&(pe[mt]=He[mt])}return pe}:F=Object.assign;var J=D(function(ne,pe,ke){for(var He=Object.keys(pe),mt=0;mt<He.length;)(!ke||ke&&ne[He[mt]]===i)&&(ne[He[mt]]=pe[He[mt]]),mt++;return ne},"extend","Use `assign`."),U=D(function(ne,pe){return J(ne,pe,!0)},"merge","Use `assign`.");function V(Z,ne,pe){var ke=ne.prototype,He;He=Z.prototype=Object.create(ke),He.constructor=Z,He._super=ke,pe&&F(He,pe)}function G(Z,ne){return function(){return Z.apply(ne,arguments)}}function ee(Z,ne){return typeof Z==l?Z.apply(ne&&ne[0]||i,ne):Z}function se(Z,ne){return Z===i?ne:Z}function me(Z,ne,pe){z(ze(ne),function(ke){Z.addEventListener(ke,pe,!1)})}function ve(Z,ne,pe){z(ze(ne),function(ke){Z.removeEventListener(ke,pe,!1)})}function Me(Z,ne){for(;Z;){if(Z==ne)return!0;Z=Z.parentNode}return!1}function Be(Z,ne){return Z.indexOf(ne)>-1}function ze(Z){return Z.trim().split(/\s+/g)}function Oe(Z,ne,pe){if(Z.indexOf&&!pe)return Z.indexOf(ne);for(var ke=0;ke<Z.length;){if(pe&&Z[ke][pe]==ne||!pe&&Z[ke]===ne)return ke;ke++}return-1}function tt(Z){return Array.prototype.slice.call(Z,0)}function et(Z,ne,pe){for(var ke=[],He=[],mt=0;mt<Z.length;){var qt=ne?Z[mt][ne]:Z[mt];Oe(He,qt)<0&&ke.push(Z[mt]),He[mt]=qt,mt++}return pe&&(ne?ke=ke.sort(function(Gt,_r){return Gt[ne]>_r[ne]}):ke=ke.sort()),ke}function st(Z,ne){for(var pe,ke,He=ne[0].toUpperCase()+ne.slice(1),mt=0;mt<a.length;){if(pe=a[mt],ke=pe?pe+He:ne,ke in Z)return ke;mt++}return i}var Bt=1;function Je(){return Bt++}function en(Z){var ne=Z.ownerDocument||Z;return ne.defaultView||ne.parentWindow||e}var We=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in e,Tt=st(e,"PointerEvent")!==i,tn=Qe&&We.test(navigator.userAgent),Xt="touch",An="pen",xn="mouse",zn="kinect",Dn=25,ln=1,Wn=2,zt=4,Tn=8,Lr=1,Hn=2,pn=4,un=8,Jt=16,Un=Hn|pn,Jn=un|Jt,Ur=Un|Jn,Vt=["x","y"],cn=["clientX","clientY"];function yn(Z,ne){var pe=this;this.manager=Z,this.callback=ne,this.element=Z.element,this.target=Z.options.inputTarget,this.domHandler=function(ke){ee(Z.options.enable,[Z])&&pe.handler(ke)},this.init()}yn.prototype={handler:function(){},init:function(){this.evEl&&me(this.element,this.evEl,this.domHandler),this.evTarget&&me(this.target,this.evTarget,this.domHandler),this.evWin&&me(en(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ve(this.element,this.evEl,this.domHandler),this.evTarget&&ve(this.target,this.evTarget,this.domHandler),this.evWin&&ve(en(this.element),this.evWin,this.domHandler)}};function ui(Z){var ne,pe=Z.options.inputClass;return pe?ne=pe:Tt?ne=Zr:tn?ne=bi:Qe?ne=te:ne=Ft,new ne(Z,Ki)}function Ki(Z,ne,pe){var ke=pe.pointers.length,He=pe.changedPointers.length,mt=ne&ln&&ke-He===0,qt=ne&(zt|Tn)&&ke-He===0;pe.isFirst=!!mt,pe.isFinal=!!qt,mt&&(Z.session={}),pe.eventType=ne,Rr(Z,pe),Z.emit("hammer.input",pe),Z.recognize(pe),Z.session.prevInput=pe}function Rr(Z,ne){var pe=Z.session,ke=ne.pointers,He=ke.length;pe.firstInput||(pe.firstInput=Rt(ne)),He>1&&!pe.firstMultiple?pe.firstMultiple=Rt(ne):He===1&&(pe.firstMultiple=!1);var mt=pe.firstInput,qt=pe.firstMultiple,tr=qt?qt.center:mt.center,Gt=ne.center=Ee(ke);ne.timeStamp=E(),ne.deltaTime=ne.timeStamp-mt.timeStamp,ne.angle=xt(tr,Gt),ne.distance=Ut(tr,Gt),Ye(pe,ne),ne.offsetDirection=On(ne.deltaX,ne.deltaY);var _r=Re(ne.deltaTime,ne.deltaX,ne.deltaY);ne.overallVelocityX=_r.x,ne.overallVelocityY=_r.y,ne.overallVelocity=v(_r.x)>v(_r.y)?_r.x:_r.y,ne.scale=qt?Vn(qt.pointers,ke):1,ne.rotation=qt?rn(qt.pointers,ke):0,ne.maxPointers=pe.prevInput?ne.pointers.length>pe.prevInput.maxPointers?ne.pointers.length:pe.prevInput.maxPointers:ne.pointers.length,St(pe,ne);var Di=Z.element;Me(ne.srcEvent.target,Di)&&(Di=ne.srcEvent.target),ne.target=Di}function Ye(Z,ne){var pe=ne.center,ke=Z.offsetDelta||{},He=Z.prevDelta||{},mt=Z.prevInput||{};(ne.eventType===ln||mt.eventType===zt)&&(He=Z.prevDelta={x:mt.deltaX||0,y:mt.deltaY||0},ke=Z.offsetDelta={x:pe.x,y:pe.y}),ne.deltaX=He.x+(pe.x-ke.x),ne.deltaY=He.y+(pe.y-ke.y)}function St(Z,ne){var pe=Z.lastInterval||ne,ke=ne.timeStamp-pe.timeStamp,He,mt,qt,tr;if(ne.eventType!=Tn&&(ke>Dn||pe.velocity===i)){var Gt=ne.deltaX-pe.deltaX,_r=ne.deltaY-pe.deltaY,Di=Re(ke,Gt,_r);mt=Di.x,qt=Di.y,He=v(Di.x)>v(Di.y)?Di.x:Di.y,tr=On(Gt,_r),Z.lastInterval=ne}else He=pe.velocity,mt=pe.velocityX,qt=pe.velocityY,tr=pe.direction;ne.velocity=He,ne.velocityX=mt,ne.velocityY=qt,ne.direction=tr}function Rt(Z){for(var ne=[],pe=0;pe<Z.pointers.length;)ne[pe]={clientX:m(Z.pointers[pe].clientX),clientY:m(Z.pointers[pe].clientY)},pe++;return{timeStamp:E(),pointers:ne,center:Ee(ne),deltaX:Z.deltaX,deltaY:Z.deltaY}}function Ee(Z){var ne=Z.length;if(ne===1)return{x:m(Z[0].clientX),y:m(Z[0].clientY)};for(var pe=0,ke=0,He=0;He<ne;)pe+=Z[He].clientX,ke+=Z[He].clientY,He++;return{x:m(pe/ne),y:m(ke/ne)}}function Re(Z,ne,pe){return{x:ne/Z||0,y:pe/Z||0}}function On(Z,ne){return Z===ne?Lr:v(Z)>=v(ne)?Z<0?Hn:pn:ne<0?un:Jt}function Ut(Z,ne,pe){pe||(pe=Vt);var ke=ne[pe[0]]-Z[pe[0]],He=ne[pe[1]]-Z[pe[1]];return Math.sqrt(ke*ke+He*He)}function xt(Z,ne,pe){pe||(pe=Vt);var ke=ne[pe[0]]-Z[pe[0]],He=ne[pe[1]]-Z[pe[1]];return Math.atan2(He,ke)*180/Math.PI}function rn(Z,ne){return xt(ne[1],ne[0],cn)+xt(Z[1],Z[0],cn)}function Vn(Z,ne){return Ut(ne[0],ne[1],cn)/Ut(Z[0],Z[1],cn)}var yr={mousedown:ln,mousemove:Wn,mouseup:zt},Qn="mousedown",Ze="mousemove mouseup";function Ft(){this.evEl=Qn,this.evWin=Ze,this.pressed=!1,yn.apply(this,arguments)}V(Ft,yn,{handler:function(ne){var pe=yr[ne.type];pe&ln&&ne.button===0&&(this.pressed=!0),pe&Wn&&ne.which!==1&&(pe=zt),this.pressed&&(pe&zt&&(this.pressed=!1),this.callback(this.manager,pe,{pointers:[ne],changedPointers:[ne],pointerType:xn,srcEvent:ne}))}});var Ot={pointerdown:ln,pointermove:Wn,pointerup:zt,pointercancel:Tn,pointerout:Tn},hr={2:Xt,3:An,4:xn,5:zn},vi="pointerdown",kt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(vi="MSPointerDown",kt="MSPointerMove MSPointerUp MSPointerCancel");function Zr(){this.evEl=vi,this.evWin=kt,yn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}V(Zr,yn,{handler:function(ne){var pe=this.store,ke=!1,He=ne.type.toLowerCase().replace("ms",""),mt=Ot[He],qt=hr[ne.pointerType]||ne.pointerType,tr=qt==Xt,Gt=Oe(pe,ne.pointerId,"pointerId");mt&ln&&(ne.button===0||tr)?Gt<0&&(pe.push(ne),Gt=pe.length-1):mt&(zt|Tn)&&(ke=!0),!(Gt<0)&&(pe[Gt]=ne,this.callback(this.manager,mt,{pointers:pe,changedPointers:[ne],pointerType:qt,srcEvent:ne}),ke&&pe.splice(Gt,1))}});var or={touchstart:ln,touchmove:Wn,touchend:zt,touchcancel:Tn},Ji="touchstart",er="touchstart touchmove touchend touchcancel";function dr(){this.evTarget=Ji,this.evWin=er,this.started=!1,yn.apply(this,arguments)}V(dr,yn,{handler:function(ne){var pe=or[ne.type];if(pe===ln&&(this.started=!0),!!this.started){var ke=sn.call(this,ne,pe);pe&(zt|Tn)&&ke[0].length-ke[1].length===0&&(this.started=!1),this.callback(this.manager,pe,{pointers:ke[0],changedPointers:ke[1],pointerType:Xt,srcEvent:ne})}}});function sn(Z,ne){var pe=tt(Z.touches),ke=tt(Z.changedTouches);return ne&(zt|Tn)&&(pe=et(pe.concat(ke),"identifier",!0)),[pe,ke]}var Qi={touchstart:ln,touchmove:Wn,touchend:zt,touchcancel:Tn},xi="touchstart touchmove touchend touchcancel";function bi(){this.evTarget=xi,this.targetIds={},yn.apply(this,arguments)}V(bi,yn,{handler:function(ne){var pe=Qi[ne.type],ke=fs.call(this,ne,pe);ke&&this.callback(this.manager,pe,{pointers:ke[0],changedPointers:ke[1],pointerType:Xt,srcEvent:ne})}});function fs(Z,ne){var pe=tt(Z.touches),ke=this.targetIds;if(ne&(ln|Wn)&&pe.length===1)return ke[pe[0].identifier]=!0,[pe,pe];var He,mt,qt=tt(Z.changedTouches),tr=[],Gt=this.target;if(mt=pe.filter(function(_r){return Me(_r.target,Gt)}),ne===ln)for(He=0;He<mt.length;)ke[mt[He].identifier]=!0,He++;for(He=0;He<qt.length;)ke[qt[He].identifier]&&tr.push(qt[He]),ne&(zt|Tn)&&delete ke[qt[He].identifier],He++;if(tr.length)return[et(mt.concat(tr),"identifier",!0),tr]}var Ns=2500,es=25;function te(){yn.apply(this,arguments);var Z=G(this.handler,this);this.touch=new bi(this.manager,Z),this.mouse=new Ft(this.manager,Z),this.primaryTouch=null,this.lastTouches=[]}V(te,yn,{handler:function(ne,pe,ke){var He=ke.pointerType==Xt,mt=ke.pointerType==xn;if(!(mt&&ke.sourceCapabilities&&ke.sourceCapabilities.firesTouchEvents)){if(He)R.call(this,pe,ke);else if(mt&&K.call(this,ke))return;this.callback(ne,pe,ke)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(Z,ne){Z&ln?(this.primaryTouch=ne.changedPointers[0].identifier,j.call(this,ne)):Z&(zt|Tn)&&j.call(this,ne)}function j(Z){var ne=Z.changedPointers[0];if(ne.identifier===this.primaryTouch){var pe={x:ne.clientX,y:ne.clientY};this.lastTouches.push(pe);var ke=this.lastTouches,He=function(){var mt=ke.indexOf(pe);mt>-1&&ke.splice(mt,1)};setTimeout(He,Ns)}}function K(Z){for(var ne=Z.srcEvent.clientX,pe=Z.srcEvent.clientY,ke=0;ke<this.lastTouches.length;ke++){var He=this.lastTouches[ke],mt=Math.abs(ne-He.x),qt=Math.abs(pe-He.y);if(mt<=es&&qt<=es)return!0}return!1}var Q=st(h.style,"touchAction"),he=Q!==i,fe="compute",ue="auto",ce="manipulation",ye="none",Ae="pan-x",je="pan-y",Le=ot();function ft(Z,ne){this.manager=Z,this.set(ne)}ft.prototype={set:function(Z){Z==fe&&(Z=this.compute()),he&&this.manager.element.style&&Le[Z]&&(this.manager.element.style[Q]=Z),this.actions=Z.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Z=[];return z(this.manager.recognizers,function(ne){ee(ne.options.enable,[ne])&&(Z=Z.concat(ne.getTouchAction()))}),gt(Z.join(" "))},preventDefaults:function(Z){var ne=Z.srcEvent,pe=Z.offsetDirection;if(this.manager.session.prevented){ne.preventDefault();return}var ke=this.actions,He=Be(ke,ye)&&!Le[ye],mt=Be(ke,je)&&!Le[je],qt=Be(ke,Ae)&&!Le[Ae];if(He){var tr=Z.pointers.length===1,Gt=Z.distance<2,_r=Z.deltaTime<250;if(tr&&Gt&&_r)return}if(!(qt&&mt)&&(He||mt&&pe&Un||qt&&pe&Jn))return this.preventSrc(ne)},preventSrc:function(Z){this.manager.session.prevented=!0,Z.preventDefault()}};function gt(Z){if(Be(Z,ye))return ye;var ne=Be(Z,Ae),pe=Be(Z,je);return ne&&pe?ye:ne||pe?ne?Ae:je:Be(Z,ce)?ce:ue}function ot(){if(!he)return!1;var Z={},ne=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(pe){Z[pe]=ne?e.CSS.supports("touch-action",pe):!0}),Z}var Pt=1,bt=2,jt=4,It=8,Dt=It,Ht=16,Yt=32;function kn(Z){this.options=F({},this.defaults,Z||{}),this.id=Je(),this.manager=null,this.options.enable=se(this.options.enable,!0),this.state=Pt,this.simultaneous={},this.requireFail=[]}kn.prototype={defaults:{},set:function(Z){return F(this.options,Z),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Z){if(S(Z,"recognizeWith",this))return this;var ne=this.simultaneous;return Z=ps(Z,this),ne[Z.id]||(ne[Z.id]=Z,Z.recognizeWith(this)),this},dropRecognizeWith:function(Z){return S(Z,"dropRecognizeWith",this)?this:(Z=ps(Z,this),delete this.simultaneous[Z.id],this)},requireFailure:function(Z){if(S(Z,"requireFailure",this))return this;var ne=this.requireFail;return Z=ps(Z,this),Oe(ne,Z)===-1&&(ne.push(Z),Z.requireFailure(this)),this},dropRequireFailure:function(Z){if(S(Z,"dropRequireFailure",this))return this;Z=ps(Z,this);var ne=Oe(this.requireFail,Z);return ne>-1&&this.requireFail.splice(ne,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Z){return!!this.simultaneous[Z.id]},emit:function(Z){var ne=this,pe=this.state;function ke(He){ne.manager.emit(He,Z)}pe<It&&ke(ne.options.event+Ln(pe)),ke(ne.options.event),Z.additionalEvent&&ke(Z.additionalEvent),pe>=It&&ke(ne.options.event+Ln(pe))},tryEmit:function(Z){if(this.canEmit())return this.emit(Z);this.state=Yt},canEmit:function(){for(var Z=0;Z<this.requireFail.length;){if(!(this.requireFail[Z].state&(Yt|Pt)))return!1;Z++}return!0},recognize:function(Z){var ne=F({},Z);if(!ee(this.options.enable,[this,ne])){this.reset(),this.state=Yt;return}this.state&(Dt|Ht|Yt)&&(this.state=Pt),this.state=this.process(ne),this.state&(bt|jt|It|Ht)&&this.tryEmit(ne)},process:function(Z){},getTouchAction:function(){},reset:function(){}};function Ln(Z){return Z&Ht?"cancel":Z&It?"end":Z&jt?"move":Z&bt?"start":""}function zr(Z){return Z==Jt?"down":Z==un?"up":Z==Hn?"left":Z==pn?"right":""}function ps(Z,ne){var pe=ne.manager;return pe?pe.get(Z):Z}function Xr(){kn.apply(this,arguments)}V(Xr,kn,{defaults:{pointers:1},attrTest:function(Z){var ne=this.options.pointers;return ne===0||Z.pointers.length===ne},process:function(Z){var ne=this.state,pe=Z.eventType,ke=ne&(bt|jt),He=this.attrTest(Z);return ke&&(pe&Tn||!He)?ne|Ht:ke||He?pe&zt?ne|It:ne&bt?ne|jt:bt:Yt}});function hn(){Xr.apply(this,arguments),this.pX=null,this.pY=null}V(hn,Xr,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ur},getTouchAction:function(){var Z=this.options.direction,ne=[];return Z&Un&&ne.push(je),Z&Jn&&ne.push(Ae),ne},directionTest:function(Z){var ne=this.options,pe=!0,ke=Z.distance,He=Z.direction,mt=Z.deltaX,qt=Z.deltaY;return He&ne.direction||(ne.direction&Un?(He=mt===0?Lr:mt<0?Hn:pn,pe=mt!=this.pX,ke=Math.abs(Z.deltaX)):(He=qt===0?Lr:qt<0?un:Jt,pe=qt!=this.pY,ke=Math.abs(Z.deltaY))),Z.direction=He,pe&&ke>ne.threshold&&He&ne.direction},attrTest:function(Z){return Xr.prototype.attrTest.call(this,Z)&&(this.state&bt||!(this.state&bt)&&this.directionTest(Z))},emit:function(Z){this.pX=Z.deltaX,this.pY=Z.deltaY;var ne=zr(Z.direction);ne&&(Z.additionalEvent=this.options.event+ne),this._super.emit.call(this,Z)}});function ta(){Xr.apply(this,arguments)}V(ta,Xr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ye]},attrTest:function(Z){return this._super.attrTest.call(this,Z)&&(Math.abs(Z.scale-1)>this.options.threshold||this.state&bt)},emit:function(Z){if(Z.scale!==1){var ne=Z.scale<1?"in":"out";Z.additionalEvent=this.options.event+ne}this._super.emit.call(this,Z)}});function na(){kn.apply(this,arguments),this._timer=null,this._input=null}V(na,kn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ue]},process:function(Z){var ne=this.options,pe=Z.pointers.length===ne.pointers,ke=Z.distance<ne.threshold,He=Z.deltaTime>ne.time;if(this._input=Z,!ke||!pe||Z.eventType&(zt|Tn)&&!He)this.reset();else if(Z.eventType&ln)this.reset(),this._timer=T(function(){this.state=Dt,this.tryEmit()},ne.time,this);else if(Z.eventType&zt)return Dt;return Yt},reset:function(){clearTimeout(this._timer)},emit:function(Z){this.state===Dt&&(Z&&Z.eventType&zt?this.manager.emit(this.options.event+"up",Z):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function Fa(){Xr.apply(this,arguments)}V(Fa,Xr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ye]},attrTest:function(Z){return this._super.attrTest.call(this,Z)&&(Math.abs(Z.rotation)>this.options.threshold||this.state&bt)}});function Ba(){Xr.apply(this,arguments)}V(Ba,Xr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Un|Jn,pointers:1},getTouchAction:function(){return hn.prototype.getTouchAction.call(this)},attrTest:function(Z){var ne=this.options.direction,pe;return ne&(Un|Jn)?pe=Z.overallVelocity:ne&Un?pe=Z.overallVelocityX:ne&Jn&&(pe=Z.overallVelocityY),this._super.attrTest.call(this,Z)&&ne&Z.offsetDirection&&Z.distance>this.options.threshold&&Z.maxPointers==this.options.pointers&&v(pe)>this.options.velocity&&Z.eventType&zt},emit:function(Z){var ne=zr(Z.offsetDirection);ne&&this.manager.emit(this.options.event+ne,Z),this.manager.emit(this.options.event,Z)}});function Po(){kn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}V(Po,kn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ce]},process:function(Z){var ne=this.options,pe=Z.pointers.length===ne.pointers,ke=Z.distance<ne.threshold,He=Z.deltaTime<ne.time;if(this.reset(),Z.eventType&ln&&this.count===0)return this.failTimeout();if(ke&&He&&pe){if(Z.eventType!=zt)return this.failTimeout();var mt=this.pTime?Z.timeStamp-this.pTime<ne.interval:!0,qt=!this.pCenter||Ut(this.pCenter,Z.center)<ne.posThreshold;this.pTime=Z.timeStamp,this.pCenter=Z.center,!qt||!mt?this.count=1:this.count+=1,this._input=Z;var tr=this.count%ne.taps;if(tr===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=Dt,this.tryEmit()},ne.interval,this),bt):Dt}return Yt},failTimeout:function(){return this._timer=T(function(){this.state=Yt},this.options.interval,this),Yt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Dt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ms(Z,ne){return ne=ne||{},ne.recognizers=se(ne.recognizers,ms.defaults.preset),new Va(Z,ne)}ms.VERSION="2.0.7",ms.defaults={domEvents:!1,touchAction:fe,enable:!0,inputTarget:null,inputClass:null,preset:[[Fa,{enable:!1}],[ta,{enable:!1},["rotate"]],[Ba,{direction:Un}],[hn,{direction:Un},["swipe"]],[Po],[Po,{event:"doubletap",taps:2},["tap"]],[na]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Na=1,Ua=2;function Va(Z,ne){this.options=F({},ms.defaults,ne||{}),this.options.inputTarget=this.options.inputTarget||Z,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Z,this.input=ui(this),this.touchAction=new ft(this,this.options.touchAction),Fl(this,!0),z(this.options.recognizers,function(pe){var ke=this.add(new pe[0](pe[1]));pe[2]&&ke.recognizeWith(pe[2]),pe[3]&&ke.requireFailure(pe[3])},this)}Va.prototype={set:function(Z){return F(this.options,Z),Z.touchAction&&this.touchAction.update(),Z.inputTarget&&(this.input.destroy(),this.input.target=Z.inputTarget,this.input.init()),this},stop:function(Z){this.session.stopped=Z?Ua:Na},recognize:function(Z){var ne=this.session;if(!ne.stopped){this.touchAction.preventDefaults(Z);var pe,ke=this.recognizers,He=ne.curRecognizer;(!He||He&&He.state&Dt)&&(He=ne.curRecognizer=null);for(var mt=0;mt<ke.length;)pe=ke[mt],ne.stopped!==Ua&&(!He||pe==He||pe.canRecognizeWith(He))?pe.recognize(Z):pe.reset(),!He&&pe.state&(bt|jt|It)&&(He=ne.curRecognizer=pe),mt++}},get:function(Z){if(Z instanceof kn)return Z;for(var ne=this.recognizers,pe=0;pe<ne.length;pe++)if(ne[pe].options.event==Z)return ne[pe];return null},add:function(Z){if(S(Z,"add",this))return this;var ne=this.get(Z.options.event);return ne&&this.remove(ne),this.recognizers.push(Z),Z.manager=this,this.touchAction.update(),Z},remove:function(Z){if(S(Z,"remove",this))return this;if(Z=this.get(Z),Z){var ne=this.recognizers,pe=Oe(ne,Z);pe!==-1&&(ne.splice(pe,1),this.touchAction.update())}return this},on:function(Z,ne){if(Z!==i&&ne!==i){var pe=this.handlers;return z(ze(Z),function(ke){pe[ke]=pe[ke]||[],pe[ke].push(ne)}),this}},off:function(Z,ne){if(Z!==i){var pe=this.handlers;return z(ze(Z),function(ke){ne?pe[ke]&&pe[ke].splice(Oe(pe[ke],ne),1):delete pe[ke]}),this}},emit:function(Z,ne){this.options.domEvents&&qc(Z,ne);var pe=this.handlers[Z]&&this.handlers[Z].slice();if(!(!pe||!pe.length)){ne.type=Z,ne.preventDefault=function(){ne.srcEvent.preventDefault()};for(var ke=0;ke<pe.length;)pe[ke](ne),ke++}},destroy:function(){this.element&&Fl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Fl(Z,ne){var pe=Z.element;if(pe.style){var ke;z(Z.options.cssProps,function(He,mt){ke=st(pe.style,mt),ne?(Z.oldCssProps[ke]=pe.style[ke],pe.style[ke]=He):pe.style[ke]=Z.oldCssProps[ke]||""}),ne||(Z.oldCssProps={})}}function qc(Z,ne){var pe=n.createEvent("Event");pe.initEvent(Z,!0,!0),pe.gesture=ne,ne.target.dispatchEvent(pe)}F(ms,{INPUT_START:ln,INPUT_MOVE:Wn,INPUT_END:zt,INPUT_CANCEL:Tn,STATE_POSSIBLE:Pt,STATE_BEGAN:bt,STATE_CHANGED:jt,STATE_ENDED:It,STATE_RECOGNIZED:Dt,STATE_CANCELLED:Ht,STATE_FAILED:Yt,DIRECTION_NONE:Lr,DIRECTION_LEFT:Hn,DIRECTION_RIGHT:pn,DIRECTION_UP:un,DIRECTION_DOWN:Jt,DIRECTION_HORIZONTAL:Un,DIRECTION_VERTICAL:Jn,DIRECTION_ALL:Ur,Manager:Va,Input:yn,TouchAction:ft,TouchInput:bi,MouseInput:Ft,PointerEventInput:Zr,TouchMouseInput:te,SingleTouchInput:dr,Recognizer:kn,AttrRecognizer:Xr,Tap:Po,Pan:hn,Swipe:Ba,Pinch:ta,Rotate:Fa,Press:na,on:me,off:ve,each:z,merge:U,extend:J,assign:F,inherit:V,bindFn:G,prefixed:st});var ro=typeof e<"u"?e:typeof self<"u"?self:{};ro.Hammer=ms,typeof i=="function"&&i.amd?i(function(){return ms}):t.exports?t.exports=ms:e[r]=ms})(window,document,"Hammer")})($k);var _p=$k.exports;const u9=$y(_p),Bo=sC({__proto__:null,default:u9},[_p]),Wk=1,Hk=2,A1=4,h9={mousedown:Wk,mousemove:Hk,mouseup:A1};function d9(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function f9(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(d9(i,a=>a.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function p9(t){t.prototype.handler=function(n){let r=h9[n.type];r&Wk&&n.button>=0&&(this.pressed=!0),r&Hk&&n.which===0&&(r=A1),this.pressed&&(r&A1&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}f9(_p.PointerEventInput);p9(_p.MouseInput);const m9=_p.Manager;class h0{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const g9=Bo?[[Bo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Bo.Rotate,{enable:!1}],[Bo.Pinch,{enable:!1}],[Bo.Swipe,{enable:!1}],[Bo.Pan,{threshold:0,enable:!1}],[Bo.Press,{enable:!1}],[Bo.Tap,{event:"doubletap",taps:2,enable:!1}],[Bo.Tap,{event:"anytap",enable:!1}],[Bo.Tap,{enable:!1}]]:null,_P={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},y9={doubletap:["tap"]},_9={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},xw={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},v9={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},vP={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},x9=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Zu=typeof window<"u"?window:global;let C1=!1;try{const t={get passive(){return C1=!0,!0}};Zu.addEventListener("test",null,t),Zu.removeEventListener("test",null)}catch{C1=!1}const b9=x9.indexOf("firefox")!==-1,{WHEEL_EVENTS:w9}=xw,xP="wheel",bP=4.000244140625,E9=40,T9=.25;class S9 extends h0{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let a=i.deltaY;Zu.WheelEvent&&(b9&&i.deltaMode===Zu.WheelEvent.DOM_DELTA_PIXEL&&(a/=Zu.devicePixelRatio),i.deltaMode===Zu.WheelEvent.DOM_DELTA_LINE&&(a*=E9)),a!==0&&a%bP===0&&(a=Math.floor(a/bP)),i.shiftKey&&a&&(a=a*T9),this.callback({type:xP,center:{x:i.clientX,y:i.clientY},delta:-a,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(w9),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,C1?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===xP&&(this.options.enable=n)}}const{MOUSE_EVENTS:P9}=xw,wP="pointermove",EP="pointerover",TP="pointerout",SP="pointerenter",PP="pointerleave";class A9 extends h0{constructor(e,n,r){super(e,n,r),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(P9),this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===wP&&(this.enableMoveEvent=n),e===EP&&(this.enableOverEvent=n),e===TP&&(this.enableOutEvent=n),e===SP&&(this.enableEnterEvent=n),e===PP&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(EP,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(TP,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(SP,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(PP,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(wP,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:C9}=xw,AP="keydown",CP="keyup";class I9 extends h0{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const a=i.target||i.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:AP,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:CP,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(C9),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===AP&&(this.enableDownEvent=n),e===CP&&(this.enableUpEvent=n)}}const IP="contextmenu";class M9 extends h0{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:IP,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===IP&&(this.options.enable=n)}}const I1=1,Cy=2,M1=4,k9={pointerdown:I1,pointermove:Cy,pointerup:M1,mousedown:I1,mousemove:Cy,mouseup:M1},L9=1,R9=2,z9=3,D9=0,O9=1,F9=2,B9=1,N9=2,U9=4;function V9(t){const e=k9[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:i}=t.srcEvent;let a=!1,h=!1,l=!1;return e===M1||e===Cy&&!Number.isFinite(n)?(a=i===L9,h=i===R9,l=i===z9):e===Cy?(a=!!(n&B9),h=!!(n&U9),l=!!(n&N9)):e===I1&&(a=r===D9,h=r===O9,l=r===F9),{leftButton:a,middleButton:h,rightButton:l}}function j9(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,a=r.height/e.offsetHeight||1,h={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/a};return{center:n,offsetCenter:h}}const Yv={srcElement:"root",priority:0};class G9{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,a=!1){const{handlers:h,handlersByElement:l}=this;let m=Yv;typeof r=="string"||r&&r.addEventListener?m={...Yv,srcElement:r}:r&&(m={...Yv,...r});let v=l.get(m.srcElement);v||(v=[],l.set(m.srcElement,v));const E={type:e,handler:n,srcElement:m.srcElement,priority:m.priority};i&&(E.once=!0),a&&(E.passive=!0),h.push(E),this._active=this._active||!E.passive;let T=v.length-1;for(;T>=0&&!(v[T].priority>=E.priority);)T--;v.splice(T+1,0,E)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let a=r.length-1;a>=0;a--){const h=r[a];if(h.type===e&&h.handler===n){r.splice(a,1);const l=i.get(h.srcElement);l.splice(l.indexOf(h),1),l.length===0&&i.delete(h.srcElement)}}this._active=r.some(a=>!a.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const a=()=>{e.handled=!0},h=()=>{e.handled=!0,i=!0},l=[];for(let m=0;m<r.length;m++){const{type:v,handler:E,once:T}=r[m];if(E({...e,type:v,stopPropagation:a,stopImmediatePropagation:h}),T&&l.push(r[m]),i)break}for(let m=0;m<l.length;m++){const{type:v,handler:E}=l[m];this.remove(v,E)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...V9(e),...j9(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const $9={events:null,recognizers:null,recognizerOptions:{},Manager:m9,touchAction:"none",tabIndex:0};class W9{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:a}=i,h=_9[a.type];h&&this.manager.emit(h,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...$9,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||g9}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(_P).forEach(i=>{const a=this.manager.get(i);a&&_P[i].forEach(h=>{a.recognizeWith(h)})});for(const i in n.recognizerOptions){const a=this.manager.get(i);if(a){const h=n.recognizerOptions[i];delete h.enable,a.set(h)}}this.wheelInput=new S9(e,this._onOtherEvent,{enable:!1}),this.moveInput=new A9(e,this._onOtherEvent,{enable:!1}),this.keyInput=new I9(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new M9(e,this._onOtherEvent,{enable:!1});for(const[i,a]of this.events)a.isEmpty()||(this._toggleRecognizer(a.recognizerName,!0),this.manager.on(i,a.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const a=y9[e];a&&!this.options.recognizers&&a.forEach(h=>{const l=r.get(h);n?(l.requireFailure(e),i.dropRequireFailure(h)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,a){if(typeof e!="string"){r=n;for(const E in e)this._addEventHandler(E,e[E],r,i,a);return}const{manager:h,events:l}=this,m=vP[e]||e;let v=l.get(m);v||(v=new G9(this),l.set(m,v),v.recognizerName=v9[m]||m,h&&h.on(m,v.handleEvent)),v.add(e,n,r,i,a),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const h in e)this._removeEventHandler(h,e[h]);return}const{events:r}=this,i=vP[e]||e,a=r.get(i);if(a&&(a.remove(e,n),a.isEmpty())){const{recognizerName:h}=a;let l=!1;for(const m of r.values())if(m.recognizerName===h&&!m.isEmpty()){l=!0;break}l||this._toggleRecognizer(h,!1)}}}function hc(){}const H9=({isDragging:t})=>t?"grabbing":"grab",qk={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:hc,onResize:hc,onViewStateChange:hc,onInteractionStateChange:hc,onBeforeRender:hc,onAfterRender:hc,onLoad:hc,onError:t=>an.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:H9,getTooltip:null,debug:!1,drawPickingColors:!1};class d0{constructor(e){$(this,"props",void 0),$(this,"width",0),$(this,"height",0),$(this,"userData",{}),$(this,"canvas",null),$(this,"viewManager",null),$(this,"layerManager",null),$(this,"effectManager",null),$(this,"deckRenderer",null),$(this,"deckPicker",null),$(this,"eventManager",null),$(this,"tooltip",null),$(this,"metrics",void 0),$(this,"animationLoop",void 0),$(this,"stats",void 0),$(this,"viewState",void 0),$(this,"cursorState",void 0),$(this,"_needsRedraw",void 0),$(this,"_pickRequest",void 0),$(this,"_lastPointerDownInfo",null),$(this,"_metricsCounter",void 0),$(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const i=n.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),$(this,"_onEvent",n=>{const r=dS[n.type],i=n.offsetCenter;if(!r||!i||!this.layerManager)return;const a=this.layerManager.getLayers(),h=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:a,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:l}=h,m=l&&(l[r.handler]||l.props[r.handler]),v=this.props[r.handler];let E=!1;m&&(E=m.call(l,h,n)),!E&&v&&v(h,n)}),$(this,"_onPointerDown",n=>{const r=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...qk,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&an.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),GM()==="IE"&&an.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new sw({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Eh.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,a,h,l,m;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(h=this.deckPicker)===null||h===void 0||h.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(m=this.tooltip)===null||m===void 0||m.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var v;(v=this.canvas.parentElement)===null||v===void 0||v.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&an.removed("onLayerHover","onHover")(),"onLayerClick"in e&&an.removed("onLayerClick","onClick")(),e.initialViewState&&!qo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),h=this.deckRenderer.needsRedraw(e);return n=n||r||i||a||h,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ai(this.viewManager),this.viewManager.views}getViewports(e){return ai(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){ai(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),a}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),ai(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(r||r===0){var i;const a=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var e,n;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,a=(n=r.clientHeight)!==null&&n!==void 0?n:r.height;if(i!==this.width||a!==this.height){var h,l;this.width=i,this.height=a,(h=this.viewManager)===null||h===void 0||h.setProps({width:i,height:a}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:a})}}_createAnimationLoop(e){const{width:n,height:r,gl:i,glOptions:a,debug:h,onError:l,onBeforeRender:m,onAfterRender:v,useDevicePixels:E}=e;return new kN({width:n,height:r,useDevicePixels:E,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:T=>YM({...a,...T,canvas:this.canvas,debug:h,onContextLost:()=>this._onContextLost()}),onInitialize:T=>this._setGLContext(T.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:m,onAfterRender:v,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Vk({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let a=i,h=!1;for(const l of r){var n;a=l,h=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||h}if(!h&&this.props.onHover&&this.props.onHover(a,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(a);this.tooltip.setTooltip(l,a.x,a.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,iw(e,{enable:!0,copyState:!0})),this.tooltip=new c9(this.canvas),Ia(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new Pk;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new W9(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in dS)this.eventManager.on(i,this._onEvent);this.viewManager=new Oj({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new Dj(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new Jj,this.deckRenderer=new t9(e),this.deckPicker=new a9(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;Ia(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),an.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=xc.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}$(d0,"defaultProps",qk);$(d0,"VERSION",O6);class Kv{constructor(e,n){$(this,"opts",void 0),$(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:i}=n;let a=r;if(r&&r.length!==i){a=new Float32Array(i);const h=n.elementOffset||0;for(let l=0;l<i;++l)a[l]=r[h+l]}return a}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function q9(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function kg(t){return t.stride||t.size*t.bytesPerElement}function Zk(t,e){e.offset&&an.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=kg(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,a=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:a,stride:n}}function Z9(t,e){const n=Zk(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class X9{constructor(e,n,r){$(this,"gl",void 0),$(this,"id",void 0),$(this,"size",void 0),$(this,"settings",void 0),$(this,"value",void 0),$(this,"doublePrecision",void 0),$(this,"_buffer",void 0),$(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,a=i===5130;let{defaultValue:h}=n;h=Number.isFinite(h)?[h]:h||new Array(this.size).fill(0);let l;a?l=5126:!i&&n.isIndexed?l=e&&aB(e,cr.ELEMENT_INDEX_UINT32)?5125:5123:l=i||5126;let m=q9(i||l||5126);this.doublePrecision=a,a&&n.fp64===!1&&(m=Float32Array),this.value=null,this.settings={...n,defaultType:m,defaultValue:h,logicalType:i,type:l,size:this.size,bytesPerElement:m.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new $n(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*kg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Eh.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,a=Z9(this.getAccessor(),n||{});return r[e]=new Kv(this,a.high),r["".concat(e,"64Low")]=i?new Kv(this,a.low):new Float32Array(this.size),r}if(n){const r=Zk(this.getAccessor(),n);return{[e]:new Kv(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,a=r*i;if(n&&a&&n.length>=a){const h=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let m=0;m<a;)for(let v=0;v<i;v++){const E=n[m++];E<h[v]&&(h[v]=E),E>l[v]&&(l[v]=E)}e=[h,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof $n?r={buffer:e}:r=e;const i={...this.settings,...r};if(n.bufferAccessor=i,n.bounds=null,r.constant){let a=r.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!n.constant||!this._areValuesEqual(a,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=a}else if(r.buffer){const a=r.buffer;n.externalBuffer=a,n.constant=!1,this.value=r.value||null;const h=r.value instanceof Float64Array;i.type=r.type||a.accessor.type,i.bytesPerElement=a.accessor.BYTES_PER_ELEMENT*(h?2:1),i.stride=kg(i)}else if(r.value){this._checkExternalBuffer(r);let a=r.value;n.externalBuffer=null,n.constant=!1,this.value=a,i.bytesPerElement=a.BYTES_PER_ELEMENT,i.stride=kg(i);const{buffer:h,byteOffset:l}=this;this.doublePrecision&&a instanceof Float64Array&&(a=qv(a,i));const m=a.byteLength+l+i.stride*2;h.byteLength<m&&h.reallocate(m),h.setAccessor(null),h.subData({data:a,offset:l}),i.type=r.type||h.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?qv(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,a=Eh.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=a;const{buffer:h,byteOffset:l}=this;return h.byteLength<a.byteLength+l&&(h.reallocate(a.byteLength+l),n&&i&&h.subData({data:i instanceof Float64Array?qv(i,this):i,offset:l})),r.allocatedValue=a,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&an.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:a}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let h=a;for(;--h>=0;)n[r+h]=i[h];return n}switch(a){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let h=a;for(;--h>=0;)n[r+h]=Number.isFinite(e[h])?e[h]:i[h]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}}const MP=[],kP=[];function vp(t,e=0,n=1/0){let r=MP;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(kP.length=t.length,r=kP):r=MP,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function Xk(t){return t&&t[Symbol.asyncIterator]}function Yk(t,e){const{size:n,stride:r,offset:i,startIndices:a,nested:h}=e,l=t.BYTES_PER_ELEMENT,m=r?r/l:n,v=i?i/l:0,E=Math.floor((t.length-v)/m);return(T,{index:S,target:z})=>{if(!a){const U=S*m+v;for(let V=0;V<n;V++)z[V]=t[U+V];return z}const D=a[S],F=a[S+1]||E;let J;if(h){J=new Array(F-D);for(let U=D;U<F;U++){const V=U*m+v;z=new Array(n);for(let G=0;G<n;G++)z[G]=t[V+G];J[U-D]=z}}else if(m===n)J=t.subarray(D*n+v,F*n+v);else{J=new t.constructor((F-D)*n);let U=0;for(let V=D;V<F;V++){const G=V*m+v;for(let ee=0;ee<n;ee++)J[U++]=t[G+ee]}}return J}}const Y9=[],Lg=[[0,1/0]];function K9(t,e){if(t===Lg||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let a=0;a<r;a++){const h=t[a];h[1]<e[0]?(n.push(h),i=a+1):h[0]>e[1]?n.push(h):e=[Math.min(h[0],e[0]),Math.max(h[1],e[1])]}return n.splice(i,0,e),n}function Jv(t){const{source:e,target:n,start:r=0,size:i,getData:a}=t,h=t.end||n.length,l=e.length,m=h-r;if(l>m){n.set(e.subarray(0,m),r);return}if(n.set(e,r),!a)return;let v=l;for(;v<m;){const E=a(v,e);for(let T=0;T<i;T++)n[r+v]=E[T]||0,v++}}function J9({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:a}){if(!Array.isArray(a))return Jv({source:t,target:e,size:n,getData:r}),e;let h=0,l=0;const m=r&&((E,T)=>r(E+l,T)),v=Math.min(i.length,a.length);for(let E=1;E<v;E++){const T=i[E]*n,S=a[E]*n;Jv({source:t.subarray(h,T),target:e,start:l,end:S,size:n,getData:m}),h=T,l=S}return l<e.length&&Jv({source:[],target:e,start:l,size:n,getData:m}),e}const Q9={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Kk(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Q9[n],...e,...t,type:n}}function Jk(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function Qk(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function eL(t){t.push(t.shift())}function bw(t,e){const{doublePrecision:n,settings:r,value:i,size:a}=t,h=n&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*a)*h}function tL({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:i,getData:a=h=>h}){const h=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*h,m=n.byteOffset,v=n.startIndices,E=i&&v,T=bw(n,e),S=n.isConstant;if(!E&&r>=T)return;const z=S?n.value:n.getBuffer().getData({srcByteOffset:m});if(n.settings.normalized&&!S){const U=a;a=(V,G)=>n.normalizeConstant(U(V,G))}const D=S?(U,V)=>a(z,V):(U,V)=>a(z.subarray(U,U+l),V),F=t.getData({length:r}),J=new Float32Array(T);J9({source:F,target:J,sourceStartIndices:i,targetStartIndices:v,size:l,getData:D}),t.byteLength<J.byteLength+m&&t.reallocate(J.byteLength+m),t.subData({data:J,offset:m})}class ww extends X9{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Lg}),$(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(a=>e[a])]:e[n];return Kk(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=K9(this.state.updateRanges,[r,i])}else this.state.updateRanges=Lg}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Y9}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Lg),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:h,noAlloc:l}}=this;let m=!0;if(h){for(const[v,E]of a)h.call(i,this,{data:n,startRow:v,endRow:E,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,E]of a){const T=Number.isFinite(v)?this.getVertexOffset(v):0,S=Number.isFinite(E)?this.getVertexOffset(E):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:S})}this._checkAttributeArray()}else m=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),m}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const h=e;ai(ArrayBuffer.isView(h.value),"invalid ".concat(i.accessor));const l=!!h.size&&h.size!==this.size;return r.binaryAccessor=Yk(h.value,{size:h.size||this.size,stride:h.stride,offset:h.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:a,numInstances:h}){if(e.constant)return;const{settings:l,state:m,value:v,size:E,startIndices:T}=e,{accessor:S,transform:z}=l,D=m.binaryAccessor||(typeof S=="function"?S:a[S]);ai(typeof D=="function",'accessor "'.concat(S,'" is not a function'));let F=e.getVertexOffset(r);const{iterable:J,objectInfo:U}=vp(n,r,i);for(const V of J){U.index++;let G=D(V,U);if(z&&(G=z.call(this,G)),T){const ee=(U.index<T.length-1?T[U.index+1]:h)-T[U.index];if(G&&Array.isArray(G[0])){let se=F;for(const me of G)e._normalizeValue(me,v,se),se+=E}else G&&G.length>E?v.set(G,F):(e._normalizeValue(G,U.target,0),Pj({target:v,source:U.target,start:F,count:ee}));F+=ee*E}else e._normalizeValue(G,v,F),F+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class e7{constructor({gl:e,attribute:n,timeline:r}){$(this,"gl",void 0),$(this,"type","interpolation"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.transition=new yp(r),this.attribute=n,this.attributeInTransition=new ww(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=n7(e,n);const i={byteLength:0,usage:35050};this.buffers=[new $n(e,i),new $n(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:a}=this;eL(i);const h={numInstances:n,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of i)tL({buffer:l,...h});this.currentStartIndices=a.startIndices,this.currentLength=bw(a,n),this.attributeInTransition.setData({buffer:i[1],value:a.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aFrom:i[0],aTo:Jk(r,a)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:i}=this.transition;let a=i/n;r&&(a=r(a)),this.transform.run({uniforms:{time:a}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const t7=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function n7(t,e){const n=Qk(e.size);return new fw(t,{vs:t7,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class r7{constructor({gl:e,attribute:n,timeline:r}){$(this,"gl",void 0),$(this,"type","spring"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"texture",void 0),$(this,"framebuffer",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new yp(r),this.attribute=n,this.attributeInTransition=new ww(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=s7(e),this.framebuffer=o7(e,this.texture),this.transform=i7(e,n,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new $n(e,i),new $n(e,i),new $n(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:i,attribute:a}=this,h={numInstances:n,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of i)tL({buffer:l,...h});this.settings=e,this.currentStartIndices=a.startIndices,this.currentLength=bw(a,n),this.attributeInTransition.setData({buffer:i[1],value:a.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aTo:Jk(r,a)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this;if(!i.update())return!1;const h=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:h.stiffness,damping:h.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),eL(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),u0(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function i7(t,e,n){const r=Qk(e.size);return new fw(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function s7(t){return new Ds(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function o7(t,e){return new ti(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const a7={interpolation:e7,spring:r7};class l7{constructor(e,{id:n,timeline:r}){$(this,"id",void 0),$(this,"isSupported",void 0),$(this,"gl",void 0),$(this,"timeline",void 0),$(this,"transitions",void 0),$(this,"needsRedraw",void 0),$(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=fw.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const a=e[i],h=a.getTransitionSetting(n);h&&this._updateAttribute(i,a,h)}for(const i in this.transitions){const a=e[i];(!a||!a.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let a=!i||i.type!==r.type;if(a){if(!this.isSupported){an.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const h=a7[r.type];h?this.transitions[e]=new h({attribute:n,timeline:this.timeline,gl:this.gl}):(an.error("unsupported transition type '".concat(r.type,"'"))(),a=!1)}(a||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const LP="attributeManager.invalidate",c7="attributeManager.updateStart",u7="attributeManager.updateEnd",h7="attribute.updateStart",d7="attribute.allocate",f7="attribute.updateEnd";class p7{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){$(this,"id",void 0),$(this,"gl",void 0),$(this,"attributes",void 0),$(this,"updateTriggers",void 0),$(this,"needsRedraw",void 0),$(this,"userData",void 0),$(this,"stats",void 0),$(this,"attributeTransitionManager",void 0),$(this,"mergeBoundsMemoized",pp(JV)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new l7(e,{id:"".concat(n,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);ki(LP,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ki(LP,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:a={},buffers:h={},context:l={}}){let m=!1;ki(c7,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const E=this.attributes[v],T=E.settings.accessor;E.startIndices=r,E.numInstances=n,a[v]&&an.removed("props.".concat(v),"data.attributes.".concat(v))(),E.setExternalBuffer(h[v])||E.setBinaryValue(typeof T=="string"?h[T]:void 0,e.startIndices)||typeof T=="string"&&!h[T]&&E.setConstantValue(a[T])||E.needsUpdate()&&(m=!0,this._updateAttribute({attribute:E,numInstances:n,data:e,props:a,context:l})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}m&&ki(u7,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const a in n){const h=n[a];h.needsRedraw(e)&&!r.hasAttribute(a)&&(i[a]=h)}return i}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const i in e)n[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const i={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new ww(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,a=i[e];return a&&a.forEach(h=>{const l=r[h];l&&l.setNeedsUpdate(l.id,n)}),a}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(ki(h7,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&ki(d7,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,ki(f7,n,r))}}class m7 extends yp{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:a}}=this,h=a(e/i);this._value=xy(n,r,h)}}const RP=1e-5;function zP(t,e,n,r,i){const a=e-t,l=(n-e)*i,m=-a*r;return l+m+a+e}function g7(t,e,n,r,i){if(Array.isArray(n)){const a=[];for(let h=0;h<n.length;h++)a[h]=zP(t[h],e[h],n[h],r,i);return a}return zP(t,e,n,r,i)}function DP(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class y7 extends yp{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:a=e,_currValue:h=e}=this;let l=g7(a,h,n,r,i);const m=DP(l,n),v=DP(l,h);m<RP&&v<RP&&(l=n,this.end()),this._prevValue=h,this._currValue=l}}const _7={interpolation:m7,spring:y7};class v7{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:a}=this;if(a.has(e)){const m=a.get(e),{value:v=m.settings.fromValue}=m;n=v,this.remove(e)}if(i=Kk(i),!i)return;const h=_7[i.type];if(!h){an.error("unsupported transition type '".concat(i.type,"'"))();return}const l=new h(this.timeline);l.start({...i,fromValue:n,toValue:r}),a.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function x7(t){const e=t[Il];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function b7(t,e){const n=nL({newProps:t,oldProps:e,propTypes:t[Il],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=E7(t,e);let i=!1;return r||(i=T7(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:S7(t,e),transitionsChanged:w7(t,e)}}function w7(t,e){if(!t.transitions)return!1;const n={},r=t[Il];let i=!1;for(const a in t.transitions){const h=r[a],l=h&&h.type;(l==="number"||l==="color"||l==="array")&&k1(t[a],e[a],h)&&(n[a]=!0,i=!0)}return i?n:!1}function nL({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(i,".").concat(a," added");const h=k1(t[a],e[a],r[a]);if(h)return"".concat(i,".").concat(a," ").concat(h)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(i,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const h=k1(t[a],e[a],r[a]);if(h)return"".concat(i,".").concat(a," ").concat(h)}}return!1}function k1(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function E7(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function T7(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&OP(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&OP(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function S7(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function OP(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},nL({oldProps:i,newProps:r,triggerName:n})}const P7="count(): argument not an object",A7="count(): argument not a container";function C7(t){if(!M7(t))throw new Error(P7);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(I7(t))return Object.keys(t).length;throw new Error(A7)}function I7(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function M7(t){return t!==null&&typeof t=="object"}function k7(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const L7={10241:9987,10240:9729,10242:33071,10243:33071},L1={};function R7(t,e,n,r){if(n instanceof Ds)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={10241:n.data.length>1?9985:9729});const a=new Ds(e,{...n,parameters:{...L7,...i,...r}});return L1[a.id]=t,a}function z7(t,e){!e||!(e instanceof Ds)||L1[e.id]===t&&(e.delete(),delete L1[e.id])}const D7={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||R1(t)&&(t.length===3||t.length===4)},equal(t,e,n){return qo(t,e,1)}},accessor:{validate(t,e){const n=Iy(t);return n==="function"||n===Iy(e.value)},equal(t,e,n){return typeof e=="function"?!0:qo(t,e,1)}},array:{validate(t,e){return e.optional&&!t||R1(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?qo(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?qo(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:R7(n.id,r.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{z7(n.id,t)}}};function O7(t){const e={},n={},r={};for(const[i,a]of Object.entries(t)){const h=a==null?void 0:a.deprecatedFor;if(h)r[i]=Array.isArray(h)?h:[h];else{const l=F7(i,a);e[i]=l,n[i]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function F7(t,e){switch(Iy(e)){case"object":return Vd(t,e);case"array":return Vd(t,{type:"array",value:e,compare:!1});case"boolean":return Vd(t,{type:"boolean",value:e});case"number":return Vd(t,{type:"number",value:e});case"function":return Vd(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Vd(t,e){return"type"in e?{name:t,...D7[e.type],...e}:"value"in e?{name:t,type:Iy(e.value),...e}:{name:t,type:"object",value:e}}function R1(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Iy(t){return R1(t)?"array":t===null?"null":typeof t}function B7(t,e){let n;for(let a=e.length-1;a>=0;a--){const h=e[a];"extensions"in h&&(n=h.extensions)}const r=z1(t.constructor,n),i=Object.create(r);i[Ay]=t,i[Fc]={},i[yl]={};for(let a=0;a<e.length;++a){const h=e[a];for(const l in h)i[l]=h[l]}return Object.freeze(i),i}const N7="_mergedDefaultProps";function z1(t,e){let n=N7;if(e)for(const i of e){const a=i.constructor;a&&(n+=":".concat(a.extensionName||a.name))}const r=rL(t,n);return r||(t[n]=U7(t,e||[]))}function U7(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=z1(r),a=rL(t,"defaultProps")||{},h=O7(a),l=Object.assign(Object.create(null),i,h.defaultProps),m=Object.assign(Object.create(null),i==null?void 0:i[Il],h.propTypes),v=Object.assign(Object.create(null),i==null?void 0:i[Xv],h.deprecatedProps);for(const E of e){const T=z1(E.constructor);T&&(Object.assign(l,T),Object.assign(m,T[Il]),Object.assign(v,T[Xv]))}return V7(l,t),G7(l,m),j7(l,v),l[Il]=m,l[Xv]=v,e.length===0&&!Ew(t,"_propTypes")&&(t._propTypes=m),l}function V7(t,e){const n=W7(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function j7(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(n);for(const a of e[n])Ew(this,a)||(this[a]=r);an.deprecated(i,e[n].join("/"))()}})}function G7(t,e){const n={},r={};for(const i in e){const a=e[i],{name:h,value:l}=a;a.async&&(n[h]=l,r[h]=$7(h))}t[rh]=n,t[Fc]={},Object.defineProperties(t,r)}function $7(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Xk(e)?this[Fc][t]=e:this[yl][t]=e},get(){if(this[yl]){if(t in this[yl])return this[yl][t]||this[rh][t];if(t in this[Fc]){const e=this[Ay]&&this[Ay].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[rh][t]}}return this[rh][t]}}}function Ew(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function rL(t,e){return Ew(t,e)&&t[e]}function W7(t){const e=t.componentName;return e||an.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let H7=0;class Tw{constructor(...e){$(this,"id",void 0),$(this,"props",void 0),$(this,"count",void 0),this.props=B7(this,e),this.id=this.props.id,this.count=H7++}clone(e){const{props:n}=this,r={};for(const i in n[rh])i in n[yl]?r[i]=n[yl][i]:i in n[Fc]&&(r[i]=n[Fc][i]);return new this.constructor({...n,...r,...e})}}$(Tw,"componentName","Component");$(Tw,"defaultProps",{});const q7=Object.freeze({});class Z7{constructor(e){$(this,"component",void 0),$(this,"onAsyncPropUpdated",void 0),$(this,"asyncProps",void 0),$(this,"oldProps",void 0),$(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||q7}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Ay]||this.component;const n=e[yl]||{},r=e[Fc]||e,i=e[rh]||{};for(const a in n){const h=n[a];this._createAsyncPropData(a,i[a]),this._updateAsyncProp(a,h),n[a]=this.getAsyncProp(a)}for(const a in r){const h=r[a];this._createAsyncPropData(a,i[a]),this._updateAsyncProp(a,h)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Xk(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(a=>{this.component&&(a=this._postProcessValue(r,a),this._setAsyncPropValue(e,a,i),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let a=[],h=0;for await(const l of n){if(!this.component)return;const{dataTransform:m}=this.component.props;m?a=m(l,a):a=a.concat(l),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:h,endRow:a.length}]}),h=a.length,this._setAsyncPropValue(e,a,i)}this._onResolve(e,a)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Il];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class X7 extends Z7{constructor({attributeManager:e,layer:n}){super(n),$(this,"attributeManager",void 0),$(this,"needsRedraw",void 0),$(this,"needsUpdate",void 0),$(this,"subLayers",void 0),$(this,"usesPickingColorCache",void 0),$(this,"hasPickingBuffer",void 0),$(this,"changeFlags",void 0),$(this,"viewport",void 0),$(this,"uniformTransitions",void 0),$(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const Y7="layer.changeFlag",K7="layer.initialize",J7="layer.update",Q7="layer.finalize",eG="layer.matched",FP=2**24-1,tG=Object.freeze([]),nG=pp(({oldViewport:t,viewport:e})=>t.equals(e));let No=new Uint8ClampedArray(0);const rG={data:{type:"data",value:tG,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:a})=>{const{resourceManager:h}=n.context;if(i=i||n.getLoadOptions(),r=r||n.props.loaders,a){var l;i={...i,fetch:{...(l=i)===null||l===void 0?void 0:l.fetch,signal:a}}}let m=h.contains(t);return!m&&!i&&(h.add({resourceId:t,data:my(t,r),persistent:!1}),m=!0),m?h.subscribe({resourceId:t,onChange:v=>{var E;return(E=n.internalState)===null||E===void 0?void 0:E.reloadAsyncProp(e,v)},consumerId:n.id,requestId:e}):my(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Pn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class za extends Tw{constructor(...e){super(...e),$(this,"internalState",null),$(this,"lifecycle",zu.NO_STATE),$(this,"context",void 0),$(this,"state",void 0),$(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){ai(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=Fk(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,a,h]=Ok(r,n.pixelProjectionMatrix);return e.length===2?[i,a]:[i,a,h]}unproject(e){return ai(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){ai(this.internalState);const r=this.internalState.viewport||this.context.viewport;return ij(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Pn.DEFAULT||e===Pn.LNGLAT||e===Pn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){ai(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:C7(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=k7(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,a=this.internalState.hasPickingBuffer,h=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(a!==h){this.internalState.hasPickingBuffer=h;const{pickingColors:l,instancePickingColors:m}=n.attributes,v=l||m;v&&(h&&v.constant&&(v.constant=!1,n.invalidate(v.id)),!v.value&&!h&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var a,h;(a=this.context)===null||a===void 0||(h=a.onError)===null||h===void 0||h.call(a,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!nG({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(No.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>FP&&an.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),No=Eh.allocate(No,n,{size:3,copy:!0,maxCount:Math.max(n,FP)});const i=Math.floor(No.length/3),a=[];for(let h=r;h<i;h++)this.encodePickingColor(h,a),No[h*3+0]=a[0],No[h*3+1]=a[1],No[h*3+2]=a[2]}e.value=No.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},a=r.getShaderAttributes(n,i);e.setAttributes(a)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,a=r||i,h=a&&n.attributes&&n.attributes[a.id];if(h&&h.value){const l=h.value,m=this.encodePickingColor(e);for(let v=0;v<n.length;v++){const E=a.getVertexOffset(v);l[E]===m[0]&&l[E+1]===m[1]&&l[E+2]===m[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const a=i.getVertexOffset(e),h=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(h-a),offset:a})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==No.buffer&&(r.value=No.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ai(!this.internalState),ai(Number.isFinite(this.props.coordinateSystem)),ki(K7,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new X7({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(an.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new v7(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ki(eG,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ki(J7,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,a=r.viewport,h=this._updateUniformTransition();i.propsInTransition=h,r.viewport=i.viewport||a,this.props=h;try{const l=this._getUpdateParams(),m=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const E of this.props.extensions)E.updateState.call(this,l,E);const v=this.getModels()[0]!==m[0];this._postUpdate(l,v)}finally{r.viewport=a,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){ki(Q7,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,a=this.context;this.props=this.internalState.propsInTransition||i;const h=this.props.opacity;n.opacity=Math.pow(h,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,m=l&&l(n)||[0,0];Ia(a.gl,{polygonOffset:m}),wo(a.gl,r,()=>{const v={moduleParameters:e,uniforms:n,parameters:r,context:a};for(const E of this.props.extensions)E.draw.call(this,v,E);this.draw(v)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let a=!1;switch(i){case"dataChanged":const h=e[i],l=n[i];h&&Array.isArray(l)&&(n.dataChanged=Array.isArray(h)?l.concat(h):h,a=!0);default:n[i]||(n[i]=e[i],a=!0)}a&&ki(Y7,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=b7(e,n);if(r.updateTriggersChanged)for(const a in r.updateTriggersChanged)r.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(r.transitionsChanged)for(const a in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(a,n[a],e[a],(i=e.transitions)===null||i===void 0?void 0:i[a])}return this.setChangeFlags(r)}validateProps(){x7(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new p7(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:a}=this.state;a==null||a.setInstanceCount(this.getNumInstances());const{autoHighlight:h,highlightedObjectIndex:l,highlightColor:m}=r;if(n||i.autoHighlight!==h||i.highlightedObjectIndex!==l||i.highlightColor!==m){const v={};h||(v.pickingSelectedColor=null),Array.isArray(m)&&(v.pickingHighlightColor=m),(n||l!==i.highlightedObjectIndex)&&(v.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(v)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$(za,"defaultProps",rG);$(za,"layerName","Layer");const iG="compositeLayer.renderLayers";class f0 extends za{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var n;const{opacity:r,pickable:i,visible:a,parameters:h,getPolygonOffset:l,highlightedObjectIndex:m,autoHighlight:v,highlightColor:E,coordinateSystem:T,coordinateOrigin:S,wrapLongitude:z,positionFormat:D,modelMatrix:F,extensions:J,fetch:U,operation:V,_subLayerProps:G}=this.props,ee={id:"",updateTriggers:{},opacity:r,pickable:i,visible:a,parameters:h,getPolygonOffset:l,highlightedObjectIndex:m,autoHighlight:v,highlightColor:E,coordinateSystem:T,coordinateOrigin:S,wrapLongitude:z,positionFormat:D,modelMatrix:F,extensions:J,fetch:U,operation:V},se=G&&e.id&&G[e.id],me=se&&se.updateTriggers,ve=e.id||"sublayer";if(se){const Me=this.props[Il],Be=e.type?e.type._propTypes:{};for(const ze in se){const Oe=Be[ze]||Me[ze];Oe&&Oe.type==="accessor"&&(se[ze]=this.getSubLayerAccessor(se[ze]))}}Object.assign(ee,e,se),ee.id="".concat(this.props.id,"-").concat(ve),ee.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...me};for(const Me of J){const Be=Me.getSubLayerProps.call(this,Me);Be&&Object.assign(ee,Be,{updateTriggers:Object.assign(ee.updateTriggers,Be.updateTriggers)})}return ee}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const a=this.renderLayers();r=vw(a,Boolean),this.internalState.subLayers=r}ki(iG,this,i,r);for(const a of r)a.parent=this}}$(f0,"layerName","CompositeLayer");class iL{constructor(e){$(this,"opts",void 0),$(this,"typedArrayManager",void 0),$(this,"indexStarts",[0]),$(this,"vertexStarts",[0]),$(this,"vertexCount",0),$(this,"instanceCount",0),$(this,"attributes",void 0),$(this,"_attributeDefs",void 0),$(this,"data",void 0),$(this,"getGeometry",void 0),$(this,"geometryBuffer",void 0),$(this,"buffers",void 0),$(this,"positionSize",void 0),$(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Eh,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:a,positionFormat:h,dataChanged:l,normalize:m=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=a&&a.size||(h==="XY"?2:3),this.buffers=r,this.normalize=m,a&&(ai(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),m||(r.positions=a)),this.geometryBuffer=r.positions,Array.isArray(l))for(const v of l)this._rebuildGeometry(v);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?Yk(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:a,typedArrayManager:h}=this;for(const l in a)if(l in i)h.release(r[l]),r[l]=null;else{const m=a[l];m.copy=n,r[l]=h.allocate(r[l],e,m)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:a}=this,{iterable:h,objectInfo:l}=vp(i,n,r);for(const m of h){l.index++;const v=a?a(m,l):null;e(v,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:a,geometryBuffer:h}=this,{startRow:l=0,endRow:m=1/0}=e||{},v={};if(e||(n=[0],r=[0]),this.normalize||!h)this._forEachGeometry((T,S)=>{const z=T&&this.normalizeGeometry(T);v[S]=z,r[S+1]=r[S]+(z?this.getGeometrySize(z):0)},l,m),i=r[r.length-1];else if(r=a.startIndices,i=r[a.length]||0,ArrayBuffer.isView(h))i=i||h.length/this.positionSize;else if(h instanceof $n){const T=h.accessor.stride||this.positionSize*4;i=i||h.byteLength/T}else if(h.buffer){const T=h.stride||this.positionSize*4;i=i||h.buffer.byteLength/T}else if(h.value){const T=h.value,S=h.stride/T.BYTES_PER_ELEMENT||this.positionSize;i=i||T.length/S}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const E={};this._forEachGeometry((T,S)=>{const z=v[S]||T;E.vertexStart=r[S],E.indexStart=n[S];const D=S<r.length-1?r[S+1]:i;E.geometrySize=D-r[S],E.geometryIndex=S,this.updateGeometryAttributes(z,E)},l,m),this.vertexCount=n[n.length-1]}}const sG=typeof window<"u"?Pe.useLayoutEffect:Pe.useEffect,oG=sG;function My(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const aG={position:"absolute",zIndex:-1};function sL(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>sL(n,e));if(p0(t)){if(lG(t))return e.style=aG,Pe.cloneElement(t,e);if(cG(t))return Pe.cloneElement(t,e)}return t}function p0(t){return t&&typeof t=="object"&&"type"in t||!1}function lG(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function cG(t){const e=t.type;return e&&e.deckGLViewProps}function D1(t){if(typeof t=="function")return Pe.createElement(Sh,{},t);if(Array.isArray(t))return t.map(D1);if(p0(t)){if(t.type===Pe.Fragment)return D1(t.props.children);if(My(t.type,Sh))return t}return t}function uG({children:t,layers:e=[],views:n=null}){const r=[],i=[],a={};return Pe.Children.forEach(D1(t),h=>{if(p0(h)){const l=h.type;if(My(l,za)){const m=hG(l,h.props);i.push(m)}else r.push(h);if(My(l,Sh)&&l!==Sh&&h.props.id){const m=new l(h.props);a[m.id]=m}}else h&&r.push(h)}),Object.keys(a).length>0&&(Array.isArray(n)?n.forEach(h=>{a[h.id]=h}):n&&(a[n.id]=n),n=Object.values(a)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function hG(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function dG({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},a=r.views[0].id;for(const h of t){let l=a,m=h;p0(h)&&My(h.type,Sh)&&(l=h.props.id||a,m=h.props.children);const v=r.getViewport(l),E=r.getViewState(l);if(v){E.padding=v.padding;const{x:T,y:S,width:z,height:D}=v;m=sL(m,{x:T,y:S,width:z,height:D,viewport:v,viewState:E}),i[l]||(i[l]={viewport:v,children:[]}),i[l].children.push(m)}}return Object.keys(i).map(h=>{const{viewport:l,children:m}=i[h],{x:v,y:E,width:T,height:S}=l,z={position:"absolute",left:v,top:E,width:T,height:S},D="view-".concat(h),F=Pe.createElement("div",{key:D,id:D,style:z},...m);if(n){const J={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:U=>{U.viewId=h,e._onViewStateChange(U)}};return Pe.createElement(n,{key:D,value:J},F)}return F})}const fG={mixBlendMode:null};function pG({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const a in n)a in fG?i[a]=n[a]:r[a]=n[a];return{containerStyle:r,canvasStyle:i}}function mG(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function oL(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function gG(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const a=r.getViewports();t.lastRenderedViewports!==a?t.forceUpdate():oL(t)}});return r}const aL=Pe.forwardRef((t,e)=>{const[n,r]=Pe.useState(0),a=Pe.useRef({control:null,version:n,forceUpdate:()=>r(se=>se+1)}).current,h=Pe.useRef(null),l=Pe.useRef(null),m=Pe.useMemo(()=>uG(t),[t.layers,t.views,t.children]);let v=!0;const E=se=>{var me;return v&&t.viewState?(a.viewStateUpdateRequested=se,null):(a.viewStateUpdateRequested=null,(me=t.onViewStateChange)===null||me===void 0?void 0:me.call(t,se))},T=se=>{if(v)a.interactionStateUpdateRequested=se;else{var me;a.interactionStateUpdateRequested=null,(me=t.onInteractionStateChange)===null||me===void 0||me.call(t,se)}},S=Pe.useMemo(()=>{const se={...t,style:null,width:"100%",height:"100%",parent:h.current,canvas:l.current,layers:m.layers,views:m.views,onViewStateChange:E,onInteractionStateChange:T};return delete se._customRender,a.deck&&a.deck.setProps(se),se},[t]);Pe.useEffect(()=>{const se=t.Deck||d0;return a.deck=gG(a,se,{...S,parent:h.current,canvas:l.current}),()=>{var me;return(me=a.deck)===null||me===void 0?void 0:me.finalize()}},[]),oG(()=>{oL(a);const{viewStateUpdateRequested:se,interactionStateUpdateRequested:me}=a;se&&E(se),me&&T(me)}),Pe.useImperativeHandle(e,()=>mG(a),[]);const z=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:D,width:F,height:J,id:U,style:V}=t,{containerStyle:G,canvasStyle:ee}=Pe.useMemo(()=>pG({width:F,height:J,style:V}),[F,J,V]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===z||a.version!==n){a.lastRenderedViewports=z,a.version=n;const se=dG({children:m.children,deck:a.deck,ContextProvider:D}),me=Pe.createElement("canvas",{key:"canvas",id:U||"deckgl-overlay",ref:l,style:ee});a.control=Pe.createElement("div",{id:"".concat(U||"deckgl","-wrapper"),ref:h,style:G},[me,se])}return v=!1,a.control});aL.defaultProps=d0.defaultProps;const yG=aL,_G=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,vG=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,xG=1024,bG=4,BP=()=>{},NP={10241:9987,10240:9729,10242:33071,10243:33071};function wG(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function EG(t,e,n,r){const i=Math.min(n/e.width,r/e.height),a=Math.floor(e.width*i),h=Math.floor(e.height*i);return i===1?{data:e,width:a,height:h}:(t.canvas.height=h,t.canvas.width=a,t.clearRect(0,0,a,h),t.drawImage(e,0,0,e.width,e.height,0,0,a,h),{data:t.canvas,width:a,height:h})}function jf(t){return t&&(t.id||t.url)}function TG(t,e,n,r){const i=t.width,a=t.height,h=new Ds(t.gl,{width:e,height:n,parameters:r});return rB(t,h,{targetY:0,width:i,height:a}),t.delete(),h}function UP(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:a}=e[r],h=jf(i);t[h]={...i,x:a,y:n}}}function SG({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:a=0,canvasWidth:h}){let l=[];for(let m=0;m<t.length;m++){const v=t[m],E=jf(v);if(!n[E]){const{height:T,width:S}=v;r+S+e>h&&(UP(n,l,i),r=0,i=a+i+e,a=0,l=[]),l.push({icon:v,xOffset:r}),r=r+S+e,a=Math.max(a,T)}}return l.length>0&&UP(n,l,i),{mapping:n,rowHeight:a,xOffset:r,yOffset:i,canvasWidth:h,canvasHeight:wG(a+i+e)}}function PG(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:a}=vp(t);for(const h of i){a.index++;const l=e(h,a),m=jf(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!r[m]&&(!n[m]||l.url!==n[m].url)&&(r[m]={...l,source:h,sourceIndex:a.index})}return r}class AG{constructor(e,{onUpdate:n=BP,onError:r=BP}){$(this,"gl",void 0),$(this,"onUpdate",void 0),$(this,"onError",void 0),$(this,"_loadOptions",null),$(this,"_texture",null),$(this,"_externalTexture",null),$(this,"_mapping",{}),$(this,"_textureParameters",null),$(this,"_pendingCount",0),$(this,"_autoPacking",!1),$(this,"_xOffset",0),$(this,"_yOffset",0),$(this,"_rowHeight",0),$(this,"_buffer",bG),$(this,"_canvasWidth",xG),$(this,"_canvasHeight",0),$(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?jf(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:a}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r){var h;(h=this._texture)===null||h===void 0||h.delete(),this._texture=null,this._externalTexture=r}a&&(this._textureParameters=a)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(PG(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:a,yOffset:h,rowHeight:l,canvasHeight:m}=SG({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=i,this._xOffset=a,this._yOffset=h,this._canvasHeight=m,this._texture||(this._texture=new Ds(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||NP})),this._texture.height!==this._canvasHeight&&(this._texture=TG(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||NP)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,my(r.url,this._loadOptions).then(i=>{const a=jf(r),h=this._mapping[a],{x:l,y:m,width:v,height:E}=h,{data:T,width:S,height:z}=EG(n,i,v,E);this._texture.setSubImageData({data:T,x:l+(v-S)/2,y:m+(E-z)/2,width:S,height:z}),h.width=S,h.height=z,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const lL=[0,0,0,255],CG={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:lL},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class m0 extends za{constructor(...e){super(...e),$(this,"state",void 0)}getShaders(){return super.getShaders({vs:_G,fs:vG,modules:[mp,gp]})}initializeState(){this.state={iconManager:new AG(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:lL},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,a=this.getAttributeManager(),{iconAtlas:h,iconMapping:l,data:m,getIcon:v,textureParameters:E}=n,{iconManager:T}=this.state,S=h||this.internalState.isAsyncPropLoading("iconAtlas");if(T.setProps({loadOptions:n.loadOptions,autoPacking:!S,iconAtlas:h,iconMapping:S?l:null,textureParameters:E}),S?r.iconMapping!==n.iconMapping&&a.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&T.packIcons(m,v),i.extensionsChanged){var z;const{gl:D}=this.context;(z=this.state.model)===null||z===void 0||z.delete(),this.state.model=this._getModel(D),a.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:a,billboard:h,alphaCutoff:l}=this.props,{iconManager:m}=this.state,v=m.getTexture();v&&this.state.model.setUniforms(e).setUniforms({iconsTexture:v,iconsTextureDim:[v.width,v.height],sizeUnits:Rc[a],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:h,alphaCutoff:l}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Dc(e,{...this.getShaders(),id:this.props.id,geometry:new fp({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const r=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;r?r(e):an.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:a=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-a]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:a}=this.state.iconManager.getIconMapping(e);return[n,r,i,a]}}$(m0,"defaultProps",CG);$(m0,"layerName","IconLayer");const IG=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,MG=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,VP=[0,0,0,255],kG={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:VP},getLineColor:{type:"accessor",value:VP},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Sw extends za{getShaders(){return super.getShaders({vs:IG,fs:MG,modules:[mp,gp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:a,stroked:h,filled:l,billboard:m,antialiasing:v,lineWidthUnits:E,lineWidthScale:T,lineWidthMinPixels:S,lineWidthMaxPixels:z}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:h?1:0,filled:l,billboard:m,antialiasing:v,radiusUnits:Rc[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:a,lineWidthUnits:Rc[E],lineWidthScale:T,lineWidthMinPixels:S,lineWidthMaxPixels:z}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Dc(e,{...this.getShaders(),id:this.props.id,geometry:new fp({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}$(Sw,"defaultProps",kG);$(Sw,"layerName","ScatterplotLayer");const cL={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function uL(t,e,n={}){return LG(t,n)!==e?(zG(t,n),!0):!1}function LG(t,e={}){return Math.sign(RG(t,e))}function RG(t,e={}){const{start:n=0,end:r=t.length}=e,i=e.size||2;let a=0;for(let h=n,l=r-i;h<r;h+=i)a+=(t[h]-t[l])*(t[h+1]+t[l+1]),l=h;return a/2}function zG(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,a=(r-n)/i,h=Math.floor(a/2);for(let l=0;l<h;++l){const m=n+l*i,v=n+(a-1-l)*i;for(let E=0;E<i;++E){const T=t[m+E];t[m+E]=t[v+E],t[v+E]=T}}}function _o(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let a=0;a<n;a++)if(t[r-n+a]!==e[a]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function O1(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function Gf(t,e,n,r,i=[]){const a=r+e*n;for(let h=0;h<n;h++)i[h]=t[a+h];return i}function F1(t,e,n,r,i=[]){let a,h;if(n&8)a=(r[3]-t[1])/(e[1]-t[1]),h=3;else if(n&4)a=(r[1]-t[1])/(e[1]-t[1]),h=1;else if(n&2)a=(r[2]-t[0])/(e[0]-t[0]),h=2;else if(n&1)a=(r[0]-t[0])/(e[0]-t[0]),h=0;else return null;for(let l=0;l<t.length;l++)i[l]=(h&1)===l?r[h]:a*(e[l]-t[l])+t[l];return i}function Rg(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function hL(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:a=[0,0],startIndex:h=0,endIndex:l=t.length}=e||{},m=(l-h)/n;let v=[];const E=[v],T=Gf(t,0,n,h);let S,z;const D=fL(T,i,a,[]),F=[];_o(v,T);for(let J=1;J<m;J++){for(S=Gf(t,J,n,h,S),z=Rg(S,D);z;){F1(T,S,z,D,F);const U=Rg(F,D);U&&(F1(T,F,U,D,F),z=U),_o(v,F),O1(T,F),OG(D,i,z),r&&v.length>n&&(v=[],E.push(v),_o(v,T)),z=Rg(S,D)}_o(v,S),O1(T,S)}return r?E:E[0]}const jP=0,DG=1;function eg(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function dL(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:a=[0,0],edgeTypes:h=!1}=n||{},l=[],m=[{pos:t,types:h?new Array(t.length/r).fill(DG):null,holes:e||[]}],v=[[],[]];let E=[];for(;m.length;){const{pos:T,types:S,holes:z}=m.shift();FG(T,r,z[0]||T.length,v),E=fL(v[0],i,a,E);const D=Rg(v[1],E);if(D){let F=GP(T,S,r,0,z[0]||T.length,E,D);const J={pos:F[0].pos,types:F[0].types,holes:[]},U={pos:F[1].pos,types:F[1].types,holes:[]};m.push(J,U);for(let V=0;V<z.length;V++)F=GP(T,S,r,z[V],z[V+1]||T.length,E,D),F[0]&&(J.holes.push(J.pos.length),J.pos=eg(J.pos,F[0].pos),h&&(J.types=eg(J.types,F[0].types))),F[1]&&(U.holes.push(U.pos.length),U.pos=eg(U.pos,F[1].pos),h&&(U.types=eg(U.types,F[1].types)))}else{const F={positions:T};h&&(F.edgeTypes=S),z.length&&(F.holeIndices=z),l.push(F)}}return l}function GP(t,e,n,r,i,a,h){const l=(i-r)/n,m=[],v=[],E=[],T=[],S=[];let z,D,F;const J=Gf(t,l-1,n,r);let U=Math.sign(h&8?J[1]-a[3]:J[0]-a[2]),V=e&&e[l-1],G=0,ee=0;for(let se=0;se<l;se++)z=Gf(t,se,n,r,z),D=Math.sign(h&8?z[1]-a[3]:z[0]-a[2]),F=e&&e[r/n+se],D&&U&&U!==D&&(F1(J,z,h,a,S),_o(m,S)&&E.push(V),_o(v,S)&&T.push(V)),D<=0?(_o(m,z)&&E.push(F),G-=D):E.length&&(E[E.length-1]=jP),D>=0?(_o(v,z)&&T.push(F),ee+=D):T.length&&(T[T.length-1]=jP),O1(J,z),U=D,V=F;return[G?{pos:m,types:e&&E}:null,ee?{pos:v,types:e&&T}:null]}function fL(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],a=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=a,r[2]=i+e,r[3]=a+e,r}function OG(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function FG(t,e,n,r){let i=1/0,a=-1/0,h=1/0,l=-1/0;for(let m=0;m<n;m+=e){const v=t[m],E=t[m+1];i=v<i?v:i,a=v>a?v:a,h=E<h?E:h,l=E>l?E:l}return r[0][0]=i,r[0][1]=h,r[1][0]=a,r[1][1]=l,r}const BG=85.051129;function NG(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:a=!0}=e||{},h=t.slice(r,i);pL(h,n,0,i-r);const l=hL(h,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const m of l)mL(m,n);return l}function UG(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:a=!1}=n||{};e=e||[];const h=[],l=[];let m=0,v=0;for(let T=0;T<=e.length;T++){const S=e[T]||t.length,z=v,D=VG(t,r,m,S);for(let F=D;F<S;F++)h[v++]=t[F];for(let F=m;F<D;F++)h[v++]=t[F];pL(h,r,z,v),jG(h,r,z,v,n==null?void 0:n.maxLatitude),m=S,l[T]=v}l.pop();const E=dL(h,l,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:a});if(i)for(const T of E)mL(T.positions,r);return E}function VG(t,e,n,r){let i=-1,a=-1;for(let h=n+1;h<r;h+=e){const l=Math.abs(t[h]);l>i&&(i=l,a=h-1)}return a}function jG(t,e,n,r,i=BG){const a=t[n],h=t[r-e];if(Math.abs(a-h)>180){const l=Gf(t,0,e,n);l[0]+=Math.round((h-a)/360)*360,_o(t,l),l[1]=Math.sign(l[1])*i,_o(t,l),l[0]=a,_o(t,l)}}function pL(t,e,n,r){let i=t[0],a;for(let h=n;h<r;h+=e){a=t[h];const l=a-i;(l>180||l<-180)&&(a-=Math.round(l/360)*360),t[h]=i=a}}function mL(t,e){let n;const r=t.length/e;for(let a=0;a<r&&(n=t[a*e],(n+180)%360===0);a++);const i=-Math.round(n/360)*360;if(i!==0)for(let a=0;a<r;a++)t[a*e]+=i}function GG(t,e,n,r){let i;if(Array.isArray(t[0])){const a=t.length*e;i=new Array(a);for(let h=0;h<t.length;h++)for(let l=0;l<e;l++)i[h*e+l]=t[h][l]||0}else i=t;return n?hL(i,{size:e,gridResolution:n}):r?NG(i,{size:e}):i}const $G=1,WG=2,Qv=4;class HG extends iL{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?GG(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if($P(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&$P(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:h}=n;r.fill(0,a,a+h),i?(r[a]=Qv,r[a+h-2]=Qv):(r[a]+=$G,r[a+h-2]+=WG),r[a+h-1]=Qv}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:a}=n,h=new Array(3);for(let l=i,m=0;m<a;l++,m++)this.getPointOnPath(e,m,h),r[l*3]=h[0],r[l*3+1]=h[1],r[l*3+2]=h[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const a=n*i;return r[0]=e[a],r[1]=e[a+1],r[2]=i===3&&e[a+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function $P(t){return Array.isArray(t[0])}const qG=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ZG=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,gL=[0,0,0,255],XG={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:gL},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ex={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class g0 extends za{constructor(...e){super(...e),$(this,"state",void 0)}getShaders(){return super.getShaders({vs:qG,fs:ZG,modules:[mp,gp]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:ex,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ex,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:ex,defaultValue:gL},instancePickingColors:{size:3,type:5121,accessor:(r,{index:i,target:a})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,a)}}),this.setState({pathTesselator:new HG({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,m=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:m.getPath,buffers:m,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),r.dataChanged||i.invalidateAll()}if(r.extensionsChanged){var h;const{gl:l}=this.context;(h=this.state.model)===null||h===void 0||h.delete(),this.state.model=this._getModel(l),i.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(a=>a.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:a,widthUnits:h,widthScale:l,widthMinPixels:m,widthMaxPixels:v}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:Rc[h],widthScale:l,miterLimit:a,widthMinPixels:m,widthMaxPixels:v}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Dc(e,{...this.getShaders(),id:this.props.id,geometry:new fp({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}$(g0,"defaultProps",XG);$(g0,"layerName","PathLayer");var Pw={exports:{}};Pw.exports=y0;Pw.exports.default=y0;function y0(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,a=yL(t,0,i,n,!0),h=[];if(!a||a.next===a.prev)return h;var l,m,v,E,T,S,z;if(r&&(a=e$(t,e,a,n)),t.length>80*n){l=v=t[0],m=E=t[1];for(var D=n;D<i;D+=n)T=t[D],S=t[D+1],T<l&&(l=T),S<m&&(m=S),T>v&&(v=T),S>E&&(E=S);z=Math.max(v-l,E-m),z=z!==0?32767/z:0}return $f(a,h,n,l,m,z,0),h}function yL(t,e,n,r,i){var a,h;if(i===U1(t,e,n,r)>0)for(a=e;a<n;a+=r)h=WP(a,t[a],t[a+1],h);else for(a=n-r;a>=e;a-=r)h=WP(a,t[a],t[a+1],h);return h&&_0(h,h.next)&&(Hf(h),h=h.next),h}function Bc(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(_0(n,n.next)||br(n.prev,n,n.next)===0)){if(Hf(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function $f(t,e,n,r,i,a,h){if(t){!h&&a&&s$(t,r,i,a);for(var l=t,m,v;t.prev!==t.next;){if(m=t.prev,v=t.next,a?KG(t,r,i,a):YG(t)){e.push(m.i/n|0),e.push(t.i/n|0),e.push(v.i/n|0),Hf(t),t=v.next,l=v.next;continue}if(t=v,t===l){h?h===1?(t=JG(Bc(t),e,n),$f(t,e,n,r,i,a,2)):h===2&&QG(t,e,n,r,i,a):$f(Bc(t),e,n,r,i,a,1);break}}}}function YG(t){var e=t.prev,n=t,r=t.next;if(br(e,n,r)>=0)return!1;for(var i=e.x,a=n.x,h=r.x,l=e.y,m=n.y,v=r.y,E=i<a?i<h?i:h:a<h?a:h,T=l<m?l<v?l:v:m<v?m:v,S=i>a?i>h?i:h:a>h?a:h,z=l>m?l>v?l:v:m>v?m:v,D=r.next;D!==e;){if(D.x>=E&&D.x<=S&&D.y>=T&&D.y<=z&&Xu(i,l,a,m,h,v,D.x,D.y)&&br(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function KG(t,e,n,r){var i=t.prev,a=t,h=t.next;if(br(i,a,h)>=0)return!1;for(var l=i.x,m=a.x,v=h.x,E=i.y,T=a.y,S=h.y,z=l<m?l<v?l:v:m<v?m:v,D=E<T?E<S?E:S:T<S?T:S,F=l>m?l>v?l:v:m>v?m:v,J=E>T?E>S?E:S:T>S?T:S,U=B1(z,D,e,n,r),V=B1(F,J,e,n,r),G=t.prevZ,ee=t.nextZ;G&&G.z>=U&&ee&&ee.z<=V;){if(G.x>=z&&G.x<=F&&G.y>=D&&G.y<=J&&G!==i&&G!==h&&Xu(l,E,m,T,v,S,G.x,G.y)&&br(G.prev,G,G.next)>=0||(G=G.prevZ,ee.x>=z&&ee.x<=F&&ee.y>=D&&ee.y<=J&&ee!==i&&ee!==h&&Xu(l,E,m,T,v,S,ee.x,ee.y)&&br(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;G&&G.z>=U;){if(G.x>=z&&G.x<=F&&G.y>=D&&G.y<=J&&G!==i&&G!==h&&Xu(l,E,m,T,v,S,G.x,G.y)&&br(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;ee&&ee.z<=V;){if(ee.x>=z&&ee.x<=F&&ee.y>=D&&ee.y<=J&&ee!==i&&ee!==h&&Xu(l,E,m,T,v,S,ee.x,ee.y)&&br(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function JG(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!_0(i,a)&&_L(i,r,r.next,a)&&Wf(i,a)&&Wf(a,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(a.i/n|0),Hf(r),Hf(r.next),r=t=a),r=r.next}while(r!==t);return Bc(r)}function QG(t,e,n,r,i,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&l$(h,l)){var m=vL(h,l);h=Bc(h,h.next),m=Bc(m,m.next),$f(h,e,n,r,i,a,0),$f(m,e,n,r,i,a,0);return}l=l.next}h=h.next}while(h!==t)}function e$(t,e,n,r){var i=[],a,h,l,m,v;for(a=0,h=e.length;a<h;a++)l=e[a]*r,m=a<h-1?e[a+1]*r:t.length,v=yL(t,l,m,r,!1),v===v.next&&(v.steiner=!0),i.push(a$(v));for(i.sort(t$),a=0;a<i.length;a++)n=n$(i[a],n);return n}function t$(t,e){return t.x-e.x}function n$(t,e){var n=r$(t,e);if(!n)return e;var r=vL(n,t);return Bc(r,r.next),Bc(n,n.next)}function r$(t,e){var n=e,r=t.x,i=t.y,a=-1/0,h;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var l=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(l<=r&&l>a&&(a=l,h=n.x<n.next.x?n:n.next,l===r))return h}n=n.next}while(n!==e);if(!h)return null;var m=h,v=h.x,E=h.y,T=1/0,S;n=h;do r>=n.x&&n.x>=v&&r!==n.x&&Xu(i<E?r:a,i,v,E,i<E?a:r,i,n.x,n.y)&&(S=Math.abs(i-n.y)/(r-n.x),Wf(n,t)&&(S<T||S===T&&(n.x>h.x||n.x===h.x&&i$(h,n)))&&(h=n,T=S)),n=n.next;while(n!==m);return h}function i$(t,e){return br(t.prev,t,e.prev)<0&&br(e.next,t,t.next)<0}function s$(t,e,n,r){var i=t;do i.z===0&&(i.z=B1(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,o$(i)}function o$(t){var e,n,r,i,a,h,l,m,v=1;do{for(n=t,t=null,a=null,h=0;n;){for(h++,r=n,l=0,e=0;e<v&&(l++,r=r.nextZ,!!r);e++);for(m=v;l>0||m>0&&r;)l!==0&&(m===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,m--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;n=r}a.nextZ=null,v*=2}while(h>1);return t}function B1(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function a$(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Xu(t,e,n,r,i,a,h,l){return(i-h)*(e-l)>=(t-h)*(a-l)&&(t-h)*(r-l)>=(n-h)*(e-l)&&(n-h)*(a-l)>=(i-h)*(r-l)}function l$(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!c$(t,e)&&(Wf(t,e)&&Wf(e,t)&&u$(t,e)&&(br(t.prev,t,e.prev)||br(t,e.prev,e))||_0(t,e)&&br(t.prev,t,t.next)>0&&br(e.prev,e,e.next)>0)}function br(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function _0(t,e){return t.x===e.x&&t.y===e.y}function _L(t,e,n,r){var i=ng(br(t,e,n)),a=ng(br(t,e,r)),h=ng(br(n,r,t)),l=ng(br(n,r,e));return!!(i!==a&&h!==l||i===0&&tg(t,n,e)||a===0&&tg(t,r,e)||h===0&&tg(n,t,r)||l===0&&tg(n,e,r))}function tg(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ng(t){return t>0?1:t<0?-1:0}function c$(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&_L(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Wf(t,e){return br(t.prev,t,t.next)<0?br(t,e,t.next)>=0&&br(t,t.prev,e)>=0:br(t,e,t.prev)<0||br(t,t.next,e)<0}function u$(t,e){var n=t,r=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function vL(t,e){var n=new N1(t.i,t.x,t.y),r=new N1(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function WP(t,e,n,r){var i=new N1(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Hf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function N1(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}y0.deviation=function(t,e,n,r){var i=e&&e.length,a=i?e[0]*n:t.length,h=Math.abs(U1(t,0,a,n));if(i)for(var l=0,m=e.length;l<m;l++){var v=e[l]*n,E=l<m-1?e[l+1]*n:t.length;h-=Math.abs(U1(t,v,E,n))}var T=0;for(l=0;l<r.length;l+=3){var S=r[l]*n,z=r[l+1]*n,D=r[l+2]*n;T+=Math.abs((t[S]-t[D])*(t[z+1]-t[S+1])-(t[S]-t[z])*(t[D+1]-t[S+1]))}return h===0&&T===0?0:Math.abs((T-h)/h)};function U1(t,e,n,r){for(var i=0,a=e,h=n-r;a<n;a+=r)i+=(t[h]-t[a])*(t[a+1]+t[h+1]),h=a;return i}y0.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var h=0;h<e;h++)n.vertices.push(t[i][a][h]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var h$=Pw.exports;const d$=$y(h$),rg=cL.CLOCKWISE,HP=cL.COUNTER_CLOCKWISE,_l={isClosed:!0};function f$(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ef(t){return"positions"in t?t.positions:t}function zg(t){return"holeIndices"in t?t.holeIndices:null}function p$(t){return Array.isArray(t[0])}function m$(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function g$(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function y$(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function qP(t,e,n,r,i){let a=e;const h=n.length;for(let l=0;l<h;l++)for(let m=0;m<r;m++)t[a++]=n[l][m]||0;if(!g$(n))for(let l=0;l<r;l++)t[a++]=n[0][l]||0;return _l.start=e,_l.end=a,_l.size=r,uL(t,i,_l),a}function ZP(t,e,n,r,i=0,a,h){a=a||n.length;const l=a-i;if(l<=0)return e;let m=e;for(let v=0;v<l;v++)t[m++]=n[i+v];if(!y$(n,r,i,a))for(let v=0;v<r;v++)t[m++]=n[i+v];return _l.start=e,_l.end=m,_l.size=r,uL(t,h,_l),m}function xL(t,e){f$(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:a}=t;if(a){let h=0;for(let l=0;l<=a.length;l++)h=ZP(n,h,i,e,a[l-1],a[l],l===0?rg:HP),r.push(h);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!p$(t))return ZP(n,0,t,e,0,n.length,rg),n;if(!m$(t)){let i=0;for(const[a,h]of t.entries())i=qP(n,i,h,e,a===0?rg:HP),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return qP(n,0,t,e,rg),n}function tx(t,e,n){const r=t.length/3;let i=0;for(let a=0;a<r;a++){const h=(a+1)%r;i+=t[a*3+e]*t[h*3+n],i-=t[h*3+e]*t[a*3+n]}return Math.abs(i/2)}function XP(t,e,n,r){const i=t.length/3;for(let a=0;a<i;a++){const h=a*3,l=t[h+0],m=t[h+1],v=t[h+2];t[h+e]=l,t[h+n]=m,t[h+r]=v}}function _$(t,e,n,r){let i=zg(t);i&&(i=i.map(l=>l/e));let a=ef(t);const h=r&&e===3;if(n){const l=a.length;a=a.slice();const m=[];for(let v=0;v<l;v+=e){m[0]=a[v],m[1]=a[v+1],h&&(m[2]=a[v+2]);const E=n(m);a[v]=E[0],a[v+1]=E[1],h&&(a[v+2]=E[2])}}if(h){const l=tx(a,0,1),m=tx(a,0,2),v=tx(a,1,2);if(!l&&!m&&!v)return[];l>m&&l>v||(m>v?(n||(a=a.slice()),XP(a,0,2,1)):(n||(a=a.slice()),XP(a,2,0,1)))}return d$(a,i,e)}class v$ extends iL{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=xL(e,this.positionSize);return this.opts.resolution?dL(ef(n),zg(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?UG(ef(n),zg(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(YP(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return ef(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&YP(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:a,indexStarts:h,typedArrayManager:l}=this;let m=a.indices;if(!m||!e)return;let v=i;const E=_$(e,this.positionSize,this.opts.preproject,this.opts.full3d);m=l.allocate(m,i+E.length,{copy:!0});for(let T=0;T<E.length;T++)m[v++]=E[T]+r;h[n+1]=i+E.length,a.indices=m}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:a}=this;if(!i||!e)return;const h=ef(e);for(let l=n,m=0;m<r;l++,m++){const v=h[m*a],E=h[m*a+1],T=a>2?h[m*a+2]:0;i[l*3]=v,i[l*3+1]=E,i[l*3+2]=T}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,a=this.attributes.vertexValid,h=e&&zg(e);if(e&&e.edgeTypes?a.set(e.edgeTypes,n):a.fill(1,n,n+r),h)for(let l=0;l<h.length;l++)a[n+h[l]/i-1]=0;a[n+r-1]=0}}function YP(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const bL=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,x$=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(bL,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),b$=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(bL,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),w$=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ky=[0,0,0,255],E$={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ky},getLineColor:{type:"accessor",value:ky},material:!0},ig={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class v0 extends za{constructor(...e){super(...e),$(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?x$:b$,fs:w$,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[mp,AU,gp]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:i}=this.props;n.isGeospatial&&r===Pn.DEFAULT&&(r=Pn.LNGLAT);let a;r===Pn.LNGLAT&&(i?a=n.projectPosition.bind(n):a=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new v$({preproject:a,fp64:this.use64bitPositions(),IndexType:!e||lw(e,cr.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const h=this.getAttributeManager(),l=!0;h.remove(["instancePickingColors"]),h.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ig,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:ig,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ig,accessor:"getFillColor",defaultValue:ky,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ig,accessor:"getLineColor",defaultValue:ky,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(m,{index:v,target:E})=>this.encodePickingColor(m&&m.__source?m.__source.index:v,E),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(a=>a.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:a}=this.props,{topModel:h,sideModel:l,polygonTesselator:m}=this.state,v={...e,extruded:!!n,elevationScale:a};l&&(l.setInstanceCount(m.instanceCount-1),l.setUniforms(v),i&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),r&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),h&&(h.setVertexCount(m.vertexCount),h.setUniforms(v).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,a=this.getAttributeManager();if(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded){var l;(l=this.state.models)===null||l===void 0||l.forEach(m=>m.delete()),this.setState(this._getModels(this.context.gl)),a.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:a}=this.state,h=e.data.attributes||{};a.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:h.getPolygon,buffers:h,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:r,extruded:i}=this.props;let a,h;if(r){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,a=new Dc(e,{...l,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(h=new Dc(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new fp({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),h.userData.excludeAttributes={indices:!0}),{models:[h,a].filter(Boolean),topModel:a,sideModel:h}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}$(v0,"defaultProps",E$);$(v0,"layerName","SolidPolygonLayer");function wL({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:a=1/0}=n,h=t.length;let l=h,m=h;for(let S=0;S<h;S++){const z=e(t[S]);if(l>S&&z>=i&&(l=S),z>=a){m=S;break}}let v=l;const T=m-l!==r.length?t.slice(m):void 0;for(let S=0;S<r.length;S++)t[v++]=r[S];if(T){for(let S=0;S<T.length;S++)t[v++]=T[S];t.length=v}return{startRow:l,endRow:l+r.length}}const EL=[0,0,0,255],T$=[0,0,0,255],S$={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:T$},getLineColor:{type:"accessor",value:EL},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Aw extends f0{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&an.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),i=e.dataChanged.map(a=>wL({data:r,getIndex:h=>h.__source.index,dataRange:a,replace:this._getPaths(a)}));this.setState({paths:r,pathsDiff:i})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:r,positionFormat:i,_normalize:a}=this.props,h=[],l=i==="XY"?2:3,{startRow:m,endRow:v}=e,{iterable:E,objectInfo:T}=vp(n,m,v);for(const S of E){T.index++;let z=r(S,T);a&&(z=xL(z,l));const{holeIndices:D}=z,F=z.positions||z;if(D)for(let J=0;J<=D.length;J++){const U=F.slice(D[J-1]||0,D[J]||F.length);h.push(this.getSubLayerRow({path:U},S,T.index))}else h.push(this.getSubLayerRow({path:F},S,T.index))}return h}renderLayers(){const{data:e,_dataDiff:n,stroked:r,filled:i,extruded:a,wireframe:h,_normalize:l,_windingOrder:m,elevationScale:v,transitions:E,positionFormat:T}=this.props,{lineWidthUnits:S,lineWidthScale:z,lineWidthMinPixels:D,lineWidthMaxPixels:F,lineJointRounded:J,lineMiterLimit:U,lineDashJustified:V}=this.props,{getFillColor:G,getLineColor:ee,getLineWidth:se,getLineDashArray:me,getElevation:ve,getPolygon:Me,updateTriggers:Be,material:ze}=this.props,{paths:Oe,pathsDiff:tt}=this.state,et=this.getSubLayerClass("fill",v0),st=this.getSubLayerClass("stroke",g0),Bt=this.shouldRenderSubLayer("fill",Oe)&&new et({_dataDiff:n,extruded:a,elevationScale:v,filled:i,wireframe:h,_normalize:l,_windingOrder:m,getElevation:ve,getFillColor:G,getLineColor:a&&h?ee:EL,material:ze,transitions:E},this.getSubLayerProps({id:"fill",updateTriggers:Be&&{getPolygon:Be.getPolygon,getElevation:Be.getElevation,getFillColor:Be.getFillColor,lineColors:a&&h,getLineColor:Be.getLineColor}}),{data:e,positionFormat:T,getPolygon:Me}),Je=!a&&r&&this.shouldRenderSubLayer("stroke",Oe)&&new st({_dataDiff:tt&&(()=>tt),widthUnits:S,widthScale:z,widthMinPixels:D,widthMaxPixels:F,jointRounded:J,miterLimit:U,dashJustified:V,_pathType:"loop",transitions:E&&{getWidth:E.getLineWidth,getColor:E.getLineColor,getPath:E.getPolygon},getColor:this.getSubLayerAccessor(ee),getWidth:this.getSubLayerAccessor(se),getDashArray:this.getSubLayerAccessor(me)},this.getSubLayerProps({id:"stroke",updateTriggers:Be&&{getWidth:Be.getLineWidth,getColor:Be.getLineColor,getDashArray:Be.getLineDashArray}}),{data:Oe,positionFormat:T,getPath:en=>en.path});return[!a&&Bt,Je,a&&Bt]}}$(Aw,"layerName","PolygonLayer");$(Aw,"defaultProps",S$);function P$(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?A$(t,r,n):null}function A$(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function C$(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*3);const a=[];for(let h=0;h<i.length;h++)e(i[h],a),n[r][h*3+0]=a[0],n[r][h*3+1]=a[1],n[r][h*3+2]=a[2]}return n}const I$=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,nx=192/256,KP=[],M$={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Cw extends m0{constructor(...e){super(...e),$(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:I$}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(a=>a/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&an.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:a}=this.state,h=i?Math.max(r,nx*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:nx,outlineBuffer:h,gamma:r,sdf:!!n,outlineColor:a},super.draw(e),n&&i){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:nx}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):KP}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):KP}}$(Cw,"defaultProps",M$);$(Cw,"layerName","MultiIconLayer");const gf=1e20;class k${constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:h="normal",fontStyle:l="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const m=this.size=e+n*4,v=this._createCanvas(m),E=this.ctx=v.getContext("2d",{willReadFrequently:!0});E.font=`${l} ${h} ${e}px ${a}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:h}=this.ctx.measureText(e),l=Math.ceil(r),m=0,v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-a))),E=Math.min(this.size-this.buffer,l+Math.ceil(i)),T=v+2*this.buffer,S=E+2*this.buffer,z=Math.max(T*S,0),D=new Uint8ClampedArray(z),F={data:D,width:T,height:S,glyphWidth:v,glyphHeight:E,glyphTop:l,glyphLeft:m,glyphAdvance:n};if(v===0||E===0)return F;const{ctx:J,buffer:U,gridInner:V,gridOuter:G}=this;J.clearRect(U,U,v,E),J.fillText(e,U,U+l);const ee=J.getImageData(U,U,v,E);G.fill(gf,0,z),V.fill(0,0,z);for(let se=0;se<E;se++)for(let me=0;me<v;me++){const ve=ee.data[4*(se*v+me)+3]/255;if(ve===0)continue;const Me=(se+U)*T+me+U;if(ve===1)G[Me]=0,V[Me]=gf;else{const Be=.5-ve;G[Me]=Be>0?Be*Be:0,V[Me]=Be<0?Be*Be:0}}JP(G,0,0,T,S,T,this.f,this.v,this.z),JP(V,U,U,v,E,T,this.f,this.v,this.z);for(let se=0;se<z;se++){const me=Math.sqrt(G[se])-Math.sqrt(V[se]);D[se]=Math.round(255-255*(me/this.radius+this.cutoff))}return F}}function JP(t,e,n,r,i,a,h,l,m){for(let v=e;v<e+r;v++)QP(t,n*a+v,a,i,h,l,m);for(let v=n;v<n+i;v++)QP(t,v*a+e,1,r,h,l,m)}function QP(t,e,n,r,i,a,h){a[0]=0,h[0]=-gf,h[1]=gf,i[0]=t[e];for(let l=1,m=0,v=0;l<r;l++){i[l]=t[e+l*n];const E=l*l;do{const T=a[m];v=(i[l]-i[T]+E-T*T)/(l-T)/2}while(v<=h[m]&&--m>-1);m++,a[m]=l,h[m]=v,h[m+1]=gf}for(let l=0,m=0;l<r;l++){for(;h[m+1]<l;)m++;const v=a[m],E=l-v;t[e+l*n]=i[v]+E*E}}const L$=32,R$=[];function z$(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function D$({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:a={},xOffset:h=0,yOffset:l=0}){let m=0,v=h;const E=n+r*2;for(const T of t)if(!a[T]){const S=e(T);v+S+r*2>i&&(v=0,m++),a[T]={x:v+r,y:l+m*E+r,width:S,height:E,layoutWidth:S,layoutHeight:n},v+=S+r*2}return{mapping:a,xOffset:v,yOffset:l+m*E,canvasHeight:z$(l+(m+1)*E)}}function TL(t,e,n,r){let i=0;for(let h=e;h<n;h++){var a;const l=t[h];i+=((a=r[l])===null||a===void 0?void 0:a.layoutWidth)||0}return i}function SL(t,e,n,r,i,a){let h=e,l=0;for(let m=e;m<n;m++){const v=TL(t,m,m+1,i);l+v>r&&(h<m&&a.push(m),h=m,l=0),l+=v}return l}function O$(t,e,n,r,i,a){let h=e,l=e,m=e,v=0;for(let E=e;E<n;E++)if((t[E]===" "||t[E+1]===" "||E+1===n)&&(m=E+1),m>l){let T=TL(t,l,m,i);v+T>r&&(h<l&&(a.push(l),h=l,v=0),T>r&&(T=SL(t,l,m,r,i,a),h=a[a.length-1])),l=m,v+=T}return v}function F$(t,e,n,r,i=0,a){a===void 0&&(a=t.length);const h=[];return e==="break-all"?SL(t,i,a,n,r,h):O$(t,i,a,n,r,h),h}function B$(t,e,n,r,i,a){let h=0,l=0;for(let m=e;m<n;m++){const v=t[m],E=r[v];E?(l||(l=E.layoutHeight),i[m]=h+E.layoutWidth/2,h+=E.layoutWidth):(an.warn("Missing character: ".concat(v," (").concat(v.codePointAt(0),")"))(),i[m]=h,h+=L$)}a[0]=h,a[1]=l}function N$(t,e,n,r,i){const a=Array.from(t),h=a.length,l=new Array(h),m=new Array(h),v=new Array(h),E=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,T=[0,0],S=[0,0];let z=0,D=0,F=0;for(let U=0;U<=h;U++){const V=a[U];if((V===`
`||U===h)&&(F=U),F>D){const G=E?F$(a,n,r,i,D,F):R$;for(let ee=0;ee<=G.length;ee++){const se=ee===0?D:G[ee-1],me=ee<G.length?G[ee]:F;B$(a,se,me,i,l,S);for(let ve=se;ve<me;ve++){var J;const Me=a[ve],Be=((J=i[Me])===null||J===void 0?void 0:J.layoutOffsetY)||0;m[ve]=z+S[1]/2+Be,v[ve]=S[0]}z=z+S[1]*e,T[0]=Math.max(T[0],S[0])}D=F}V===`
`&&(l[D]=0,m[D]=0,v[D]=0,D++)}return T[1]=z,{x:l,y:m,rowWidth:v,size:T}}function U$({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:a}){const h=t.BYTES_PER_ELEMENT,l=n?n/h:1,m=r?r/h:0,v=i[e]||Math.ceil((t.length-m)/l),E=a&&new Set,T=new Array(e);let S=t;if(l>1||m>0){const z=t.constructor;S=new z(v);for(let D=0;D<v;D++)S[D]=t[D*l+m]}for(let z=0;z<e;z++){const D=i[z],F=i[z+1]||v,J=S.subarray(D,F);T[z]=String.fromCodePoint.apply(null,J),E&&J.forEach(E.add,E)}if(E)for(const z of E)a.add(String.fromCodePoint(z));return{texts:T,characterCount:v}}class PL{constructor(e=5){$(this,"limit",void 0),$(this,"_cache",{}),$(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function V$(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const ih={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:V$(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},eA=1024,tA=.9,nA=1.2,AL=3;let Ly=new PL(AL);function j$(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=Ly.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function G$(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function rA(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function $$(t){an.assert(Number.isFinite(t)&&t>=AL,"Invalid cache limit"),Ly=new PL(t)}class W${constructor(){$(this,"props",{...ih}),$(this,"_key",void 0),$(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*nA+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=j$(this._key,this.props.characterSet),r=Ly.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,Ly.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:a,buffer:h,sdf:l,radius:m,cutoff:v}=this.props;let E=n&&n.data;E||(E=document.createElement("canvas"),E.width=eA);const T=E.getContext("2d",{willReadFrequently:!0});rA(T,r,a,i);const{mapping:S,canvasHeight:z,xOffset:D,yOffset:F}=D$({getFontWidth:J=>T.measureText(J).width,fontHeight:a*nA,buffer:h,characterSet:e,maxCanvasWidth:eA,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(E.height!==z){const J=T.getImageData(0,0,E.width,E.height);E.height=z,T.putImageData(J,0,0)}if(rA(T,r,a,i),l){const J=new k$({fontSize:a,buffer:h,radius:m,cutoff:v,fontFamily:r,fontWeight:"".concat(i)});for(const U of e){const{data:V,width:G,height:ee,glyphTop:se}=J.draw(U);S[U].width=G,S[U].layoutOffsetY=a*tA-se;const me=T.createImageData(G,ee);G$(V,me),T.putImageData(me,S[U].x,S[U].y)}}else for(const J of e)T.fillText(J,S[J].x,S[J].y+h+a*tA);return{xOffset:D,yOffset:F,mapping:S,data:E,width:E.width,height:E.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:a,radius:h,cutoff:l}=this.props;return a?"".concat(e," ").concat(n," ").concat(r," ").concat(i," ").concat(h," ").concat(l):"".concat(e," ").concat(n," ").concat(r," ").concat(i)}}const H$=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,q$=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Z$={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Iw extends za{constructor(...e){super(...e),$(this,"state",void 0)}getShaders(){return super.getShaders({vs:H$,fs:q$,modules:[mp,gp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var r;const{gl:i}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:a,sizeMaxPixels:h,getLineWidth:l}=this.props;let{padding:m}=this.props;m.length<4&&(m=[m[0],m[1],m[0],m[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!l,padding:m,sizeUnits:Rc[i],sizeScale:r,sizeMinPixels:a,sizeMaxPixels:h}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Dc(e,{...this.getShaders(),id:this.props.id,geometry:new fp({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}$(Iw,"defaultProps",Z$);$(Iw,"layerName","TextBackgroundLayer");const iA={start:1,middle:0,end:-1},sA={top:1,center:0,bottom:-1},rx=[0,0,0,255],X$=1,Y$={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:rx},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:ih.characterSet},fontFamily:ih.fontFamily,fontWeight:ih.fontWeight,lineHeight:X$,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:rx},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:rx},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Mw extends f0{constructor(...e){super(...e),$(this,"state",void 0),$(this,"getBoundingRect",(n,r)=>{let{size:[i,a]}=this.transformParagraph(n,r);const{fontSize:h}=this.state.fontAtlasManager.props;i/=h,a/=h;const{getTextAnchor:l,getAlignmentBaseline:m}=this.props,v=iA[typeof l=="function"?l(n,r):l],E=sA[typeof m=="function"?m(n,r):m];return[(v-1)*i/2,(E-1)*a/2,i,a]}),$(this,"getIconOffsets",(n,r)=>{const{getTextAnchor:i,getAlignmentBaseline:a}=this.props,{x:h,y:l,rowWidth:m,size:[v,E]}=this.transformParagraph(n,r),T=iA[typeof i=="function"?i(n,r):i],S=sA[typeof a=="function"?a(n,r):a],z=h.length,D=new Array(z*2);let F=0;for(let J=0;J<z;J++){const U=(1-T)*(v-m[J])/2;D[F++]=(T-1)*v/2+U+h[J],D[F++]=(S-1)*E/2+l[J]}return D})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new W$},this.props.maxWidth>0&&an.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:a}=this.state,h={...e,characterSet:a,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(h),!0;for(const l in h)if(h[l]!==i.props[l])return i.setProps(h),!0;return!1}_updateText(){var e;const{data:n,characterSet:r}=this.props,i=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:a}=this.props,h=n.startIndices,l;const m=r==="auto"&&new Set;if(i&&h){const{texts:v,characterCount:E}=U$({...ArrayBuffer.isView(i)?{value:i}:i,length:n.length,startIndices:h,characterSet:m});l=E,a=(T,{index:S})=>v[S]}else{const{iterable:v,objectInfo:E}=vp(n);h=[0],l=0;for(const T of v){E.index++;const S=Array.from(a(T,E)||"");m&&S.forEach(m.add,m),l+=S.length,h.push(l)}}this.setState({getText:a,startIndices:h,numInstances:l,characterSet:m||r})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,a=this.state.getText,{wordBreak:h,lineHeight:l,maxWidth:m}=this.props,v=a(e,n)||"";return N$(v,l,h,m*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,texture:a,mapping:h},styleVersion:l}=this.state,{data:m,_dataDiff:v,getPosition:E,getColor:T,getSize:S,getAngle:z,getPixelOffset:D,getBackgroundColor:F,getBorderColor:J,getBorderWidth:U,backgroundPadding:V,background:G,billboard:ee,fontSettings:se,outlineWidth:me,outlineColor:ve,sizeScale:Me,sizeUnits:Be,sizeMinPixels:ze,sizeMaxPixels:Oe,transitions:tt,updateTriggers:et}=this.props,st=this.getSubLayerClass("characters",Cw),Bt=this.getSubLayerClass("background",Iw);return[G&&new Bt({getFillColor:F,getLineColor:J,getLineWidth:U,padding:V,getPosition:E,getSize:S,getAngle:z,getPixelOffset:D,billboard:ee,sizeScale:Me,sizeUnits:Be,sizeMinPixels:ze,sizeMaxPixels:Oe,transitions:tt&&{getPosition:tt.getPosition,getAngle:tt.getAngle,getSize:tt.getSize,getFillColor:tt.getBackgroundColor,getLineColor:tt.getBorderColor,getLineWidth:tt.getBorderWidth,getPixelOffset:tt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:et.getPosition,getAngle:et.getAngle,getSize:et.getSize,getFillColor:et.getBackgroundColor,getLineColor:et.getBorderColor,getLineWidth:et.getBorderWidth,getPixelOffset:et.getPixelOffset,getBoundingRect:{getText:et.getText,getTextAnchor:et.getTextAnchor,getAlignmentBaseline:et.getAlignmentBaseline,styleVersion:l}}}),{data:m.attributes&&m.attributes.background?{length:m.length,attributes:m.attributes.background}:m,_dataDiff:v,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new st({sdf:se.sdf,smoothing:Number.isFinite(se.smoothing)?se.smoothing:ih.smoothing,outlineWidth:me/(se.radius||ih.radius),outlineColor:ve,iconAtlas:a,iconMapping:h,getPosition:E,getColor:T,getSize:S,getAngle:z,getPixelOffset:D,billboard:ee,sizeScale:Me*i,sizeUnits:Be,sizeMinPixels:ze*i,sizeMaxPixels:Oe*i,transitions:tt&&{getPosition:tt.getPosition,getAngle:tt.getAngle,getColor:tt.getColor,getSize:tt.getSize,getPixelOffset:tt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:et.getText,getPosition:et.getPosition,getAngle:et.getAngle,getColor:et.getColor,getSize:et.getSize,getPixelOffset:et.getPixelOffset,getIconOffsets:{getTextAnchor:et.getTextAnchor,getAlignmentBaseline:et.getAlignmentBaseline,styleVersion:l}}}),{data:m,_dataDiff:v,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){$$(e)}}$(Mw,"defaultProps",Y$);$(Mw,"layerName","TextLayer");const Dg={circle:{type:Sw,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:m0,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Mw,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Og={type:g0,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},V1={type:v0,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function jd({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function ix(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const a in e){const h=e[a];let l=t.props[a];a.startsWith("get")&&(l=t.getSubLayerAccessor(l),i.updateTriggers[h]=r[a],n&&(i.transitions[h]=n[a])),i[h]=l}return i}function K$(t){if(Array.isArray(t))return t;switch(an.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return an.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function oA(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:a=t.length}=n;for(let h=i;h<a;h++){const l=t[h],{geometry:m}=l;if(m)if(m.type==="GeometryCollection"){an.assert(Array.isArray(m.geometries),"GeoJSON does not have geometries array");const{geometries:v}=m;for(let E=0;E<v.length;E++){const T=v[E];aA(T,r,e,l,h)}}else aA(m,r,e,l,h)}return r}function aA(t,e,n,r,i){const{type:a,coordinates:h}=t,{pointFeatures:l,lineFeatures:m,polygonFeatures:v,polygonOutlineFeatures:E}=e;if(!Q$(a,h)){an.warn("".concat(a," coordinates are malformed"))();return}switch(a){case"Point":l.push(n({geometry:t},r,i));break;case"MultiPoint":h.forEach(T=>{l.push(n({geometry:{type:"Point",coordinates:T}},r,i))});break;case"LineString":m.push(n({geometry:t},r,i));break;case"MultiLineString":h.forEach(T=>{m.push(n({geometry:{type:"LineString",coordinates:T}},r,i))});break;case"Polygon":v.push(n({geometry:t},r,i)),h.forEach(T=>{E.push(n({geometry:{type:"LineString",coordinates:T}},r,i))});break;case"MultiPolygon":h.forEach(T=>{v.push(n({geometry:{type:"Polygon",coordinates:T}},r,i)),T.forEach(S=>{E.push(n({geometry:{type:"LineString",coordinates:S}},r,i))})});break}}const J$={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Q$(t,e){let n=J$[t];for(an.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function CL(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function sg(t){return t.geometry.coordinates}function eW(t,e){const n=CL(),{pointFeatures:r,lineFeatures:i,polygonFeatures:a,polygonOutlineFeatures:h}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=sg,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=sg,n.polygons.data=a,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=sg,n.polygonsOutline.data=h,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=sg,n}function tW(t,e){const n=CL(),{points:r,lines:i,polygons:a}=t,h=C$(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:h.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:h.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:{...a.attributes,getPolygon:a.positions,pickingColors:{size:3,value:h.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},n.polygons._normalize=!1,a.triangles&&(n.polygons.data.attributes.indices=a.triangles.value),n.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:{...a.attributes,getPath:a.positions,instancePickingColors:{size:3,value:h.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},n.polygonsOutline._pathType="open",n}const nW=["points","linestrings","polygons"],rW={...jd(Dg.circle),...jd(Dg.icon),...jd(Dg.text),...jd(Og),...jd(V1),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class kw extends f0{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=tW(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=K$(e.data),i=this.getSubLayerRow.bind(this);let a={};const h={};if(Array.isArray(n.dataChanged)){const m=this.state.features;for(const v in m)a[v]=m[v].slice(),h[v]=[];for(const v of n.dataChanged){const E=oA(r,i,v);for(const T in m)h[T].push(wL({data:a[T],getIndex:S=>S.__source.index,dataRange:v,replace:E[T]}))}}else a=oA(r,i);const l=eW(a,h);this.setState({features:a,featuresDiff:h,layerProps:l})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=nW.find(a=>i.id.startsWith("".concat(this.id,"-").concat(a,"-"))),r>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",a=this.shouldRenderSubLayer(i,r.polygons.data)&&this.getSubLayerClass(i,V1.type);if(a){const h=ix(this,V1.props),l=e&&n;return l||delete h.getLineColor,h.updateTriggers.lineColors=l,new a(h,this.getSubLayerProps({id:i,updateTriggers:h.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",a="linestrings",h=!e&&n&&this.shouldRenderSubLayer(i,r.polygonsOutline.data)&&this.getSubLayerClass(i,Og.type),l=this.shouldRenderSubLayer(a,r.lines.data)&&this.getSubLayerClass(a,Og.type);if(h||l){const m=ix(this,Og.props);return[h&&new h(m,this.getSubLayerProps({id:i,updateTriggers:m.updateTriggers}),r.polygonsOutline),l&&new l(m,this.getSubLayerProps({id:a,updateTriggers:m.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(l=>l.__source.index===i));const a=new Set(e.split("+")),h=[];for(const l of a){const m="points-".concat(l),v=Dg[l],E=v&&this.shouldRenderSubLayer(m,n.points.data)&&this.getSubLayerClass(m,v.type);if(E){const T=ix(this,v.props);let S=n.points;if(l==="text"&&r){const{instancePickingColors:z,...D}=S.data.attributes;S={...S,data:{...S.data,attributes:D}}}h.push(new E(T,this.getSubLayerProps({id:m,updateTriggers:T.updateTriggers,highlightedObjectIndex:i}),S))}}return h}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:a,index:h}=i,l=P$(a,h);return e(l,i)}}}$(kw,"layerName","GeoJsonLayer");$(kw,"defaultProps",rW);function IL(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function iW(t){return t.length===1&&(t=sW(t)),{left:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}function sW(t){return function(e,n){return IL(t(e),n)}}var oW=iW(IL),aW=oW.right;function lW(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}var Hs="$";function Ry(){}Ry.prototype=ML.prototype={constructor:Ry,has:function(t){return Hs+t in this},get:function(t){return this[Hs+t]},set:function(t,e){return this[Hs+t]=e,this},remove:function(t){var e=Hs+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Hs&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Hs&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Hs&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Hs&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Hs&&++t;return t},empty:function(){for(var t in this)if(t[0]===Hs)return!1;return!0},each:function(t){for(var e in this)e[0]===Hs&&t(this[e],e.slice(1),this)}};function ML(t,e){var n=new Ry;if(t instanceof Ry)t.each(function(l,m){n.set(m,l)});else if(Array.isArray(t)){var r=-1,i=t.length,a;if(e==null)for(;++r<i;)n.set(r,t[r]);else for(;++r<i;)n.set(e(a=t[r],r,t),a)}else if(t)for(var h in t)n.set(h,t[h]);return n}function lA(){}var dc=ML.prototype;lA.prototype={constructor:lA,has:dc.has,add:function(t){return t+="",this[Hs+t]=t,this},remove:dc.remove,clear:dc.clear,values:dc.keys,size:dc.size,empty:dc.empty,each:dc.each};var cW=Array.prototype,cA=cW.slice;function kL(){var t=[.5],e=[0,1],n,r=1;function i(a){return a<=a?e[aW(t,a,0,r)]:n}return i.domain=function(a){return arguments.length?(t=cA.call(a),r=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(a){return arguments.length?(e=cA.call(a),r=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(a){var h=e.indexOf(a);return[t[h-1],t[h]]},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return kL().domain(t).range(e).unknown(n)},lW.apply(i,arguments)}function uW(t){return t}function hW(t){if(t==null)return uW;var e,n,r=t.scale[0],i=t.scale[1],a=t.translate[0],h=t.translate[1];return function(l,m){m||(e=n=0);var v=2,E=l.length,T=new Array(E);for(T[0]=(e+=l[0])*r+a,T[1]=(n+=l[1])*i+h;v<E;)T[v]=l[v],++v;return T}}function dW(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}function fW(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(n){return uA(t,n)})}:uA(t,e)}function uA(t,e){var n=e.id,r=e.bbox,i=e.properties==null?{}:e.properties,a=pW(t,e);return n==null&&r==null?{type:"Feature",properties:i,geometry:a}:r==null?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function pW(t,e){var n=hW(t.transform),r=t.arcs;function i(E,T){T.length&&T.pop();for(var S=r[E<0?~E:E],z=0,D=S.length;z<D;++z)T.push(n(S[z],z));E<0&&dW(T,D)}function a(E){return n(E)}function h(E){for(var T=[],S=0,z=E.length;S<z;++S)i(E[S],T);return T.length<2&&T.push(T[0]),T}function l(E){for(var T=h(E);T.length<4;)T.push(T[0]);return T}function m(E){return E.map(l)}function v(E){var T=E.type,S;switch(T){case"GeometryCollection":return{type:T,geometries:E.geometries.map(v)};case"Point":S=a(E.coordinates);break;case"MultiPoint":S=E.coordinates.map(a);break;case"LineString":S=h(E.arcs);break;case"MultiLineString":S=E.arcs.map(h);break;case"Polygon":S=m(E.arcs);break;case"MultiPolygon":S=E.arcs.map(m);break;default:return null}return{type:T,coordinates:S}}return v(e)}function Fg(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function mW(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function LL(t){let e,n,r;t.length!==2?(e=Fg,n=(l,m)=>Fg(t(l),m),r=(l,m)=>t(l)-m):(e=t===Fg||t===mW?t:gW,n=t,r=t);function i(l,m,v=0,E=l.length){if(v<E){if(e(m,m)!==0)return E;do{const T=v+E>>>1;n(l[T],m)<0?v=T+1:E=T}while(v<E)}return v}function a(l,m,v=0,E=l.length){if(v<E){if(e(m,m)!==0)return E;do{const T=v+E>>>1;n(l[T],m)<=0?v=T+1:E=T}while(v<E)}return v}function h(l,m,v=0,E=l.length){const T=i(l,m,v,E-1);return T>v&&r(l[T-1],m)>-r(l[T],m)?T-1:T}return{left:i,center:h,right:a}}function gW(){return 0}function yW(t){return t===null?NaN:+t}const _W=LL(Fg),vW=_W.right;LL(yW).center;const xW=vW;function bW(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let a of t)(a=e(a,++i,t))!=null&&(n===void 0?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}return[n,r]}class wW extends Map{constructor(e,n=SW){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(hA(this,e))}has(e){return super.has(hA(this,e))}set(e,n){return super.set(EW(this,e),n)}delete(e){return super.delete(TW(this,e))}}function hA({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function EW({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function TW({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function SW(t){return t!==null&&typeof t=="object"?t.valueOf():t}function PW(t){return t}function AW(t,...e){return IW(t,PW,CW,e)}function CW(t){if(t.length!==1)throw new Error("duplicate key");return t[0]}function IW(t,e,n,r){return function i(a,h){if(h>=r.length)return n(a);const l=new wW,m=r[h++];let v=-1;for(const E of a){const T=m(E,++v,a),S=l.get(T);S?S.push(E):l.set(T,[E])}for(const[E,T]of l)l.set(E,i(T,h));return e(l)}(t,0)}const MW=Math.sqrt(50),kW=Math.sqrt(10),LW=Math.sqrt(2);function zy(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),h=a>=MW?10:a>=kW?5:a>=LW?2:1;let l,m,v;return i<0?(v=Math.pow(10,-i)/h,l=Math.round(t*v),m=Math.round(e*v),l/v<t&&++l,m/v>e&&--m,v=-v):(v=Math.pow(10,i)*h,l=Math.round(t/v),m=Math.round(e/v),l*v<t&&++l,m*v>e&&--m),m<l&&.5<=n&&n<2?zy(t,e,n*2):[l,m,v]}function RW(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,h]=r?zy(e,t,n):zy(t,e,n);if(!(a>=i))return[];const l=a-i+1,m=new Array(l);if(r)if(h<0)for(let v=0;v<l;++v)m[v]=(a-v)/-h;else for(let v=0;v<l;++v)m[v]=(a-v)*h;else if(h<0)for(let v=0;v<l;++v)m[v]=(i+v)/-h;else for(let v=0;v<l;++v)m[v]=(i+v)*h;return m}function j1(t,e,n){return e=+e,t=+t,n=+n,zy(t,e,n)[2]}function zW(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?j1(e,t,n):j1(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function DW(t,e){if(typeof e!="function")throw new TypeError("test is not a function");const n=[];let r=-1;for(const i of t)e(i,++r,t)&&n.push(i);return n}function Lw(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function RL(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function xp(){}var qf=.7,Dy=1/qf,sh="\\s*([+-]?\\d+)\\s*",Zf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",OW=/^#([0-9a-f]{3,8})$/,FW=new RegExp(`^rgb\\(${sh},${sh},${sh}\\)$`),BW=new RegExp(`^rgb\\(${Yo},${Yo},${Yo}\\)$`),NW=new RegExp(`^rgba\\(${sh},${sh},${sh},${Zf}\\)$`),UW=new RegExp(`^rgba\\(${Yo},${Yo},${Yo},${Zf}\\)$`),VW=new RegExp(`^hsl\\(${Zf},${Yo},${Yo}\\)$`),jW=new RegExp(`^hsla\\(${Zf},${Yo},${Yo},${Zf}\\)$`),dA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Lw(xp,Ph,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:fA,formatHex:fA,formatHex8:GW,formatHsl:$W,formatRgb:pA,toString:pA});function fA(){return this.rgb().formatHex()}function GW(){return this.rgb().formatHex8()}function $W(){return zL(this).formatHsl()}function pA(){return this.rgb().formatRgb()}function Ph(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=OW.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?mA(e):n===3?new ls(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?og(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?og(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=FW.exec(t))?new ls(e[1],e[2],e[3],1):(e=BW.exec(t))?new ls(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=NW.exec(t))?og(e[1],e[2],e[3],e[4]):(e=UW.exec(t))?og(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=VW.exec(t))?_A(e[1],e[2]/100,e[3]/100,1):(e=jW.exec(t))?_A(e[1],e[2]/100,e[3]/100,e[4]):dA.hasOwnProperty(t)?mA(dA[t]):t==="transparent"?new ls(NaN,NaN,NaN,0):null}function mA(t){return new ls(t>>16&255,t>>8&255,t&255,1)}function og(t,e,n,r){return r<=0&&(t=e=n=NaN),new ls(t,e,n,r)}function WW(t){return t instanceof xp||(t=Ph(t)),t?(t=t.rgb(),new ls(t.r,t.g,t.b,t.opacity)):new ls}function G1(t,e,n,r){return arguments.length===1?WW(t):new ls(t,e,n,r??1)}function ls(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Lw(ls,G1,RL(xp,{brighter(t){return t=t==null?Dy:Math.pow(Dy,t),new ls(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?qf:Math.pow(qf,t),new ls(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ls(Ac(this.r),Ac(this.g),Ac(this.b),Oy(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:gA,formatHex:gA,formatHex8:HW,formatRgb:yA,toString:yA}));function gA(){return`#${bc(this.r)}${bc(this.g)}${bc(this.b)}`}function HW(){return`#${bc(this.r)}${bc(this.g)}${bc(this.b)}${bc((isNaN(this.opacity)?1:this.opacity)*255)}`}function yA(){const t=Oy(this.opacity);return`${t===1?"rgb(":"rgba("}${Ac(this.r)}, ${Ac(this.g)}, ${Ac(this.b)}${t===1?")":`, ${t})`}`}function Oy(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ac(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function bc(t){return t=Ac(t),(t<16?"0":"")+t.toString(16)}function _A(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new go(t,e,n,r)}function zL(t){if(t instanceof go)return new go(t.h,t.s,t.l,t.opacity);if(t instanceof xp||(t=Ph(t)),!t)return new go;if(t instanceof go)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),h=NaN,l=a-i,m=(a+i)/2;return l?(e===a?h=(n-r)/l+(n<r)*6:n===a?h=(r-e)/l+2:h=(e-n)/l+4,l/=m<.5?a+i:2-a-i,h*=60):l=m>0&&m<1?0:h,new go(h,l,m,t.opacity)}function qW(t,e,n,r){return arguments.length===1?zL(t):new go(t,e,n,r??1)}function go(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Lw(go,qW,RL(xp,{brighter(t){return t=t==null?Dy:Math.pow(Dy,t),new go(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?qf:Math.pow(qf,t),new go(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new ls(sx(t>=240?t-240:t+120,i,r),sx(t,i,r),sx(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new go(vA(this.h),ag(this.s),ag(this.l),Oy(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Oy(this.opacity);return`${t===1?"hsl(":"hsla("}${vA(this.h)}, ${ag(this.s)*100}%, ${ag(this.l)*100}%${t===1?")":`, ${t})`}`}}));function vA(t){return t=(t||0)%360,t<0?t+360:t}function ag(t){return Math.max(0,Math.min(1,t||0))}function sx(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Rw=t=>()=>t;function ZW(t,e){return function(n){return t+n*e}}function XW(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function YW(t){return(t=+t)==1?DL:function(e,n){return n-e?XW(e,n,t):Rw(isNaN(e)?n:e)}}function DL(t,e){var n=e-t;return n?ZW(t,n):Rw(isNaN(t)?e:t)}const xA=function t(e){var n=YW(e);function r(i,a){var h=n((i=G1(i)).r,(a=G1(a)).r),l=n(i.g,a.g),m=n(i.b,a.b),v=DL(i.opacity,a.opacity);return function(E){return i.r=h(E),i.g=l(E),i.b=m(E),i.opacity=v(E),i+""}}return r.gamma=t,r}(1);function KW(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function JW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function QW(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),h;for(h=0;h<r;++h)i[h]=x0(t[h],e[h]);for(;h<n;++h)a[h]=e[h];return function(l){for(h=0;h<r;++h)a[h]=i[h](l);return a}}function eH(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Fy(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function tH(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=x0(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var $1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ox=new RegExp($1.source,"g");function nH(t){return function(){return t}}function rH(t){return function(e){return t(e)+""}}function iH(t,e){var n=$1.lastIndex=ox.lastIndex=0,r,i,a,h=-1,l=[],m=[];for(t=t+"",e=e+"";(r=$1.exec(t))&&(i=ox.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),l[h]?l[h]+=a:l[++h]=a),(r=r[0])===(i=i[0])?l[h]?l[h]+=i:l[++h]=i:(l[++h]=null,m.push({i:h,x:Fy(r,i)})),n=ox.lastIndex;return n<e.length&&(a=e.slice(n),l[h]?l[h]+=a:l[++h]=a),l.length<2?m[0]?rH(m[0].x):nH(e):(e=m.length,function(v){for(var E=0,T;E<e;++E)l[(T=m[E]).i]=T.x(v);return l.join("")})}function x0(t,e){var n=typeof e,r;return e==null||n==="boolean"?Rw(e):(n==="number"?Fy:n==="string"?(r=Ph(e))?(e=r,xA):iH:e instanceof Ph?xA:e instanceof Date?eH:JW(e)?KW:Array.isArray(e)?QW:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?tH:Fy)(t,e)}function OL(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var bA={},ax={},lx=34,Gd=10,cx=13;function FL(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function sH(t,e){var n=FL(t);return function(r,i){return e(n(r),i,t)}}function wA(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function ss(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function oH(t){return t<0?"-"+ss(-t,6):t>9999?"+"+ss(t,6):ss(t,4)}function aH(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":oH(t.getUTCFullYear())+"-"+ss(t.getUTCMonth()+1,2)+"-"+ss(t.getUTCDate(),2)+(i?"T"+ss(e,2)+":"+ss(n,2)+":"+ss(r,2)+"."+ss(i,3)+"Z":r?"T"+ss(e,2)+":"+ss(n,2)+":"+ss(r,2)+"Z":n||e?"T"+ss(e,2)+":"+ss(n,2)+"Z":"")}function lH(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(T,S){var z,D,F=i(T,function(J,U){if(z)return z(J,U-1);D=J,z=S?sH(J,S):FL(J)});return F.columns=D||[],F}function i(T,S){var z=[],D=T.length,F=0,J=0,U,V=D<=0,G=!1;T.charCodeAt(D-1)===Gd&&--D,T.charCodeAt(D-1)===cx&&--D;function ee(){if(V)return ax;if(G)return G=!1,bA;var me,ve=F,Me;if(T.charCodeAt(ve)===lx){for(;F++<D&&T.charCodeAt(F)!==lx||T.charCodeAt(++F)===lx;);return(me=F)>=D?V=!0:(Me=T.charCodeAt(F++))===Gd?G=!0:Me===cx&&(G=!0,T.charCodeAt(F)===Gd&&++F),T.slice(ve+1,me-1).replace(/""/g,'"')}for(;F<D;){if((Me=T.charCodeAt(me=F++))===Gd)G=!0;else if(Me===cx)G=!0,T.charCodeAt(F)===Gd&&++F;else if(Me!==n)continue;return T.slice(ve,me)}return V=!0,T.slice(ve,D)}for(;(U=ee())!==ax;){for(var se=[];U!==bA&&U!==ax;)se.push(U),U=ee();S&&(se=S(se,J++))==null||z.push(se)}return z}function a(T,S){return T.map(function(z){return S.map(function(D){return E(z[D])}).join(t)})}function h(T,S){return S==null&&(S=wA(T)),[S.map(E).join(t)].concat(a(T,S)).join(`
`)}function l(T,S){return S==null&&(S=wA(T)),a(T,S).join(`
`)}function m(T){return T.map(v).join(`
`)}function v(T){return T.map(E).join(t)}function E(T){return T==null?"":T instanceof Date?aH(T):e.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:r,parseRows:i,format:h,formatBody:l,formatRows:m,formatRow:v,formatValue:E}}var cH=lH(","),uH=cH.parse;function hH(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function dH(t,e){return fetch(t,e).then(hH)}function fH(t){return function(e,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=void 0),dH(e,n).then(function(i){return t(i,r)})}}var pH=fH(uH);function mH(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function By(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Ah(t){return t=By(Math.abs(t)),t?t[1]:NaN}function gH(t,e){return function(n,r){for(var i=n.length,a=[],h=0,l=t[0],m=0;i>0&&l>0&&(m+l+1>r&&(l=Math.max(1,r-m)),a.push(n.substring(i-=l,i+l)),!((m+=l+1)>r));)l=t[h=(h+1)%t.length];return a.reverse().join(e)}}function yH(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var _H=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ny(t){if(!(e=_H.exec(t)))throw new Error("invalid format: "+t);var e;return new zw({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ny.prototype=zw.prototype;function zw(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}zw.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function vH(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var BL;function xH(t,e){var n=By(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(BL=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,h=r.length;return a===h?r:a>h?r+new Array(a-h+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+By(t,Math.max(0,e+a-1))[0]}function EA(t,e){var n=By(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const TA={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:mH,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>EA(t*100,e),r:EA,s:xH,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function SA(t){return t}var PA=Array.prototype.map,AA=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bH(t){var e=t.grouping===void 0||t.thousands===void 0?SA:gH(PA.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?SA:yH(PA.call(t.numerals,String)),h=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",m=t.nan===void 0?"NaN":t.nan+"";function v(T){T=Ny(T);var S=T.fill,z=T.align,D=T.sign,F=T.symbol,J=T.zero,U=T.width,V=T.comma,G=T.precision,ee=T.trim,se=T.type;se==="n"?(V=!0,se="g"):TA[se]||(G===void 0&&(G=12),ee=!0,se="g"),(J||S==="0"&&z==="=")&&(J=!0,S="0",z="=");var me=F==="$"?n:F==="#"&&/[boxX]/.test(se)?"0"+se.toLowerCase():"",ve=F==="$"?r:/[%p]/.test(se)?h:"",Me=TA[se],Be=/[defgprs%]/.test(se);G=G===void 0?6:/[gprs]/.test(se)?Math.max(1,Math.min(21,G)):Math.max(0,Math.min(20,G));function ze(Oe){var tt=me,et=ve,st,Bt,Je;if(se==="c")et=Me(Oe)+et,Oe="";else{Oe=+Oe;var en=Oe<0||1/Oe<0;if(Oe=isNaN(Oe)?m:Me(Math.abs(Oe),G),ee&&(Oe=vH(Oe)),en&&+Oe==0&&D!=="+"&&(en=!1),tt=(en?D==="("?D:l:D==="-"||D==="("?"":D)+tt,et=(se==="s"?AA[8+BL/3]:"")+et+(en&&D==="("?")":""),Be){for(st=-1,Bt=Oe.length;++st<Bt;)if(Je=Oe.charCodeAt(st),48>Je||Je>57){et=(Je===46?i+Oe.slice(st+1):Oe.slice(st))+et,Oe=Oe.slice(0,st);break}}}V&&!J&&(Oe=e(Oe,1/0));var We=tt.length+Oe.length+et.length,Qe=We<U?new Array(U-We+1).join(S):"";switch(V&&J&&(Oe=e(Qe+Oe,Qe.length?U-et.length:1/0),Qe=""),z){case"<":Oe=tt+Oe+et+Qe;break;case"=":Oe=tt+Qe+Oe+et;break;case"^":Oe=Qe.slice(0,We=Qe.length>>1)+tt+Oe+et+Qe.slice(We);break;default:Oe=Qe+tt+Oe+et;break}return a(Oe)}return ze.toString=function(){return T+""},ze}function E(T,S){var z=v((T=Ny(T),T.type="f",T)),D=Math.max(-8,Math.min(8,Math.floor(Ah(S)/3)))*3,F=Math.pow(10,-D),J=AA[8+D/3];return function(U){return z(F*U)+J}}return{format:v,formatPrefix:E}}var lg,NL,UL;wH({thousands:",",grouping:[3],currency:["$",""]});function wH(t){return lg=bH(t),NL=lg.format,UL=lg.formatPrefix,lg}function EH(t){return Math.max(0,-Ah(Math.abs(t)))}function TH(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ah(e)/3)))*3-Ah(Math.abs(t)))}function SH(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ah(e)-Ah(t))+1}function PH(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function AH(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function CH(t){return function(){return t}}function IH(t){return+t}var CA=[0,1];function vl(t){return t}function W1(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:CH(isNaN(e)?NaN:.5)}function MH(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function kH(t,e,n){var r=t[0],i=t[1],a=e[0],h=e[1];return i<r?(r=W1(i,r),a=n(h,a)):(r=W1(r,i),a=n(a,h)),function(l){return a(r(l))}}function LH(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),h=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++h<r;)i[h]=W1(t[h],t[h+1]),a[h]=n(e[h],e[h+1]);return function(l){var m=xW(t,l,1,r)-1;return a[m](i[m](l))}}function RH(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function zH(){var t=CA,e=CA,n=x0,r,i,a,h=vl,l,m,v;function E(){var S=Math.min(t.length,e.length);return h!==vl&&(h=MH(t[0],t[S-1])),l=S>2?LH:kH,m=v=null,T}function T(S){return S==null||isNaN(S=+S)?a:(m||(m=l(t.map(r),e,n)))(r(h(S)))}return T.invert=function(S){return h(i((v||(v=l(e,t.map(r),Fy)))(S)))},T.domain=function(S){return arguments.length?(t=Array.from(S,IH),E()):t.slice()},T.range=function(S){return arguments.length?(e=Array.from(S),E()):e.slice()},T.rangeRound=function(S){return e=Array.from(S),n=OL,E()},T.clamp=function(S){return arguments.length?(h=S?!0:vl,E()):h!==vl},T.interpolate=function(S){return arguments.length?(n=S,E()):n},T.unknown=function(S){return arguments.length?(a=S,T):a},function(S,z){return r=S,i=z,E()}}function DH(){return zH()(vl,vl)}function OH(t,e,n,r){var i=zW(t,e,n),a;switch(r=Ny(r??",f"),r.type){case"s":{var h=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=TH(i,h))&&(r.precision=a),UL(r,h)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=SH(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=EH(i))&&(r.precision=a-(r.type==="%")*2);break}}return NL(r)}function VL(t){var e=t.domain;return t.ticks=function(n){var r=e();return RW(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return OH(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,h=r[i],l=r[a],m,v,E=10;for(l<h&&(v=h,h=l,l=v,v=i,i=a,a=v);E-- >0;){if(v=j1(h,l,n),v===m)return r[i]=h,r[a]=l,e(r);if(v>0)h=Math.floor(h/v)*v,l=Math.ceil(l/v)*v;else if(v<0)h=Math.ceil(h*v)/v,l=Math.floor(l*v)/v;else break;m=v}return t},t}function jL(){var t=DH();return t.copy=function(){return RH(t,jL())},PH.apply(t,arguments),VL(t)}function FH(){var t=0,e=1,n,r,i,a,h=vl,l=!1,m;function v(T){return T==null||isNaN(T=+T)?m:h(i===0?.5:(T=(a(T)-n)*i,l?Math.max(0,Math.min(1,T)):T))}v.domain=function(T){return arguments.length?([t,e]=T,n=a(t=+t),r=a(e=+e),i=n===r?0:1/(r-n),v):[t,e]},v.clamp=function(T){return arguments.length?(l=!!T,v):l},v.interpolator=function(T){return arguments.length?(h=T,v):h};function E(T){return function(S){var z,D;return arguments.length?([z,D]=S,h=T(z,D),v):[h(0),h(1)]}}return v.range=E(x0),v.rangeRound=E(OL),v.unknown=function(T){return arguments.length?(m=T,v):m},function(T){return a=T,n=T(t),r=T(e),i=n===r?0:1/(r-n),v}}function BH(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function GL(){var t=VL(FH()(vl));return t.copy=function(){return BH(t,GL())},AH.apply(t,arguments)}function b0(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}function w0(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}w0(b0("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));w0(b0("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var NH=w0(b0("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));w0(b0("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function tf(t,e,n){this.k=t,this.x=e,this.y=n}tf.prototype={constructor:tf,scale:function(t){return t===1?this:new tf(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new tf(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};tf.prototype;const UH={black:"#000",white:"#fff"},Xf=UH,VH={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Iu=VH,jH={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},Mu=jH,GH={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},ku=GH,$H={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},Lu=$H,WH={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},Ru=WH,HH={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},$d=HH,qH={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},ZH=qH;function Ge(){return Ge=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ge.apply(this,arguments)}function gc(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function $L(t){if(!gc(t))return t;const e={};return Object.keys(t).forEach(n=>{e[n]=$L(t[n])}),e}function Eo(t,e,n={clone:!0}){const r=n.clone?Ge({},t):t;return gc(t)&&gc(e)&&Object.keys(e).forEach(i=>{i!=="__proto__"&&(gc(e[i])&&i in t&&gc(t[i])?r[i]=Eo(t[i],e[i],n):n.clone?r[i]=gc(e[i])?$L(e[i]):e[i]:r[i]=e[i])}),r}function Ch(t){let e="https://mui.com/production-error/?code="+t;for(let n=1;n<arguments.length;n+=1)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+t+"; visit "+e+" for the full message."}function Kn(t){if(typeof t!="string")throw new Error(Ch(7));return t.charAt(0).toUpperCase()+t.slice(1)}function Bg(t){return t&&t.ownerDocument||document}function XH(t,e){typeof t=="function"?t(e):t&&(t.current=e)}const YH=typeof window<"u"?Pe.useLayoutEffect:Pe.useEffect,WL=YH;function HL({controlled:t,default:e,name:n,state:r="value"}){const{current:i}=Pe.useRef(t!==void 0),[a,h]=Pe.useState(e),l=i?t:a,m=Pe.useCallback(v=>{i||h(v)},[]);return[l,m]}function wc(t){const e=Pe.useRef(t);return WL(()=>{e.current=t}),Pe.useCallback((...n)=>(0,e.current)(...n),[])}function Yf(...t){return Pe.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(n=>{XH(n,e)})},t)}let E0=!0,H1=!1,IA;const KH={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function JH(t){const{type:e,tagName:n}=t;return!!(n==="INPUT"&&KH[e]&&!t.readOnly||n==="TEXTAREA"&&!t.readOnly||t.isContentEditable)}function QH(t){t.metaKey||t.altKey||t.ctrlKey||(E0=!0)}function ux(){E0=!1}function eq(){this.visibilityState==="hidden"&&H1&&(E0=!0)}function tq(t){t.addEventListener("keydown",QH,!0),t.addEventListener("mousedown",ux,!0),t.addEventListener("pointerdown",ux,!0),t.addEventListener("touchstart",ux,!0),t.addEventListener("visibilitychange",eq,!0)}function nq(t){const{target:e}=t;try{return e.matches(":focus-visible")}catch{}return E0||JH(e)}function qL(){const t=Pe.useCallback(i=>{i!=null&&tq(i.ownerDocument)},[]),e=Pe.useRef(!1);function n(){return e.current?(H1=!0,window.clearTimeout(IA),IA=window.setTimeout(()=>{H1=!1},100),e.current=!1,!0):!1}function r(i){return nq(i)?(e.current=!0,!0):!1}return{isFocusVisibleRef:e,onFocus:r,onBlur:n,ref:t}}const rq={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:-1,overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},iq=rq;function ZL(t,e){const n=Ge({},e);return Object.keys(t).forEach(r=>{if(r.toString().match(/^(components|slots)$/))n[r]=Ge({},t[r],n[r]);else if(r.toString().match(/^(componentsProps|slotProps)$/)){const i=t[r]||{},a=e[r];n[r]={},!a||!Object.keys(a)?n[r]=i:!i||!Object.keys(i)?n[r]=a:(n[r]=Ge({},a),Object.keys(i).forEach(h=>{n[r][h]=ZL(i[h],a[h])}))}else n[r]===void 0&&(n[r]=t[r])}),n}function Da(t,e,n=void 0){const r={};return Object.keys(t).forEach(i=>{r[i]=t[i].reduce((a,h)=>{if(h){const l=e(h);l!==""&&a.push(l),n&&n[h]&&a.push(n[h])}return a},[]).join(" ")}),r}const MA=t=>t,sq=()=>{let t=MA;return{configure(e){t=e},generate(e){return t(e)},reset(){t=MA}}},oq=sq(),aq=oq,lq={active:"active",checked:"checked",completed:"completed",disabled:"disabled",readOnly:"readOnly",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function ea(t,e,n="Mui"){const r=lq[e];return r?`${n}-${r}`:`${aq.generate(t)}-${e}`}function Ol(t,e,n="Mui"){const r={};return e.forEach(i=>{r[i]=ea(t,i,n)}),r}const Dw="$$material";function Nr(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,a;for(a=0;a<r.length;a++)i=r[a],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function XL(t){var e=Object.create(null);return function(n){return e[n]===void 0&&(e[n]=t(n)),e[n]}}var cq=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,uq=XL(function(t){return cq.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91});function hq(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function dq(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var fq=function(){function t(n){var r=this;this._insertTag=function(i){var a;r.tags.length===0?r.insertionPoint?a=r.insertionPoint.nextSibling:r.prepend?a=r.container.firstChild:a=r.before:a=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,a),r.tags.push(i)},this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.prepend=n.prepend,this.insertionPoint=n.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(dq(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var a=hq(i);try{a.insertRule(r,a.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){return r.parentNode&&r.parentNode.removeChild(r)}),this.tags=[],this.ctr=0},t}(),Mi="-ms-",Uy="-moz-",In="-webkit-",YL="comm",Ow="rule",Fw="decl",pq="@import",KL="@keyframes",mq="@layer",gq=Math.abs,T0=String.fromCharCode,yq=Object.assign;function _q(t,e){return gi(t,0)^45?(((e<<2^gi(t,0))<<2^gi(t,1))<<2^gi(t,2))<<2^gi(t,3):0}function JL(t){return t.trim()}function vq(t,e){return(t=e.exec(t))?t[0]:t}function Mn(t,e,n){return t.replace(e,n)}function q1(t,e){return t.indexOf(e)}function gi(t,e){return t.charCodeAt(e)|0}function Kf(t,e,n){return t.slice(e,n)}function Vo(t){return t.length}function Bw(t){return t.length}function cg(t,e){return e.push(t),t}function xq(t,e){return t.map(e).join("")}var S0=1,Ih=1,QL=0,ds=0,Hr=0,zh="";function P0(t,e,n,r,i,a,h){return{value:t,root:e,parent:n,type:r,props:i,children:a,line:S0,column:Ih,length:h,return:""}}function Wd(t,e){return yq(P0("",null,null,"",null,null,0),t,{length:-t.length},e)}function bq(){return Hr}function wq(){return Hr=ds>0?gi(zh,--ds):0,Ih--,Hr===10&&(Ih=1,S0--),Hr}function Rs(){return Hr=ds<QL?gi(zh,ds++):0,Ih++,Hr===10&&(Ih=1,S0++),Hr}function Ko(){return gi(zh,ds)}function Ng(){return ds}function bp(t,e){return Kf(zh,t,e)}function Jf(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function e3(t){return S0=Ih=1,QL=Vo(zh=t),ds=0,[]}function t3(t){return zh="",t}function Ug(t){return JL(bp(ds-1,Z1(t===91?t+2:t===40?t+1:t)))}function Eq(t){for(;(Hr=Ko())&&Hr<33;)Rs();return Jf(t)>2||Jf(Hr)>3?"":" "}function Tq(t,e){for(;--e&&Rs()&&!(Hr<48||Hr>102||Hr>57&&Hr<65||Hr>70&&Hr<97););return bp(t,Ng()+(e<6&&Ko()==32&&Rs()==32))}function Z1(t){for(;Rs();)switch(Hr){case t:return ds;case 34:case 39:t!==34&&t!==39&&Z1(Hr);break;case 40:t===41&&Z1(t);break;case 92:Rs();break}return ds}function Sq(t,e){for(;Rs()&&t+Hr!==47+10;)if(t+Hr===42+42&&Ko()===47)break;return"/*"+bp(e,ds-1)+"*"+T0(t===47?t:Rs())}function Pq(t){for(;!Jf(Ko());)Rs();return bp(t,ds)}function Aq(t){return t3(Vg("",null,null,null,[""],t=e3(t),0,[0],t))}function Vg(t,e,n,r,i,a,h,l,m){for(var v=0,E=0,T=h,S=0,z=0,D=0,F=1,J=1,U=1,V=0,G="",ee=i,se=a,me=r,ve=G;J;)switch(D=V,V=Rs()){case 40:if(D!=108&&gi(ve,T-1)==58){q1(ve+=Mn(Ug(V),"&","&\f"),"&\f")!=-1&&(U=-1);break}case 34:case 39:case 91:ve+=Ug(V);break;case 9:case 10:case 13:case 32:ve+=Eq(D);break;case 92:ve+=Tq(Ng()-1,7);continue;case 47:switch(Ko()){case 42:case 47:cg(Cq(Sq(Rs(),Ng()),e,n),m);break;default:ve+="/"}break;case 123*F:l[v++]=Vo(ve)*U;case 125*F:case 59:case 0:switch(V){case 0:case 125:J=0;case 59+E:U==-1&&(ve=Mn(ve,/\f/g,"")),z>0&&Vo(ve)-T&&cg(z>32?LA(ve+";",r,n,T-1):LA(Mn(ve," ","")+";",r,n,T-2),m);break;case 59:ve+=";";default:if(cg(me=kA(ve,e,n,v,E,i,l,G,ee=[],se=[],T),a),V===123)if(E===0)Vg(ve,e,me,me,ee,a,T,l,se);else switch(S===99&&gi(ve,3)===110?100:S){case 100:case 108:case 109:case 115:Vg(t,me,me,r&&cg(kA(t,me,me,0,0,i,l,G,i,ee=[],T),se),i,se,T,l,r?ee:se);break;default:Vg(ve,me,me,me,[""],se,0,l,se)}}v=E=z=0,F=U=1,G=ve="",T=h;break;case 58:T=1+Vo(ve),z=D;default:if(F<1){if(V==123)--F;else if(V==125&&F++==0&&wq()==125)continue}switch(ve+=T0(V),V*F){case 38:U=E>0?1:(ve+="\f",-1);break;case 44:l[v++]=(Vo(ve)-1)*U,U=1;break;case 64:Ko()===45&&(ve+=Ug(Rs())),S=Ko(),E=T=Vo(G=ve+=Pq(Ng())),V++;break;case 45:D===45&&Vo(ve)==2&&(F=0)}}return a}function kA(t,e,n,r,i,a,h,l,m,v,E){for(var T=i-1,S=i===0?a:[""],z=Bw(S),D=0,F=0,J=0;D<r;++D)for(var U=0,V=Kf(t,T+1,T=gq(F=h[D])),G=t;U<z;++U)(G=JL(F>0?S[U]+" "+V:Mn(V,/&\f/g,S[U])))&&(m[J++]=G);return P0(t,e,n,i===0?Ow:l,m,v,E)}function Cq(t,e,n){return P0(t,e,n,YL,T0(bq()),Kf(t,2,-2),0)}function LA(t,e,n,r){return P0(t,e,n,Fw,Kf(t,0,r),Kf(t,r+1,-1),r)}function oh(t,e){for(var n="",r=Bw(t),i=0;i<r;i++)n+=e(t[i],i,t,e)||"";return n}function Iq(t,e,n,r){switch(t.type){case mq:if(t.children.length)break;case pq:case Fw:return t.return=t.return||t.value;case YL:return"";case KL:return t.return=t.value+"{"+oh(t.children,r)+"}";case Ow:t.value=t.props.join(",")}return Vo(n=oh(t.children,r))?t.return=t.value+"{"+n+"}":""}function Mq(t){var e=Bw(t);return function(n,r,i,a){for(var h="",l=0;l<e;l++)h+=t[l](n,r,i,a)||"";return h}}function kq(t){return function(e){e.root||(e=e.return)&&t(e)}}var Lq=function(e,n,r){for(var i=0,a=0;i=a,a=Ko(),i===38&&a===12&&(n[r]=1),!Jf(a);)Rs();return bp(e,ds)},Rq=function(e,n){var r=-1,i=44;do switch(Jf(i)){case 0:i===38&&Ko()===12&&(n[r]=1),e[r]+=Lq(ds-1,n,r);break;case 2:e[r]+=Ug(i);break;case 4:if(i===44){e[++r]=Ko()===58?"&\f":"",n[r]=e[r].length;break}default:e[r]+=T0(i)}while(i=Rs());return e},zq=function(e,n){return t3(Rq(e3(e),n))},RA=new WeakMap,Dq=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var n=e.value,r=e.parent,i=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&n.charCodeAt(0)!==58&&!RA.get(r))&&!i){RA.set(e,!0);for(var a=[],h=zq(n,a),l=r.props,m=0,v=0;m<h.length;m++)for(var E=0;E<l.length;E++,v++)e.props[v]=a[m]?h[m].replace(/&\f/g,l[E]):l[E]+" "+h[m]}}},Oq=function(e){if(e.type==="decl"){var n=e.value;n.charCodeAt(0)===108&&n.charCodeAt(2)===98&&(e.return="",e.value="")}};function n3(t,e){switch(_q(t,e)){case 5103:return In+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return In+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return In+t+Uy+t+Mi+t+t;case 6828:case 4268:return In+t+Mi+t+t;case 6165:return In+t+Mi+"flex-"+t+t;case 5187:return In+t+Mn(t,/(\w+).+(:[^]+)/,In+"box-$1$2"+Mi+"flex-$1$2")+t;case 5443:return In+t+Mi+"flex-item-"+Mn(t,/flex-|-self/,"")+t;case 4675:return In+t+Mi+"flex-line-pack"+Mn(t,/align-content|flex-|-self/,"")+t;case 5548:return In+t+Mi+Mn(t,"shrink","negative")+t;case 5292:return In+t+Mi+Mn(t,"basis","preferred-size")+t;case 6060:return In+"box-"+Mn(t,"-grow","")+In+t+Mi+Mn(t,"grow","positive")+t;case 4554:return In+Mn(t,/([^-])(transform)/g,"$1"+In+"$2")+t;case 6187:return Mn(Mn(Mn(t,/(zoom-|grab)/,In+"$1"),/(image-set)/,In+"$1"),t,"")+t;case 5495:case 3959:return Mn(t,/(image-set\([^]*)/,In+"$1$`$1");case 4968:return Mn(Mn(t,/(.+:)(flex-)?(.*)/,In+"box-pack:$3"+Mi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+In+t+t;case 4095:case 3583:case 4068:case 2532:return Mn(t,/(.+)-inline(.+)/,In+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Vo(t)-1-e>6)switch(gi(t,e+1)){case 109:if(gi(t,e+4)!==45)break;case 102:return Mn(t,/(.+:)(.+)-([^]+)/,"$1"+In+"$2-$3$1"+Uy+(gi(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~q1(t,"stretch")?n3(Mn(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(gi(t,e+1)!==115)break;case 6444:switch(gi(t,Vo(t)-3-(~q1(t,"!important")&&10))){case 107:return Mn(t,":",":"+In)+t;case 101:return Mn(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+In+(gi(t,14)===45?"inline-":"")+"box$3$1"+In+"$2$3$1"+Mi+"$2box$3")+t}break;case 5936:switch(gi(t,e+11)){case 114:return In+t+Mi+Mn(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return In+t+Mi+Mn(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return In+t+Mi+Mn(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return In+t+Mi+t+t}return t}var Fq=function(e,n,r,i){if(e.length>-1&&!e.return)switch(e.type){case Fw:e.return=n3(e.value,e.length);break;case KL:return oh([Wd(e,{value:Mn(e.value,"@","@"+In)})],i);case Ow:if(e.length)return xq(e.props,function(a){switch(vq(a,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return oh([Wd(e,{props:[Mn(a,/:(read-\w+)/,":"+Uy+"$1")]})],i);case"::placeholder":return oh([Wd(e,{props:[Mn(a,/:(plac\w+)/,":"+In+"input-$1")]}),Wd(e,{props:[Mn(a,/:(plac\w+)/,":"+Uy+"$1")]}),Wd(e,{props:[Mn(a,/:(plac\w+)/,Mi+"input-$1")]})],i)}return""})}},Bq=[Fq],Nq=function(e){var n=e.key;if(n==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(F){var J=F.getAttribute("data-emotion");J.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var i=e.stylisPlugins||Bq,a={},h,l=[];h=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+n+' "]'),function(F){for(var J=F.getAttribute("data-emotion").split(" "),U=1;U<J.length;U++)a[J[U]]=!0;l.push(F)});var m,v=[Dq,Oq];{var E,T=[Iq,kq(function(F){E.insert(F)})],S=Mq(v.concat(i,T)),z=function(J){return oh(Aq(J),S)};m=function(J,U,V,G){E=V,z(J?J+"{"+U.styles+"}":U.styles),G&&(D.inserted[U.name]=!0)}}var D={key:n,sheet:new fq({key:n,container:h,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:a,registered:{},insert:m};return D.sheet.hydrate(l),D},r3={exports:{}},Nn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ci=typeof Symbol=="function"&&Symbol.for,Nw=ci?Symbol.for("react.element"):60103,Uw=ci?Symbol.for("react.portal"):60106,A0=ci?Symbol.for("react.fragment"):60107,C0=ci?Symbol.for("react.strict_mode"):60108,I0=ci?Symbol.for("react.profiler"):60114,M0=ci?Symbol.for("react.provider"):60109,k0=ci?Symbol.for("react.context"):60110,Vw=ci?Symbol.for("react.async_mode"):60111,L0=ci?Symbol.for("react.concurrent_mode"):60111,R0=ci?Symbol.for("react.forward_ref"):60112,z0=ci?Symbol.for("react.suspense"):60113,Uq=ci?Symbol.for("react.suspense_list"):60120,D0=ci?Symbol.for("react.memo"):60115,O0=ci?Symbol.for("react.lazy"):60116,Vq=ci?Symbol.for("react.block"):60121,jq=ci?Symbol.for("react.fundamental"):60117,Gq=ci?Symbol.for("react.responder"):60118,$q=ci?Symbol.for("react.scope"):60119;function Bs(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case Nw:switch(t=t.type,t){case Vw:case L0:case A0:case I0:case C0:case z0:return t;default:switch(t=t&&t.$$typeof,t){case k0:case R0:case O0:case D0:case M0:return t;default:return e}}case Uw:return e}}}function i3(t){return Bs(t)===L0}Nn.AsyncMode=Vw;Nn.ConcurrentMode=L0;Nn.ContextConsumer=k0;Nn.ContextProvider=M0;Nn.Element=Nw;Nn.ForwardRef=R0;Nn.Fragment=A0;Nn.Lazy=O0;Nn.Memo=D0;Nn.Portal=Uw;Nn.Profiler=I0;Nn.StrictMode=C0;Nn.Suspense=z0;Nn.isAsyncMode=function(t){return i3(t)||Bs(t)===Vw};Nn.isConcurrentMode=i3;Nn.isContextConsumer=function(t){return Bs(t)===k0};Nn.isContextProvider=function(t){return Bs(t)===M0};Nn.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===Nw};Nn.isForwardRef=function(t){return Bs(t)===R0};Nn.isFragment=function(t){return Bs(t)===A0};Nn.isLazy=function(t){return Bs(t)===O0};Nn.isMemo=function(t){return Bs(t)===D0};Nn.isPortal=function(t){return Bs(t)===Uw};Nn.isProfiler=function(t){return Bs(t)===I0};Nn.isStrictMode=function(t){return Bs(t)===C0};Nn.isSuspense=function(t){return Bs(t)===z0};Nn.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===A0||t===L0||t===I0||t===C0||t===z0||t===Uq||typeof t=="object"&&t!==null&&(t.$$typeof===O0||t.$$typeof===D0||t.$$typeof===M0||t.$$typeof===k0||t.$$typeof===R0||t.$$typeof===jq||t.$$typeof===Gq||t.$$typeof===$q||t.$$typeof===Vq)};Nn.typeOf=Bs;r3.exports=Nn;var Wq=r3.exports,s3=Wq,Hq={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},qq={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o3={};o3[s3.ForwardRef]=Hq;o3[s3.Memo]=qq;var Zq=!0;function Xq(t,e,n){var r="";return n.split(" ").forEach(function(i){t[i]!==void 0?e.push(t[i]+";"):r+=i+" "}),r}var a3=function(e,n,r){var i=e.key+"-"+n.name;(r===!1||Zq===!1)&&e.registered[i]===void 0&&(e.registered[i]=n.styles)},Yq=function(e,n,r){a3(e,n,r);var i=e.key+"-"+n.name;if(e.inserted[n.name]===void 0){var a=n;do e.insert(n===a?"."+i:"",a,e.sheet,!0),a=a.next;while(a!==void 0)}};function Kq(t){for(var e=0,n,r=0,i=t.length;i>=4;++r,i-=4)n=t.charCodeAt(r)&255|(t.charCodeAt(++r)&255)<<8|(t.charCodeAt(++r)&255)<<16|(t.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(i){case 3:e^=(t.charCodeAt(r+2)&255)<<16;case 2:e^=(t.charCodeAt(r+1)&255)<<8;case 1:e^=t.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var Jq={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Qq=/[A-Z]|^ms/g,eZ=/_EMO_([^_]+?)_([^]*?)_EMO_/g,l3=function(e){return e.charCodeAt(1)===45},zA=function(e){return e!=null&&typeof e!="boolean"},hx=XL(function(t){return l3(t)?t:t.replace(Qq,"-$&").toLowerCase()}),DA=function(e,n){switch(e){case"animation":case"animationName":if(typeof n=="string")return n.replace(eZ,function(r,i,a){return jo={name:i,styles:a,next:jo},i})}return Jq[e]!==1&&!l3(e)&&typeof n=="number"&&n!==0?n+"px":n};function Qf(t,e,n){if(n==null)return"";if(n.__emotion_styles!==void 0)return n;switch(typeof n){case"boolean":return"";case"object":{if(n.anim===1)return jo={name:n.name,styles:n.styles,next:jo},n.name;if(n.styles!==void 0){var r=n.next;if(r!==void 0)for(;r!==void 0;)jo={name:r.name,styles:r.styles,next:jo},r=r.next;var i=n.styles+";";return i}return tZ(t,e,n)}case"function":{if(t!==void 0){var a=jo,h=n(t);return jo=a,Qf(t,e,h)}break}}if(e==null)return n;var l=e[n];return l!==void 0?l:n}function tZ(t,e,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=Qf(t,e,n[i])+";";else for(var a in n){var h=n[a];if(typeof h!="object")e!=null&&e[h]!==void 0?r+=a+"{"+e[h]+"}":zA(h)&&(r+=hx(a)+":"+DA(a,h)+";");else if(Array.isArray(h)&&typeof h[0]=="string"&&(e==null||e[h[0]]===void 0))for(var l=0;l<h.length;l++)zA(h[l])&&(r+=hx(a)+":"+DA(a,h[l])+";");else{var m=Qf(t,e,h);switch(a){case"animation":case"animationName":{r+=hx(a)+":"+m+";";break}default:r+=a+"{"+m+"}"}}}return r}var OA=/label:\s*([^\s;\n{]+)\s*(;|$)/g,jo,c3=function(e,n,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var i=!0,a="";jo=void 0;var h=e[0];h==null||h.raw===void 0?(i=!1,a+=Qf(r,n,h)):a+=h[0];for(var l=1;l<e.length;l++)a+=Qf(r,n,e[l]),i&&(a+=h[l]);OA.lastIndex=0;for(var m="",v;(v=OA.exec(a))!==null;)m+="-"+v[1];var E=Kq(a)+m;return{name:E,styles:a,next:jo}},nZ=function(e){return e()},rZ=CE["useInsertionEffect"]?CE["useInsertionEffect"]:!1,iZ=rZ||nZ,u3=Pe.createContext(typeof HTMLElement<"u"?Nq({key:"css"}):null);u3.Provider;var sZ=function(e){return Pe.forwardRef(function(n,r){var i=Pe.useContext(u3);return e(n,i,r)})},h3=Pe.createContext({});function oZ(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return c3(e)}var jw=function(){var e=oZ.apply(void 0,arguments),n="animation-"+e.name;return{name:n,styles:"@keyframes "+n+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},aZ=uq,lZ=function(e){return e!=="theme"},FA=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?aZ:lZ},BA=function(e,n,r){var i;if(n){var a=n.shouldForwardProp;i=e.__emotion_forwardProp&&a?function(h){return e.__emotion_forwardProp(h)&&a(h)}:a}return typeof i!="function"&&r&&(i=e.__emotion_forwardProp),i},cZ=function(e){var n=e.cache,r=e.serialized,i=e.isStringTag;return a3(n,r,i),iZ(function(){return Yq(n,r,i)}),null},uZ=function t(e,n){var r=e.__emotion_real===e,i=r&&e.__emotion_base||e,a,h;n!==void 0&&(a=n.label,h=n.target);var l=BA(e,n,r),m=l||FA(i),v=!m("as");return function(){var E=arguments,T=r&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(a!==void 0&&T.push("label:"+a+";"),E[0]==null||E[0].raw===void 0)T.push.apply(T,E);else{T.push(E[0][0]);for(var S=E.length,z=1;z<S;z++)T.push(E[z],E[0][z])}var D=sZ(function(F,J,U){var V=v&&F.as||i,G="",ee=[],se=F;if(F.theme==null){se={};for(var me in F)se[me]=F[me];se.theme=Pe.useContext(h3)}typeof F.className=="string"?G=Xq(J.registered,ee,F.className):F.className!=null&&(G=F.className+" ");var ve=c3(T.concat(ee),J.registered,se);G+=J.key+"-"+ve.name,h!==void 0&&(G+=" "+h);var Me=v&&l===void 0?FA(V):m,Be={};for(var ze in F)v&&ze==="as"||Me(ze)&&(Be[ze]=F[ze]);return Be.className=G,Be.ref=U,Pe.createElement(Pe.Fragment,null,Pe.createElement(cZ,{cache:J,serialized:ve,isStringTag:typeof V=="string"}),Pe.createElement(V,Be))});return D.displayName=a!==void 0?a:"Styled("+(typeof i=="string"?i:i.displayName||i.name||"Component")+")",D.defaultProps=e.defaultProps,D.__emotion_real=D,D.__emotion_base=i,D.__emotion_styles=T,D.__emotion_forwardProp=l,Object.defineProperty(D,"toString",{value:function(){return"."+h}}),D.withComponent=function(F,J){return t(F,Ge({},n,J,{shouldForwardProp:BA(D,J,!0)})).apply(void 0,T)},D}},hZ=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],X1=uZ.bind();hZ.forEach(function(t){X1[t]=X1(t)});var d3={exports:{}},F0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dZ=Pe,fZ=Symbol.for("react.element"),pZ=Symbol.for("react.fragment"),mZ=Object.prototype.hasOwnProperty,gZ=dZ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yZ={key:!0,ref:!0,__self:!0,__source:!0};function f3(t,e,n){var r,i={},a=null,h=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(h=e.ref);for(r in e)mZ.call(e,r)&&!yZ.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:fZ,type:t,key:a,ref:h,props:i,_owner:gZ.current}}F0.Fragment=pZ;F0.jsx=f3;F0.jsxs=f3;d3.exports=F0;var vn=d3.exports;/**
 * @mui/styled-engine v5.13.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function _Z(t,e){return X1(t,e)}const vZ=(t,e)=>{Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))},xZ=["values","unit","step"],bZ=t=>{const e=Object.keys(t).map(n=>({key:n,val:t[n]}))||[];return e.sort((n,r)=>n.val-r.val),e.reduce((n,r)=>Ge({},n,{[r.key]:r.val}),{})};function wZ(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:r=5}=t,i=Nr(t,xZ),a=bZ(e),h=Object.keys(a);function l(S){return`@media (min-width:${typeof e[S]=="number"?e[S]:S}${n})`}function m(S){return`@media (max-width:${(typeof e[S]=="number"?e[S]:S)-r/100}${n})`}function v(S,z){const D=h.indexOf(z);return`@media (min-width:${typeof e[S]=="number"?e[S]:S}${n}) and (max-width:${(D!==-1&&typeof e[h[D]]=="number"?e[h[D]]:z)-r/100}${n})`}function E(S){return h.indexOf(S)+1<h.length?v(S,h[h.indexOf(S)+1]):l(S)}function T(S){const z=h.indexOf(S);return z===0?l(h[1]):z===h.length-1?m(h[z]):v(S,h[h.indexOf(S)+1]).replace("@media","@media not all and")}return Ge({keys:h,values:a,up:l,down:m,between:v,only:E,not:T,unit:n},i)}const EZ={borderRadius:4},TZ=EZ;function yf(t,e){return e?Eo(t,e,{clone:!1}):t}const Gw={xs:0,sm:600,md:900,lg:1200,xl:1536},NA={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${Gw[t]}px)`};function So(t,e,n){const r=t.theme||{};if(Array.isArray(e)){const a=r.breakpoints||NA;return e.reduce((h,l,m)=>(h[a.up(a.keys[m])]=n(e[m]),h),{})}if(typeof e=="object"){const a=r.breakpoints||NA;return Object.keys(e).reduce((h,l)=>{if(Object.keys(a.values||Gw).indexOf(l)!==-1){const m=a.up(l);h[m]=n(e[l],l)}else{const m=l;h[m]=e[m]}return h},{})}return n(e)}function p3(t={}){var e;return((e=t.keys)==null?void 0:e.reduce((r,i)=>{const a=t.up(i);return r[a]={},r},{}))||{}}function m3(t,e){return t.reduce((n,r)=>{const i=n[r];return(!i||Object.keys(i).length===0)&&delete n[r],n},e)}function SZ(t,...e){const n=p3(t),r=[n,...e].reduce((i,a)=>Eo(i,a),{});return m3(Object.keys(n),r)}function PZ(t,e){if(typeof t!="object")return{};const n={},r=Object.keys(e);return Array.isArray(t)?r.forEach((i,a)=>{a<t.length&&(n[i]=!0)}):r.forEach(i=>{t[i]!=null&&(n[i]=!0)}),n}function dx({values:t,breakpoints:e,base:n}){const r=n||PZ(t,e),i=Object.keys(r);if(i.length===0)return t;let a;return i.reduce((h,l,m)=>(Array.isArray(t)?(h[l]=t[m]!=null?t[m]:t[a],a=m):typeof t=="object"?(h[l]=t[l]!=null?t[l]:t[a],a=l):h[l]=t,h),{})}function B0(t,e,n=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&n){const r=`vars.${e}`.split(".").reduce((i,a)=>i&&i[a]?i[a]:null,t);if(r!=null)return r}return e.split(".").reduce((r,i)=>r&&r[i]!=null?r[i]:null,t)}function Vy(t,e,n,r=n){let i;return typeof t=="function"?i=t(n):Array.isArray(t)?i=t[n]||r:i=B0(t,n)||r,e&&(i=e(i,r,t)),i}function Rn(t){const{prop:e,cssProperty:n=t.prop,themeKey:r,transform:i}=t,a=h=>{if(h[e]==null)return null;const l=h[e],m=h.theme,v=B0(m,r)||{};return So(h,l,T=>{let S=Vy(v,i,T);return T===S&&typeof T=="string"&&(S=Vy(v,i,`${e}${T==="default"?"":Kn(T)}`,T)),n===!1?S:{[n]:S}})};return a.propTypes={},a.filterProps=[e],a}function AZ(t){const e={};return n=>(e[n]===void 0&&(e[n]=t(n)),e[n])}const CZ={m:"margin",p:"padding"},IZ={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},UA={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},MZ=AZ(t=>{if(t.length>2)if(UA[t])t=UA[t];else return[t];const[e,n]=t.split(""),r=CZ[e],i=IZ[n]||"";return Array.isArray(i)?i.map(a=>r+a):[r+i]}),$w=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],Ww=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...$w,...Ww];function wp(t,e,n,r){var i;const a=(i=B0(t,e,!1))!=null?i:n;return typeof a=="number"?h=>typeof h=="string"?h:a*h:Array.isArray(a)?h=>typeof h=="string"?h:a[h]:typeof a=="function"?a:()=>{}}function Hw(t){return wp(t,"spacing",8)}function Nc(t,e){if(typeof e=="string"||e==null)return e;const n=Math.abs(e),r=t(n);return e>=0?r:typeof r=="number"?-r:`-${r}`}function kZ(t,e){return n=>t.reduce((r,i)=>(r[i]=Nc(e,n),r),{})}function LZ(t,e,n,r){if(e.indexOf(n)===-1)return null;const i=MZ(n),a=kZ(i,r),h=t[n];return So(t,h,a)}function g3(t,e){const n=Hw(t.theme);return Object.keys(t).map(r=>LZ(t,e,r,n)).reduce(yf,{})}function Cr(t){return g3(t,$w)}Cr.propTypes={};Cr.filterProps=$w;function Ir(t){return g3(t,Ww)}Ir.propTypes={};Ir.filterProps=Ww;function RZ(t=8){if(t.mui)return t;const e=Hw({spacing:t}),n=(...r)=>(r.length===0?[1]:r).map(a=>{const h=e(a);return typeof h=="number"?`${h}px`:h}).join(" ");return n.mui=!0,n}function N0(...t){const e=t.reduce((r,i)=>(i.filterProps.forEach(a=>{r[a]=i}),r),{}),n=r=>Object.keys(r).reduce((i,a)=>e[a]?yf(i,e[a](r)):i,{});return n.propTypes={},n.filterProps=t.reduce((r,i)=>r.concat(i.filterProps),[]),n}function Wo(t){return typeof t!="number"?t:`${t}px solid`}const zZ=Rn({prop:"border",themeKey:"borders",transform:Wo}),DZ=Rn({prop:"borderTop",themeKey:"borders",transform:Wo}),OZ=Rn({prop:"borderRight",themeKey:"borders",transform:Wo}),FZ=Rn({prop:"borderBottom",themeKey:"borders",transform:Wo}),BZ=Rn({prop:"borderLeft",themeKey:"borders",transform:Wo}),NZ=Rn({prop:"borderColor",themeKey:"palette"}),UZ=Rn({prop:"borderTopColor",themeKey:"palette"}),VZ=Rn({prop:"borderRightColor",themeKey:"palette"}),jZ=Rn({prop:"borderBottomColor",themeKey:"palette"}),GZ=Rn({prop:"borderLeftColor",themeKey:"palette"}),U0=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=wp(t.theme,"shape.borderRadius",4),n=r=>({borderRadius:Nc(e,r)});return So(t,t.borderRadius,n)}return null};U0.propTypes={};U0.filterProps=["borderRadius"];N0(zZ,DZ,OZ,FZ,BZ,NZ,UZ,VZ,jZ,GZ,U0);const V0=t=>{if(t.gap!==void 0&&t.gap!==null){const e=wp(t.theme,"spacing",8),n=r=>({gap:Nc(e,r)});return So(t,t.gap,n)}return null};V0.propTypes={};V0.filterProps=["gap"];const j0=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=wp(t.theme,"spacing",8),n=r=>({columnGap:Nc(e,r)});return So(t,t.columnGap,n)}return null};j0.propTypes={};j0.filterProps=["columnGap"];const G0=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=wp(t.theme,"spacing",8),n=r=>({rowGap:Nc(e,r)});return So(t,t.rowGap,n)}return null};G0.propTypes={};G0.filterProps=["rowGap"];const $Z=Rn({prop:"gridColumn"}),WZ=Rn({prop:"gridRow"}),HZ=Rn({prop:"gridAutoFlow"}),qZ=Rn({prop:"gridAutoColumns"}),ZZ=Rn({prop:"gridAutoRows"}),XZ=Rn({prop:"gridTemplateColumns"}),YZ=Rn({prop:"gridTemplateRows"}),KZ=Rn({prop:"gridTemplateAreas"}),JZ=Rn({prop:"gridArea"});N0(V0,j0,G0,$Z,WZ,HZ,qZ,ZZ,XZ,YZ,KZ,JZ);function ah(t,e){return e==="grey"?e:t}const QZ=Rn({prop:"color",themeKey:"palette",transform:ah}),eX=Rn({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:ah}),tX=Rn({prop:"backgroundColor",themeKey:"palette",transform:ah});N0(QZ,eX,tX);function Cs(t){return t<=1&&t!==0?`${t*100}%`:t}const nX=Rn({prop:"width",transform:Cs}),qw=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=n=>{var r;return{maxWidth:((r=t.theme)==null||(r=r.breakpoints)==null||(r=r.values)==null?void 0:r[n])||Gw[n]||Cs(n)}};return So(t,t.maxWidth,e)}return null};qw.filterProps=["maxWidth"];const rX=Rn({prop:"minWidth",transform:Cs}),iX=Rn({prop:"height",transform:Cs}),sX=Rn({prop:"maxHeight",transform:Cs}),oX=Rn({prop:"minHeight",transform:Cs});Rn({prop:"size",cssProperty:"width",transform:Cs});Rn({prop:"size",cssProperty:"height",transform:Cs});const aX=Rn({prop:"boxSizing"});N0(nX,qw,rX,iX,sX,oX,aX);const lX={border:{themeKey:"borders",transform:Wo},borderTop:{themeKey:"borders",transform:Wo},borderRight:{themeKey:"borders",transform:Wo},borderBottom:{themeKey:"borders",transform:Wo},borderLeft:{themeKey:"borders",transform:Wo},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:U0},color:{themeKey:"palette",transform:ah},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:ah},backgroundColor:{themeKey:"palette",transform:ah},p:{style:Ir},pt:{style:Ir},pr:{style:Ir},pb:{style:Ir},pl:{style:Ir},px:{style:Ir},py:{style:Ir},padding:{style:Ir},paddingTop:{style:Ir},paddingRight:{style:Ir},paddingBottom:{style:Ir},paddingLeft:{style:Ir},paddingX:{style:Ir},paddingY:{style:Ir},paddingInline:{style:Ir},paddingInlineStart:{style:Ir},paddingInlineEnd:{style:Ir},paddingBlock:{style:Ir},paddingBlockStart:{style:Ir},paddingBlockEnd:{style:Ir},m:{style:Cr},mt:{style:Cr},mr:{style:Cr},mb:{style:Cr},ml:{style:Cr},mx:{style:Cr},my:{style:Cr},margin:{style:Cr},marginTop:{style:Cr},marginRight:{style:Cr},marginBottom:{style:Cr},marginLeft:{style:Cr},marginX:{style:Cr},marginY:{style:Cr},marginInline:{style:Cr},marginInlineStart:{style:Cr},marginInlineEnd:{style:Cr},marginBlock:{style:Cr},marginBlockStart:{style:Cr},marginBlockEnd:{style:Cr},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:V0},rowGap:{style:G0},columnGap:{style:j0},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Cs},maxWidth:{style:qw},minWidth:{transform:Cs},height:{transform:Cs},maxHeight:{transform:Cs},minHeight:{transform:Cs},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}},$0=lX;function cX(...t){const e=t.reduce((r,i)=>r.concat(Object.keys(i)),[]),n=new Set(e);return t.every(r=>n.size===Object.keys(r).length)}function uX(t,e){return typeof t=="function"?t(e):t}function hX(){function t(n,r,i,a){const h={[n]:r,theme:i},l=a[n];if(!l)return{[n]:r};const{cssProperty:m=n,themeKey:v,transform:E,style:T}=l;if(r==null)return null;if(v==="typography"&&r==="inherit")return{[n]:r};const S=B0(i,v)||{};return T?T(h):So(h,r,D=>{let F=Vy(S,E,D);return D===F&&typeof D=="string"&&(F=Vy(S,E,`${n}${D==="default"?"":Kn(D)}`,D)),m===!1?F:{[m]:F}})}function e(n){var r;const{sx:i,theme:a={}}=n||{};if(!i)return null;const h=(r=a.unstable_sxConfig)!=null?r:$0;function l(m){let v=m;if(typeof m=="function")v=m(a);else if(typeof m!="object")return m;if(!v)return null;const E=p3(a.breakpoints),T=Object.keys(E);let S=E;return Object.keys(v).forEach(z=>{const D=uX(v[z],a);if(D!=null)if(typeof D=="object")if(h[z])S=yf(S,t(z,D,a,h));else{const F=So({theme:a},D,J=>({[z]:J}));cX(F,D)?S[z]=e({sx:D,theme:a}):S=yf(S,F)}else S=yf(S,t(z,D,a,h))}),m3(T,S)}return Array.isArray(i)?i.map(l):l(i)}return e}const y3=hX();y3.filterProps=["sx"];const Zw=y3,dX=["breakpoints","palette","spacing","shape"];function Ep(t={},...e){const{breakpoints:n={},palette:r={},spacing:i,shape:a={}}=t,h=Nr(t,dX),l=wZ(n),m=RZ(i);let v=Eo({breakpoints:l,direction:"ltr",components:{},palette:Ge({mode:"light"},r),spacing:m,shape:Ge({},TZ,a)},h);return v=e.reduce((E,T)=>Eo(E,T),v),v.unstable_sxConfig=Ge({},$0,h==null?void 0:h.unstable_sxConfig),v.unstable_sx=function(T){return Zw({sx:T,theme:this})},v}function fX(t){return Object.keys(t).length===0}function pX(t=null){const e=Pe.useContext(h3);return!e||fX(e)?t:e}const mX=Ep();function _3(t=mX){return pX(t)}const gX=["sx"],yX=t=>{var e,n;const r={systemProps:{},otherProps:{}},i=(e=t==null||(n=t.theme)==null?void 0:n.unstable_sxConfig)!=null?e:$0;return Object.keys(t).forEach(a=>{i[a]?r.systemProps[a]=t[a]:r.otherProps[a]=t[a]}),r};function v3(t){const{sx:e}=t,n=Nr(t,gX),{systemProps:r,otherProps:i}=yX(n);let a;return Array.isArray(e)?a=[r,...e]:typeof e=="function"?a=(...h)=>{const l=e(...h);return gc(l)?Ge({},r,l):r}:a=Ge({},r,e),Ge({},i,{sx:a})}function x3(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=x3(t[e]))&&(r&&(r+=" "),r+=n);else for(e in t)t[e]&&(r&&(r+=" "),r+=e);return r}function ir(){for(var t,e,n=0,r="";n<arguments.length;)(t=arguments[n++])&&(e=x3(t))&&(r&&(r+=" "),r+=e);return r}const _X=["variant"];function VA(t){return t.length===0}function b3(t){const{variant:e}=t,n=Nr(t,_X);let r=e||"";return Object.keys(n).sort().forEach(i=>{i==="color"?r+=VA(r)?t[i]:Kn(t[i]):r+=`${VA(r)?i:Kn(i)}${Kn(t[i].toString())}`}),r}const vX=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function xX(t){return Object.keys(t).length===0}function bX(t){return typeof t=="string"&&t.charCodeAt(0)>96}const wX=(t,e)=>e.components&&e.components[t]&&e.components[t].styleOverrides?e.components[t].styleOverrides:null,EX=(t,e)=>{let n=[];e&&e.components&&e.components[t]&&e.components[t].variants&&(n=e.components[t].variants);const r={};return n.forEach(i=>{const a=b3(i.props);r[a]=i.style}),r},TX=(t,e,n,r)=>{var i;const{ownerState:a={}}=t,h=[],l=n==null||(i=n.components)==null||(i=i[r])==null?void 0:i.variants;return l&&l.forEach(m=>{let v=!0;Object.keys(m.props).forEach(E=>{a[E]!==m.props[E]&&t[E]!==m.props[E]&&(v=!1)}),v&&h.push(e[b3(m.props)])}),h};function _f(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const SX=Ep();function Hd({defaultTheme:t,theme:e,themeId:n}){return xX(e)?t:e[n]||e}function w3(t={}){const{themeId:e,defaultTheme:n=SX,rootShouldForwardProp:r=_f,slotShouldForwardProp:i=_f}=t,a=h=>Zw(Ge({},h,{theme:Hd(Ge({},h,{defaultTheme:n,themeId:e}))}));return a.__mui_systemSx=!0,(h,l={})=>{vZ(h,ee=>ee.filter(se=>!(se!=null&&se.__mui_systemSx)));const{name:m,slot:v,skipVariantsResolver:E,skipSx:T,overridesResolver:S}=l,z=Nr(l,vX),D=E!==void 0?E:v&&v!=="Root"||!1,F=T||!1;let J,U=_f;v==="Root"?U=r:v?U=i:bX(h)&&(U=void 0);const V=_Z(h,Ge({shouldForwardProp:U,label:J},z)),G=(ee,...se)=>{const me=se?se.map(ze=>typeof ze=="function"&&ze.__emotion_real!==ze?Oe=>ze(Ge({},Oe,{theme:Hd(Ge({},Oe,{defaultTheme:n,themeId:e}))})):ze):[];let ve=ee;m&&S&&me.push(ze=>{const Oe=Hd(Ge({},ze,{defaultTheme:n,themeId:e})),tt=wX(m,Oe);if(tt){const et={};return Object.entries(tt).forEach(([st,Bt])=>{et[st]=typeof Bt=="function"?Bt(Ge({},ze,{theme:Oe})):Bt}),S(ze,et)}return null}),m&&!D&&me.push(ze=>{const Oe=Hd(Ge({},ze,{defaultTheme:n,themeId:e}));return TX(ze,EX(m,Oe),Oe,m)}),F||me.push(a);const Me=me.length-se.length;if(Array.isArray(ee)&&Me>0){const ze=new Array(Me).fill("");ve=[...ee,...ze],ve.raw=[...ee.raw,...ze]}else typeof ee=="function"&&ee.__emotion_real!==ee&&(ve=ze=>ee(Ge({},ze,{theme:Hd(Ge({},ze,{defaultTheme:n,themeId:e}))})));const Be=V(ve,...me);return h.muiName&&(Be.muiName=h.muiName),Be};return V.withConfig&&(G.withConfig=V.withConfig),G}}const PX=w3(),E3=PX;function AX(t){const{theme:e,name:n,props:r}=t;return!e||!e.components||!e.components[n]||!e.components[n].defaultProps?r:ZL(e.components[n].defaultProps,r)}function Xw({props:t,name:e,defaultTheme:n,themeId:r}){let i=_3(n);return r&&(i=i[r]||i),AX({theme:i,name:e,props:t})}function Yw(t,e=0,n=1){return Math.min(Math.max(e,t),n)}function CX(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let n=t.match(e);return n&&n[0].length===1&&(n=n.map(r=>r+r)),n?`rgb${n.length===4?"a":""}(${n.map((r,i)=>i<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3).join(", ")})`:""}function Uc(t){if(t.type)return t;if(t.charAt(0)==="#")return Uc(CX(t));const e=t.indexOf("("),n=t.substring(0,e);if(["rgb","rgba","hsl","hsla","color"].indexOf(n)===-1)throw new Error(Ch(9,t));let r=t.substring(e+1,t.length-1),i;if(n==="color"){if(r=r.split(" "),i=r.shift(),r.length===4&&r[3].charAt(0)==="/"&&(r[3]=r[3].slice(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(i)===-1)throw new Error(Ch(10,i))}else r=r.split(",");return r=r.map(a=>parseFloat(a)),{type:n,values:r,colorSpace:i}}function W0(t){const{type:e,colorSpace:n}=t;let{values:r}=t;return e.indexOf("rgb")!==-1?r=r.map((i,a)=>a<3?parseInt(i,10):i):e.indexOf("hsl")!==-1&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),e.indexOf("color")!==-1?r=`${n} ${r.join(" ")}`:r=`${r.join(", ")}`,`${e}(${r})`}function IX(t){t=Uc(t);const{values:e}=t,n=e[0],r=e[1]/100,i=e[2]/100,a=r*Math.min(i,1-i),h=(v,E=(v+n/30)%12)=>i-a*Math.max(Math.min(E-3,9-E,1),-1);let l="rgb";const m=[Math.round(h(0)*255),Math.round(h(8)*255),Math.round(h(4)*255)];return t.type==="hsla"&&(l+="a",m.push(e[3])),W0({type:l,values:m})}function jA(t){t=Uc(t);let e=t.type==="hsl"||t.type==="hsla"?Uc(IX(t)).values:t.values;return e=e.map(n=>(t.type!=="color"&&(n/=255),n<=.03928?n/12.92:((n+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function MX(t,e){const n=jA(t),r=jA(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function jy(t,e){return t=Uc(t),e=Yw(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,W0(t)}function Kw(t,e){if(t=Uc(t),e=Yw(e),t.type.indexOf("hsl")!==-1)t.values[2]*=1-e;else if(t.type.indexOf("rgb")!==-1||t.type.indexOf("color")!==-1)for(let n=0;n<3;n+=1)t.values[n]*=1-e;return W0(t)}function Jw(t,e){if(t=Uc(t),e=Yw(e),t.type.indexOf("hsl")!==-1)t.values[2]+=(100-t.values[2])*e;else if(t.type.indexOf("rgb")!==-1)for(let n=0;n<3;n+=1)t.values[n]+=(255-t.values[n])*e;else if(t.type.indexOf("color")!==-1)for(let n=0;n<3;n+=1)t.values[n]+=(1-t.values[n])*e;return W0(t)}const kX=["className","component","disableGutters","fixed","maxWidth","classes"],LX=Ep(),RX=E3("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`maxWidth${Kn(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),zX=t=>Xw({props:t,name:"MuiContainer",defaultTheme:LX}),DX=(t,e)=>{const n=m=>ea(e,m),{classes:r,fixed:i,disableGutters:a,maxWidth:h}=t,l={root:["root",h&&`maxWidth${Kn(String(h))}`,i&&"fixed",a&&"disableGutters"]};return Da(l,n,r)};function OX(t={}){const{createStyledComponent:e=RX,useThemeProps:n=zX,componentName:r="MuiContainer"}=t,i=e(({theme:h,ownerState:l})=>Ge({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!l.disableGutters&&{paddingLeft:h.spacing(2),paddingRight:h.spacing(2),[h.breakpoints.up("sm")]:{paddingLeft:h.spacing(3),paddingRight:h.spacing(3)}}),({theme:h,ownerState:l})=>l.fixed&&Object.keys(h.breakpoints.values).reduce((m,v)=>{const E=v,T=h.breakpoints.values[E];return T!==0&&(m[h.breakpoints.up(E)]={maxWidth:`${T}${h.breakpoints.unit}`}),m},{}),({theme:h,ownerState:l})=>Ge({},l.maxWidth==="xs"&&{[h.breakpoints.up("xs")]:{maxWidth:Math.max(h.breakpoints.values.xs,444)}},l.maxWidth&&l.maxWidth!=="xs"&&{[h.breakpoints.up(l.maxWidth)]:{maxWidth:`${h.breakpoints.values[l.maxWidth]}${h.breakpoints.unit}`}}));return Pe.forwardRef(function(l,m){const v=n(l),{className:E,component:T="div",disableGutters:S=!1,fixed:z=!1,maxWidth:D="lg"}=v,F=Nr(v,kX),J=Ge({},v,{component:T,disableGutters:S,fixed:z,maxWidth:D}),U=DX(J,r);return vn.jsx(i,Ge({as:T,ownerState:J,className:ir(U.root,E),ref:m},F))})}const FX=["component","direction","spacing","divider","children","className","useFlexGap"],BX=Ep(),NX=E3("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,e)=>e.root});function UX(t){return Xw({props:t,name:"MuiStack",defaultTheme:BX})}function VX(t,e){const n=Pe.Children.toArray(t).filter(Boolean);return n.reduce((r,i,a)=>(r.push(i),a<n.length-1&&r.push(Pe.cloneElement(e,{key:`separator-${a}`})),r),[])}const jX=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],GX=({ownerState:t,theme:e})=>{let n=Ge({display:"flex",flexDirection:"column"},So({theme:e},dx({values:t.direction,breakpoints:e.breakpoints.values}),r=>({flexDirection:r})));if(t.spacing){const r=Hw(e),i=Object.keys(e.breakpoints.values).reduce((m,v)=>((typeof t.spacing=="object"&&t.spacing[v]!=null||typeof t.direction=="object"&&t.direction[v]!=null)&&(m[v]=!0),m),{}),a=dx({values:t.direction,base:i}),h=dx({values:t.spacing,base:i});typeof a=="object"&&Object.keys(a).forEach((m,v,E)=>{if(!a[m]){const S=v>0?a[E[v-1]]:"column";a[m]=S}}),n=Eo(n,So({theme:e},h,(m,v)=>t.useFlexGap?{gap:Nc(r,m)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${jX(v?a[v]:t.direction)}`]:Nc(r,m)}}))}return n=SZ(e.breakpoints,n),n};function $X(t={}){const{createStyledComponent:e=NX,useThemeProps:n=UX,componentName:r="MuiStack"}=t,i=()=>Da({root:["root"]},m=>ea(r,m),{}),a=e(GX);return Pe.forwardRef(function(m,v){const E=n(m),T=v3(E),{component:S="div",direction:z="column",spacing:D=0,divider:F,children:J,className:U,useFlexGap:V=!1}=T,G=Nr(T,FX),ee={direction:z,spacing:D,useFlexGap:V},se=i();return vn.jsx(a,Ge({as:S,ownerState:ee,ref:v,className:ir(se.root,U)},G,{children:F?VX(J,F):J}))})}function WX(t,e){return Ge({toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}}},e)}const HX=["mode","contrastThreshold","tonalOffset"],GA={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Xf.white,default:Xf.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},fx={text:{primary:Xf.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Xf.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function $A(t,e,n,r){const i=r.light||r,a=r.dark||r*1.5;t[e]||(t.hasOwnProperty(n)?t[e]=t[n]:e==="light"?t.light=Jw(t.main,i):e==="dark"&&(t.dark=Kw(t.main,a)))}function qX(t="light"){return t==="dark"?{main:ku[200],light:ku[50],dark:ku[400]}:{main:ku[700],light:ku[400],dark:ku[800]}}function ZX(t="light"){return t==="dark"?{main:Mu[200],light:Mu[50],dark:Mu[400]}:{main:Mu[500],light:Mu[300],dark:Mu[700]}}function XX(t="light"){return t==="dark"?{main:Iu[500],light:Iu[300],dark:Iu[700]}:{main:Iu[700],light:Iu[400],dark:Iu[800]}}function YX(t="light"){return t==="dark"?{main:Lu[400],light:Lu[300],dark:Lu[700]}:{main:Lu[700],light:Lu[500],dark:Lu[900]}}function KX(t="light"){return t==="dark"?{main:Ru[400],light:Ru[300],dark:Ru[700]}:{main:Ru[800],light:Ru[500],dark:Ru[900]}}function JX(t="light"){return t==="dark"?{main:$d[400],light:$d[300],dark:$d[700]}:{main:"#ed6c02",light:$d[500],dark:$d[900]}}function QX(t){const{mode:e="light",contrastThreshold:n=3,tonalOffset:r=.2}=t,i=Nr(t,HX),a=t.primary||qX(e),h=t.secondary||ZX(e),l=t.error||XX(e),m=t.info||YX(e),v=t.success||KX(e),E=t.warning||JX(e);function T(F){return MX(F,fx.text.primary)>=n?fx.text.primary:GA.text.primary}const S=({color:F,name:J,mainShade:U=500,lightShade:V=300,darkShade:G=700})=>{if(F=Ge({},F),!F.main&&F[U]&&(F.main=F[U]),!F.hasOwnProperty("main"))throw new Error(Ch(11,J?` (${J})`:"",U));if(typeof F.main!="string")throw new Error(Ch(12,J?` (${J})`:"",JSON.stringify(F.main)));return $A(F,"light",V,r),$A(F,"dark",G,r),F.contrastText||(F.contrastText=T(F.main)),F},z={dark:fx,light:GA};return Eo(Ge({common:Ge({},Xf),mode:e,primary:S({color:a,name:"primary"}),secondary:S({color:h,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:S({color:l,name:"error"}),warning:S({color:E,name:"warning"}),info:S({color:m,name:"info"}),success:S({color:v,name:"success"}),grey:ZH,contrastThreshold:n,getContrastText:T,augmentColor:S,tonalOffset:r},z[e]),i)}const eY=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function tY(t){return Math.round(t*1e5)/1e5}const WA={textTransform:"uppercase"},HA='"Roboto", "Helvetica", "Arial", sans-serif';function nY(t,e){const n=typeof e=="function"?e(t):e,{fontFamily:r=HA,fontSize:i=14,fontWeightLight:a=300,fontWeightRegular:h=400,fontWeightMedium:l=500,fontWeightBold:m=700,htmlFontSize:v=16,allVariants:E,pxToRem:T}=n,S=Nr(n,eY),z=i/14,D=T||(U=>`${U/v*z}rem`),F=(U,V,G,ee,se)=>Ge({fontFamily:r,fontWeight:U,fontSize:D(V),lineHeight:G},r===HA?{letterSpacing:`${tY(ee/V)}em`}:{},se,E),J={h1:F(a,96,1.167,-1.5),h2:F(a,60,1.2,-.5),h3:F(h,48,1.167,0),h4:F(h,34,1.235,.25),h5:F(h,24,1.334,0),h6:F(l,20,1.6,.15),subtitle1:F(h,16,1.75,.15),subtitle2:F(l,14,1.57,.1),body1:F(h,16,1.5,.15),body2:F(h,14,1.43,.15),button:F(l,14,1.75,.4,WA),caption:F(h,12,1.66,.4),overline:F(h,12,2.66,1,WA),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Eo(Ge({htmlFontSize:v,pxToRem:D,fontFamily:r,fontSize:i,fontWeightLight:a,fontWeightRegular:h,fontWeightMedium:l,fontWeightBold:m},J),S,{clone:!1})}const rY=.2,iY=.14,sY=.12;function mr(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${rY})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${iY})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${sY})`].join(",")}const oY=["none",mr(0,2,1,-1,0,1,1,0,0,1,3,0),mr(0,3,1,-2,0,2,2,0,0,1,5,0),mr(0,3,3,-2,0,3,4,0,0,1,8,0),mr(0,2,4,-1,0,4,5,0,0,1,10,0),mr(0,3,5,-1,0,5,8,0,0,1,14,0),mr(0,3,5,-1,0,6,10,0,0,1,18,0),mr(0,4,5,-2,0,7,10,1,0,2,16,1),mr(0,5,5,-3,0,8,10,1,0,3,14,2),mr(0,5,6,-3,0,9,12,1,0,3,16,2),mr(0,6,6,-3,0,10,14,1,0,4,18,3),mr(0,6,7,-4,0,11,15,1,0,4,20,3),mr(0,7,8,-4,0,12,17,2,0,5,22,4),mr(0,7,8,-4,0,13,19,2,0,5,24,4),mr(0,7,9,-4,0,14,21,2,0,5,26,4),mr(0,8,9,-5,0,15,22,2,0,6,28,5),mr(0,8,10,-5,0,16,24,2,0,6,30,5),mr(0,8,11,-5,0,17,26,2,0,6,32,5),mr(0,9,11,-5,0,18,28,2,0,7,34,6),mr(0,9,12,-6,0,19,29,2,0,7,36,6),mr(0,10,13,-6,0,20,31,3,0,8,38,7),mr(0,10,13,-6,0,21,33,3,0,8,40,7),mr(0,10,14,-6,0,22,35,3,0,8,42,7),mr(0,11,14,-7,0,23,36,3,0,9,44,8),mr(0,11,15,-7,0,24,38,3,0,9,46,8)],aY=oY,lY=["duration","easing","delay"],cY={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},uY={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function qA(t){return`${Math.round(t)}ms`}function hY(t){if(!t)return 0;const e=t/36;return Math.round((4+15*e**.25+e/5)*10)}function dY(t){const e=Ge({},cY,t.easing),n=Ge({},uY,t.duration);return Ge({getAutoHeightDuration:hY,create:(i=["all"],a={})=>{const{duration:h=n.standard,easing:l=e.easeInOut,delay:m=0}=a;return Nr(a,lY),(Array.isArray(i)?i:[i]).map(v=>`${v} ${typeof h=="string"?h:qA(h)} ${l} ${typeof m=="string"?m:qA(m)}`).join(",")}},t,{easing:e,duration:n})}const fY={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},pY=fY,mY=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function gY(t={},...e){const{mixins:n={},palette:r={},transitions:i={},typography:a={}}=t,h=Nr(t,mY);if(t.vars)throw new Error(Ch(18));const l=QX(r),m=Ep(t);let v=Eo(m,{mixins:WX(m.breakpoints,n),palette:l,shadows:aY.slice(),typography:nY(l,a),transitions:dY(i),zIndex:Ge({},pY)});return v=Eo(v,h),v=e.reduce((E,T)=>Eo(E,T),v),v.unstable_sxConfig=Ge({},$0,h==null?void 0:h.unstable_sxConfig),v.unstable_sx=function(T){return Zw({sx:T,theme:this})},v}const yY=gY(),Qw=yY;function _Y(){const t=_3(Qw);return t[Dw]||t}function Oa({props:t,name:e}){return Xw({props:t,name:e,defaultTheme:Qw,themeId:Dw})}const vY=t=>_f(t)&&t!=="classes",T3=_f,xY=w3({themeId:Dw,defaultTheme:Qw,rootShouldForwardProp:vY}),kr=xY;function vf(t){return typeof t=="string"}function bY(t,e,n){return t===void 0||vf(t)?e:Ge({},e,{ownerState:Ge({},e.ownerState,n)})}function wY(t,e,n=(r,i)=>r===i){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function EY(t,e=[]){if(t===void 0)return{};const n={};return Object.keys(t).filter(r=>r.match(/^on[A-Z]/)&&typeof t[r]=="function"&&!e.includes(r)).forEach(r=>{n[r]=t[r]}),n}function TY(t,e,n){return typeof t=="function"?t(e,n):t}function ZA(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(n=>!(n.match(/^on[A-Z]/)&&typeof t[n]=="function")).forEach(n=>{e[n]=t[n]}),e}function SY(t){const{getSlotProps:e,additionalProps:n,externalSlotProps:r,externalForwardedProps:i,className:a}=t;if(!e){const z=ir(i==null?void 0:i.className,r==null?void 0:r.className,a,n==null?void 0:n.className),D=Ge({},n==null?void 0:n.style,i==null?void 0:i.style,r==null?void 0:r.style),F=Ge({},n,i,r);return z.length>0&&(F.className=z),Object.keys(D).length>0&&(F.style=D),{props:F,internalRef:void 0}}const h=EY(Ge({},i,r)),l=ZA(r),m=ZA(i),v=e(h),E=ir(v==null?void 0:v.className,n==null?void 0:n.className,a,i==null?void 0:i.className,r==null?void 0:r.className),T=Ge({},v==null?void 0:v.style,n==null?void 0:n.style,i==null?void 0:i.style,r==null?void 0:r.style),S=Ge({},v,n,m,l);return E.length>0&&(S.className=E),Object.keys(T).length>0&&(S.style=T),{props:S,internalRef:v.ref}}const PY=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function cl(t){var e;const{elementType:n,externalSlotProps:r,ownerState:i,skipResolvingSlotProps:a=!1}=t,h=Nr(t,PY),l=a?{}:TY(r,i),{props:m,internalRef:v}=SY(Ge({},h,{externalSlotProps:l})),E=Yf(v,l==null?void 0:l.ref,(e=t.additionalProps)==null?void 0:e.ref);return bY(n,Ge({},m,{ref:E}),i)}const AY=2;function S3(t,e){return t-e}function qd(t,e,n){return t==null?e:Math.min(Math.max(e,t),n)}function XA(t,e){var n;const{index:r}=(n=t.reduce((i,a,h)=>{const l=Math.abs(e-a);return i===null||l<i.distance||l===i.distance?{distance:l,index:h}:i},null))!=null?n:{};return r}function ug(t,e){if(e.current!==void 0&&t.changedTouches){const n=t;for(let r=0;r<n.changedTouches.length;r+=1){const i=n.changedTouches[r];if(i.identifier===e.current)return{x:i.clientX,y:i.clientY}}return!1}return{x:t.clientX,y:t.clientY}}function Gy(t,e,n){return(t-e)*100/(n-e)}function CY(t,e,n){return(n-e)*t+e}function IY(t){if(Math.abs(t)<1){const n=t.toExponential().split("e-"),r=n[0].split(".")[1];return(r?r.length:0)+parseInt(n[1],10)}const e=t.toString().split(".")[1];return e?e.length:0}function MY(t,e,n){const r=Math.round((t-n)/e)*e+n;return Number(r.toFixed(IY(e)))}function YA({values:t,newValue:e,index:n}){const r=t.slice();return r[n]=e,r.sort(S3)}function hg({sliderRef:t,activeIndex:e,setActive:n}){var r,i;const a=Bg(t.current);if(!((r=t.current)!=null&&r.contains(a.activeElement))||Number(a==null||(i=a.activeElement)==null?void 0:i.getAttribute("data-index"))!==e){var h;(h=t.current)==null||h.querySelector(`[type="range"][data-index="${e}"]`).focus()}n&&n(e)}function dg(t,e){return typeof t=="number"&&typeof e=="number"?t===e:typeof t=="object"&&typeof e=="object"?wY(t,e):!1}const kY={horizontal:{offset:t=>({left:`${t}%`}),leap:t=>({width:`${t}%`})},"horizontal-reverse":{offset:t=>({right:`${t}%`}),leap:t=>({width:`${t}%`})},vertical:{offset:t=>({bottom:`${t}%`}),leap:t=>({height:`${t}%`})}},LY=t=>t;let fg;function px(){return fg===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?fg=CSS.supports("touch-action","none"):fg=!0),fg}function RY(t){const{"aria-labelledby":e,defaultValue:n,disabled:r=!1,disableSwap:i=!1,isRtl:a=!1,marks:h=!1,max:l=100,min:m=0,name:v,onChange:E,onChangeCommitted:T,orientation:S="horizontal",rootRef:z,scale:D=LY,step:F=1,tabIndex:J,value:U}=t,V=Pe.useRef(),[G,ee]=Pe.useState(-1),[se,me]=Pe.useState(-1),[ve,Me]=Pe.useState(!1),Be=Pe.useRef(0),[ze,Oe]=HL({controlled:U,default:n??m,name:"Slider"}),tt=E&&((Ye,St,Rt)=>{const Ee=Ye.nativeEvent||Ye,Re=new Ee.constructor(Ee.type,Ee);Object.defineProperty(Re,"target",{writable:!0,value:{value:St,name:v}}),E(Re,St,Rt)}),et=Array.isArray(ze);let st=et?ze.slice().sort(S3):[ze];st=st.map(Ye=>qd(Ye,m,l));const Bt=h===!0&&F!==null?[...Array(Math.floor((l-m)/F)+1)].map((Ye,St)=>({value:m+F*St})):h||[],Je=Bt.map(Ye=>Ye.value),{isFocusVisibleRef:en,onBlur:We,onFocus:Qe,ref:Tt}=qL(),[tn,Xt]=Pe.useState(-1),An=Pe.useRef(),xn=Yf(Tt,An),zn=Yf(z,xn),Dn=Ye=>St=>{var Rt;const Ee=Number(St.currentTarget.getAttribute("data-index"));Qe(St),en.current===!0&&Xt(Ee),me(Ee),Ye==null||(Rt=Ye.onFocus)==null||Rt.call(Ye,St)},ln=Ye=>St=>{var Rt;We(St),en.current===!1&&Xt(-1),me(-1),Ye==null||(Rt=Ye.onBlur)==null||Rt.call(Ye,St)};WL(()=>{if(r&&An.current.contains(document.activeElement)){var Ye;(Ye=document.activeElement)==null||Ye.blur()}},[r]),r&&G!==-1&&ee(-1),r&&tn!==-1&&Xt(-1);const Wn=Ye=>St=>{var Rt;(Rt=Ye.onChange)==null||Rt.call(Ye,St);const Ee=Number(St.currentTarget.getAttribute("data-index")),Re=st[Ee],On=Je.indexOf(Re);let Ut=St.target.valueAsNumber;if(Bt&&F==null){const xt=Je[Je.length-1];Ut>xt?Ut=xt:Ut<Je[0]?Ut=Je[0]:Ut=Ut<Re?Je[On-1]:Je[On+1]}if(Ut=qd(Ut,m,l),et){i&&(Ut=qd(Ut,st[Ee-1]||-1/0,st[Ee+1]||1/0));const xt=Ut;Ut=YA({values:st,newValue:Ut,index:Ee});let rn=Ee;i||(rn=Ut.indexOf(xt)),hg({sliderRef:An,activeIndex:rn})}Oe(Ut),Xt(Ee),tt&&!dg(Ut,ze)&&tt(St,Ut,Ee),T&&T(St,Ut)},zt=Pe.useRef();let Tn=S;a&&S==="horizontal"&&(Tn+="-reverse");const Lr=({finger:Ye,move:St=!1})=>{const{current:Rt}=An,{width:Ee,height:Re,bottom:On,left:Ut}=Rt.getBoundingClientRect();let xt;Tn.indexOf("vertical")===0?xt=(On-Ye.y)/Re:xt=(Ye.x-Ut)/Ee,Tn.indexOf("-reverse")!==-1&&(xt=1-xt);let rn;if(rn=CY(xt,m,l),F)rn=MY(rn,F,m);else{const yr=XA(Je,rn);rn=Je[yr]}rn=qd(rn,m,l);let Vn=0;if(et){St?Vn=zt.current:Vn=XA(st,rn),i&&(rn=qd(rn,st[Vn-1]||-1/0,st[Vn+1]||1/0));const yr=rn;rn=YA({values:st,newValue:rn,index:Vn}),i&&St||(Vn=rn.indexOf(yr),zt.current=Vn)}return{newValue:rn,activeIndex:Vn}},Hn=wc(Ye=>{const St=ug(Ye,V);if(!St)return;if(Be.current+=1,Ye.type==="mousemove"&&Ye.buttons===0){pn(Ye);return}const{newValue:Rt,activeIndex:Ee}=Lr({finger:St,move:!0});hg({sliderRef:An,activeIndex:Ee,setActive:ee}),Oe(Rt),!ve&&Be.current>AY&&Me(!0),tt&&!dg(Rt,ze)&&tt(Ye,Rt,Ee)}),pn=wc(Ye=>{const St=ug(Ye,V);if(Me(!1),!St)return;const{newValue:Rt}=Lr({finger:St,move:!0});ee(-1),Ye.type==="touchend"&&me(-1),T&&T(Ye,Rt),V.current=void 0,Jt()}),un=wc(Ye=>{if(r)return;px()||Ye.preventDefault();const St=Ye.changedTouches[0];St!=null&&(V.current=St.identifier);const Rt=ug(Ye,V);if(Rt!==!1){const{newValue:Re,activeIndex:On}=Lr({finger:Rt});hg({sliderRef:An,activeIndex:On,setActive:ee}),Oe(Re),tt&&!dg(Re,ze)&&tt(Ye,Re,On)}Be.current=0;const Ee=Bg(An.current);Ee.addEventListener("touchmove",Hn),Ee.addEventListener("touchend",pn)}),Jt=Pe.useCallback(()=>{const Ye=Bg(An.current);Ye.removeEventListener("mousemove",Hn),Ye.removeEventListener("mouseup",pn),Ye.removeEventListener("touchmove",Hn),Ye.removeEventListener("touchend",pn)},[pn,Hn]);Pe.useEffect(()=>{const{current:Ye}=An;return Ye.addEventListener("touchstart",un,{passive:px()}),()=>{Ye.removeEventListener("touchstart",un,{passive:px()}),Jt()}},[Jt,un]),Pe.useEffect(()=>{r&&Jt()},[r,Jt]);const Un=Ye=>St=>{var Rt;if((Rt=Ye.onMouseDown)==null||Rt.call(Ye,St),r||St.defaultPrevented||St.button!==0)return;St.preventDefault();const Ee=ug(St,V);if(Ee!==!1){const{newValue:On,activeIndex:Ut}=Lr({finger:Ee});hg({sliderRef:An,activeIndex:Ut,setActive:ee}),Oe(On),tt&&!dg(On,ze)&&tt(St,On,Ut)}Be.current=0;const Re=Bg(An.current);Re.addEventListener("mousemove",Hn),Re.addEventListener("mouseup",pn)},Jn=Gy(et?st[0]:m,m,l),Ur=Gy(st[st.length-1],m,l)-Jn,Vt=(Ye={})=>{const St={onMouseDown:Un(Ye||{})},Rt=Ge({},Ye,St);return Ge({ref:zn},Rt)},cn=Ye=>St=>{var Rt;(Rt=Ye.onMouseOver)==null||Rt.call(Ye,St);const Ee=Number(St.currentTarget.getAttribute("data-index"));me(Ee)},yn=Ye=>St=>{var Rt;(Rt=Ye.onMouseLeave)==null||Rt.call(Ye,St),me(-1)};return{active:G,axis:Tn,axisProps:kY,dragging:ve,focusedThumbIndex:tn,getHiddenInputProps:(Ye={})=>{var St;const Rt={onChange:Wn(Ye||{}),onFocus:Dn(Ye||{}),onBlur:ln(Ye||{})},Ee=Ge({},Ye,Rt);return Ge({tabIndex:J,"aria-labelledby":e,"aria-orientation":S,"aria-valuemax":D(l),"aria-valuemin":D(m),name:v,type:"range",min:t.min,max:t.max,step:t.step===null&&t.marks?"any":(St=t.step)!=null?St:void 0,disabled:r},Ee,{style:Ge({},iq,{direction:a?"rtl":"ltr",width:"100%",height:"100%"})})},getRootProps:Vt,getThumbProps:(Ye={})=>{const St={onMouseOver:cn(Ye||{}),onMouseLeave:yn(Ye||{})};return Ge({},Ye,St)},marks:Bt,open:se,range:et,rootRef:zn,trackLeap:Ur,trackOffset:Jn,values:st,getThumbStyle:Ye=>({pointerEvents:G!==-1&&G!==Ye?"none":void 0})}}function Y1(t,e){return Y1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},Y1(t,e)}function zY(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Y1(t,e)}const KA=Hi.createContext(null);function DY(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e2(t,e){var n=function(a){return e&&Pe.isValidElement(a)?e(a):a},r=Object.create(null);return t&&Pe.Children.map(t,function(i){return i}).forEach(function(i){r[i.key]=n(i)}),r}function OY(t,e){t=t||{},e=e||{};function n(E){return E in e?e[E]:t[E]}var r=Object.create(null),i=[];for(var a in t)a in e?i.length&&(r[a]=i,i=[]):i.push(a);var h,l={};for(var m in e){if(r[m])for(h=0;h<r[m].length;h++){var v=r[m][h];l[r[m][h]]=n(v)}l[m]=n(m)}for(h=0;h<i.length;h++)l[i[h]]=n(i[h]);return l}function Ec(t,e,n){return n[e]!=null?n[e]:t.props[e]}function FY(t,e){return e2(t.children,function(n){return Pe.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:Ec(n,"appear",t),enter:Ec(n,"enter",t),exit:Ec(n,"exit",t)})})}function BY(t,e,n){var r=e2(t.children),i=OY(e,r);return Object.keys(i).forEach(function(a){var h=i[a];if(Pe.isValidElement(h)){var l=a in e,m=a in r,v=e[a],E=Pe.isValidElement(v)&&!v.props.in;m&&(!l||E)?i[a]=Pe.cloneElement(h,{onExited:n.bind(null,h),in:!0,exit:Ec(h,"exit",t),enter:Ec(h,"enter",t)}):!m&&l&&!E?i[a]=Pe.cloneElement(h,{in:!1}):m&&l&&Pe.isValidElement(v)&&(i[a]=Pe.cloneElement(h,{onExited:n.bind(null,h),in:v.props.in,exit:Ec(h,"exit",t),enter:Ec(h,"enter",t)}))}}),i}var NY=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},UY={component:"div",childFactory:function(e){return e}},t2=function(t){zY(e,t);function e(r,i){var a;a=t.call(this,r,i)||this;var h=a.handleExited.bind(DY(a));return a.state={contextValue:{isMounting:!0},handleExited:h,firstRender:!0},a}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(i,a){var h=a.children,l=a.handleExited,m=a.firstRender;return{children:m?FY(i,l):BY(i,h,l),firstRender:!1}},n.handleExited=function(i,a){var h=e2(this.props.children);i.key in h||(i.props.onExited&&i.props.onExited(a),this.mounted&&this.setState(function(l){var m=Ge({},l.children);return delete m[i.key],{children:m}}))},n.render=function(){var i=this.props,a=i.component,h=i.childFactory,l=Nr(i,["component","childFactory"]),m=this.state.contextValue,v=NY(this.state.children).map(h);return delete l.appear,delete l.enter,delete l.exit,a===null?Hi.createElement(KA.Provider,{value:m},v):Hi.createElement(KA.Provider,{value:m},Hi.createElement(a,l,v))},e}(Hi.Component);t2.propTypes={};t2.defaultProps=UY;const VY=t2;function jY(t){const{className:e,classes:n,pulsate:r=!1,rippleX:i,rippleY:a,rippleSize:h,in:l,onExited:m,timeout:v}=t,[E,T]=Pe.useState(!1),S=ir(e,n.ripple,n.rippleVisible,r&&n.ripplePulsate),z={width:h,height:h,top:-(h/2)+a,left:-(h/2)+i},D=ir(n.child,E&&n.childLeaving,r&&n.childPulsate);return!l&&!E&&T(!0),Pe.useEffect(()=>{if(!l&&m!=null){const F=setTimeout(m,v);return()=>{clearTimeout(F)}}},[m,l,v]),vn.jsx("span",{className:S,style:z,children:vn.jsx("span",{className:D})})}const GY=Ol("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Xs=GY,$Y=["center","classes","className"];let H0=t=>t,JA,QA,eC,tC;const K1=550,WY=80,HY=jw(JA||(JA=H0`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),qY=jw(QA||(QA=H0`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),ZY=jw(eC||(eC=H0`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),XY=kr("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),YY=kr(jY,{name:"MuiTouchRipple",slot:"Ripple"})(tC||(tC=H0`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),Xs.rippleVisible,HY,K1,({theme:t})=>t.transitions.easing.easeInOut,Xs.ripplePulsate,({theme:t})=>t.transitions.duration.shorter,Xs.child,Xs.childLeaving,qY,K1,({theme:t})=>t.transitions.easing.easeInOut,Xs.childPulsate,ZY,({theme:t})=>t.transitions.easing.easeInOut),KY=Pe.forwardRef(function(e,n){const r=Oa({props:e,name:"MuiTouchRipple"}),{center:i=!1,classes:a={},className:h}=r,l=Nr(r,$Y),[m,v]=Pe.useState([]),E=Pe.useRef(0),T=Pe.useRef(null);Pe.useEffect(()=>{T.current&&(T.current(),T.current=null)},[m]);const S=Pe.useRef(!1),z=Pe.useRef(0),D=Pe.useRef(null),F=Pe.useRef(null);Pe.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]);const J=Pe.useCallback(ee=>{const{pulsate:se,rippleX:me,rippleY:ve,rippleSize:Me,cb:Be}=ee;v(ze=>[...ze,vn.jsx(YY,{classes:{ripple:ir(a.ripple,Xs.ripple),rippleVisible:ir(a.rippleVisible,Xs.rippleVisible),ripplePulsate:ir(a.ripplePulsate,Xs.ripplePulsate),child:ir(a.child,Xs.child),childLeaving:ir(a.childLeaving,Xs.childLeaving),childPulsate:ir(a.childPulsate,Xs.childPulsate)},timeout:K1,pulsate:se,rippleX:me,rippleY:ve,rippleSize:Me},E.current)]),E.current+=1,T.current=Be},[a]),U=Pe.useCallback((ee={},se={},me=()=>{})=>{const{pulsate:ve=!1,center:Me=i||se.pulsate,fakeElement:Be=!1}=se;if((ee==null?void 0:ee.type)==="mousedown"&&S.current){S.current=!1;return}(ee==null?void 0:ee.type)==="touchstart"&&(S.current=!0);const ze=Be?null:F.current,Oe=ze?ze.getBoundingClientRect():{width:0,height:0,left:0,top:0};let tt,et,st;if(Me||ee===void 0||ee.clientX===0&&ee.clientY===0||!ee.clientX&&!ee.touches)tt=Math.round(Oe.width/2),et=Math.round(Oe.height/2);else{const{clientX:Bt,clientY:Je}=ee.touches&&ee.touches.length>0?ee.touches[0]:ee;tt=Math.round(Bt-Oe.left),et=Math.round(Je-Oe.top)}if(Me)st=Math.sqrt((2*Oe.width**2+Oe.height**2)/3),st%2===0&&(st+=1);else{const Bt=Math.max(Math.abs((ze?ze.clientWidth:0)-tt),tt)*2+2,Je=Math.max(Math.abs((ze?ze.clientHeight:0)-et),et)*2+2;st=Math.sqrt(Bt**2+Je**2)}ee!=null&&ee.touches?D.current===null&&(D.current=()=>{J({pulsate:ve,rippleX:tt,rippleY:et,rippleSize:st,cb:me})},z.current=setTimeout(()=>{D.current&&(D.current(),D.current=null)},WY)):J({pulsate:ve,rippleX:tt,rippleY:et,rippleSize:st,cb:me})},[i,J]),V=Pe.useCallback(()=>{U({},{pulsate:!0})},[U]),G=Pe.useCallback((ee,se)=>{if(clearTimeout(z.current),(ee==null?void 0:ee.type)==="touchend"&&D.current){D.current(),D.current=null,z.current=setTimeout(()=>{G(ee,se)});return}D.current=null,v(me=>me.length>0?me.slice(1):me),T.current=se},[]);return Pe.useImperativeHandle(n,()=>({pulsate:V,start:U,stop:G}),[V,U,G]),vn.jsx(XY,Ge({className:ir(Xs.root,a.root,h),ref:F},l,{children:vn.jsx(VY,{component:null,exit:!0,children:m})}))}),JY=KY;function QY(t){return ea("MuiButtonBase",t)}const eK=Ol("MuiButtonBase",["root","disabled","focusVisible"]),tK=eK,nK=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],rK=t=>{const{disabled:e,focusVisible:n,focusVisibleClassName:r,classes:i}=t,h=Da({root:["root",e&&"disabled",n&&"focusVisible"]},QY,i);return n&&r&&(h.root+=` ${r}`),h},iK=kr("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(t,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${tK.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),sK=Pe.forwardRef(function(e,n){const r=Oa({props:e,name:"MuiButtonBase"}),{action:i,centerRipple:a=!1,children:h,className:l,component:m="button",disabled:v=!1,disableRipple:E=!1,disableTouchRipple:T=!1,focusRipple:S=!1,LinkComponent:z="a",onBlur:D,onClick:F,onContextMenu:J,onDragLeave:U,onFocus:V,onFocusVisible:G,onKeyDown:ee,onKeyUp:se,onMouseDown:me,onMouseLeave:ve,onMouseUp:Me,onTouchEnd:Be,onTouchMove:ze,onTouchStart:Oe,tabIndex:tt=0,TouchRippleProps:et,touchRippleRef:st,type:Bt}=r,Je=Nr(r,nK),en=Pe.useRef(null),We=Pe.useRef(null),Qe=Yf(We,st),{isFocusVisibleRef:Tt,onFocus:tn,onBlur:Xt,ref:An}=qL(),[xn,zn]=Pe.useState(!1);v&&xn&&zn(!1),Pe.useImperativeHandle(i,()=>({focusVisible:()=>{zn(!0),en.current.focus()}}),[]);const[Dn,ln]=Pe.useState(!1);Pe.useEffect(()=>{ln(!0)},[]);const Wn=Dn&&!E&&!v;Pe.useEffect(()=>{xn&&S&&!E&&Dn&&We.current.pulsate()},[E,S,xn,Dn]);function zt(Re,On,Ut=T){return wc(xt=>(On&&On(xt),!Ut&&We.current&&We.current[Re](xt),!0))}const Tn=zt("start",me),Lr=zt("stop",J),Hn=zt("stop",U),pn=zt("stop",Me),un=zt("stop",Re=>{xn&&Re.preventDefault(),ve&&ve(Re)}),Jt=zt("start",Oe),Un=zt("stop",Be),Jn=zt("stop",ze),Ur=zt("stop",Re=>{Xt(Re),Tt.current===!1&&zn(!1),D&&D(Re)},!1),Vt=wc(Re=>{en.current||(en.current=Re.currentTarget),tn(Re),Tt.current===!0&&(zn(!0),G&&G(Re)),V&&V(Re)}),cn=()=>{const Re=en.current;return m&&m!=="button"&&!(Re.tagName==="A"&&Re.href)},yn=Pe.useRef(!1),ui=wc(Re=>{S&&!yn.current&&xn&&We.current&&Re.key===" "&&(yn.current=!0,We.current.stop(Re,()=>{We.current.start(Re)})),Re.target===Re.currentTarget&&cn()&&Re.key===" "&&Re.preventDefault(),ee&&ee(Re),Re.target===Re.currentTarget&&cn()&&Re.key==="Enter"&&!v&&(Re.preventDefault(),F&&F(Re))}),Ki=wc(Re=>{S&&Re.key===" "&&We.current&&xn&&!Re.defaultPrevented&&(yn.current=!1,We.current.stop(Re,()=>{We.current.pulsate(Re)})),se&&se(Re),F&&Re.target===Re.currentTarget&&cn()&&Re.key===" "&&!Re.defaultPrevented&&F(Re)});let Rr=m;Rr==="button"&&(Je.href||Je.to)&&(Rr=z);const Ye={};Rr==="button"?(Ye.type=Bt===void 0?"button":Bt,Ye.disabled=v):(!Je.href&&!Je.to&&(Ye.role="button"),v&&(Ye["aria-disabled"]=v));const St=Yf(n,An,en),Rt=Ge({},r,{centerRipple:a,component:m,disabled:v,disableRipple:E,disableTouchRipple:T,focusRipple:S,tabIndex:tt,focusVisible:xn}),Ee=rK(Rt);return vn.jsxs(iK,Ge({as:Rr,className:ir(Ee.root,l),ownerState:Rt,onBlur:Ur,onClick:F,onContextMenu:Lr,onFocus:Vt,onKeyDown:ui,onKeyUp:Ki,onMouseDown:Tn,onMouseLeave:un,onMouseUp:pn,onDragLeave:Hn,onTouchEnd:Un,onTouchMove:Jn,onTouchStart:Jt,ref:St,tabIndex:v?-1:tt,type:Bt},Ye,Je,{children:[h,Wn?vn.jsx(JY,Ge({ref:Qe,center:a},et)):null]}))}),oK=sK;function aK(t){return ea("MuiTypography",t)}Ol("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const lK=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],cK=t=>{const{align:e,gutterBottom:n,noWrap:r,paragraph:i,variant:a,classes:h}=t,l={root:["root",a,t.align!=="inherit"&&`align${Kn(e)}`,n&&"gutterBottom",r&&"noWrap",i&&"paragraph"]};return Da(l,aK,h)},uK=kr("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.variant&&e[n.variant],n.align!=="inherit"&&e[`align${Kn(n.align)}`],n.noWrap&&e.noWrap,n.gutterBottom&&e.gutterBottom,n.paragraph&&e.paragraph]}})(({theme:t,ownerState:e})=>Ge({margin:0},e.variant&&t.typography[e.variant],e.align!=="inherit"&&{textAlign:e.align},e.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},e.gutterBottom&&{marginBottom:"0.35em"},e.paragraph&&{marginBottom:16})),nC={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},hK={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},dK=t=>hK[t]||t,fK=Pe.forwardRef(function(e,n){const r=Oa({props:e,name:"MuiTypography"}),i=dK(r.color),a=v3(Ge({},r,{color:i})),{align:h="inherit",className:l,component:m,gutterBottom:v=!1,noWrap:E=!1,paragraph:T=!1,variant:S="body1",variantMapping:z=nC}=a,D=Nr(a,lK),F=Ge({},a,{align:h,color:i,className:l,component:m,gutterBottom:v,noWrap:E,paragraph:T,variant:S,variantMapping:z}),J=m||(T?"p":z[S]||nC[S])||"span",U=cK(F);return vn.jsx(uK,Ge({as:J,ref:n,ownerState:F,className:ir(U.root,l)},D))}),rC=fK;function P3({props:t,states:e,muiFormControl:n}){return e.reduce((r,i)=>(r[i]=t[i],n&&typeof t[i]>"u"&&(r[i]=n[i]),r),{})}const pK=Pe.createContext(void 0),mK=pK;function n2(){return Pe.useContext(mK)}function gK(t){return ea("PrivateSwitchBase",t)}Ol("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const yK=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],_K=t=>{const{classes:e,checked:n,disabled:r,edge:i}=t,a={root:["root",n&&"checked",r&&"disabled",i&&`edge${Kn(i)}`],input:["input"]};return Da(a,gK,e)},vK=kr(oK)(({ownerState:t})=>Ge({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),xK=kr("input")({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),bK=Pe.forwardRef(function(e,n){const{autoFocus:r,checked:i,checkedIcon:a,className:h,defaultChecked:l,disabled:m,disableFocusRipple:v=!1,edge:E=!1,icon:T,id:S,inputProps:z,inputRef:D,name:F,onBlur:J,onChange:U,onFocus:V,readOnly:G,required:ee=!1,tabIndex:se,type:me,value:ve}=e,Me=Nr(e,yK),[Be,ze]=HL({controlled:i,default:!!l,name:"SwitchBase",state:"checked"}),Oe=n2(),tt=Qe=>{V&&V(Qe),Oe&&Oe.onFocus&&Oe.onFocus(Qe)},et=Qe=>{J&&J(Qe),Oe&&Oe.onBlur&&Oe.onBlur(Qe)},st=Qe=>{if(Qe.nativeEvent.defaultPrevented)return;const Tt=Qe.target.checked;ze(Tt),U&&U(Qe,Tt)};let Bt=m;Oe&&typeof Bt>"u"&&(Bt=Oe.disabled);const Je=me==="checkbox"||me==="radio",en=Ge({},e,{checked:Be,disabled:Bt,disableFocusRipple:v,edge:E}),We=_K(en);return vn.jsxs(vK,Ge({component:"span",className:ir(We.root,h),centerRipple:!0,focusRipple:!v,disabled:Bt,tabIndex:null,role:void 0,onFocus:tt,onBlur:et,ownerState:en,ref:n},Me,{children:[vn.jsx(xK,Ge({autoFocus:r,checked:i,defaultChecked:l,className:We.input,disabled:Bt,id:Je?S:void 0,name:F,onChange:st,readOnly:G,ref:D,required:ee,ownerState:en,tabIndex:se,type:me},me==="checkbox"&&ve===void 0?{}:{value:ve},z)),Be?a:T]}))}),wK=bK,EK=OX({createStyledComponent:kr("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`maxWidth${Kn(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),useThemeProps:t=>Oa({props:t,name:"MuiContainer"})}),TK=EK,SK=$X({createStyledComponent:kr("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,e)=>e.root}),useThemeProps:t=>Oa({props:t,name:"MuiStack"})}),A3=SK;function PK(t){return ea("MuiFormControlLabel",t)}const AK=Ol("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),nf=AK,CK=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],IK=t=>{const{classes:e,disabled:n,labelPlacement:r,error:i,required:a}=t,h={root:["root",n&&"disabled",`labelPlacement${Kn(r)}`,i&&"error",a&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",i&&"error"]};return Da(h,PK,e)},MK=kr("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[{[`& .${nf.label}`]:e.label},e.root,e[`labelPlacement${Kn(n.labelPlacement)}`]]}})(({theme:t,ownerState:e})=>Ge({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${nf.disabled}`]:{cursor:"default"}},e.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},e.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},e.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${nf.label}`]:{[`&.${nf.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),kK=kr("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(({theme:t})=>({[`&.${nf.error}`]:{color:(t.vars||t).palette.error.main}})),LK=Pe.forwardRef(function(e,n){var r,i;const a=Oa({props:e,name:"MuiFormControlLabel"}),{className:h,componentsProps:l={},control:m,disabled:v,disableTypography:E,label:T,labelPlacement:S="end",required:z,slotProps:D={}}=a,F=Nr(a,CK),J=n2(),U=(r=v??m.props.disabled)!=null?r:J==null?void 0:J.disabled,V=z??m.props.required,G={disabled:U,required:V};["checked","name","onChange","value","inputRef"].forEach(Be=>{typeof m.props[Be]>"u"&&typeof a[Be]<"u"&&(G[Be]=a[Be])});const ee=P3({props:a,muiFormControl:J,states:["error"]}),se=Ge({},a,{disabled:U,labelPlacement:S,required:V,error:ee.error}),me=IK(se),ve=(i=D.typography)!=null?i:l.typography;let Me=T;return Me!=null&&Me.type!==rC&&!E&&(Me=vn.jsx(rC,Ge({component:"span"},ve,{className:ir(me.label,ve==null?void 0:ve.className),children:Me}))),vn.jsxs(MK,Ge({className:ir(me.root,h),ownerState:se,ref:n},F,{children:[Pe.cloneElement(m,G),V?vn.jsxs(A3,{direction:"row",alignItems:"center",children:[Me,vn.jsxs(kK,{ownerState:se,"aria-hidden":!0,className:me.asterisk,children:[" ","*"]})]}):Me]}))}),RK=LK;function zK(t){return ea("MuiFormGroup",t)}Ol("MuiFormGroup",["root","row","error"]);const DK=["className","row"],OK=t=>{const{classes:e,row:n,error:r}=t;return Da({root:["root",n&&"row",r&&"error"]},zK,e)},FK=kr("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.row&&e.row]}})(({ownerState:t})=>Ge({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),BK=Pe.forwardRef(function(e,n){const r=Oa({props:e,name:"MuiFormGroup"}),{className:i,row:a=!1}=r,h=Nr(r,DK),l=n2(),m=P3({props:r,muiFormControl:l,states:["error"]}),v=Ge({},r,{row:a,error:m.error}),E=OK(v);return vn.jsx(FK,Ge({className:ir(E.root,i),ownerState:v,ref:n},h))}),NK=BK,UK=t=>!t||!vf(t),VK=UK;function jK(t){return ea("MuiSlider",t)}const GK=Ol("MuiSlider",["root","active","colorPrimary","colorSecondary","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),vo=GK,$K=t=>{const{open:e}=t;return{offset:ir(e&&vo.valueLabelOpen),circle:vo.valueLabelCircle,label:vo.valueLabelLabel}};function WK(t){const{children:e,className:n,value:r}=t,i=$K(t);return e?Pe.cloneElement(e,{className:ir(e.props.className)},vn.jsxs(Pe.Fragment,{children:[e.props.children,vn.jsx("span",{className:ir(i.offset,n),"aria-hidden":!0,children:vn.jsx("span",{className:i.circle,children:vn.jsx("span",{className:i.label,children:r})})})]})):null}const HK=["aria-label","aria-valuetext","aria-labelledby","component","components","componentsProps","color","classes","className","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","orientation","size","step","scale","slotProps","slots","tabIndex","track","value","valueLabelDisplay","valueLabelFormat"];function iC(t){return t}const qK=kr("span",{name:"MuiSlider",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`color${Kn(n.color)}`],n.size!=="medium"&&e[`size${Kn(n.size)}`],n.marked&&e.marked,n.orientation==="vertical"&&e.vertical,n.track==="inverted"&&e.trackInverted,n.track===!1&&e.trackFalse]}})(({theme:t,ownerState:e})=>Ge({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:(t.vars||t).palette[e.color].main,WebkitTapHighlightColor:"transparent"},e.orientation==="horizontal"&&Ge({height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}},e.size==="small"&&{height:2},e.marked&&{marginBottom:20}),e.orientation==="vertical"&&Ge({height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}},e.size==="small"&&{width:2},e.marked&&{marginRight:44}),{"@media print":{colorAdjust:"exact"},[`&.${vo.disabled}`]:{pointerEvents:"none",cursor:"default",color:(t.vars||t).palette.grey[400]},[`&.${vo.dragging}`]:{[`& .${vo.thumb}, & .${vo.track}`]:{transition:"none"}}})),ZK=kr("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(t,e)=>e.rail})(({ownerState:t})=>Ge({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38},t.orientation==="horizontal"&&{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"},t.orientation==="vertical"&&{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"},t.track==="inverted"&&{opacity:1})),XK=kr("span",{name:"MuiSlider",slot:"Track",overridesResolver:(t,e)=>e.track})(({theme:t,ownerState:e})=>{const n=t.palette.mode==="light"?Jw(t.palette[e.color].main,.62):Kw(t.palette[e.color].main,.5);return Ge({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:t.transitions.create(["left","width","bottom","height"],{duration:t.transitions.duration.shortest})},e.size==="small"&&{border:"none"},e.orientation==="horizontal"&&{height:"inherit",top:"50%",transform:"translateY(-50%)"},e.orientation==="vertical"&&{width:"inherit",left:"50%",transform:"translateX(-50%)"},e.track===!1&&{display:"none"},e.track==="inverted"&&{backgroundColor:t.vars?t.vars.palette.Slider[`${e.color}Track`]:n,borderColor:t.vars?t.vars.palette.Slider[`${e.color}Track`]:n})}),YK=kr("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.thumb,e[`thumbColor${Kn(n.color)}`],n.size!=="medium"&&e[`thumbSize${Kn(n.size)}`]]}})(({theme:t,ownerState:e})=>Ge({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:t.transitions.create(["box-shadow","left","bottom"],{duration:t.transitions.duration.shortest})},e.size==="small"&&{width:12,height:12},e.orientation==="horizontal"&&{top:"50%",transform:"translate(-50%, -50%)"},e.orientation==="vertical"&&{left:"50%",transform:"translate(-50%, 50%)"},{"&:before":Ge({position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(t.vars||t).shadows[2]},e.size==="small"&&{boxShadow:"none"}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&:hover, &.${vo.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / 0.16)`:jy(t.palette[e.color].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${vo.active}`]:{boxShadow:`0px 0px 0px 14px ${t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / 0.16)`:jy(t.palette[e.color].main,.16)}`},[`&.${vo.disabled}`]:{"&:hover":{boxShadow:"none"}}})),KK=kr(WK,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(t,e)=>e.valueLabel})(({theme:t,ownerState:e})=>Ge({[`&.${vo.valueLabelOpen}`]:{transform:`${e.orientation==="vertical"?"translateY(-50%)":"translateY(-100%)"} scale(1)`},zIndex:1,whiteSpace:"nowrap"},t.typography.body2,{fontWeight:500,transition:t.transitions.create(["transform"],{duration:t.transitions.duration.shortest}),transform:`${e.orientation==="vertical"?"translateY(-50%)":"translateY(-100%)"} scale(0)`,position:"absolute",backgroundColor:(t.vars||t).palette.grey[600],borderRadius:2,color:(t.vars||t).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem"},e.orientation==="horizontal"&&{top:"-10px",transformOrigin:"bottom center","&:before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"}},e.orientation==="vertical"&&{right:e.size==="small"?"20px":"30px",top:"50%",transformOrigin:"right center","&:before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"}},e.size==="small"&&{fontSize:t.typography.pxToRem(12),padding:"0.25rem 0.5rem"})),JK=kr("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:t=>T3(t)&&t!=="markActive",overridesResolver:(t,e)=>{const{markActive:n}=t;return[e.mark,n&&e.markActive]}})(({theme:t,ownerState:e,markActive:n})=>Ge({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},e.orientation==="horizontal"&&{top:"50%",transform:"translate(-1px, -50%)"},e.orientation==="vertical"&&{left:"50%",transform:"translate(-50%, 1px)"},n&&{backgroundColor:(t.vars||t).palette.background.paper,opacity:.8})),QK=kr("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:t=>T3(t)&&t!=="markLabelActive",overridesResolver:(t,e)=>e.markLabel})(({theme:t,ownerState:e,markLabelActive:n})=>Ge({},t.typography.body2,{color:(t.vars||t).palette.text.secondary,position:"absolute",whiteSpace:"nowrap"},e.orientation==="horizontal"&&{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}},e.orientation==="vertical"&&{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}},n&&{color:(t.vars||t).palette.text.primary})),eJ=t=>{const{disabled:e,dragging:n,marked:r,orientation:i,track:a,classes:h,color:l,size:m}=t,v={root:["root",e&&"disabled",n&&"dragging",r&&"marked",i==="vertical"&&"vertical",a==="inverted"&&"trackInverted",a===!1&&"trackFalse",l&&`color${Kn(l)}`,m&&`size${Kn(m)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",e&&"disabled",m&&`thumbSize${Kn(m)}`,l&&`thumbColor${Kn(l)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return Da(v,jK,h)},tJ=({children:t})=>t,nJ=Pe.forwardRef(function(e,n){var r,i,a,h,l,m,v,E,T,S,z,D,F,J,U,V,G,ee,se,me,ve,Me,Be,ze;const Oe=Oa({props:e,name:"MuiSlider"}),et=_Y().direction==="rtl",{"aria-label":st,"aria-valuetext":Bt,"aria-labelledby":Je,component:en="span",components:We={},componentsProps:Qe={},color:Tt="primary",classes:tn,className:Xt,disableSwap:An=!1,disabled:xn=!1,getAriaLabel:zn,getAriaValueText:Dn,marks:ln=!1,max:Wn=100,min:zt=0,orientation:Tn="horizontal",size:Lr="medium",step:Hn=1,scale:pn=iC,slotProps:un,slots:Jt,track:Un="normal",valueLabelDisplay:Jn="off",valueLabelFormat:Ur=iC}=Oe,Vt=Nr(Oe,HK),cn=Ge({},Oe,{isRtl:et,max:Wn,min:zt,classes:tn,disabled:xn,disableSwap:An,orientation:Tn,marks:ln,color:Tt,size:Lr,step:Hn,scale:pn,track:Un,valueLabelDisplay:Jn,valueLabelFormat:Ur}),{axisProps:yn,getRootProps:ui,getHiddenInputProps:Ki,getThumbProps:Rr,open:Ye,active:St,axis:Rt,focusedThumbIndex:Ee,range:Re,dragging:On,marks:Ut,values:xt,trackOffset:rn,trackLeap:Vn,getThumbStyle:yr}=RY(Ge({},cn,{rootRef:n}));cn.marked=Ut.length>0&&Ut.some(fe=>fe.label),cn.dragging=On,cn.focusedThumbIndex=Ee;const Qn=eJ(cn),Ze=(r=(i=Jt==null?void 0:Jt.root)!=null?i:We.Root)!=null?r:qK,Ft=(a=(h=Jt==null?void 0:Jt.rail)!=null?h:We.Rail)!=null?a:ZK,Ot=(l=(m=Jt==null?void 0:Jt.track)!=null?m:We.Track)!=null?l:XK,hr=(v=(E=Jt==null?void 0:Jt.thumb)!=null?E:We.Thumb)!=null?v:YK,vi=(T=(S=Jt==null?void 0:Jt.valueLabel)!=null?S:We.ValueLabel)!=null?T:KK,kt=(z=(D=Jt==null?void 0:Jt.mark)!=null?D:We.Mark)!=null?z:JK,Zr=(F=(J=Jt==null?void 0:Jt.markLabel)!=null?J:We.MarkLabel)!=null?F:QK,or=(U=(V=Jt==null?void 0:Jt.input)!=null?V:We.Input)!=null?U:"input",Ji=(G=un==null?void 0:un.root)!=null?G:Qe.root,er=(ee=un==null?void 0:un.rail)!=null?ee:Qe.rail,dr=(se=un==null?void 0:un.track)!=null?se:Qe.track,sn=(me=un==null?void 0:un.thumb)!=null?me:Qe.thumb,Qi=(ve=un==null?void 0:un.valueLabel)!=null?ve:Qe.valueLabel,xi=(Me=un==null?void 0:un.mark)!=null?Me:Qe.mark,bi=(Be=un==null?void 0:un.markLabel)!=null?Be:Qe.markLabel,fs=(ze=un==null?void 0:un.input)!=null?ze:Qe.input,Ns=cl({elementType:Ze,getSlotProps:ui,externalSlotProps:Ji,externalForwardedProps:Vt,additionalProps:Ge({},VK(Ze)&&{as:en}),ownerState:Ge({},cn,Ji==null?void 0:Ji.ownerState),className:[Qn.root,Xt]}),es=cl({elementType:Ft,externalSlotProps:er,ownerState:cn,className:Qn.rail}),te=cl({elementType:Ot,externalSlotProps:dr,additionalProps:{style:Ge({},yn[Rt].offset(rn),yn[Rt].leap(Vn))},ownerState:Ge({},cn,dr==null?void 0:dr.ownerState),className:Qn.track}),R=cl({elementType:hr,getSlotProps:Rr,externalSlotProps:sn,ownerState:Ge({},cn,sn==null?void 0:sn.ownerState),className:Qn.thumb}),j=cl({elementType:vi,externalSlotProps:Qi,ownerState:Ge({},cn,Qi==null?void 0:Qi.ownerState),className:Qn.valueLabel}),K=cl({elementType:kt,externalSlotProps:xi,ownerState:cn,className:Qn.mark}),Q=cl({elementType:Zr,externalSlotProps:bi,ownerState:cn,className:Qn.markLabel}),he=cl({elementType:or,getSlotProps:Ki,externalSlotProps:fs,ownerState:cn});return vn.jsxs(Ze,Ge({},Ns,{children:[vn.jsx(Ft,Ge({},es)),vn.jsx(Ot,Ge({},te)),Ut.filter(fe=>fe.value>=zt&&fe.value<=Wn).map((fe,ue)=>{const ce=Gy(fe.value,zt,Wn),ye=yn[Rt].offset(ce);let Ae;return Un===!1?Ae=xt.indexOf(fe.value)!==-1:Ae=Un==="normal"&&(Re?fe.value>=xt[0]&&fe.value<=xt[xt.length-1]:fe.value<=xt[0])||Un==="inverted"&&(Re?fe.value<=xt[0]||fe.value>=xt[xt.length-1]:fe.value>=xt[0]),vn.jsxs(Pe.Fragment,{children:[vn.jsx(kt,Ge({"data-index":ue},K,!vf(kt)&&{markActive:Ae},{style:Ge({},ye,K.style),className:ir(K.className,Ae&&Qn.markActive)})),fe.label!=null?vn.jsx(Zr,Ge({"aria-hidden":!0,"data-index":ue},Q,!vf(Zr)&&{markLabelActive:Ae},{style:Ge({},ye,Q.style),className:ir(Qn.markLabel,Q.className,Ae&&Qn.markLabelActive),children:fe.label})):null]},ue)}),xt.map((fe,ue)=>{const ce=Gy(fe,zt,Wn),ye=yn[Rt].offset(ce),Ae=Jn==="off"?tJ:vi;return vn.jsx(Ae,Ge({},!vf(Ae)&&{valueLabelFormat:Ur,valueLabelDisplay:Jn,value:typeof Ur=="function"?Ur(pn(fe),ue):Ur,index:ue,open:Ye===ue||St===ue||Jn==="on",disabled:xn},j,{children:vn.jsx(hr,Ge({"data-index":ue},R,{className:ir(Qn.thumb,R.className,St===ue&&Qn.active,Ee===ue&&Qn.focusVisible),style:Ge({},ye,yr(ue),R.style),children:vn.jsx(or,Ge({"data-index":ue,"aria-label":zn?zn(ue):st,"aria-valuenow":pn(fe),"aria-labelledby":Je,"aria-valuetext":Dn?Dn(pn(fe),ue):Bt,value:xt[ue]},he))}))}),ue)})]}))}),rJ=nJ;function iJ(t){return ea("MuiSwitch",t)}const sJ=Ol("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),$i=sJ,oJ=["className","color","edge","size","sx"],aJ=t=>{const{classes:e,edge:n,size:r,color:i,checked:a,disabled:h}=t,l={root:["root",n&&`edge${Kn(n)}`,`size${Kn(r)}`],switchBase:["switchBase",`color${Kn(i)}`,a&&"checked",h&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},m=Da(l,iJ,e);return Ge({},e,m)},lJ=kr("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.edge&&e[`edge${Kn(n.edge)}`],e[`size${Kn(n.size)}`]]}})(({ownerState:t})=>Ge({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${$i.thumb}`]:{width:16,height:16},[`& .${$i.switchBase}`]:{padding:4,[`&.${$i.checked}`]:{transform:"translateX(16px)"}}})),cJ=kr(wK,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.switchBase,{[`& .${$i.input}`]:e.input},n.color!=="default"&&e[`color${Kn(n.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${$i.checked}`]:{transform:"translateX(20px)"},[`&.${$i.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${$i.checked} + .${$i.track}`]:{opacity:.5},[`&.${$i.disabled} + .${$i.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${$i.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:e})=>Ge({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:jy(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},e.color!=="default"&&{[`&.${$i.checked}`]:{color:(t.vars||t).palette[e.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:jy(t.palette[e.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${$i.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${e.color}DisabledColor`]:`${t.palette.mode==="light"?Jw(t.palette[e.color].main,.62):Kw(t.palette[e.color].main,.55)}`}},[`&.${$i.checked} + .${$i.track}`]:{backgroundColor:(t.vars||t).palette[e.color].main}})),uJ=kr("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,e)=>e.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),hJ=kr("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,e)=>e.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),dJ=Pe.forwardRef(function(e,n){const r=Oa({props:e,name:"MuiSwitch"}),{className:i,color:a="primary",edge:h=!1,size:l="medium",sx:m}=r,v=Nr(r,oJ),E=Ge({},r,{color:a,edge:h,size:l}),T=aJ(E),S=vn.jsx(hJ,{className:T.thumb,ownerState:E});return vn.jsxs(lJ,{className:ir(T.root,i),sx:m,ownerState:E,children:[vn.jsx(cJ,Ge({type:"checkbox",icon:S,checkedIcon:S,ref:n,ownerState:E},v,{classes:Ge({},T,{root:T.switchBase})})),vn.jsx(uJ,{className:T.track,ownerState:E})]})}),fJ=dJ;const pJ="https://raw.githubusercontent.com/jPeach-Stantec/flow-map-test/main/test-msoa.json",mJ="https://raw.githubusercontent.com/jPeach-Stantec/flow-map-test/main/test-msoa.csv";async function gJ(t){const e=(await fetch(t)).json(),n=pH(mJ).then(r=>AW(r,i=>i.ReturnName));return Promise.all([e,n]).then(([r,i])=>{const a=fW(r,r.objects["test-msoa"]),h=Object.keys(i.get(i.keys().next().value)).slice(1);return a.features.forEach(l=>{const m=i.get(l.properties.msoa11nm);h.forEach(v=>{v!=="ReturnName"&&(l.properties[v]=m?+m[v]:0)})}),[a,h]})}kL().domain([-.6,-.45,-.3,-.15,0,.15,.3,.45,.6,.75,.9,1.05,1.2]).range([[65,182,196],[127,205,187],[199,233,180],[237,248,177],[255,255,204],[255,237,160],[254,217,118],[254,178,76],[253,141,60],[252,78,42],[227,26,28],[189,0,38],[128,0,38]]);const yJ={latitude:53,longitude:-.5,zoom:6,maxZoom:16,pitch:45,bearing:0},_J="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",vJ=new Ak({color:[255,255,255],intensity:1}),xJ=new Ej({timestamp:Date.UTC(2019,7,1,8),color:[255,255,255],intensity:1,_shadow:!0}),bJ=[[[1.76294,49.864679],[1.76294,59.3922591],[-7.6607354,59.3922591],[-7.6607354,49.864679]]],wJ=t=>[t.r,t.g,t.b];function EJ(t,e,n){if(!t)return null;const r=bW(DW([...t.features.map(h=>{const{msoa11nm:l,...m}=h.properties;return Math.max(...Object.values(m))}),...t.features.map(h=>{const{msoa11nm:l,...m}=h.properties;return Math.min(...Object.values(m))})],h=>h!==0));console.log(r);const i=jL().domain(r).range([0,1e5]),a=GL().domain(r).interpolator(NH);return[new Aw({id:"ground",data:bJ,stroked:!1,getPolygon:h=>h,getFillColor:[0,0,0,0]}),new kw({id:"geojson",data:t,opacity:.8,stroked:!1,filled:!0,extruded:!0,wireframe:!0,autoHighlight:!0,elevationScale:1,getLineColor:[255,255,255],highlightColor:[100,100,100,100],getLineWidth:1,pickable:!0,getElevation:h=>i(h.properties[e]),updateTriggers:{getElevation:e,getFillColor:e},getFillColor:h=>wJ(Ph(a(h.properties[e]))),transitions:{getElevation:{duration:300},getFillColor:{duration:300}}})]}function TJ({object:t,scenario:e}){return t&&{html:`  <div><b>Zone Totals</b></div>
  <div>Zone: ${t.properties.msoa11nm}</div>
  <div>Demand: ${t.properties[e]}</div>
  `}}function SJ({hasData:t=!1,mapStyle:e=_J}){const[n]=Pe.useState(()=>{const J=new _w({ambientLight:vJ,dirLight:xJ});return J.shadowColor=[0,0,0,.5],[J]}),[r,i]=Pe.useState(t),[a,h]=Pe.useState([]),[l,m]=Pe.useState(!0),[v,E]=Pe.useState("Core"),T=Pe.useRef(!0);Pe.useEffect(()=>{gJ(pJ).then(([J,U])=>{i(J),h(U),E(U[0])}),T.current=!1},[]);const S=(J,U)=>{console.log("Updated"),l&&m(!1),E(a[U])},z=J=>{m(J)};l&&!T.current&&setTimeout(()=>{console.log("timer");const J=(a.indexOf(v)+1)%a.length;E(a[J])},3e3);const D=EJ(r,v),F=a.map((J,U)=>({value:U,label:J}));return console.log(a.indexOf(v)),Hi.createElement(TK,null,Hi.createElement(A3,{direction:"row",spacing:8},Hi.createElement(NK,{sx:{zIndex:1e3,backgroundColor:"white",paddingRight:"10px",borderRadius:"5px"}},Hi.createElement(RK,{labelPlacement:"start",control:Hi.createElement(fJ,{checked:l,onChange:J=>z(J.target.checked)}),label:"Auto-Update"})),Hi.createElement(rJ,{"aria-label":"scenario-select",value:a.indexOf(v),step:1,marks:F,onChange:(J,U)=>S(J,U),min:0,max:a.length-1,sx:{zIndex:1e3}})),Hi.createElement(yG,{layers:D||null,effects:n,initialViewState:yJ,controller:!0,getTooltip:J=>TJ({...J,scenario:v})},Hi.createElement(aD,{reuseMaps:!0,mapLib:cD,mapStyle:e,preventStyleDiffing:!0})))}function PJ(t){yM(t).render(Hi.createElement(SJ,null))}PJ(document.getElementById("app"));
